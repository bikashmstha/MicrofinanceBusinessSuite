/*
 * File: app/view/DistrictAreas.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.DistrictAreas', {
    extend: 'Ext.window.Window',

    height: 400,
    id: 'DistrictAreas',
    itemId: 'DistrictAreas',
    width: 700,
    layout: {
        type: 'fit'
    },
    title: 'क्षत्र',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'gridpanel',
                    cls: 'grid-row-span',
                    height: 400,
                    itemId: 'bud_reg_DistrictAreas',
                    title: 'My Grid Panel',
                    store: 'DistrictAreaStore',
                    viewConfig: {

                    },
                    selModel: Ext.create('Ext.selection.CellModel', {
                        listeners: {
                            select: {
                                fn: me.onCellselectionmodelSelect,
                                scope: me
                            }
                        }
                    }),
                    columns: [
                        {
                            xtype: 'rownumberer',
                            width: 35,
                            text: 'सि.नं. '
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                //if(rowIndex>0)

                                var first = !rowIndex || value !== store.getAt(rowIndex - 1).get('Office');
                                var   last = rowIndex >= store.getCount() - 1 || value !== store.getAt(rowIndex + 1).get('Office');

                                // meta.css += 'row-span' + (first ? ' row-span-first' : '') +  (last ? ' row-span-last' : '');

                                if (first) 
                                {
                                    var i = rowIndex + 1;
                                    while (i < store.getCount() && value === store.getAt(i).get('Office')) 
                                    {
                                        i++;
                                    }

                                    var rowHeight = 20, padding = 6;
                                    var height = (rowHeight * (i - rowIndex) - padding) + 'px';
                                    // meta.attr = 'style="height:' + height + ';line-height:' + height + ';"';
                                }
                                return first ? value : '';
                            },
                            dataIndex: 'Office',
                            text: 'अन्तरिक राजस्व कार्यालय'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'IRDCode',
                            text: 'कार्यालय कोड नं.'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                var n=value.split(",");
                                return "<span style='color: blue;font-weight: bold;text-decoration: underline;cursor: pointer;'>"+n[n.length-1].trim()+"</span>";
                            },
                            dataIndex: 'OfficeNameEnglish',
                            text: 'करदाता सेवा कार्यालाय'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'AreaDesc',
                            text: 'कार्यक्षेत्र'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'AreaNo',
                            text: 'AreaNo'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onCellselectionmodelSelect: function(cellmodel, record, row, column, options) {
        if(column==3)
        {
            Ext.Msg.confirm('Confirm', 'Is this Correct area?',

            function (btn){
                if(btn=='yes')  
                {
                    var target=Ext.getCmp('DistrictAreas').target;   

                    if(target)
                    {                               
                        target.setValue(record.data.AreaNo);
                        Ext.ComponentQuery.query('#DistrictAreas')[0].close();
                    }
                }

            }
            );   
        }
    }

});