/*
 * File: app/controller/DpCreateUserLogin.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.DpCreateUserLogin', {
    extend: 'Ext.app.Controller',

    models: [
        'AgencyList'
    ],
    stores: [
        'AgencyList'
    ],
    views: [
        'DpCreateUserLogin'
    ],

    onBtnDCULSaveClick: function(button, e, eOpts) {
        var me = this;

        var form = Ext.ComponentQuery.query("#frmCULform")[0].getForm();
        var txtUser = Ext.ComponentQuery.query("#txtDCULUser")[0];
        var txtPass = Ext.ComponentQuery.query("#txtDCULPass")[0];
        var chkNo = Ext.ComponentQuery.query("#chkDCULNo")[0];
        var chkYes = Ext.ComponentQuery.query("#chkDCULYes")[0];

        if(txtUser.getValue()==="")
        {
            msg("WARNING","Please enter the Username!");
            return false;
        }
        if(txtPass.getValue()==="")
        {
            msg("WARNING","Please enter the Password!");
            return false;
        }
        if(chkNo.getValue()===false&&chkYes.getValue()===false)
        {
            msg("WARNING","Please specify if the agency is Diplomat or not!");
            return false;
        }

        if(!form.isValid())
        {
            msg("WARNING","Please choose the Agency!");
            return false;
        }

        me.Save();
    },

    onBtnDCULCancelClick: function(button, e, eOpts) {
        var me = this;

        me.Clear();
    },

    onChkDCULYesChange: function(field, newValue, oldValue, eOpts) {
        var me = this;
        var chkNo = Ext.ComponentQuery.query("#chkDCULNo")[0];

        if(newValue===true)
        {
            chkNo.setValue(false);
        }
    },

    onChkDCULNoChange: function(field, newValue, oldValue, eOpts) {
        var me = this;

        var chkYes = Ext.ComponentQuery.query("#chkDCULYes")[0];

        if(newValue===true)
        {
            chkYes.setValue(false); 
        }
    },

    Show: function(user) {
        //var me = this;

        /*var pnlToRender = Ext.getCmp('cntARDisplay'); 
        var pnlDynamic = Ext.create('MyApp.view.DpCreateUserLogin');

        pnlToRender.removeAll();
        pnlToRender.add(pnlDynamic);*/

        /*var window = Ext.create('MyApp.view.DpCreateUserLogin');
        window.modal = true;
        window.show();*/

        var hdnuser = Ext.ComponentQuery.query("#hdnDCULuser")[0];
        hdnuser.setValue(user);

    },

    Clear: function() {
        var txtDCULUser = Ext.ComponentQuery.query("#txtDCULUser")[0];
        var txtDCULPass = Ext.ComponentQuery.query("#txtDCULPass")[0];
        var txtDCULMail = Ext.ComponentQuery.query("#txtDCULMail")[0];
        var cboDCULAgency = Ext.ComponentQuery.query("#cboDCULAgency")[0];

        var chkDCULYes = Ext.ComponentQuery.query("#chkDCULYes")[0];
        var chkDCULNo = Ext.ComponentQuery.query("#chkDCULNo")[0];

        txtDCULUser.setValue("");
        txtDCULPass.setValue("");
        txtDCULMail.setValue("");
        cboDCULAgency.setValue("");

        chkDCULYes.setValue(false);
        chkDCULNo.setValue(false);

        cboDCULAgency.clearInvalid();
    },

    Save: function() {
        var me = this;

        var txtDCULUser = Ext.ComponentQuery.query("#txtDCULUser")[0].getValue();
        var txtDCULPass = Ext.ComponentQuery.query("#txtDCULPass")[0].getValue();
        var txtDCULMail = Ext.ComponentQuery.query("#txtDCULMail")[0].getValue();
        var cboDCULAgency = Ext.ComponentQuery.query("#cboDCULAgency")[0].getValue();

        var chkDCULYes = Ext.ComponentQuery.query("#chkDCULYes")[0].getValue();
        var chkDCULNo = Ext.ComponentQuery.query("#chkDCULNo")[0].getValue();

        var hdnuser = Ext.ComponentQuery.query("#hdnDCULuser")[0].getValue();

        var isDiplomat = "";

        if(chkDCULYes===true&&chkDCULNo===false)
        {
            isDiplomat = "Y";
        }
        else if(chkDCULNo===true&&chkDCULYes===false)
        {
            isDiplomat = "N";
        }
        else if(chkDCULNo===false&&chkDCULYes===false)
        {
            msg("WARNING","Please specify whether the user is diplomat or not!");
            return false;
        }

        var param = {
            d_username:txtDCULUser,
            d_password:txtDCULPass,
            created_by:hdnuser,
            email_id:txtDCULMail,
            status:"A",
            is_diplomat:isDiplomat,
            agency_id:cboDCULAgency
        };

        var waitSave = watiMsg('Processing...');

        Ext.Ajax.request({
            url:"../Handlers/DiplomaticRefund/DiplomaticUserHandler.ashx?method=CreateUserLogin",
            params:{userLogin:JSON.stringify(param)},
            success: function ( result, request ){
                var obj = Ext.decode(result.responseText);

                waitSave.hide();

                msg(obj.success === "true" ?"SUCCESS":"FAILURE",obj.message);

                if(obj.success === "false") return;

                var wndARView = Ext.ComponentQuery.query("#wndDCULCreate")[0];//Ext.create('MyApp.view.WndAgencyView');
                wndARView.close();

            },

            failure: function ( result, request ){

                waitSave.hide();

                msg("FAILURE","Error in Fetching Data !!!");
                return;
            }

        });
    },

    init: function(application) {
        this.control({
            "#btnDCULSave": {
                click: this.onBtnDCULSaveClick
            },
            "#btnDCULCancel": {
                click: this.onBtnDCULCancelClick
            },
            "#chkDCULYes": {
                change: this.onChkDCULYesChange
            },
            "#chkDCULNo": {
                change: this.onChkDCULNoChange
            }
        });
    }

});
