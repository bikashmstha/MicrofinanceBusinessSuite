/*
 * File: app/view/VisitSelection.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.VisitSelection', {
    extend: 'Ext.panel.Panel',

    id: 'VisitSelection',
    itemId: 'VisitSelection',
    title: 'Visit',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    id: 'frmVisitSelection',
                    itemId: 'frmVisitSelection',
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'container',
                            id: 'visitSelHeader',
                            padding: 10,
                            items: [
                                {
                                    xtype: 'label',
                                    margin: '0 0 0 300',
                                    style: 'font-size:18px;',
                                    text: 'भ्रमण छनोट'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnVisitSelAction',
                                    fieldLabel: 'Label'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            border: '',
                            id: 'VisitSelTaxpayerInfo',
                            padding: 5,
                            style: 'border: 2px solid #D3E1F1;',
                            layout: {
                                columns: 2,
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtVisitSelPan',
                                    fieldLabel: 'करदाता नम्बर',
                                    enforceMaxLength: true,
                                    maxLength: 9
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtVisitSelTaxpayerName',
                                    margin: '0 0 0 10',
                                    width: 500,
                                    fieldLabel: 'करदाताको नाम',
                                    readOnly: true
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtVisitSelSelectionDate',
                                    width: 200,
                                    fieldLabel: 'छनोट मिति',
                                    emptyText: 'YYYY.MM.DD',
                                    enforceMaxLength: true,
                                    maxLength: 10
                                },
                                {
                                    xtype: 'textfield',
                                    id: 'txtVisitSelInitiationDate',
                                    margin: '0 0 0 10',
                                    width: 200,
                                    fieldLabel: 'भ्रमण शरू मिति',
                                    emptyText: 'YYYY.MM.DD',
                                    enforceMaxLength: true,
                                    maxLength: 10
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlVisSelVisitType',
                                    fieldLabel: 'भ्रमणको किसिम',
                                    displayField: 'VisitDescNep',
                                    queryMode: 'local',
                                    store: 'VisitTypeStore',
                                    valueField: 'VisitTypeId'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'visitOfficers',
                            margin: 5,
                            padding: 5,
                            style: 'border: 2px solid #D3E1F1;',
                            items: [
                                {
                                    xtype: 'gridpanel',
                                    height: 200,
                                    itemId: 'grdAVOfficer',
                                    title: 'Officers',
                                    store: 'VisitOfficerStore',
                                    dockedItems: [
                                        {
                                            xtype: 'toolbar',
                                            dock: 'top',
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    itemId: 'btnAVOfficerAdd',
                                                    padding: 5,
                                                    icon: 'icon-add',
                                                    iconCls: 'icon-add',
                                                    text: 'Add'
                                                }
                                            ]
                                        }
                                    ],
                                    plugins: [
                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                            pluginId: 'plugInGrdAVOfficer',
                                            listeners: {
                                                validateedit: {
                                                    fn: me.onGridroweditingpluginValidateedit,
                                                    scope: me
                                                },
                                                canceledit: {
                                                    fn: me.onGridroweditingpluginCanceledit,
                                                    scope: me
                                                }
                                            }
                                        })
                                    ],
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'PAN',
                                            text: 'PAN'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'SelectionDate',
                                            text: 'SelectionDate',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtAVOfficerSelectionDate'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'OfficerName',
                                            text: 'OfficerName',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtOfficerName'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'OfficerCode',
                                            text: 'OfficerCode'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Action',
                                            text: 'Action'
                                        },
                                        {
                                            xtype: 'actioncolumn',
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e) {
                                                        var grd = Ext.ComponentQuery.query("#grdAVOfficer")[0];
                                                        var store = Ext.getStore('VisitOfficerStore');
                                                        var row = store.getAt(rowIndex).data;


                                                        Ext.Msg.confirm('Confirm','के तपाई साचै डाटा हटाउन चाहनुहुन्छ?', function(btn) {
                                                            if(btn == 'yes'){

                                                                if(row.Action === "E")
                                                                {    
                                                                    //alert("Deleting...");
                                                                    row.Action = "D";
                                                                    grd.bindStore(store);         
                                                                    store.filter(function(item){
                                                                        return item.get("Action")!= 'D';
                                                                    });
                                                                }
                                                                else
                                                                {

                                                                    store.removeAt(rowIndex);
                                                                }
                                                                return true;
                                                            }
                                                        }, this);

                                                    },
                                                    icon: '../ITS/resources/images/icons/cancel.png'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'checkboxgroup',
                                    margin: '10 0 0 0',
                                    width: 450,
                                    fieldLabel: 'Selection For',
                                    items: [
                                        {
                                            xtype: 'checkboxfield',
                                            id: '',
                                            itemId: 'chkVisitSelVat',
                                            boxLabel: 'Vat'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            itemId: 'chkVisitSelIT',
                                            margin: '',
                                            width: 150,
                                            boxLabel: 'Income Tax'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            id: 'chkVisitSelExcise',
                                            margin: '0 0 0 50',
                                            width: 120,
                                            boxLabel: 'Excise'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'VisitSelButtons',
                            margin: '0 0 0 400',
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnVisitSelectionSave',
                                    padding: 5,
                                    iconCls: 'icon-save',
                                    text: 'Save'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnVisitSelectionSubmit',
                                    padding: 5,
                                    iconCls: 'icon-ok',
                                    text: 'Submit'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnVisitSelectionCancel',
                                    padding: 5,
                                    iconCls: 'icon-cancel',
                                    text: 'Cancel'
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {
        var officerSelDate = Ext.ComponentQuery.query('#txtAVOfficerSelectionDate')[0];
        var officerName=Ext.ComponentQuery.query('#txtOfficerName')[0];
        var btnOfficerAdd=Ext.ComponentQuery.query('#btnAVOfficerAdd')[0];
        var message = "";
        e.cancel=false;

        if(officerSelDate.getValue()==='')
        {
            message+='<BR>* तपाईले अफिसर छनोट मिति अनिवार्य रूपमा भर्नु पर्नेछ।';
        }
        if(officerName.getValue()==='')
        {
            message+='<BR>* तपाईले अफिसरको नाम अनिवार्य रूपमा भर्नु पर्नेछ।';
        }

        if(message!=='')
        {
            msg('INFO',message);
            e.cancel=true;

        }
        else
        {
            btnOfficerAdd.enable(true);
        }

    },

    onGridroweditingpluginCanceledit: function(editor, e, eOpts) {
        var btnOfficerAdd=Ext.ComponentQuery.query('#btnAVOfficerAdd')[0];
        grid.store.removeAt(grid.rowIdx);
        btnOfficerAdd.enable(true);


    }

});