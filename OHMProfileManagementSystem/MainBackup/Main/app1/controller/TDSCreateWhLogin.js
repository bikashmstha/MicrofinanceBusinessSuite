/*
 * File: app/controller/TDSCreateWhLogin.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TDSCreateWhLogin', {
    extend: 'Ext.app.Controller',

    views: [
        'TDSCreateWhLogin'
    ],

    onBtnTDSCWLCreateClick: function(button, e, eOpts) {
        var txtPan = Ext.ComponentQuery.query("#txtTDSCWLPan")[0].getValue();
        var txtUser = Ext.ComponentQuery.query("#txtTDSCWLUsername")[0].getValue();
        var form = Ext.ComponentQuery.query("#frmTDSCWLform")[0].getForm();
        //var TradeName = Ext.ComponentQuery.query("#hdnTDSCWLTradeName")[0].getValue();

        if(!form.isValid())
        {
            msg("WARNING","Please enter the required fields");
            return false;
        }

        var param = {
            Pan:txtPan,
            PinCode:txtUser,
            Pass:txtUser,
            CreatedBy:"its",
            Status:"A",
            RecStatus:"I"
        };

        var waitSave = watiMsg("Creating...");

        Ext.Ajax.request({
            url:"../Handlers/TDS/ChangeCreateWithholdeeHandler.ashx?method=CreateWithhold",
            params:{objWith:JSON.stringify(param)},
            success: function ( result, request ){

                waitSave.hide();

                var obj = Ext.decode(result.responseText);
                var data = obj.root;

                var txtPan = Ext.ComponentQuery.query("#txtTDSCWLPan")[0];
                var txtUser = Ext.ComponentQuery.query("#txtTDSCWLUsername")[0];

                txtPan.setValue('');
                txtUser.setValue('');

                if(obj.success === "true")
                {
                    msg("SUCCESS",obj.message);
                }
                else if(obj.success === "false") 
                {
                    msg("FAILURE",obj.message);
                    return;
                }

            },

            failure: function ( result, request ){

                return;
            }

        });
    },

    ShowCreateWhLogin: function() {
        Ext.getCmp('cntOMTDS').removeAll();

        var pnlDynamic = Ext.create('MyApp.view.TDSCreateWhLogin');
        var pnlToRender = Ext.ComponentQuery.query("#cntOMTDS")[0];
        pnlToRender.add(pnlDynamic);
    },

    init: function(application) {
        this.control({
            "#btnTDSCWLCreate": {
                click: this.onBtnTDSCWLCreateClick
            }
        });
    }

});
