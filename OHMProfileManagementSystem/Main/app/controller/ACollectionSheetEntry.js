/*
 * File: app/controller/ACollectionSheetEntry.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.ACollectionSheetEntry', {
    extend: 'Ext.app.Controller',

    stores: [
        'CSCenterCodePopUpStore',
        'SavingCollectionDetailsStore',
        'LoanCollectionDetailsStore'
    ],

    onTxtCenterCodeAfterRender: function(component, eOpts) {
          component.getEl().on('dblclick', function(){
                     var winPopup = Ext.create('MyApp.view.CSCenterCodePopUp',{

                     });

                        winPopup.extraParam={param:null};
                        winPopup.show();

                  });
    },

    onBtnLoadSavingDataClick: function(button, e, eOpts) {
        var offCode=Ext.get('offCode').dom.innerHTML;
        var sheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var centerCode=Ext.ComponentQuery.query("#txtCenterCode")[0].getValue();
        var collectionDate='';

                Ext.Ajax.request
                ({
                    url:'../Handlers/Finance/Transaction/CollectionSheetTransaction/GenerateSavingCollectionHandler.ashx?method=GenerateSavingCollection',
                    params:{offCode:offCode,sheetNo:sheetNo,centerCode:centerCode,collectionDate:collectionDate},
                    success: function(result, request) {
                        var obj = Ext.decode(result.responseText);
                        console.log(obj);
                        if (obj.success != "false")
                        {
                            showMessage('ERROR OCURRED !!!',obj.message);
                        }
                        else
                        {
                            showMessage('INFO','Saving Collection Generated Successfully');


                        }
                    },
                    failure: function(result, request) {
                        var obj = Ext.decode(result.responseText);

                        msg("FAILURE","Saving Collection Generated Failed");
                        return;
                    }
                });

    },

    onBtmEnterClick: function(button, e, eOpts) {
        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var dataEntered='Y';
        var dataEnteredDate=Ext.ComponentQuery.query("#txtCollectionDateBS")[0].getValue();
        var welfareFundAmount=Ext.ComponentQuery.query("#txtAdvanceRecAmount")[0].getValue();
        //var userName=Ext.get('userName').dom.innerHTML;
        var userName='';
         var collectionSheetEnter={CollectionSheetNo:collectionSheetNo,
                                 DataEntered:dataEntered,
                                 DataEnteredDate:dataEnteredDate,
                                 WelfareFundAmount:welfareFundAmount,
                                 UseName:userName};



                        var wMsg='';
                        var waitSave = watiMsg(wMsg);

                        Ext.Ajax.request({
                                    url: '../Handlers/Finance/Transaction/CollectionSheetTransaction/SavingCollectionSheetHandler.ashx',
                                    params: {
                                        method:'Save',
                                        savingCollectionSheet:JSON.stringify(collectionSheetEnter)
                                    },
                                    success: function(response){
                                    waitSave.hide();
                                    var out=Ext.decode(response.responseText);
                                    console.log(out);

                                    if(out.success==="true")
                                        {
                                            var message=out.root;
                                            if(message.OutResultCode==="SUCCESS")
                                                {
                                                    msg("SUCCESS",message.OutResultMessage,function(){

                                                    });



                                                }
                                            else
                                                {
                                                  msg("FAILURE",message.OutResultMessage);
                                                }
                                        }
                                        else
                                            {
                                                msg("FAILURE",out.message);
                                            }
                                    },
                                    failure: function ( result, request ) {
                                        waitSave.hide();
                                        var out=Ext.decode(response.responseText);
                                        msg("FAILURE",out.message);
                                    }

                                });



    },

    onBtnSaveSavingDetailsClick: function(button, e, eOpts) {
        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var collectionDate=Ext.ComponentQuery.query("#txtCollectionDateBS")[0].getValue();
        //var clientNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var monthlySavingAccountNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var monthlySavingRec=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var monthlySavingAdjustYN=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var monthlySavingAdjustNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var monthlySavingAdjustAmt=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var ssfFundAcountNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var ssfFundRec=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var optionalSavingAccountNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var optionalSavingRec=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var optionalSavingWithdraw=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var pensionFundAccountNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var pensionFundRec=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var pensionFundAdjustYN=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var pensionFundAdjustNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var pensionFundAdjustAmt=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var receivedYN=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var presentYN=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var businessAC=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var businessReceived=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var businessWithDraw=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var useName=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();

        var savingCollectionSheet={CollectionSheetNo:collectionSheetNo,
                         CollectionDate:collectionDate,
                         ClientNo:clientNo,
                         MonthlySavingACNo:monthlySavingAccountNo,
                         MonthlySavingRec:monthlySavingRec,
                         MonthlySavingAdjustYN:monthlySavingAdjustYN,
                         MonthlySavingAdjustNo:monthlySavingAdjustNo,
                         MonthlySavingAdjustAmt:monthlySavingAdjustAmt,
                         SSFFundACNo:ssfFundAcountNo,
                         SSFFundRec:ssfFundRec,
                         OpionalSavingACNo:optionalSavingAccountNo,
                        // OpionalSavingACNo:optionalSavingRec,missing
                         OptionalSavingWithdrawal:optionalSavingWithdraw,
                         PensionFundACNo:pensionFundAccountNo,
                         PensionFundRec:pensionFundRec,
                         PensionFundAdjustYN:pensionFundAdjustYN,
                        // PensionFundACNo:pensionFundAdjustNo,
                         PensionFundAdjustAmt:pensionFundAdjustAmt,
                         ReceivedYN:receivedYN,
                         PresentYN:presentYN,
                         BusinessAC:businessAC,
                         BusinessReceived:businessReceived,
                         BusinessWithdraw:businessWithDraw,
                         UserName:useName,




                         Action:action.getValue()};



                var wMsg='';
                if(action.getValue()==='I')
                    {
                        wMsg='Inserting....';
                    }
                else
                    {
                        wMsg='Updting....';
                    }
                var waitSave = watiMsg(wMsg);

                Ext.Ajax.request({
                            url: '../Handlers/Finance/Transaction/CollectionSheetTransaction/SavingCollectionSheetHandler.ashx',
                            params: {
                                method:'Save',
                                savingCollectionSheet:JSON.stringify(savingCollectionSheet)
                            },
                            success: function(response){
                            waitSave.hide();
                            var out=Ext.decode(response.responseText);
                            console.log(out);

                            if(out.success==="true")
                                {
                                    var message=out.root;
                                    if(message.OutResultCode==="SUCCESS")
                                        {
                                            msg("SUCCESS",message.OutResultMessage,function(){
                                                var grd = Ext.ComponentQuery.query('#grdABBSCharge')[0];

                                                var record = grd.getSelectionModel().getSelection()[0];
                                                record.set('Action','U');

                                            });



                                        }
                                    else
                                        {
                                          msg("FAILURE",message.OutResultMessage);
                                        }
                                }
                                else
                                    {
                                        msg("FAILURE",out.message);
                                    }
                            },
                            failure: function ( result, request ) {
                                waitSave.hide();
                                var out=Ext.decode(response.responseText);
                                msg("FAILURE",out.message);
                            }

                        });



    },

    onBtnLoadCollectionLoadDataClick: function(button, e, eOpts) {
        var centerCode=Ext.ComponentQuery.query("#txtCollectionDateBS")[0].getValue();
        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
         Ext.Ajax.request
                        ({
                            url:'../Handlers/Finance/Transaction/CollectionSheetTransaction/LoanCollectionDetailHandler.ashx?method=GetCollectionLoanDetail',
                            params:{centerCode:centerCode,collectionSheetNo:collectionSheetNo},
                            success: function(result, request) {
                                var obj = Ext.decode(result.responseText);
                                console.log(obj);
                                if (obj.success != "false")
                                {
                                    showMessage('ERROR OCURRED !!!',obj.message);
                                }
                                else
                                {
                                    showMessage('INFO','Loan Collection Generated Successfully');


                                }
                            },
                            failure: function(result, request) {
                                var obj = Ext.decode(result.responseText);

                                msg("FAILURE","Loan Collection Generated Failed");
                                return;
                            }
                        });


    },

    onBtnSaveLoanDetailsClick: function(button, e, eOpts) {
        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var collectionDate=Ext.ComponentQuery.query("#txtCollectionDateBS")[0].getValue();
        var loanNo=Ext.ComponentQuery.query("#txtLLoanNo")[0].getValue();
        //var paidAmt=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var principlePaidAmt=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var interestPaidAmt=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var penaltyPaidAmt=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var adjustFromSaving=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        //var savingAccountNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var received=Ext.ComponentQuery.query("#chkReceived")[0];
        //var chequeNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var adjustAmtFrmSaving=Ext.ComponentQuery.query("#txtLAdjAmt")[0].getValue();
        //var userName=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();

                var loanCollectionSheet={CollectionSheetNo:collectionSheetNo,
                                 CollectionDate:collectionDate,
                                 LoanNo:loanNo,
                                 PaidAmount:paidAmt,
                                 PrincipalPaidAmount:principlePaidAmt,
                                 InterestPaidAmount:interestPaidAmt,
                                 PenaltyPaidAmount:penaltyPaidAmt,
                                 AdjustFromSaving:adjustFromSaving,
                                 SavingAccountNo:savingAccountNo,
                                 Received:received.checked ===true?'Y':'N',
                                 ChequeNo:chequeNo,
                                 AdjustAmtFrmSaving:adjustAmtFrmSaving,
                                 CreatedBy:userName,

                                };



                        var wMsg='';
                        var waitSave = watiMsg(wMsg);

                        Ext.Ajax.request({
                                    url: '../Handlers/Finance/Transaction/LoanCollectionDetailHandler.ashx',
                                    params: {
                                        method:'UpdateLoanCollectionSheet',
                                        loanCollectionDetail:JSON.stringify(loanCollectionSheet)
                                    },
                                    success: function(response){
                                    waitSave.hide();
                                    var out=Ext.decode(response.responseText);
                                    console.log(out);

                                    if(out.success==="true")
                                        {
                                            var message=out.root;
                                            if(message.OutResultCode==="SUCCESS")
                                                {
                                                    msg("SUCCESS",message.OutResultMessage,function(){
        //                                                / var grd = Ext.ComponentQuery.query('#grdABBSCharge')[0];

                                                        //var record = grd.getSelectionModel().getSelection()[0];
                                                       // record.set('Action','U');

                                                    });



                                                }
                                            else
                                                {
                                                  msg("FAILURE",message.OutResultMessage);
                                                }
                                        }
                                        else
                                            {
                                                msg("FAILURE",out.message);
                                            }
                                    },
                                    failure: function ( result, request ) {
                                        waitSave.hide();
                                        var out=Ext.decode(response.responseText);
                                        msg("FAILURE",out.message);
                                    }

                                });


    },

    onBtnGenerateLoanColinSheetClick: function(button, e, eOpts) {
        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();

        Ext.Ajax.request
                                ({
                                    url:'../Handlers/Finance/Transaction/CollectionSheetTransaction/LoanCollectionDetailHandler.ashx?method=DeleteLoanCollectionSheet',
                                    params:{collectionSheetNo:collectionSheetNo},
                                    success: function(result, request) {
                                        var obj = Ext.decode(result.responseText);
                                        console.log(obj);
                                        if (obj.success != "false")
                                        {
                                            showMessage('ERROR OCURRED !!!',obj.message);
                                        }
                                        else
                                        {
                                            showMessage('INFO','Loan Collection Deleted Successfully');


                                        }
                                    },
                                    failure: function(result, request) {
                                        var obj = Ext.decode(result.responseText);

                                        msg("FAILURE","Loan Collection Deleted Failed");
                                        return;
                                    }
                                });




        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
         var centerCode=Ext.ComponentQuery.query("#txtCollectionDateBS")[0].getValue();

                 Ext.Ajax.request
                                ({
                                    url:'../Handlers/Finance/Transaction/CollectionSheetTransaction/LoanCollectionDetailHandler.ashx?method=GetCollectionLoanDetail',
                                    params:{centerCode:centerCode,collectionSheetNo:collectionSheetNo},
                                    success: function(result, request) {
                                        var obj = Ext.decode(result.responseText);
                                        console.log(obj);
                                        if (obj.success != "false")
                                        {
                                            showMessage('ERROR OCURRED !!!',obj.message);
                                        }
                                        else
                                        {
                                            showMessage('INFO','Loan Collection Generated Successfully');


                                        }
                                    },
                                    failure: function(result, request) {
                                        var obj = Ext.decode(result.responseText);

                                        msg("FAILURE","Loan Collection Generated Failed");
                                        return;
                                    }
                                });

    },

    onBtnGenerateOriginalSavingSheetClick: function(button, e, eOpts) {
        var collectionSheetNo=Ext.ComponentQuery.query("#txtCollectionSheetNo")[0].getValue();
        var userName ='';

        Ext.Ajax.request
                                ({
                                    url:'../Handlers/Finance/Transaction/CollectionSheetTransaction/LoanCollectionDetailHandler.ashx?method=DeleteLoanCollectionSheet',
                                    params:{collectionSheetNo:collectionSheetNo,userName:userName},
                                    success: function(result, request) {
                                        var obj = Ext.decode(result.responseText);
                                        console.log(obj);
                                        if (obj.success != "false")
                                        {
                                            showMessage('ERROR OCURRED !!!',obj.message);
                                        }
                                        else
                                        {
                                            showMessage('INFO','Loan Collection Deleted Successfully');


                                        }
                                    },
                                    failure: function(result, request) {
                                        var obj = Ext.decode(result.responseText);

                                        msg("FAILURE","Loan Collection Deleted Failed");
                                        return;
                                    }
                                });




        var offCode=Ext.get('offCode').dom.innerHTML;
        var centerCode=Ext.ComponentQuery.query("#txtCenterCode")[0].getValue();
        var collectionDate=Ext.ComponentQuery.query("#txtCollectionDateBS")[0].getValue();

                 Ext.Ajax.request
                                ({
                                    url:'../Handlers/Finance/Transaction/CollectionSheetTransaction/GenerateSavingCollectionHandler.ashx?method=GenerateSavingCollection',
                                    params:{offCode:offCode,collectionSheetNo:collectionSheetNo,centerCode:centerCode,collectionDate:collectionDate},
                                    success: function(result, request) {
                                        var obj = Ext.decode(result.responseText);
                                        console.log(obj);
                                        if (obj.success != "false")
                                        {
                                            showMessage('ERROR OCURRED !!!',obj.message);
                                        }
                                        else
                                        {
                                            showMessage('INFO','Loan Collection Generated Successfully');


                                        }
                                    },
                                    failure: function(result, request) {
                                        var obj = Ext.decode(result.responseText);

                                        msg("FAILURE","Loan Collection Generated Failed");
                                        return;
                                    }
                                });

    },

    init: function(application) {
        this.control({
            "#txtCenterCode": {
                afterrender: this.onTxtCenterCodeAfterRender
            },
            "#btnLoadSavingData": {
                click: this.onBtnLoadSavingDataClick
            },
            "#btmEnter": {
                click: this.onBtmEnterClick
            },
            "#btnSaveSavingDetails": {
                click: this.onBtnSaveSavingDetailsClick
            },
            "#btnLoadCollectionLoadData": {
                click: this.onBtnLoadCollectionLoadDataClick
            },
            "#btnSaveLoanDetails": {
                click: this.onBtnSaveLoanDetailsClick
            },
            "#btnGenerateLoanColinSheet": {
                click: this.onBtnGenerateLoanColinSheetClick
            },
            "#btnGenerateOriginalSavingSheet": {
                click: this.onBtnGenerateOriginalSavingSheetClick
            }
        });
    }

});
