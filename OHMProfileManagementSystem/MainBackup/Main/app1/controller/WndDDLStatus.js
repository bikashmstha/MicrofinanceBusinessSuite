/*
 * File: app/controller/WndDDLStatus.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.WndDDLStatus', {
    extend: 'Ext.app.Controller',

    views: [
        'WndDDLStatus'
    ],

    onRdDDLActiveChange: function(field, newValue, oldValue, eOpts) {
        var me = this;

        var InActive = Ext.ComponentQuery.query("#rdDDLInActive")[0];
        InActive.setDisabled(true);
        var inactive = "";

        me.Change(newValue,inactive);
    },

    onRdDDLInActiveChange: function(field, newValue, oldValue, eOpts) {
        var me = this;

        var Active = Ext.ComponentQuery.query("#rdDDLActive")[0];
        Active.setDisabled(true);
        var active = "";

        me.Change(active,newValue);
    },

    WndSession: function(agID) {
        var hdnID = Ext.ComponentQuery.query("#hdnDDLID")[0];
        hdnID.setValue(agID);

    },

    Change: function(ActiveValue, InactiveValue) {
        var hdnID = Ext.ComponentQuery.query("#hdnDDLID")[0];
        var id = hdnID.getValue();
        var status = "";

        var store = Ext.getStore('AgencyList');
        var data = store.getAt(id);

        var agid = data.get('AgencyID');
        var agname = data.get('AgencyName');
        var agadd = data.get('AgencyAdd');
        var Type = data.get('AgencyType');
        var agType = "";
        if(Type=="PERSONAL")
        {
            agType="P";
        }
        else if(Type=="OFFICIAL")
        {
            agType="O";
        }
        var crBy = data.get('CreatedBy');
        var crDate = data.get('CreatedDate');
        var agattch = data.get('AgreeAttch');
        var agclause = data.get('AgreeClause');
        var agDate = data.get('AgreeDate');
        var aidloan = data.get('AIDLoanNo');
        var apprdatemof = data.get('ApprDateMof');
        var crcommdate = data.get('CRCommDate');
        var crname = data.get('CRName');
        var crno = data.get('CRNo');
        var crtermdate = data.get('CRTermDate');
        var pan = data.get('Pan');
        var purpaidloan = data.get('PurpAIDLoan');
        var termdate = data.get('TermDate');
        var totamtrec = data.get('TotAmtRec');

        if(ActiveValue===true)
        {
            status = "A";
        }
        else if(InactiveValue===true)
        {
            status = "In"; 
        }
        else
        {
            return false;
        }

        var paramAgency = {
            AgencyID:agid,
            AgencyName:agname,
            AgencyAdd:agadd,
            AgencyType:agType,
            CreatedBy:crBy,
            CreatedDate:crDate,
            AgreeAttch:agattch,
            AgreeClause:agclause,
            AgreeDate:agDate,
            AIDLoanNo:aidloan,
            ApprDateMof:apprdatemof,
            CRCommDate:crcommdate,
            CRName:crname,
            CRNo:crno,
            CRTermDate:crtermdate,
            Pan:pan,
            PurpAIDLoan:purpaidloan,
            TermDate:termdate,
            TotAmtRec:totamtrec,
            Action:"E",
            Status:status
        };

        //var waitSave = watiMsg('Saving ...');

        Ext.Ajax.request({
            url:"../Handlers/DiplomaticRefund/DAgencyRegistrationHandler.ashx?method=SaveAgency",
            params:{Agency:JSON.stringify(paramAgency)},
            success: function ( result, request ){
                var obj = Ext.decode(result.responseText);

                var store = Ext.getStore('AgencyList');
                store.load();

                var wnd = Ext.ComponentQuery.query("#wndDDlStatus")[0];
                wnd.close();

                if(obj.success === "false") 
                {
                    msg("FAILURE","Failed to Change Status!!");
                    return;
                }


            },

            failure: function ( result, request ){

                msg("FAILURE","Error in Fetching Data !!!");
                return;
            }

        });

    },

    showStatus: function() {
        var dynamicWindow = Ext.create('MyApp.view.WndDDLStatus');
        //dynamicWindow.close();
        dynamicWindow.modal = true;
        dynamicWindow.show();

    },

    init: function(application) {
        this.control({
            "#rdDDLActive": {
                change: this.onRdDDLActiveChange
            },
            "#rdDDLInActive": {
                change: this.onRdDDLInActiveChange
            }
        });
    }

});
