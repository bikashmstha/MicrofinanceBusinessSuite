/*
 * File: app/view/HolidayList.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.HolidayList', {
    extend: 'Ext.panel.Panel',

    requires: [
        'Ext.form.Panel',
        'Ext.tab.Panel',
        'Ext.tab.Tab',
        'Ext.grid.Panel',
        'Ext.grid.View',
        'Ext.selection.RowModel',
        'Ext.grid.plugin.RowEditing',
        'Ext.grid.column.Action',
        'Ext.form.field.ComboBox'
    ],

    frame: true,
    title: 'Holiday List',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    id: 'frmholidaylist',
                    itemId: 'frmholidaylist',
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'tabpanel',
                            activeTab: 0,
                            items: [
                                {
                                    xtype: 'panel',
                                    title: 'Naration Detail',
                                    tabConfig: {
                                        xtype: 'tab',
                                        listeners: {
                                            click: {
                                                fn: me.onTabClick,
                                                scope: me
                                            }
                                        }
                                    },
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            itemId: 'grdNarrations',
                                            padding: '10 0 0 0',
                                            store: 'NarrationStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NarrationCode',
                                                    text: 'Narration Code',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtNarrationCode',
                                                        readOnly: true
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 250,
                                                    dataIndex: 'NarrationDesc',
                                                    text: 'Narration Description',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtNarrationDesc'
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Action',
                                                    text: 'Action'
                                                },
                                                {
                                                    xtype: 'actioncolumn',
                                                    items: [
                                                        {
                                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                var store = Ext.getStore('NarrationStore');
                                                                var grd =  Ext.ComponentQuery.query('#grdNarrations')[0];
                                                                var row = store.getAt(rowIndex).data;

                                                                Ext.Msg.confirm('Confirm Action', 'Do you want to Remove the selected Narration ?', function(btn) {
                                                                    if(btn == 'yes'){

                                                                        grd.bindStore(store);
                                                                        store.removeAt(rowIndex);

                                                                        return true;
                                                                    }
                                                                });
                                                            },
                                                            icon: '../ITS/resources/images/icons/cancel.png'
                                                        }
                                                    ]
                                                }
                                            ],
                                            selModel: Ext.create('Ext.selection.RowModel', {

                                            }),
                                            plugins: [
                                                Ext.create('Ext.grid.plugin.RowEditing', {
                                                    listeners: {
                                                        edit: {
                                                            fn: me.onRowEditingEdit,
                                                            scope: me
                                                        },
                                                        validateedit: {
                                                            fn: me.onRowEditingValidateedit,
                                                            scope: me
                                                        },
                                                        canceledit: {
                                                            fn: me.onRowEditingCanceledit,
                                                            scope: me
                                                        }
                                                    }
                                                })
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Nepal Date Conersion',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            padding: '10 0 0 0',
                                            store: 'NepaliDateConversionStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'FiscalYear',
                                                    text: 'Fiscal Year'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'MonthCode',
                                                    text: 'Month Code'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'EnglishStartDate',
                                                    text: 'English Start Date'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NepaliStartDate',
                                                    text: 'Nepali Start Date'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'EnglishEndDate',
                                                    text: 'English End Date'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NepaliEndDate',
                                                    text: 'Nepali End Date'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NepaliYear',
                                                    text: 'Nepali Year'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NepaliPeriod',
                                                    text: 'Nepali Period'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NoOfDays',
                                                    text: 'No. Of Days'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Generate Date of Fiscal Year',
                                    tabConfig: {
                                        xtype: 'tab',
                                        itemId: 'GetDate'
                                    },
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            maxWidth: 280,
                                            width: 280,
                                            fieldLabel: 'Fiscal Year',
                                            emptyText: ' - - - Select Fiscal Year - - -',
                                            displayField: 'FiscalYear',
                                            forceSelection: true,
                                            queryMode: 'local',
                                            store: 'FiscalYearStore',
                                            valueField: 'FiscalYear'
                                        },
                                        {
                                            xtype: 'button',
                                            padding: 5,
                                            text: 'Generate Date of Above Fiscal Year'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Generate Date of English Year',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            fieldLabel: 'English Year'
                                        },
                                        {
                                            xtype: 'button',
                                            padding: 5,
                                            text: 'Generate Date of Above English Year'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Nepali Fiscal Year Setup',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            padding: '10 0 0 0',
                                            store: 'FiscalYearStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'FiscalYear',
                                                    text: 'Fiscal Year'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'StartDateBS',
                                                    text: 'Start Date BS'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'StartDate',
                                                    text: 'Start Date'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'EndDateBS',
                                                    text: 'End Date BS'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'EndDate',
                                                    text: 'End Date'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Installment Period Setup',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            padding: '10 0 0 0',
                                            store: 'InstallmentPeriodStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'InstallmentPeriod',
                                                    text: 'Installment Period'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 200,
                                                    dataIndex: 'InstallmentPeriodDesc',
                                                    text: 'Installment Period Description'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'PeriodType',
                                                    text: 'Period Type'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'MaxGraceDays',
                                                    text: 'Max Grace Days'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'InstallmentType',
                                                    text: 'Installment Type'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Status',
                                                    text: 'Status'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Loan Period',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            padding: '10 0 0 0',
                                            store: 'LoanPeriodStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'LoanPeriod',
                                                    text: 'Loan Period'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'LoanPeriodDesc',
                                                    text: 'Loan Period Desc'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'PeriodType',
                                                    text: 'Period Type'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Active',
                                                    text: 'Active'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    padding: '10 0 0 0',
                                    title: 'Loan and Installment Period Map',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            store: 'LoanAndInstallmentPeriodMapStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'InstallmentPeriod',
                                                    text: 'Installment Period'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'InstallmentType',
                                                    text: 'Installment Type'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'LoanPeriod',
                                                    text: 'Loan Period'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'LoanPeriodType',
                                                    text: 'Loan Period Type'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'NoOfInstallment',
                                                    text: 'No. Of Installment'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Active',
                                                    text: 'Active'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: 'Loan Period And Product Map',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            padding: '10 0 0 0',
                                            store: 'LoanPeriodProductMapStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'LoanPeriod',
                                                    text: 'Loan Period'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'LoanPeriodType',
                                                    text: 'Loan Period Type'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Description',
                                                    text: 'Description'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'DisplaySequence',
                                                    text: 'Display Sequence'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Active',
                                                    text: 'Active'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    /*  */
    onTabClick: function(button, e, eOpts) {
        var store=Ext.getStore('NarrationStore');
        store.removeAll();

        Ext.Ajax.request({
            url: '../Handlers/Maintenance/GeneralDefinitions/NarrationHandler.ashx',
            params: {
                method:'GetNarrations'
            },
            success: function(response){

            var data=Ext.decode(response.responseText);
            console.log('data',data);
            store.removeAll();
            store.add(data.root);


        }
        });
    },

    onRowEditingEdit: function(editor, e, eOpts) {
        var narrationCode=Ext.ComponentQuery.query('#txtNarrationCode')[0];
        var narrationDesc=Ext.ComponentQuery.query('#txtNarrationDesc')[0];

        var narration={
            NarrationCode:narrationCode.getValue(),
            NarrationDesc:narrationDesc.getValue()
        };

        Ext.Ajax.request({
                    url: '../Handlers/Maintenance/GeneralDefinitions/NarrationHandler.ashx',
                    params: {
                        method:'SaveNarration',
                        narration:JSON.stringify(narration)
                    },
                    success: function(response){

                    var out=Ext.decode(response.responseText);
                    console.log(out);



                }
                });

    },

    onRowEditingValidateedit: function(editor, e, eOpts) {

    },

    onRowEditingCanceledit: function(editor, e, eOpts) {

    }

});