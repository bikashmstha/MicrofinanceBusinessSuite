/*
 * File: app/view/AssetDisposal.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.AssetDisposal', {
    extend: 'Ext.panel.Panel',

    requires: [
        'Ext.form.Panel',
        'Ext.form.field.ComboBox',
        'Ext.form.field.Checkbox',
        'Ext.button.Button',
        'Ext.grid.Panel',
        'Ext.grid.View',
        'Ext.grid.column.Column'
    ],

    title: 'Asset Disposal',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    id: 'frmAssetDisposal',
                    itemId: 'frmAssetDisposal',
                    width: 1203,
                    autoScroll: true,
                    title: '',
                    layout: {
                        type: 'table',
                        columns: 5
                    },
                    items: [
                        {
                            xtype: 'combobox',
                            colspan: 2,
                            itemId: 'ddlAsset',
                            fieldLabel: 'Asset',
                            labelWidth: 110,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            emptyText: '---Select---',
                            displayField: 'AssetDesc',
                            queryMode: 'local',
                            store: 'AssetShortStore',
                            valueField: 'AssetCode',
                            listeners: {
                                change: {
                                    fn: me.onDdlAssetChange,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            colspan: 1,
                            itemId: 'txtItemCode',
                            margin: '0 0 0 10',
                            fieldLabel: 'Item',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtItemDesc',
                            margin: '0 0 0 -130',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 52
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtCurrentDeptCode',
                            fieldLabel: 'Current Dept',
                            labelWidth: 110,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtCurrentDeptDesc',
                            margin: '0 0 0 10',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 1,
                            itemId: 'txtPurchaseDateBS',
                            margin: '0 0 0 10',
                            fieldLabel: 'Purchase Date',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtPurchaseDateAD',
                            margin: '0 0 0 -130',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 17
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtDepriciationPer',
                            fieldLabel: 'Depreciation',
                            labelWidth: 110,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'checkboxfield',
                            itemId: 'chkTransferred',
                            margin: '0 0 0 10',
                            fieldLabel: 'Transfered(Yes/No)',
                            boxLabel: ''
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtLastDepeDateBS',
                            margin: '0 0 0 150',
                            fieldLabel: 'Last Depe Date',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLastDepeDateAD',
                            margin: '0 0 0 10',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLastDeprAmt',
                            fieldLabel: 'Last Depr Amount',
                            labelWidth: 110,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 1,
                            itemId: 'txtCurrentValue',
                            margin: '0 0 0 40',
                            fieldLabel: 'Current Value',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 3,
                            itemId: 'txtPurchasePrice',
                            margin: '0 0 0 150',
                            fieldLabel: 'Purchase Price',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtTotalMaintenance',
                            fieldLabel: 'Total Maintenance',
                            labelWidth: 110,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 1,
                            itemId: 'txtTotalDepr',
                            margin: '0 0 0 40',
                            fieldLabel: 'Total Depr',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtCurrentOfficeCode',
                            margin: '0 0 0 150',
                            fieldLabel: 'Current Office',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtCurrentOfficeDesc',
                            margin: '0 0 0 10',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'form',
                            colspan: 5,
                            frame: true,
                            bodyPadding: 10,
                            title: '',
                            layout: {
                                type: 'table',
                                columns: 4
                            },
                            items: [
                                {
                                    xtype: 'combobox',
                                    colspan: 2,
                                    itemId: 'ddlOffice',
                                    fieldLabel: 'Office',
                                    fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                                    emptyText: '---Select---',
                                    displayField: 'InstituteName',
                                    queryMode: 'local',
                                    store: 'InstituteShortStore',
                                    valueField: 'InstituteCode',
                                    listeners: {
                                        change: {
                                            fn: me.onDdlOfficeChange,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'combobox',
                                    colspan: 2,
                                    itemId: 'ddlDepartment',
                                    fieldLabel: 'Department',
                                    fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                                    emptyText: '---Select---',
                                    displayField: 'DeptName',
                                    queryMode: 'local',
                                    store: 'DepartmentShortStore',
                                    valueField: 'DeptCode'
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDropDateBS',
                                    fieldLabel: 'Drop Date B.S.'
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDropDateAD',
                                    margin: '0 0 0 10',
                                    fieldLabel: 'Label',
                                    hideLabel: true,
                                    fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtUnCalcDepr',
                                    fieldLabel: 'Un Calc Depr',
                                    fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtScrapValue',
                                    margin: '0 0 0 10',
                                    fieldLabel: 'Scrap Value',
                                    fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                },
                                {
                                    xtype: 'textfield',
                                    colspan: 2,
                                    itemId: 'txtRemarks',
                                    fieldLabel: 'Remarks'
                                },
                                {
                                    xtype: 'textfield',
                                    colspan: 2,
                                    itemId: 'txtSerialNo',
                                    fieldLabel: 'Serial No',
                                    fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                },
                                {
                                    xtype: 'container',
                                    colspan: 6,
                                    height: 28,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch',
                                        pack: 'center'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSave',
                                            padding: 5,
                                            text: 'Save',
                                            listeners: {
                                                click: {
                                                    fn: me.onBtnSaveClick,
                                                    scope: me
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            colspan: 6,
                            frame: true,
                            margin: '10 0 0 0 ',
                            bodyPadding: 10,
                            title: 'Destination',
                            layout: {
                                type: 'table',
                                columns: 2
                            },
                            items: [
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlDestinationFormal',
                                    fieldLabel: 'Destination Format',
                                    labelWidth: 120,
                                    emptyText: '---Select---',
                                    queryMode: 'local'
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlDestinationParameter',
                                    margin: '0 0 0 200',
                                    fieldLabel: 'Destination Parameter',
                                    labelWidth: 130,
                                    emptyText: '---Select---',
                                    queryMode: 'local'
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlDestinationType',
                                    fieldLabel: 'Destination Type',
                                    labelWidth: 120,
                                    emptyText: '---Select---',
                                    queryMode: 'local'
                                },
                                {
                                    xtype: 'checkboxfield',
                                    itemId: 'chkPrint',
                                    margin: '0 0 0 200',
                                    fieldLabel: 'Print',
                                    labelWidth: 130,
                                    boxLabel: ''
                                },
                                {
                                    xtype: 'container',
                                    colspan: 2,
                                    height: 28,
                                    margin: '10 0 0 0',
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch',
                                        pack: 'center'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnOk',
                                            padding: 5,
                                            text: 'Ok'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            colspan: 5,
                            frame: true,
                            bodyPadding: 10,
                            title: 'Search',
                            layout: {
                                type: 'table',
                                columns: 2
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDrpDateFromBS',
                                    fieldLabel: 'Drop Date From B.S.',
                                    labelWidth: 120
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDrpDateFromAD',
                                    margin: '0 0 0 100',
                                    fieldLabel: 'Drop Date From A.D.',
                                    labelWidth: 120,
                                    fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDrpDateToBS',
                                    fieldLabel: 'Drop Date To B.S.',
                                    labelWidth: 120
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDrpDateToAD',
                                    margin: '0 0 0 100',
                                    fieldLabel: 'Drop Date To A.D.',
                                    labelWidth: 120,
                                    fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                },
                                {
                                    xtype: 'container',
                                    colspan: 2,
                                    height: 28,
                                    margin: '10 0 0 0',
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch',
                                        pack: 'center'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSearch',
                                            padding: 5,
                                            text: 'Search',
                                            listeners: {
                                                click: {
                                                    fn: me.onBtnSearchClick,
                                                    scope: me
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    colspan: 2,
                                    itemId: 'grdAssetDisposal',
                                    width: 905,
                                    title: '',
                                    store: 'AssetIssueGridStore',
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'SNo',
                                            text: 'S No'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'AssetCode',
                                            text: 'Asset Code'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            text: 'Asset Name'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'ToDeptCode',
                                            text: 'Department Code'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'ToDeptName',
                                            text: 'Department Name'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'TranDate',
                                            text: 'Drop Date'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'UnCalcDepr',
                                            text: 'UnCalc Depr'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'CurrentValue',
                                            text: 'Scrap Value'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Remarks',
                                            text: 'Remarks'
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    listeners: {
                        afterrender: {
                            fn: me.onFrmAssetDisposalAfterRender,
                            scope: me
                        }
                    }
                }
            ]
        });

        me.callParent(arguments);
    },

    onDdlAssetChange: function(field, newValue, oldValue, eOpts) {
        //GET FOR ASSET GRID


        Ext.Ajax.request({
            url:'../Handlers/Inventory/Transaction/AssetSendReceiptDetailHandler.ashx',
            params:{method:'GetAssetSendReceiptDetail',AssetCode:newValue,
                    ReceiveSendDrop:'D',

                   },
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    //console.log("Resu",obj.root);
                    var store =Ext.getStore('AssetIssueGridStore');
                    store.removeAll();
                    store.add(obj.root);

                    var deptFill = obj.root[0].data;
                    Ext.ComponentQuery.query('#txtCurrentDeptCode')[0].setValue(deptFill.ToDeptCode);
                    Ext.ComponentQuery.query('#txtCurrentDeptDesc')[0].setValue(deptFill.ToDeptName);
                    Ext.ComponentQuery.query('#chkTransferred')[0].setValue(deptFill.TransferYN==='Y'?true:false);
                    //Ext.ComponentQuery.query('#chkGrdTrn')[0].setValue(deptFill.TransferYN==='Y'?true:false);
                    //Ext.ComponentQuery.query('#chkGrdDeprCalc')[0].setValue(deptFill.DeprCalcY_N==='Y'?true:false);



                }else{msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");    }
        });

        //GET FOR ASSET GET
        var astCode ={
            TranOfficeCode:getOfficeCode(),
            AssetCode:newValue,//Ext.ComponentQuery.query('#ddlAsset')[0].AssetCode,
            CategoryCode:'',
            AssetCategory:'',
            Donar:'',
        };
        Ext.Ajax.request({
            url:'../Handlers/Inventory/Transaction/AssetDetailHandler.ashx',
            params:{method:'GetAssetDetail',assetDetail:JSON.stringify(astCode)


                   },
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    console.log("Resu",obj.root);
                    var store =Ext.getStore('AssetDetailStore');
                    store.removeAll();
                    store.add(obj.root);
                    var fillData = obj.root[0].data;

                    console.log('getdetail',fillData);
                    Ext.ComponentQuery.query('#txtItemCode')[0].setValue(fillData.ItemCode);
                    Ext.ComponentQuery.query('#txtItemDesc')[0].setValue(fillData.ItemName);
                    Ext.ComponentQuery.query('#txtPurchasePrice')[0].setValue(fillData.PurchasePrice);
                    Ext.ComponentQuery.query('#txtDepriciationPer')[0].setValue(fillData.DepreciablePercentage);
                    Ext.ComponentQuery.query('#txtLastDepeDateAD')[0].setValue(fillData.CalcDeprFrom);
                    Ext.ComponentQuery.query('#txtLastDepeDateBS')[0].setValue(fillData.CalcDeprFrom_Bs);
                    Ext.ComponentQuery.query('#txtPurchaseDateAD')[0].setValue(fillData.DateAquired);
                    Ext.ComponentQuery.query('#txtPurchaseDateBS')[0].setValue(fillData.DateAquiredBs);
                    Ext.ComponentQuery.query('#txtCurrentValue')[0].setValue(fillData.CurrentValue);
                    Ext.ComponentQuery.query('#txtLastDeprAmt')[0].setValue(fillData.LastDeprAmt);
                    Ext.ComponentQuery.query('#txtTotalMaintenance')[0].setValue(fillData.TotalMaintenance);
                    Ext.ComponentQuery.query('#txtTotalDepr')[0].setValue(fillData.TotalDepreciation);
                    Ext.ComponentQuery.query('#txtCurrentOfficeCode')[0].setValue(fillData.TranOfficeCode);
                    Ext.ComponentQuery.query('#txtCurrentOfficeCode')[0].EmpId= fillData.EmpId;
                    //Ext.ComponentQuery.query('#txtCurrentOfficeDesc')[0].setValue(deptFill.ToTranOffice_Name);



                }else{msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");    }
        });

        var assetIssueGridStore=Ext.getStore('AssetIssueGridStore');
        assetIssueGridStore.add({Action:'I'});
        //Ext.ComponentQuery.query('#grdAssetIssue')[0].getPlugin('p1').startEdit( 0, 0 ); ;

    },

    onDdlOfficeChange: function(field, newValue, oldValue, eOpts) {
        //GET FOR DEPARTMENT
        Ext.Ajax.request({
            url:'../Handlers/GeneralMasterParameters/Maintenance/DepartmentHandler.ashx',
            params:{method:'GetDepartment',OfficeCode:newValue

                   },
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    //console.log("Resu",obj.root);
                    var store =Ext.getStore('DepartmentShortStore');
                    store.removeAll();
                    store.add(obj.root);


                }else{msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");    }
        });
    },

    onBtnSaveClick: function(button, e, eOpts) {
        var objAI={
        TranOfficeCode: getOfficeCode,
        AssetCode: Ext.ComponentQuery.query('#ddlAsset')[0].getValue(),
        ReceiveSendDrop: 'D',
        FromTranOffice_Code:'',//Ext.ComponentQuery.query('#txtCurrentOfficeCode')[0].getValue(),
        ToTranOffice_Code: Ext.ComponentQuery.query('#ddlOffice')[0].getValue(),
        FromDeptCode:'',// Ext.ComponentQuery.query('#')[0].getValue(),
        ToDeptCode: Ext.ComponentQuery.query('#ddlDepartment')[0].getValue(),
        DeprCalcY_N:'Y',// Ext.ComponentQuery.query('#chkGrdDeprCalc')[0].getValue()?'Y':'N',
        CurrentValue: Ext.ComponentQuery.query('#txtScrapValue')[0].getValue(),
        TranDate: Ext.ComponentQuery.query('#txtDropDateAD')[0].getValue(),
        TranDateBs: Ext.ComponentQuery.query('#txtDropDateBS')[0].getValue(),
        TransferYN:'N',// Ext.ComponentQuery.query('#chkTransferred')[0].getValue()?'Y':'N',
        Remarks: Ext.ComponentQuery.query('#txtRemarks')[0].getValue(),
        Uncalcdepr: Ext.ComponentQuery.query('#txtUnCalcDepr')[0].getValue(),
        EmployeeId:  '',//Ext.ComponentQuery.query('#ddlAssetGivenTo')[0].getValue(),
        Username: getCurrentUser(),
        InsertUpdate:'I',
        //OutSno: '',
        };
        var waitSave = watiMsg('Saving. Please wait ...');
        Ext.Ajax.request({
             url:'../Handlers/Inventory/Transaction/FaAssetSendReceiptHandler.ashx',
             params:{method:'SaveFaAssetSendReceipt',faAssetSendReceipt:JSON.stringify(objAI)},
             success: function ( result, request ) {
        waitSave.hide();
                  var out = Ext.decode(result.responseText);
        				if(out.success==='true'){
        					msg('SUCCESS',out.message);
        						}

        				else{msg('FAILURE',out.message);


                  }
             },
             failure: function(form, action) {
        waitSave.hide();var out=Ext.decode(response.responseText);msg('FAILURE',out.message);     }
        });
    },

    onBtnSearchClick: function(button, e, eOpts) {
        Ext.Ajax.request({
            url:'../Handlers/Inventory/Transaction/AssetDetailHandler.ashx',
            params:{method:'GetAssetDetail',
                    AssetCode:'',
                    ReceiveSendDrop:'D'
                   },
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    console.log("Resu",obj.root);
                    var store =Ext.getStore('AssetIssueGridStore');
                    store.removeAll();
                    store.add(obj.root);


                }else{msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");    }
        });
    },

    onFrmAssetDisposalAfterRender: function(component, eOpts) {
        //GET FOR ASSET
        Ext.Ajax.request({
            url:'../Handlers/Inventory/Transaction/AssetHandler.ashx',
            params:{method:'GetAsset',AssetCode:null,
                    Category:null,
                    AssetDesc:null
                   },
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    //console.log("Resu",obj.root);
                    var store =Ext.getStore('AssetShortStore');
                    store.removeAll();
                    store.add(obj.root);


                }else{msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");    }
        });

        //GET FOR OFFICE
        Ext.Ajax.request({
            url:'../Handlers/Inventory/Transaction/UserOfficeHandler.ashx',
            params:{method:'GetUserOffice',UserCode:getCurrentUser(),
                    OfficeName:null
                   },
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    //console.log("Resu",obj.root);
                    var store =Ext.getStore('InstituteShortStore');
                    store.removeAll();
                    store.add(obj.root);


                }else{msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");    }
        });


    }

});