/*
 * File: app/view/StaffLoanDisbursement.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.StaffLoanDisbursement', {
    extend: 'Ext.panel.Panel',

    requires: [
        'Ext.form.Panel',
        'Ext.form.field.Number',
        'Ext.form.field.ComboBox',
        'Ext.grid.Panel',
        'Ext.grid.View',
        'Ext.toolbar.Toolbar',
        'Ext.button.Button',
        'Ext.selection.RowModel',
        'Ext.grid.plugin.RowEditing',
        'Ext.grid.column.Action'
    ],

    frame: true,
    title: 'Staff Loan Disbursement',

    layout: {
        type: 'table',
        columns: 4
    },

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmStaffLoanDisbursement',
                    bodyPadding: 10,
                    layout: {
                        type: 'table',
                        columns: 4
                    },
                    items: [
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtLoanNo',
                            fieldLabel: 'Loan No',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 53
                        },
                        {
                            xtype: 'numberfield',
                            itemId: 'txtDeduction1',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 1',
                            labelWidth: 125
                        },
                        {
                            xtype: 'numberfield',
                            itemId: 'txtDeduction2',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 2',
                            labelWidth: 120
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanDateBS',
                            fieldLabel: 'Loan Date(B.S.)',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanDateAD',
                            margin: '0 0 0 10',
                            fieldLabel: '(A.D.)',
                            labelWidth: 50,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'numberfield',
                            itemId: 'txtDeduction3',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 3',
                            labelWidth: 125
                        },
                        {
                            xtype: 'numberfield',
                            itemId: 'txtDeduction4',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 4',
                            labelWidth: 120
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtMemberCode',
                            fieldLabel: 'Member Code',
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            size: 53,
                            listeners: {
                                afterrender: {
                                    fn: me.onTxtMemberCodeAfterRender,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtTotalDeduction',
                            margin: '0 0 0 10',
                            fieldLabel: 'Total Deduction',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtNetAmountPaid',
                            margin: '0 0 0 10',
                            fieldLabel: 'Net Amount Paid',
                            labelWidth: 120,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtName',
                            fieldLabel: 'Name',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 53
                        },
                        {
                            xtype: 'combobox',
                            colspan: 2,
                            itemId: 'ddlInterestCalcMethod',
                            margin: '0 0 0 10',
                            fieldLabel: 'Interest Calc Method',
                            labelWidth: 125,
                            emptyText: '---Select---',
                            size: 30,
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'InterestCalcMethodStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtAddress',
                            fieldLabel: 'Address',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 53
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtInterestRate',
                            margin: '0 0 0 10',
                            fieldLabel: 'Interest Rate',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'combobox',
                            itemId: 'ddlLoanStatus',
                            margin: '0 0 0 10',
                            fieldLabel: 'Loan Status',
                            labelWidth: 120,
                            emptyText: '- - - Select - - -',
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'LoanStatusStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'combobox',
                            colspan: 2,
                            itemId: 'ddlEmpId',
                            fieldLabel: 'Manager',
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            emptyText: '---Select---',
                            displayField: 'EmpName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'EmployeeSearchShortStore',
                            valueField: 'EmpId'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanPeriod',
                            margin: '0 0 0 10',
                            fieldLabel: 'Loan Period',
                            labelWidth: 125
                        },
                        {
                            xtype: 'combobox',
                            itemId: 'ddlLoanPeriodType',
                            margin: '0 0 0 10',
                            fieldLabel: 'Loan Period Type',
                            labelWidth: 120,
                            emptyText: '---Select---',
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'LoanPeriodTypeStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanHeading',
                            fieldLabel: 'Loan Heading',
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            listeners: {
                                afterrender: {
                                    fn: me.onTxtLoanHeadingAfterRender,
                                    scope: me
                                },
                                change: {
                                    fn: me.onTxtLoanHeadingChange,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanHeadingDesc',
                            margin: '0 0 0 10',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 28
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtInstallmentPeriod',
                            margin: '0 0 0 10',
                            fieldLabel: 'Installment Period',
                            labelWidth: 125
                        },
                        {
                            xtype: 'combobox',
                            itemId: 'ddlInstallmentType',
                            margin: '0 0 0 10',
                            fieldLabel: 'Installment Type',
                            labelWidth: 120,
                            emptyText: '---Select---',
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'InstallmentTypeRefShortStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'combobox',
                            colspan: 2,
                            itemId: 'ddlLoanPurpose',
                            fieldLabel: 'Loan Purpose',
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            emptyText: '---Select---',
                            displayField: 'LoanPurposeDesc',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'LoanPurposeForDisbursementStore',
                            valueField: 'LoanPurposeCode',
                            listeners: {
                                select: {
                                    fn: me.onDdlLoanPurposeSelect,
                                    scope: me
                                },
                                change: {
                                    fn: me.onDdlLoanPurposeChange,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtFirstInstallDateBS',
                            fieldLabel: 'First Install Date(B.S)'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtFirstInstallDateAD',
                            fieldLabel: 'First Install Date(A.D)'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtLoanSector',
                            fieldLabel: 'Loan Sector',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 53
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtGraceDays',
                            margin: '0 0 0 10',
                            fieldLabel: 'Grace Days',
                            labelWidth: 125
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtFixedPriAmount',
                            margin: '0 0 0 10',
                            fieldLabel: 'Fixed Pri Amount',
                            labelWidth: 120,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtAppLoanAmount',
                            fieldLabel: 'App. Loan Amt'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtNoOfInstallment',
                            margin: '0 0 0 10',
                            fieldLabel: 'No Of Installment',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtInstallmentAmount',
                            margin: '0 0 0 10',
                            fieldLabel: 'Installment Amount',
                            labelWidth: 120,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtTotalLoanTaken',
                            fieldLabel: 'Total Loan Taken'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtMaturityDateBS',
                            margin: '0 0 0 10',
                            fieldLabel: 'Maturity Date(B.S.)',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtMaturityDateAD',
                            margin: '0 0 0 10',
                            fieldLabel: 'Maturity Date(A.D.)',
                            labelWidth: 120,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 30
                        },
                        {
                            xtype: 'combobox',
                            colspan: 2,
                            itemId: 'ddlFundingAgency',
                            fieldLabel: 'Funding Agency',
                            emptyText: '---Select---',
                            displayField: 'FundingAgency_Name',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'FundingAgencyStore',
                            valueField: 'FundingAgency_Code'
                        },
                        {
                            xtype: 'combobox',
                            colspan: 2,
                            itemId: 'ddlContraAccount',
                            margin: '0 0 0 10',
                            fieldLabel: 'Contra Account',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            emptyText: '---Select---',
                            size: 30,
                            displayField: 'AccountDesc',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'ContraAccountSearchShortStore',
                            valueField: 'AccountCode'
                        },
                        {
                            xtype: 'container',
                            colspan: 4,
                            layout: {
                                type: 'hbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    flex: 0,
                                    itemId: 'txtChequeNo',
                                    fieldLabel: 'Cheque No'
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            colspan: 4,
                            frame: true,
                            bodyPadding: 10,
                            title: 'Collateral Detail',
                            items: [
                                {
                                    xtype: 'gridpanel',
                                    height: 200,
                                    itemId: 'grdCollateralDetails',
                                    store: 'CollateralDetailsStore',
                                    dockedItems: [
                                        {
                                            xtype: 'toolbar',
                                            dock: 'bottom',
                                            items: [
                                                {
                                                    xtype: 'combobox',
                                                    itemId: 'ddlColateralType',
                                                    fieldLabel: 'Label',
                                                    hideLabel: true,
                                                    emptyText: '---Select---',
                                                    displayField: 'RefDtlName',
                                                    forceSelection: true,
                                                    queryMode: 'local',
                                                    store: 'CollateralTypeStore',
                                                    valueField: 'RefDtlName'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    itemId: 'txtCollateral',
                                                    fieldLabel: 'Label',
                                                    hideLabel: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    itemId: 'txtVenue',
                                                    fieldLabel: 'Label',
                                                    hideLabel: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    itemId: 'txtValue',
                                                    fieldLabel: 'Label',
                                                    hideLabel: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    itemId: 'txtValuatorName',
                                                    fieldLabel: 'Label',
                                                    hideLabel: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    itemId: 'txtValuationDate',
                                                    fieldLabel: 'Label',
                                                    hideLabel: true
                                                },
                                                {
                                                    xtype: 'button',
                                                    itemId: 'btnAddCollateralDetails',
                                                    text: 'Add',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onBtnAddCollateralDetailsClick,
                                                            scope: me
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    ],
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            width: 173,
                                            dataIndex: 'CollateralType',
                                            text: 'CollateralType',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'ddlEditCollateralType',
                                                emptyText: '---Select---',
                                                displayField: 'RefDtlName',
                                                forceSelection: true,
                                                queryMode: 'local',
                                                store: 'CollateralTypeStore',
                                                valueField: 'RefDtlName'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 148,
                                            dataIndex: 'Collateral',
                                            text: 'Collateral',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtEditCollateral'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            dataIndex: 'Venue',
                                            text: 'Venue',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtEditVenue'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 161,
                                            dataIndex: 'Value',
                                            text: 'Value',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtEditValue'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 151,
                                            dataIndex: 'ValuatorName',
                                            text: 'ValuatorName',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtEditValuatorName'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 151,
                                            dataIndex: 'ValuationDate',
                                            text: 'ValuationDate',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtEditValuationDate'
                                            }
                                        },
                                        {
                                            xtype: 'actioncolumn',
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                        Ext.Msg.confirm('Confirm Action', 'Do you want to Remove the selected Collateral Details?', function(btn) {
                                                            if(btn == 'yes'){
                                                                Ext.ComponentQuery.query('#grdCollateralDetails')[0].getSelectionModel().select(rowIndex);
                                                                //get reference of store
                                                                var store = Ext.getStore('CollateralDetailsStore');

                                                                //get selected row using rowindex
                                                                store.removeAt(rowIndex);
                                                            }
                                                        });


                                                    },
                                                    icon: '../ITS/resources/images/icons/cancel.png'
                                                }
                                            ]
                                        }
                                    ],
                                    selModel: Ext.create('Ext.selection.RowModel', {

                                    }),
                                    plugins: [
                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                            listeners: {
                                                validateedit: {
                                                    fn: me.onRowEditingValidateedit,
                                                    scope: me
                                                },
                                                canceledit: {
                                                    fn: me.onRowEditingCanceledit,
                                                    scope: me
                                                }
                                            }
                                        })
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            colspan: 4,
                            height: 28,
                            margin: '10 0 0 0 ',
                            layout: {
                                type: 'hbox',
                                align: 'stretch'
                            },
                            items: [
                                {
                                    xtype: 'button',
                                    text: 'Repayment Schedule'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            colspan: 4,
                            height: 28,
                            margin: '10 0 0 0 ',
                            layout: {
                                type: 'hbox',
                                align: 'stretch',
                                pack: 'center'
                            },
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnDisburseLoan',
                                    text: 'Disburse Loan',
                                    listeners: {
                                        click: {
                                            fn: me.onBtnDisburseLoanClick,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnDelete',
                                    text: 'Delete',
                                    listeners: {
                                        click: {
                                            fn: me.onBtnDeleteClick,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            colspan: 4,
                            frame: true,
                            margin: '10 0 0 0',
                            bodyPadding: 10,
                            title: 'Search',
                            layout: {
                                type: 'table',
                                columns: 2
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtSearchOpenDateFromBS',
                                    fieldLabel: 'Open Date From(B.S.)',
                                    labelWidth: 140
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtSearchOpenDateToBS',
                                    margin: '0 0 0 200',
                                    fieldLabel: 'Open Date To(B.S.)',
                                    labelWidth: 140
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlLoanNo',
                                    fieldLabel: 'Loan No',
                                    labelWidth: 140,
                                    fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                                    emptyText: '---Select---',
                                    displayField: 'LoanDno',
                                    forceSelection: true,
                                    queryMode: 'local',
                                    store: 'LoanNoShortStore',
                                    valueField: 'LoanNo',
                                    listeners: {
                                        select: {
                                            fn: me.onDdlLoanNoSelect,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtSearchMemberName',
                                    margin: '0 0 0 200',
                                    fieldLabel: 'Member Name',
                                    labelWidth: 140,
                                    size: 73
                                },
                                {
                                    xtype: 'container',
                                    colspan: 4,
                                    height: 28,
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch',
                                        pack: 'center'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSearchStaffLoanDisbursement',
                                            text: 'Search',
                                            listeners: {
                                                click: {
                                                    fn: me.onBtnSearchStaffLoanDisbursementClick,
                                                    scope: me
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            colspan: 4,
                            itemId: 'grdStaffLoanDisbursementDetail',
                            store: 'StaffLoanDisbursementSearchStore',
                            columns: [
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanDno',
                                    text: 'Loan No'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'ClientName',
                                    text: 'Member Name'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanProductName',
                                    text: 'Product Name'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanDate',
                                    text: 'Loan Date'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'TotalLoanAmount',
                                    text: 'Loan Amount'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanPeriod',
                                    text: 'Loan Period'
                                },
                                {
                                    xtype: 'actioncolumn',
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                Ext.ComponentQuery.query('#grdStaffLoanDisbursementDetail')[0].getSelectionModel().select(rowIndex);
                                                //get reference of store
                                                var store = Ext.getStore('StaffLoanDisbursementSearchStore');

                                                //get selected row using rowindex
                                                var row = store.getAt(rowIndex).data;


                                                // set values
                                                console.log('row',row);

                                                Ext.ComponentQuery.query('#txtLoanNo')[0].setValue(row.LoanDno);
                                                //Ext.ComponentQuery.query('#txtDeduction1')[0].setValue(row.OfficeTypeCode);
                                                //Ext.ComponentQuery.query('#txtDeduction2')[0].setValue(row.OfficeTypeName);
                                                Ext.ComponentQuery.query('#txtLoanDateBS')[0].setValue(row.LoanDateBs);
                                                Ext.ComponentQuery.query('#txtLoanDateAD')[0].setValue(row.LoanDate);
                                                //Ext.ComponentQuery.query('#txtDeduction3')[0].setValue(row.DistrictCode);
                                                //Ext.ComponentQuery.query('#txtDeduction4')[0].setValue(row.DistrictName);
                                                Ext.ComponentQuery.query('#txtMemberCode')[0].setValue(row.ClientCode);
                                                //Ext.ComponentQuery.query('#txtTotalDeduction')[0].setValue(row.VdcName);
                                                Ext.ComponentQuery.query('#txtNetAmountPaid')[0].setValue(row.TotalPrincipalPaid);
                                                Ext.ComponentQuery.query('#txtName')[0].setValue(row.ClientName);
                                                Ext.ComponentQuery.query('#ddlInterestCalcMethod')[0].setValue(row.InterestCalcMethod);
                                                Ext.ComponentQuery.query('#txtAddress')[0].setValue(row.Address);
                                                Ext.ComponentQuery.query('#txtInterestRate')[0].setValue(row.InterestRate);
                                                Ext.ComponentQuery.query('#ddlLoanStatus')[0].setValue(row.LoanStatus);
                                                Ext.ComponentQuery.query('#ddlEmpId')[0].setValue(row.EmployeeId);
                                                Ext.ComponentQuery.query('#txtLoanPeriod')[0].setValue(row.LoanPeriod);
                                                Ext.ComponentQuery.query('#ddlLoanPeriodType')[0].setValue(row.LoanPeriodType);
                                                Ext.ComponentQuery.query('#txtLoanHeading')[0].setValue(row.LoanProductCode);
                                                Ext.ComponentQuery.query('#txtLoanHeadingDesc')[0].setValue(row.LoanProductName);
                                                Ext.ComponentQuery.query('#txtInstallmentPeriod')[0].setValue(row.InstallmentPeriod);
                                                Ext.ComponentQuery.query('#ddlInstallmentType')[0].setValue(row.InstallmentPeriodType);
                                                Ext.ComponentQuery.query('#ddlLoanPurpose')[0].setValue(row.LoanPurposeCode);
                                                //Ext.ComponentQuery.query('#txtLoanSector')[0].setValue(row.AbbsDepositLimit);
                                                Ext.ComponentQuery.query('#txtGraceDays')[0].setValue(row.GraceDays);
                                                Ext.ComponentQuery.query('#txtFixedPriAmount')[0].setValue(row.FixedPrincipalAmount);
                                                Ext.ComponentQuery.query('#txtAppLoanAmount')[0].setValue(row.ApprovedLoanAmount);
                                                Ext.ComponentQuery.query('#txtNoOfInstallment')[0].setValue(row.NoOfInstallment);
                                                Ext.ComponentQuery.query('#txtInstallmentAmount')[0].setValue(row.InstallmentAmount);
                                                Ext.ComponentQuery.query('#txtTotalLoanTaken')[0].setValue(row.TotalLoanAmount);
                                                Ext.ComponentQuery.query('#txtMaturityDateBS')[0].setValue(row.LoanMatureBs);
                                                Ext.ComponentQuery.query('#txtMaturityDateAD')[0].setValue(row.LoanMaturityDate);
                                                Ext.ComponentQuery.query('#ddlFundingAgency')[0].setValue(row.FundingAgencyCode);
                                                Ext.ComponentQuery.query('#ddlContraAccount')[0].setValue(row.AccountNo);
                                                Ext.ComponentQuery.query('#txtChequeNo')[0].setValue(row.ChequeNo);



                                                //set buttons visible

                                                //Ext.ComponentQuery.query('#btnDeleteOfficeInfo')[0].setVisible(true);
                                                //Ext.ComponentQuery.query('#BtnInsertOfficeInfo')[0].setVisible(false);
                                            },
                                            icon: '../ITS/resources/images/icons/Modify.png'
                                        }
                                    ]
                                }
                            ],
                            selModel: Ext.create('Ext.selection.RowModel', {

                            })
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnClientNo',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction1Code',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction2Code',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction3Code',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction4Code',
                            fieldLabel: 'Label'
                        }
                    ],
                    listeners: {
                        afterrender: {
                            fn: me.onFrmStaffLoanDisbursementAfterRender,
                            scope: me
                        }
                    }
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtMemberCodeAfterRender: function(component, eOpts) {
        component.getEl().on('dblclick', function(){
            var winPopup = Ext.create('MyApp.view.SelectMemberForLoanDisbursementPopup',{

            });
            winPopup.extraParam={param:null};
            winPopup.show();
        });
    },

    onTxtLoanHeadingAfterRender: function(component, eOpts) {
        component.getEl().on('dblclick', function(){
            var winPopup = Ext.create('MyApp.view.SelectLoanHeadingForLoanDisbursementPopup',{

            });
            winPopup.extraParam={param:null};
            winPopup.show();
        });
    },

    onTxtLoanHeadingChange: function(field, newValue, oldValue, eOpts) {
        Ext.Ajax.request({
                   url: '../Handlers/Finance/Maintenance/LoanPurposeHandler.ashx',
                   params: {
                       method:'GetMfLoanPurpose',
                       productCode:Ext.ComponentQuery.query('#txtLoanHeading')[0].getValue(),
                       purposeName:null

                   },
                   success: function(response){


                       var obj = Ext.decode(response.responseText);



                       if(obj.success === "true")
                       {

                           var store=Ext.getStore('LoanPurposeForDisbursementStore');
                           store.removeAll();
                           store.add(obj.root);

                       }
                       else
                       {
                           msg("FAILURE",obj.message);
                       }
                   }
               });
    },

    onDdlLoanPurposeSelect: function(combo, records, eOpts) {
        console.log('records',records);
        Ext.ComponentQuery.query('#txtLoanSector')[0].setValue(records[0].data.LoanSectorDesc);

    },

    onDdlLoanPurposeChange: function(field, newValue, oldValue, eOpts) {
        console.log('newValue',newValue);
        console.log('oldValue',oldValue);
    },

    onBtnAddCollateralDetailsClick: function(button, e, eOpts) {
        var collateralType=Ext.ComponentQuery.query('#ddlColateralType')[0];
        var collateral=Ext.ComponentQuery.query('#txtCollateral')[0];
        var venue=Ext.ComponentQuery.query('#txtVenue')[0];
        var value=Ext.ComponentQuery.query('#txtValue')[0];
        var valuator=Ext.ComponentQuery.query('#txtValuatorName')[0];
        var valuationDate=Ext.ComponentQuery.query('#txtValuationDate')[0];


        var store=Ext.getStore('CollateralDetailsStore');
        var collateralDetails ={
                        CollateralType :collateralType.getValue(),
                        Collateral : collateral.getValue(),
                        Venue : venue.getValue(),
        				Value:value.getValue(),
                        ValuatorName:valuator.getValue(),
                        ValuationDate:valuationDate.getValue()
        };

        store.add(collateralDetails);


        collateralType.reset();
        collateral.setValue('');
        venue.setValue('');
        value.setValue('');
        valuator.setValue('');
        valuationDate.setValue('');

    },

    onRowEditingValidateedit: function(editor, e, eOpts) {
        /*console.log('editor',editor);
        console.log('e',e);
        console.log('eOpts',eOpts);
        var rowIndex=e.row.rowIdx;
        console.log('rowIndex',rowIndex)
        Ext.ComponentQuery.query('#grdStaffLoanDisbursementDetail')[0].getSelectionModel().select(rowIndex);
        //get reference of store
        var store = Ext.getStore('StaffLoanDisbursementSearchStore');

        //get selected row using rowindex
        var row = store.getAt(rowIndex);
        row.CollateralType=Ext.ComponentQuery.query('#ddlEditCollateralType')[0].getValue();
        row.Collateral=Ext.ComponentQuery.query('#txtEditCollateral')[0].getValue();
        row.Venue=Ext.ComponentQuery.query('#txtEditVenue')[0].getValue();
        row.Value=Ext.ComponentQuery.query('#txtEditvalue')[0].getValue();
        row.ValuatorName=Ext.ComponentQuery.query('#txtEditValuatorName')[0].getValue();
        row.ValuationDate=Ext.ComponentQuery.query('#ddlEditValuatorDate')[0].getValue();
        */
    },

    onRowEditingCanceledit: function(editor, e, eOpts) {

    },

    onBtnDisburseLoanClick: function(button, e, eOpts) {
        var insObj={
        ChequeNo:Ext.ComponentQuery.query('#txtChequeNo')[0].getValue(),
        LoanDate:Ext.ComponentQuery.query('#txtLoanDateAD')[0].getValue(),
        LoanMaturityDate:Ext.ComponentQuery.query('#txtMaturityDateAD')[0].getValue(),
        LoanProductCode:Ext.ComponentQuery.query('#txtLoanHeading')[0].getValue(),
        ClientNo:Ext.ComponentQuery.query('#hdnClientNo')[0].getValue(),
        LoanPurposeCode:Ext.ComponentQuery.query('#ddlLoanPurpose')[0].getValue(),
        ApprovedLoanAmount:Ext.ComponentQuery.query('#txtAppLoanAmount')[0].getValue(),
        TotalLoanAmount:Ext.ComponentQuery.query('#txtTotalLoanTaken')[0].getValue(),
        LoanPeriodType:Ext.ComponentQuery.query('#ddlLoanPeriodType')[0].getValue(),
        LoanPeriod:Ext.ComponentQuery.query('#txtLoanPeriod')[0].getValue(),
        GraceDays:Ext.ComponentQuery.query('#txtGraceDays')[0].getValue(),
        EmployeeId:Ext.ComponentQuery.query('#ddlEmpId')[0].getValue(),
        InterestRate:Ext.ComponentQuery.query('#txtInterestRate')[0].getValue(),
        InterestCalcMethod:Ext.ComponentQuery.query('#ddlInterestCalcMethod')[0].getValue(),
        LoanCloseDate:null,
        LoanStatus:Ext.ComponentQuery.query('#ddlLoanStatus')[0].getValue(),
        Rating:null,
        InstallmentAmount:Ext.ComponentQuery.query('#txtInstallmentAmount')[0].getValue(),
        RefAccountNo:null,
        InstallmentPeriodType:Ext.ComponentQuery.query('#ddlInstallmentType')[0].getValue(),
        InstallmentPeriod:Ext.ComponentQuery.query('#txtInstallmentPeriod')[0].getValue(),
        PrincipalArrear:'0',
        PrincipalAmount:'0',
        YearNo:'0',
        WithdrawalNo:'0',
        ChkAdjustSaving:'N',
        SavingAccountNo:null,
        InsurancePolicyNo:null,
        TranOfficeCode:getOfficeCode(),
        FixedPrincipalAmount:Ext.ComponentQuery.query('#txtFixedPriAmount')[0].getValue(),
        FirstInstallDate:Ext.ComponentQuery.query('#txtFirstInstallDateAD')[0].getValue(),
        ClientCenter:'c',
        FixedInterestAmount:'0',
        ContraAccount:Ext.ComponentQuery.query('#ddlContraAccount')[0].getValue(),
        Deduction1Code:Ext.ComponentQuery.query('#hdnDeduction1Code')[0].getValue(),
        Deduction1Desc:'Deduction 1',
        DeductionAmount1:Ext.ComponentQuery.query('#txtDeduction1')[0].getValue(),
        Deduction2Code:Ext.ComponentQuery.query('#hdnDeduction3Code')[0].getValue(),
        Deduction2Desc:'Deduction 2',
        DeductionAmount2:Ext.ComponentQuery.query('#txtDeduction2')[0].getValue(),
        Deduction3Code:Ext.ComponentQuery.query('#hdnDeduction3Code')[0].getValue(),
        Deduction3Desc:'Deduction 3',
        DeductionAmount3:Ext.ComponentQuery.query('#txtDeduction3')[0].getValue(),
        Deduction4Code:Ext.ComponentQuery.query('#hdnDeduction4Code')[0].getValue(),
        Deduction4Desc:'Deduction 4',
        DeductionAmount4:Ext.ComponentQuery.query('#txtDeduction4')[0].getValue(),
        NoOfInstallment:Ext.ComponentQuery.query('#txtNoOfInstallment')[0].getValue(),
        FundingAgencyCode:Ext.ComponentQuery.query('#ddlFundingAgency')[0].getValue(),
        CreatedBy:getCurrentUser(),
        Action:'I'
        };



        var waitSave = watiMsg("Saving..Please wait ...");
        Ext.Ajax.request({
        	url: '../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanDisbursementHandler.ashx',
        	params: {
        	method:'SaveStaffLoanDisbursement',
        	staffLoanDisbursement:JSON.stringify(insObj)
        	},
        	success: function ( response, request ) {
        		waitSave.hide();
        		var out=Ext.decode(response.responseText);
        		console.log(out);
        		if(out.success==="true")
        			{
        				msg("SUCCESS",out.message);
        			}
        		else
        			{
        				msg("FAILURE",out.message);
        			}
        	},
        	failure: function ( result, request ) {
        		waitSave.hide();
        		var out=Ext.decode(response.responseText);
        		msg("FAILURE",out.message);
        	}
         });
    },

    onBtnDeleteClick: function(button, e, eOpts) {
        var insObj={
        ChequeNo:Ext.ComponentQuery.query('#txtChequeNo')[0].getValue(),
        LoanDate:Ext.ComponentQuery.query('#txtLoanDateAD')[0].getValue(),
        LoanMaturityDate:Ext.ComponentQuery.query('#txtMaturityDateAD')[0].getValue(),
        LoanProductCode:Ext.ComponentQuery.query('#txtLoanHeading')[0].getValue(),
        ClientNo:Ext.ComponentQuery.query('#hdnClientNo')[0].getValue(),
        LoanPurposeCode:Ext.ComponentQuery.query('#ddlLoanPurpose')[0].getValue(),
        ApprovedLoanAmount:Ext.ComponentQuery.query('#txtAppLoanAmount')[0].getValue(),
        TotalLoanAmount:Ext.ComponentQuery.query('#txtTotalLoanTaken')[0].getValue(),
        LoanPeriodType:Ext.ComponentQuery.query('#ddlLoanPeriodType')[0].getValue(),
        LoanPeriod:Ext.ComponentQuery.query('#txtLoanPeriod')[0].getValue(),
        GraceDays:Ext.ComponentQuery.query('#txtGraceDays')[0].getValue(),
        EmployeeId:Ext.ComponentQuery.query('#ddlEmpId')[0].getValue(),
        InterestRate:Ext.ComponentQuery.query('#txtInterestRate')[0].getValue(),
        InterestCalcMethod:Ext.ComponentQuery.query('#ddlInterestCalcMethod')[0].getValue(),
        LoanCloseDate:null,
        LoanStatus:Ext.ComponentQuery.query('#ddlLoanStatus')[0].getValue(),
        Rating:null,
        InstallmentAmount:Ext.ComponentQuery.query('#txtInstallmentAmount')[0].getValue(),
        RefAccountNo:null,
        InstallmentPeriodType:Ext.ComponentQuery.query('#ddlInstallmentType')[0].getValue(),
        InstallmentPeriod:Ext.ComponentQuery.query('#txtInstallmentPeriod')[0].getValue(),
        PrincipalArrear:'0',
        PrincipalAmount:'0',
        YearNo:'0',
        WithdrawalNo:'0',
        ChkAdjustSaving:'N',
        SavingAccountNo:null,
        InsurancePolicyNo:null,
        TranOfficeCode:getOfficeCode(),
        FixedPrincipalAmount:Ext.ComponentQuery.query('#txtFixedPriAmount')[0].getValue(),
        FirstInstallDate:Ext.ComponentQuery.query('#txtFirstInstallDateAD')[0].getValue(),
        ClientCenter:'c',
        FixedInterestAmount:'0',
        ContraAccount:Ext.ComponentQuery.query('#ddlContraAccount')[0].getValue(),
        Deduction1Code:Ext.ComponentQuery.query('#hdnDeduction1Code')[0].getValue(),
        Deduction1Desc:'Deduction 1',
        DeductionAmount1:Ext.ComponentQuery.query('#txtDeduction1')[0].getValue(),
        Deduction2Code:Ext.ComponentQuery.query('#hdnDeduction3Code')[0].getValue(),
        Deduction2Desc:'Deduction 2',
        DeductionAmount2:Ext.ComponentQuery.query('#txtDeduction2')[0].getValue(),
        Deduction3Code:Ext.ComponentQuery.query('#hdnDeduction3Code')[0].getValue(),
        Deduction3Desc:'Deduction 3',
        DeductionAmount3:Ext.ComponentQuery.query('#txtDeduction3')[0].getValue(),
        Deduction4Code:Ext.ComponentQuery.query('#hdnDeduction4Code')[0].getValue(),
        Deduction4Desc:'Deduction 4',
        DeductionAmount4:Ext.ComponentQuery.query('#txtDeduction4')[0].getValue(),
        NoOfInstallment:Ext.ComponentQuery.query('#txtNoOfInstallment')[0].getValue(),
        FundingAgencyCode:Ext.ComponentQuery.query('#ddlFundingAgency')[0].getValue(),
        CreatedBy:getCurrentUser(),
        Action:'D'
        };



        var waitSave = watiMsg("Deleting..Please wait ...");
        Ext.Ajax.request({
        	url: '../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanDisbursementHandler.ashx',
        	params: {
        	method:'SaveStaffLoanDisbursement',
        	staffLoanDisbursement:JSON.stringify(insObj)
        	},
        	success: function ( response, request ) {
        		waitSave.hide();
        		var out=Ext.decode(response.responseText);
        		console.log(out);
        		if(out.success==="true")
        			{
        				msg("SUCCESS",out.message);
        			}
        		else
        			{
        				msg("FAILURE",out.message);
        			}
        	},
        	failure: function ( result, request ) {
        		waitSave.hide();
        		var out=Ext.decode(response.responseText);
        		msg("FAILURE",out.message);
        	}
         });
    },

    onDdlLoanNoSelect: function(combo, records, eOpts) {
        Ext.ComponentQuery.query('#txtSearchMemberName')[0].setValue(records[0].data.ClientName);
    },

    onBtnSearchStaffLoanDisbursementClick: function(button, e, eOpts) {
        var waitSave = watiMsg('Please wait ...');
                Ext.Ajax.request({
                    url: '../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanDisbursementDetailHandler.ashx',
                    params:{
                        method:'GetStaffLoanDisDetail',
                        OfficeCode:getOfficeCode(),
                        LoanNo:Ext.ComponentQuery.query('#ddlLoanNo')[0].getValue(),
                        ClientName:Ext.ComponentQuery.query('#txtSearchMemberName')[0].getValue(),
                        FromDate:null,
                        ToDate:null
                    },
                    success: function ( result, request ) {
                        waitSave.hide();
                        var obj = Ext.decode(result.responseText);
                        if(obj.success === 'true'){
                            var store =Ext.getStore('StaffLoanDisbursementSearchStore');
                            store.removeAll();
                            store.add(obj.root);


                        }
                        else{
                            msg("FAILURE","Could Not Load Data");
                        }

                    },
                    failure: function(form, action) {
                        msg("FAILURE","Could Not Load Data");
                    }
                });
    },

    onFrmStaffLoanDisbursementAfterRender: function(component, eOpts) {
        Ext.ComponentQuery.query('#txtLoanDateBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtSearchOpenDateFromBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtSearchOpenDateToBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtLoanDateAD')[0].setValue(getMisDateAD());

        var staffLoanDisbursementSearchStore=Ext.getStore('StaffLoanDisbursementSearchStore');
        staffLoanDisbursementSearchStore.removeAll();

        var interestCalcMethodStore=Ext.getStore('InterestCalcMethodStore');
        getReferences('LOAN_INTEREST_CALC_METHOD',function(data){
            interestCalcMethodStore.removeAll();
            interestCalcMethodStore.add(data.root);
        });

        var loanStatusStore=Ext.getStore('LoanStatusStore');
        getReferences('LOAN_STATUS',function(data){
            loanStatusStore.removeAll();
            loanStatusStore.add(data.root);
        });

        var loanPeriodTypeStore=Ext.getStore('LoanPeriodTypeStore');
        getReferences('LOAN_PERIOD_TYPE',function(data){
            loanPeriodTypeStore.removeAll();
            loanPeriodTypeStore.add(data.root);
        });

        var installmentTypeRefShortStore=Ext.getStore('InstallmentTypeRefShortStore');
        getReferences('INSTALLMENT_PERIOD_TYPE',function(data){
            installmentTypeRefShortStore.removeAll();
            installmentTypeRefShortStore.add(data.root);
        });

        var collateralTypeStore=Ext.getStore('CollateralTypeStore');
        getReferences('COLLATERAL_TYPE',function(data){
            collateralTypeStore.removeAll();
            collateralTypeStore.add(data.root);
        });
        var employeeSearchStore=Ext.getStore('EmployeeSearchShortStore');
        getfieldAssistants(getOfficeCode(),null,function(data){
                employeeSearchStore.removeAll();
                employeeSearchStore.add(data.root);
        });

        var fundingAgencyStore=Ext.getStore('FundingAgencyStore');
        getFundingAgencies(function(data){
            fundingAgencyStore.removeAll();
            fundingAgencyStore.add(data.root);
        });

        var contraAccountStore=Ext.getStore('ContraAccountSearchShortStore');
        getContraAccount(getOfficeCode(),null,function(data){
            contraAccountStore.removeAll();
            contraAccountStore.add(data.root);
            Ext.ComponentQuery.query('#ddlContraAccount')[0].select('100000021000002');
        });


        Ext.Ajax.request({
            url: '../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanDisbursementLoanHandler.ashx',
            params: {
                method:'GetStaffLoanDisLoan',
                OfficeCode:getOfficeCode(),
                EmpName:null,
            },
            success: function(response){


        var obj = Ext.decode(response.responseText);

         console.log('resp',response);

              if(obj.success === "true")
                        {

                            var DestinationFormatStore=Ext.getStore('LoanNoShortStore');
                            DestinationFormatStore.removeAll();
                            DestinationFormatStore.add(obj.root);

                        }
                        else
                        {
                            msg("FAILURE",obj.message);
                        }
            }
        });
    }

});