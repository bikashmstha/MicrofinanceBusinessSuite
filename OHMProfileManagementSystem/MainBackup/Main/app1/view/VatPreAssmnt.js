/*
 * File: app/view/VatPreAssmnt.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.VatPreAssmnt', {
    extend: 'Ext.panel.Panel',

    frame: true,
    itemId: 'pnlVatPreAssmnt',
    width: 800,
    autoScroll: true,
    title: 'प्रारम्भिक कर निर्धारण आदेश',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    height: 955,
                    itemId: 'frmVatPreAssmnt',
                    margin: 5,
                    maxHeight: 955,
                    autoScroll: true,
                    layout: {
                        align: 'stretch',
                        type: 'vbox'
                    },
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'label',
                            flex: 1,
                            margin: '0 0 0 160',
                            maxHeight: 50,
                            style: 'font-size:20px',
                            text: 'प्रारम्भिक कर निर्धारण आदेश'
                        },
                        {
                            xtype: 'displayfield',
                            flex: 1,
                            height: 30,
                            itemId: 'lblActionVpa',
                            maxHeight: 30,
                            fieldLabel: '',
                            fieldStyle: '{color:red;}'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtOfficeCodeVpa',
                            maxWidth: 200,
                            width: 200,
                            fieldLabel: 'कार्यलय कोड',
                            labelWidth: 160,
                            readOnly: true
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            height: 30,
                            itemId: 'cntMaNoVpa',
                            maxHeight: 30,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtMaNoVpa',
                                    maxWidth: 250,
                                    width: 250,
                                    fieldLabel: 'कर निर्धारण आदेश नं.',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    readOnly: true,
                                    emptyText: 'Enter Ma No.',
                                    enableKeyEvents: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 10,
                                    minLength: 10
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblMaNoVpa',
                                    margin: '-10 0 0 5',
                                    fieldLabel: '',
                                    value: '(कर निर्धारण आदेश नं. Submit वा Save भएपछि मात्र देखिनेछ ।)'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntPanVpa',
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtPanVpa',
                                    maxWidth: 250,
                                    width: 250,
                                    fieldLabel: 'करदाता दर्ता नम्बर',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    blankText: 'Please Enter PAN No.',
                                    emptyText: 'Enter Pan No.',
                                    enableKeyEvents: true,
                                    enforceMaxLength: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 9,
                                    minLength: 9,
                                    listeners: {
                                        blur: {
                                            fn: me.onTxtPanVpaBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtAcctTypeVpa',
                                    margin: '0 0 0 115',
                                    maxWidth: 200,
                                    width: 150,
                                    fieldLabel: 'खाताको किसिम',
                                    readOnly: true,
                                    enforceMaxLength: true,
                                    maxLength: 2,
                                    minLength: 2
                                }
                            ]
                        },
                        {
                            xtype: 'textfield',
                            flex: 1,
                            itemId: 'txtNameVpa',
                            maxHeight: 25,
                            maxWidth: 620,
                            fieldLabel: 'नाम',
                            labelWidth: 160,
                            readOnly: true
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntAddressPhoneVpa',
                            maxHeight: 28,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtAddressVpa',
                                    fieldLabel: 'ठेगाना',
                                    labelWidth: 160,
                                    readOnly: true
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtPhoneVpa',
                                    margin: '0 0 0 50',
                                    fieldLabel: 'फोन नं.',
                                    readOnly: true
                                }
                            ]
                        },
                        {
                            xtype: 'textfield',
                            flex: 1,
                            itemId: 'txtAssessPeriodVpa',
                            maxHeight: 24,
                            maxWidth: 315,
                            fieldLabel: 'कर निर्धारण भएको अवधि',
                            labelWidth: 160,
                            msgTarget: 'side',
                            allowBlank: false
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntSectionRuleVpa',
                            maxHeight: 28,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtSectionVpa',
                                    fieldLabel: 'कर निर्धारण गर्ने ऐनको दफा',
                                    labelSeparator: ' ',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    allowBlank: false
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtRuleVpa',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'तथा नियमावलीको नियम',
                                    labelSeparator: ' ',
                                    labelWidth: 130,
                                    msgTarget: 'side',
                                    allowBlank: false
                                },
                                {
                                    xtype: 'displayfield',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'संग सम्बन्धित',
                                    labelSeparator: ' '
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntBankVpa',
                            maxHeight: 28,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtBankVpa',
                                    fieldLabel: 'बैक',
                                    labelSeparator: ' ',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    enableKeyEvents: true,
                                    listeners: {
                                        keyup: {
                                            fn: me.onTxtBankVpaKeyup,
                                            scope: me
                                        },
                                        focus: {
                                            fn: me.onTxtBankVpaFocus,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtBankVpaKeypress,
                                            scope: me
                                        },
                                        change: {
                                            fn: me.onTxtBankVpaChange,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtBranchVpa',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'शाखा',
                                    labelSeparator: ' ',
                                    labelWidth: 130,
                                    msgTarget: 'side',
                                    enableKeyEvents: true,
                                    listeners: {
                                        keyup: {
                                            fn: me.onTxtBranchVpaKeyup,
                                            scope: me
                                        },
                                        focus: {
                                            fn: me.onTxtBranchVpaFocus,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtBranchVpaKeypress,
                                            scope: me
                                        },
                                        change: {
                                            fn: me.onTxtBranchVpaChange,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'combobox',
                            flex: 1,
                            itemId: 'cboMaReasonCodeVpa',
                            maxHeight: 27,
                            maxWidth: 620,
                            fieldLabel: 'कर निर्धारण गर्न पर्ने कारण',
                            labelWidth: 160,
                            msgTarget: 'side',
                            allowBlank: false,
                            emptyText: 'छान्नुहोस् ...',
                            displayField: 'MaReasonNp',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'MaReason',
                            typeAhead: true,
                            valueField: 'MaReasonCode'
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            margins: '0 0 2 215',
                            itemId: 'cntAppealVpa',
                            maxHeight: 98,
                            items: [
                                {
                                    xtype: 'textfield',
                                    disabled: true,
                                    itemId: 'txtAppealNoVpa',
                                    fieldLabel: 'पुनरावेदनको निर्णय अनुसार भएको भए पुनरावेदन नं',
                                    labelWidth: 250,
                                    maskRe: /[0-9]/,
                                    maxLength: 6
                                },
                                {
                                    xtype: 'textareafield',
                                    disabled: true,
                                    itemId: 'txtMaReasonDescVpa',
                                    maxWidth: 405,
                                    width: 405,
                                    fieldLabel: 'अन्य भए विवरण',
                                    enableKeyEvents: true,
                                    listeners: {
                                        keyup: {
                                            fn: me.onTxtMaReasonDescVpaKeyup,
                                            scope: me
                                        },
                                        focus: {
                                            fn: me.onTxtMaReasonDescVpaFocus,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtMaReasonDescVpaKeypress,
                                            scope: me
                                        },
                                        change: {
                                            fn: me.onTxtMaReasonDescVpaChange,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntDatesVpa',
                            margin: '4 0 0 0 ',
                            maxHeight: 30,
                            maxWidth: 590,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtIntCalUptoVpa',
                                    margin: '2 0 0 0 ',
                                    maxWidth: 300,
                                    width: 300,
                                    fieldLabel: 'व्याज र जरिवाना गणना गरिएको मिति',
                                    labelWidth: 200,
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    emptyText: 'YYYY.MM.DD',
                                    enforceMaxLength: true,
                                    maskRe: /[0-9.]/,
                                    maxLength: 10,
                                    minLength: 10,
                                    listeners: {
                                        blur: {
                                            fn: me.onTextfieldBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtEffDateVpa',
                                    margin: '0 0 0 70',
                                    maxWidth: 250,
                                    width: 250,
                                    fieldLabel: 'प्रारम्भिक कर निर्धारण मिति',
                                    labelWidth: 150,
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    emptyText: 'YYYY.MM.DD',
                                    enforceMaxLength: false,
                                    maskRe: /[0-9.]/,
                                    minLength: 10,
                                    selectOnFocus: true,
                                    listeners: {
                                        blur: {
                                            fn: me.onTextfieldBlur1,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntGrdTaxDurationVpa',
                            margin: '20 5 5 0',
                            maxWidth: 970,
                            width: 970,
                            layout: {
                                align: 'stretch',
                                type: 'vbox'
                            },
                            items: [
                                {
                                    xtype: 'label',
                                    margin: '0 0 0 160',
                                    style: 'font-size:20px',
                                    text: 'कर अवधि'
                                },
                                {
                                    xtype: 'toolbar',
                                    flex: 1,
                                    height: 23,
                                    itemId: 'tbrAddVpa',
                                    margin: '10 0 0 0',
                                    maxHeight: 50,
                                    maxWidth: 967,
                                    width: 967,
                                    items: [
                                        {
                                            xtype: 'button',
                                            disabled: true,
                                            itemId: 'btnAddVpa',
                                            iconCls: 'icon-add',
                                            text: 'Add'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    height: 200,
                                    itemId: 'grdTaxDurationVpa',
                                    margin: '',
                                    maxHeight: 600,
                                    maxWidth: 967,
                                    minHeight: 100,
                                    width: 967,
                                    autoScroll: true,
                                    title: 'कर अवधि',
                                    store: 'TaxDurationVpa',
                                    columns: [
                                        {
                                            xtype: 'rownumberer',
                                            width: 35,
                                            text: 'क्र.सं.'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'FilPeriod',
                                            text: 'मा / चौ / द्वै',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cboFilingPeriodVpa',
                                                name: 'cboFilingPeriod',
                                                emptyText: 'select ...',
                                                displayField: 'FilPeriodDesc',
                                                forceSelection: true,
                                                queryMode: 'local',
                                                store: 'FilingPeriodStore',
                                                valueField: 'FilPeriod'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Period',
                                            text: 'कर अवधि',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cboPeriodVpa',
                                                emptyText: 'Select ...',
                                                displayField: 'PeriodDesc',
                                                queryMode: 'local',
                                                store: 'Period',
                                                valueField: 'Period'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'TaxYear',
                                            text: 'वर्ष',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtTaxYearVpa',
                                                emptyText: 'YYYY',
                                                maskRe: /[0-9]/,
                                                maxLength: 4
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            cls: 'TxtRight',
                                            width: 150,
                                            defaultWidth: 120,
                                            align: 'right',
                                            dataIndex: 'MaAmount',
                                            groupable: false,
                                            text: 'कर निर्धारण भएको रकम (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtMaAmountVpa',
                                                labelAlign: 'right',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10,
                                                vtype: 'alphanum'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'PenAmount',
                                            text: 'जरिवाना (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtPenAmountVpa',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'AddAmount',
                                            text: 'थप दस्तुर (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtAddAmountVpa',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'IntAmount',
                                            text: 'व्याज (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtIntAmountVpa',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'TotAmount',
                                            text: 'जम्मा (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                id: 'totalamt',
                                                itemId: 'txtTotAmountVpa',
                                                fieldCls: 'TxtRight',
                                                readOnly: true
                                            }
                                        },
                                        {
                                            xtype: 'actioncolumn',
                                            width: 80,
                                            align: 'center',
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e) {
                                                        var store = Ext.getStore('TaxDurationVpa');
                                                        var grd =  Ext.ComponentQuery.query('#grdTaxDurationVpa')[0];
                                                        var row = store.getAt(rowIndex).data;

                                                        var finAmount = Ext.ComponentQuery.query('#lblFinTotalVpa')[0];
                                                        var totAmount = (row.TotAmount === "")?0:row.TotAmount;


                                                        Ext.Msg.confirm('Confirm Action', 'Do you want to Remove ?', function(btn) {
                                                            if(btn == 'yes'){

                                                                overallTot = parseFloat(finAmount.getValue())-parseFloat(totAmount);        
                                                                finAmount.setValue(overallTot);

                                                                if(row.Action === "E")
                                                                {    
                                                                    row.Action = "D";
                                                                    grd.bindStore(store);         
                                                                    store.filter(function(item){
                                                                        return item.get("Action")!= 'D';
                                                                    });
                                                                }
                                                                else
                                                                {
                                                                    store.removeAt(rowIndex);
                                                                }

                                                                return true;
                                                            }
                                                        }, this);
                                                    },
                                                    icon: '../ITS/resources/images/icons/cancel.png'
                                                }
                                            ]
                                        }
                                    ],
                                    plugins: [
                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                            pluginId: 'grdTaxDurationPluginVpa',
                                            listeners: {
                                                edit: {
                                                    fn: me.onGridroweditingpluginVpaEdit,
                                                    scope: me
                                                },
                                                validateedit: {
                                                    fn: me.onGridroweditingpluginVpaValidateedit,
                                                    scope: me
                                                },
                                                canceledit: {
                                                    fn: me.onGridroweditingpluginVpaCanceledit,
                                                    scope: me
                                                },
                                                beforeedit: {
                                                    fn: me.onGridroweditingpluginVpaBeforeEdit,
                                                    scope: me
                                                }
                                            }
                                        })
                                    ]
                                },
                                {
                                    xtype: 'displayfield',
                                    flex: 1,
                                    itemId: 'lblFinTotalVpa',
                                    margin: '0 0 0 360',
                                    fieldLabel: 'कुल जम्मा',
                                    labelPad: 35,
                                    labelSeparator: ':  रू',
                                    value: 0.00
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    itemId: 'hdnActionVpa',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnFilePerVpa',
                                    width: 100,
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    itemId: 'hdnTranNoVpa',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'container',
                                    flex: 1,
                                    itemId: 'cntButtonsVpa',
                                    margin: '5 0',
                                    maxHeight: 50,
                                    maxWidth: 967,
                                    width: 967,
                                    layout: {
                                        align: 'middle',
                                        pack: 'end',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            flex: 1,
                                            margins: '0 65 0 0',
                                            itemId: 'btnPrintVpa',
                                            padding: 5,
                                            iconCls: 'icon-print',
                                            text: 'Print'
                                        },
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSaveVpa',
                                            margin: '',
                                            padding: 5,
                                            iconCls: 'icon-save',
                                            text: 'Save'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5',
                                            itemId: 'btnEditVpa',
                                            padding: 5,
                                            iconCls: 'icon-edit',
                                            text: 'Edit'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5',
                                            itemId: 'btnDeleteVpa',
                                            padding: 5,
                                            iconCls: 'icon-delete',
                                            text: 'Delete'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5 ',
                                            itemId: 'btnSubmitVpa',
                                            padding: 5,
                                            iconCls: 'icon-ok',
                                            text: 'Submit'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5',
                                            itemId: 'btnCancelVpa',
                                            padding: 5,
                                            iconCls: 'icon-cancel',
                                            text: 'Cancel'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtPanVpaBlur: function(component, e, eOpts) {
        var me = this;

        if(field.getValue !== "")
        {
            return ValidatePan(field.getValue(),"00",function(){field.focus();});
        }

        return true;
    },

    onTxtBankVpaKeyup: function(textfield, e, eOpts) {
        if(textfield.getValue().substring(0,9) === "undefined")
        {

            textfield.setValue(textfield.getValue().substring(9,textfield.getValue().length + 8));
        }

        else 
        {
            if((e.keyCode >= 8 &&  e.keyCode <= 27) || (e.keyCode >= 32 &&  e.keyCode <= 46) ||
            e.keyCode === 91 || e.keyCode == 93 || e.keyCode === 144 || e.keyCode === 145 || 
            (e.keyCode >= 112 &&  e.keyCode <= 123)|| e.keyCode === 190 || e.keyCode === 188 || 
            e.keyCode === 61)
            {

                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length));
            }
            else if (e.keyCode >= 96 &&  e.keyCode <= 105)

            {
                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length-1));
            }
        }
    },

    onTxtBankVpaFocus: function(component, e, eOpts) {
        var val =field.value;
        field.setValue(val);
    },

    onTxtBankVpaKeypress: function(textfield, e, eOpts) {
        return charCodeForPCSFont(e, textfield);
    },

    onTxtBankVpaChange: function(field, newValue, oldValue, eOpts) {
        var ch = field.value.substring(field.value.length -1, field.value.length).charCodeAt(0);

        if((ch === "NaN") || (((ch <= 255) && (ch > 32)) && 
        (!((ch === 40) || (ch === 41) || (ch === 44)  || (ch === 46) || (ch === 61)))))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        var ch1 = field.value.substring( field.value.length -2, field.value.length-1).charCodeAt(0);

        //console.log('charcode',ch1,ch);

        if ((ch1 === 46) && (ch === 61))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }
        if ((ch1 === 2404) && (ch === 46))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        if ((ch1 === 2366) && (ch === 93))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
        if ((ch1 === 2366) && (ch === 125))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
    },

    onTxtBranchVpaKeyup: function(textfield, e, eOpts) {
        if(textfield.getValue().substring(0,9) === "undefined")
        {

            textfield.setValue(textfield.getValue().substring(9,textfield.getValue().length + 8));
        }

        else 
        {
            if((e.keyCode >= 8 &&  e.keyCode <= 27) || (e.keyCode >= 32 &&  e.keyCode <= 46) ||
            e.keyCode === 91 || e.keyCode == 93 || e.keyCode === 144 || e.keyCode === 145 || 
            (e.keyCode >= 112 &&  e.keyCode <= 123)|| e.keyCode === 190 || e.keyCode === 188 || 
            e.keyCode === 61)
            {

                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length));
            }
            else if (e.keyCode >= 96 &&  e.keyCode <= 105)

            {
                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length-1));
            }
        }
    },

    onTxtBranchVpaFocus: function(component, e, eOpts) {
        var val =field.value;
        field.setValue(val);
    },

    onTxtBranchVpaKeypress: function(textfield, e, eOpts) {
        return charCodeForPCSFont(e, textfield);
    },

    onTxtBranchVpaChange: function(field, newValue, oldValue, eOpts) {
        var ch = field.value.substring(field.value.length -1, field.value.length).charCodeAt(0);

        if((ch === "NaN") || (((ch <= 255) && (ch > 32)) && 
        (!((ch === 40) || (ch === 41) || (ch === 44)  || (ch === 46) || (ch === 61)))))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        var ch1 = field.value.substring( field.value.length -2, field.value.length-1).charCodeAt(0);

        //console.log('charcode',ch1,ch);

        if ((ch1 === 46) && (ch === 61))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }
        if ((ch1 === 2404) && (ch === 46))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        if ((ch1 === 2366) && (ch === 93))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
        if ((ch1 === 2366) && (ch === 125))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
    },

    onTxtMaReasonDescVpaKeyup: function(textfield, e, eOpts) {
        if(textfield.getValue().substring(0,9) === "undefined")
        {

            textfield.setValue(textfield.getValue().substring(9,textfield.getValue().length + 8));
        }

        else 
        {
            if((e.keyCode >= 8 &&  e.keyCode <= 27) || (e.keyCode >= 32 &&  e.keyCode <= 46) ||
            e.keyCode === 91 || e.keyCode == 93 || e.keyCode === 144 || e.keyCode === 145 || 
            (e.keyCode >= 112 &&  e.keyCode <= 123)|| e.keyCode === 190 || e.keyCode === 188 || 
            e.keyCode === 61)
            {

                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length));
            }
            else if (e.keyCode >= 96 &&  e.keyCode <= 105)

            {
                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length-1));
            }
        }
    },

    onTxtMaReasonDescVpaFocus: function(component, e, eOpts) {
        var val =field.value;
        field.setValue(val);
    },

    onTxtMaReasonDescVpaKeypress: function(textfield, e, eOpts) {

        return charCodeForPCSFont(e, textfield);
    },

    onTxtMaReasonDescVpaChange: function(field, newValue, oldValue, eOpts) {
        var ch = field.value.substring(field.value.length -1, field.value.length).charCodeAt(0);

        if((ch === "NaN") || (((ch <= 255) && (ch > 32)) && 
        (!((ch === 40) || (ch === 41) || (ch === 44)  || (ch === 46) || (ch === 61)))))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        var ch1 = field.value.substring( field.value.length -2, field.value.length-1).charCodeAt(0);

        //console.log('charcode',ch1,ch);

        if ((ch1 === 46) && (ch === 61))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }
        if ((ch1 === 2404) && (ch === 46))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        if ((ch1 === 2366) && (ch === 93))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
        if ((ch1 === 2366) && (ch === 125))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
    },

    onTextfieldBlur: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"N",function(){ field.focus();});
    },

    onTextfieldBlur1: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"Y",function(){ field.focus();});
    },

    onGridroweditingpluginVpaEdit: function(editor, e, eOpts) {
        editor.newValues.AddAmount = editor.newValues.AddAmount === ""?null:editor.newValues.AddAmount;
        editor.newValues.IntAmount = editor.newValues.IntAmount === ""?null:editor.newValues.IntAmount;
        editor.newValues.MaAmount = editor.newValues.MaAmount === ""?null:editor.newValues.MaAmount;
        editor.newValues.PenAmount = editor.newValues.PenAmount === ""?null:editor.newValues.PenAmount;
        editor.newValues.TaxYear = editor.newValues.TaxYear === ""?null:editor.newValues.TaxYear;

    },

    onGridroweditingpluginVpaValidateedit: function(editor, e, eOpts) {
        var errMsg = "";
        var flag = true;
        var cboFilePer = Ext.ComponentQuery.query("#cboFilingPeriodVpa")[0];
        var txtTaxYear = Ext.ComponentQuery.query("#txtTaxYearVpa")[0];
        var txtMaAmount = Ext.ComponentQuery.query("#txtMaAmountVpa")[0];
        var cboPeriod = Ext.ComponentQuery.query("#cboPeriodVpa")[0];

        var filePer = cboFilePer.getValue();
        var taxyear = txtTaxYear.getValue();
        var period = cboPeriod.getValue();

        var maAmount = txtMaAmount.getValue();


        if(filePer == null || filePer == "")
        {
            errMsg += "कृपया 'मा/चौ/द्वै' छान्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = cboFilePer;
            }
        }

        if(period == null || period == "")
        {
            errMsg += "कृपया 'कर अवधि' छान्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = cboPeriod;
            }
        }


        if(taxyear == null || taxyear == "")
        {
            errMsg += "कृपया 'कर वर्ष' राख्नुहोस् !!! <br>";
            objFocus = txtTaxYear;
        }



        if(maAmount == null || maAmount == "")
        {
            errMsg += "कृपया 'कर निर्धारण रकम' राख्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = cboPeriod;
            }
        }

        if(errMsg !== "")
        {
            msg("WARNING",errMsg,function(){ objFocus.focus();});
            return false;
        }
    },

    onGridroweditingpluginVpaCanceledit: function(editor, e, eOpts) {
        var grid = editor.grid;
        var cboFilingPeriod = Ext.ComponentQuery.query("#cboFilingPeriodVpa")[0];
        var fpVal = cboFilingPeriod.getValue();

        if(fpVal === null)
        {
            grid.store.removeAt(editor.rowIdx);

            return
        }

        var txtMaAmount = Ext.ComponentQuery.query("#txtMaAmountVpa")[0];
        var filePer = Ext.ComponentQuery.query("#cboFilingPeriodVpa")[0].getValue();
        var taxyear = Ext.ComponentQuery.query("#txtTaxYearVpa")[0].getValue();
        var period = Ext.ComponentQuery.query("#cboPeriodVpa")[0].getValue();

        var maAmount = txtMaAmount.getValue();

        if(filePer === "" || taxyear === "" || period === "" || maAmount === "")
        {
            grid.store.removeAt(editor.rowIdx);
        }
    },

    onGridroweditingpluginVpaBeforeEdit: function(editor, e, eOpts) {
        //var store = editor.grid.getStore();
        //var row = store.getAt(editor.rowIdx).data;

        //row.Action = "C";


    }

});