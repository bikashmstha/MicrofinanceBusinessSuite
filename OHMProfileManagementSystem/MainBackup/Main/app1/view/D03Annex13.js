/*
 * File: app/view/D03Annex13.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.D03Annex13', {
    extend: 'Ext.panel.Panel',

    frame: true,
    itemId: 'pnlD03Annex13',
    width: 800,
    autoScroll: true,
    title: 'Annex-13',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmD03Annex13',
                    margin: 5,
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'label',
                            height: 50,
                            margin: '0 0 0 320',
                            maxHeight: 50,
                            style: 'font-size:20px',
                            text: 'अनुसूची - १३'
                        },
                        {
                            xtype: 'panel',
                            frame: true,
                            height: 120,
                            margin: '10 0 5 0',
                            layout: {
                                columns: 1,
                                type: 'table'
                            },
                            title: ' पछाडि गएर अनुसूची तय गर्न <div id="lnkRedirectTopAnx13" style="cursor:pointer;color:red;display:inline;text-decoration:underline"><span>यहाँ कि्लक</span></div> गर्नुहोस् । ',
                            items: [
                                {
                                    xtype: 'container',
                                    itemId: 'cntTblAnx13',
                                    layout: {
                                        columns: 1,
                                        type: 'table'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            colspan: 2,
                                            itemId: 'txtAssessmentNoAnx13',
                                            fieldLabel: 'सब्मिशन नं.',
                                            labelWidth: 150,
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtFiscalYearAnx13',
                                            fieldLabel: 'आर्थिक वर्ष',
                                            labelWidth: 150,
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            colspan: 2,
                                            itemId: 'txtPanAnx13',
                                            fieldLabel: 'स्थायी लेखा नम्बर',
                                            labelWidth: 150,
                                            readOnly: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            cls: '',
                            height: 780,
                            itemId: 'grdFinanDescD03Anx13',
                            margin: '0 0 5 0',
                            autoScroll: true,
                            title: 'वित्तिय विवरण प्रविस्ट गर्नुहोस्। ',
                            store: 'Annex13',
                            columns: [
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 30,
                                    sortable: false,
                                    dataIndex: 'DispSeq',
                                    text: 'ID'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                        var row = store.getAt(rowIndex).data;

                                        var desc = row.DescNep + "<br>" + row.DescEng ;

                                        return desc;
                                    },
                                    width: 750,
                                    sortable: false,
                                    text: 'सुची'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    width: 255,
                                    sortable: false,
                                    dataIndex: 'ItemValue',
                                    hideable: false,
                                    text: 'रकम वा प्रतिसत'
                                }
                            ]
                        },
                        {
                            xtype: 'button',
                            itemId: 'btnSubmitAnx13',
                            padding: 5,
                            iconCls: 'icon-ok',
                            text: 'Submit'
                        },
                        {
                            xtype: 'panel',
                            frame: true,
                            margin: '5 0',
                            title: 'रु पाँच लाख वा सो भन्दा बदी खरिद / बिक्री / आसामी / साहुको विवरण ',
                            items: [
                                {
                                    xtype: 'checkboxfield',
                                    itemId: 'chkTranExistsAnx13',
                                    margin: '5 5 5 100',
                                    fieldLabel: 'कुनै पनि व्यक्ति / संस्था संग आर्थिक वर्षमा रू पाँच लाख भन्दा बढीको कारोबार छैन ',
                                    labelSeparator: ' ',
                                    labelWidth: 400,
                                    value: 'N'
                                },
                                {
                                    xtype: 'container',
                                    margin: '0 3 5 0',
                                    width: 1020,
                                    autoScroll: true,
                                    items: [
                                        {
                                            xtype: 'toolbar',
                                            height: 30,
                                            margin: 1,
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    itemId: 'btnAddNewAnx13',
                                                    iconCls: 'icon-add',
                                                    text: 'Add New'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'toolbar',
                                            items: [
                                                {
                                                    xtype: 'tbspacer',
                                                    width: 16
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 91,
                                                    text: '१'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 291,
                                                    text: '२'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 141,
                                                    text: '३'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 91,
                                                    text: '४'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'gridpanel',
                                            height: 150,
                                            itemId: 'grdTaxpayerTranDetailAnx13',
                                            margin: '0 0 5 0',
                                            store: 'TaxpayerTranDetailAnx13',
                                            columns: [
                                                {
                                                    xtype: 'rownumberer'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'Pan',
                                                    text: 'स्थायी लेखा नम्बर ',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtBusPanAnx13',
                                                        width: 100,
                                                        emptyText: '  |   |   |   |   |   |   |   |',
                                                        enforceMaxLength: true,
                                                        maskRe: /[0-9]/,
                                                        maxLength: 9,
                                                        listeners: {
                                                            blur: {
                                                                fn: me.onTxtBusPanAnx13Blur,
                                                                scope: me
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 300,
                                                    dataIndex: 'TradeNameEng',
                                                    text: 'व्यवसायको नाम ',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtTradeNameAnx13',
                                                        width: 300,
                                                        labelWidth: 1,
                                                        maxLength: 100
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 150,
                                                    dataIndex: 'Sorp',
                                                    text: 'खरिद/बिक्री/साहु/असामी ',
                                                    editor: {
                                                        xtype: 'combobox',
                                                        itemId: 'cboTradeTypeAnx13',
                                                        emptyText: 'Select ...',
                                                        displayField: 'TradeName',
                                                        forceSelection: true,
                                                        queryMode: 'local',
                                                        store: 'TradeTypeAnx13',
                                                        typeAhead: true,
                                                        valueField: 'TradeID'
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    align: 'right',
                                                    dataIndex: 'Amount',
                                                    text: 'रकम',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtAmountAnx13',
                                                        width: 100,
                                                        fieldCls: 'TxtRight',
                                                        enableKeyEvents: true,
                                                        maskRe: /[0-9]/,
                                                        maxLength: 8
                                                    }
                                                },
                                                {
                                                    xtype: 'actioncolumn',
                                                    align: 'center',
                                                    items: [
                                                        {
                                                            handler: function(view, rowIndex, colIndex, item, e) {
                                                                var grd = Ext.ComponentQuery.query('#grdTaxpayerTranDetailAnx13')[0];
                                                                var store = grd.getStore();
                                                                var row = store.getAt(rowIndex).data;

                                                                var txtTotTranDetail = Ext.ComponentQuery.query("#txtTotTranDetailAnx13")[0];
                                                                var amount = (row.Amount === "" || row.Amount == null)?0:row.Amount;
                                                                var prevGrandTot = (txtTotTranDetail.getValue() === "" || txtTotTranDetail== "NaN")?0:txtTotTranDetail.getValue();

                                                                Ext.Msg.confirm('Confirm Action', 'Do you want to Remove ?', function(btn) {
                                                                    if(btn == 'yes'){

                                                                        grandTotal = parseFloat(prevGrandTot)-parseFloat(amount);
                                                                        txtTotTranDetail.setValue(grandTotal);

                                                                        if(row.Action === "E")
                                                                        {    
                                                                            row.Action = "D";
                                                                            grd.bindStore(store);         
                                                                            store.filter(function(item){
                                                                                return item.get("Action")!= 'D';
                                                                            });
                                                                        }
                                                                        else
                                                                        {
                                                                            store.removeAt(rowIndex);
                                                                        }
                                                                        return true;
                                                                    }
                                                                }, this);
                                                            },
                                                            icon: '../ITS/resources/images/icons/cancel.png',
                                                            iconCls: 'iconMargin'
                                                        }
                                                    ]
                                                }
                                            ],
                                            plugins: [
                                                Ext.create('Ext.grid.plugin.RowEditing', {
                                                    pluginId: 'pluginFinancialAnx13',
                                                    listeners: {
                                                        canceledit: {
                                                            fn: me.onGridroweditingpluginCanceledit,
                                                            scope: me
                                                        },
                                                        validateedit: {
                                                            fn: me.onGridroweditingpluginValidateedit,
                                                            scope: me
                                                        }
                                                    }
                                                })
                                            ]
                                        },
                                        {
                                            xtype: 'toolbar',
                                            margin: '-4 0 0 0 ',
                                            items: [
                                                {
                                                    xtype: 'label',
                                                    margins: '0 15 0 505',
                                                    text: 'जम्मा रकम'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    margins: '0 5 ',
                                                    itemId: 'txtTotTranDetailAnx13',
                                                    width: 90,
                                                    fieldLabel: '',
                                                    fieldCls: 'TxtRight',
                                                    readOnly: true
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'button',
                            itemId: 'btnSubmitTaxpyrTranAnx13',
                            padding: 5,
                            iconCls: 'icon-ok',
                            text: 'Submit Transaction'
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntBtnAnx13',
                            items: [
                                {
                                    xtype: 'toolbar',
                                    margin: '5 0 5 0',
                                    items: [
                                        {
                                            xtype: 'label',
                                            html: 'पछाडि गएर अनुसूची तय गर्न',
                                            text: ''
                                        },
                                        {
                                            xtype: 'label',
                                            html: '<a href="#" style="color:red"> यहाँ कि्लक  </a>',
                                            itemId: 'lblRedirectAnx13',
                                            text: 'My Label',
                                            listeners: {
                                                render: {
                                                    fn: me.onLblRedirectAnx6Render1,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'label',
                                            html: ' गर्नुहोस् । ',
                                            text: 'My Label'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnTranActionAnx13',
                                    fieldLabel: 'Label'
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtBusPanAnx13Blur: function(component, e, eOpts) {
        var me = this;

        var field = Ext.ComponentQuery.query('#txtBusPanAnx13')[0];

        if(field.getValue() !== "")
        {

            if(field.getValue().length < 9)
            {
                msg("WARNING","प्यान कम्तिमा ९ अक्षरको हुनुपर्छ !!!", function(){field.focus();});

                return false;
            }

            var txtTradeName =  Ext.ComponentQuery.query('#txtTradeNameAnx13')[0];
            txtTradeName.setValue("");
            txtTradeName.clearInvalid();

            //-------------------------------------------------------------------------
            // NB: Loading details using PAN and ACCOUNT-TYPE i.e. for Submission Login
            //-------------------------------------------------------------------------
            LoadTaxpayerInfoWithValidPan(field.getValue(),"10",function(data){


                var rec = data.root.Taxpayer;

                txtTradeName.setValue(rec.Name);
                txtTradeName.clearInvalid();

            },function(){ field.focus();});

            }

            return true;
    },

    onGridroweditingpluginCanceledit: function(editor, e, eOpts) {
        var grid = editor.grid;
        var flag = true;

        var txtTradeName = Ext.ComponentQuery.query('#txtTradeNameAnx13')[0];
        var cboTradeType = Ext.ComponentQuery.query('#cboTradeTypeAnx13')[0];
        var txtAmount = Ext.ComponentQuery.query('#txtAmountAnx13')[0];

        var errMsg = "";
        var objFocus = "";

        //alert("1" + txtTradeName.getValue());
        //alert("2" + cboTradeType.getValue());
        //alert("3" + txtAmount.getValue());

        if(txtTradeName.getValue() == null || txtTradeName.getValue() == "")
        {
            //alert("1");
            flag = false;
            //errMsg += "कृपया व्यवसायको नाम राख्नुहोस् !!!<br>";
            //objFocus = txtTradeName;
        }

        if((flag) && (cboTradeType.getValue() == null || cboTradeType.getValue() == ""))
        {
            //alert("2");
            flag = false;
            //errMsg += "कृपया खरिद/बिक्री/शाहु/असामी  छान्नुहोस् !!!<br>";

            //if(objFocus == null)
            //{
            //   objFocus = cboTradeType;
            //}
        }

        if((flag) && (txtAmount.getValue() == null || txtAmount.getValue() == ""))
        {
            //alert("3");
            flag = false;
            // errMsg += "कृपया रकम राख्नुहोस !!!<br>";

            //if(objFocus == null)
            //{
            //  objFocus = txtAmount;
            //}
        }

        if(!flag)
        {
            grid.store.removeAt(editor.rowIdx);
            // msg("WARNING",errMsg,function(){objFocus.focus();});
        }
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {
        var txtPan = Ext.ComponentQuery.query('#txtBusPanAnx13')[0];
        var cboTradeType = Ext.ComponentQuery.query('#cboTradeTypeAnx13')[0];
        var txtTradeName = Ext.ComponentQuery.query('#txtTradeNameAnx13')[0];
        var txtAmount = Ext.ComponentQuery.query('#txtAmountAnx13')[0];

        var pan = txtPan.getValue();
        var tradeType = cboTradeType.getValue();
        var tradeName = txtTradeName.getValue();
        var amount = txtAmount.getValue();

        var objFocus = null;
        var errMsg = "";




        if(tradeName == null || tradeName == "")
        {
            errMsg += "कृपया 'व्यवसायको नाम' राख्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = txtTradeName;
            }
        }

        if(tradeType == null || tradeType == "")
        {
            errMsg += "कृपया 'खरिद/बिक्री/शाहु/असामी' छान्नुहोस् !!! <br>";
            objFocus = cboTradeType;
        }


        if(amount == null || amount == "")
        {
            errMsg += "कृपया 'रकम' राख्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = txtAmount;
            }
        }

        if(errMsg !== "")
        {
            msg("WARNING",errMsg,function(){ objFocus.focus();});
            return false;
        }

        return true;
    },

    onLblRedirectAnx6Render1: function(component, eOpts) {
        var c = component;

        c.getEl().on('click', function(){ this.fireEvent('click', c); }, c);
    }

});