/*
 * File: app/controller/TDSVerifiedRec.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TDSVerifiedRec', {
    extend: 'Ext.app.Controller',

    models: [
        'TDSVerifiedSum',
        'TDSVerSummary'
    ],
    stores: [
        'TDSVerifiedSum',
        'TDSVerSummary'
    ],
    views: [
        'TDSVerifiedRec'
    ],

    onGrdVerRecTDSListItemClick: function(dataview, record, item, index, e, eOpts) {
        var me = this;

        var action = Ext.ComponentQuery.query("#hdnSVRTDSaction")[0];
        console.log("action",action);
        var act = action.getValue();

        var hdniro = Ext.ComponentQuery.query("#hdnSVRTDSiro")[0];
        var hdnfrom = Ext.ComponentQuery.query("#hdnSVRTDSfrom")[0];
        var hdnto = Ext.ComponentQuery.query("#hdnSVRTDSto")[0];

        if(act=="Detail")
        {
            me.getController('MyApp.controller.TDSVerRecDetails').init();
            me.getController('MyApp.controller.TDSVerRecDetails').ShowVerRecDetails(hdniro.getValue(),hdnfrom.getValue(),hdnto.getValue());
        }
    },

    ShowVerifiedRec: function(iro, from, to) {
        Ext.getCmp('cntOMTDS').removeAll();

        var pnlDynamic = Ext.create('MyApp.view.TDSVerifiedRec');

        var pnlToRender = Ext.ComponentQuery.query("#cntOMTDS")[0];
        pnlToRender.add(pnlDynamic);

        //var hdniro = Ext.ComponentQuery.query("#hdnSVRTDSiro")[0];
        var hdnfrom = Ext.ComponentQuery.query("#hdnSVRTDSfrom")[0];
        var hdnto = Ext.ComponentQuery.query("#hdnSVRTDSto")[0];

        var dpMsg = Ext.ComponentQuery.query("#dpVerRecTDSMsg")[0];
        var dpMsg1 = Ext.ComponentQuery.query("#dpVerRecTDSMsg1")[0];
        var dpMsg2 = Ext.ComponentQuery.query("#dpVerRecTDSMsg2")[0];
        var dpMsg3 = Ext.ComponentQuery.query("#dpVerRecTDSMsg3")[0];

        if(from===""&&to==="")
        {
            dpMsg.setValue('Verified TDS statistics upto now by all IROs');
        }
        else if(from!==""&&to!=="")
        {
            // hdniro.setValue(iro);
            hdnfrom.setValue(from);
            hdnto.setValue(to);

            dpMsg.setValue('Verified TDS statistics by all IROs from');
            dpMsg1.setValue(hdnfrom.getValue());
            dpMsg2.setValue('to'); 
            dpMsg3.setValue(hdnto.getValue()); 
        }

        var param = {
            IrdCode:iro,
            FromDate:hdnfrom.getValue(),
            ToDate:hdnto.getValue()
        };

        var store = Ext.getStore('TDSVerifiedSum');
        store.load({
            params:{objRec:JSON.stringify(param)}
        });

        Ext.Ajax.request({
            url:"../Handlers/TDS/SearchRecordsHandler.ashx?method=GetVRecords",
            params: {objRec:JSON.stringify(param)},
            success: function ( result, request ){

                //waitSave.hide();

                var obj = Ext.decode(result.responseText);
                var data = obj.root;

                var TDSVerSummary = Ext.getStore('TDSVerSummary'); 

                if(obj.success === "true")
                {
                    var amt =0;
                    var TDSamt = 0;
                    var count = 0;

                    if(obj.total!=="0")
                    {
                        for(var i=0;i<obj.total;i++)
                        {
                            amt = amt+data[i].PaymentAmt;
                            TDSamt = TDSamt+data[i].TDSAmt;
                            count = count+data[i].Count;
                        }
                        TDSVerSummary.loadData([],false);
                        TDSVerSummary.add({
                            total:"Total:",
                            totalAmt:amt,
                            totalTDSAmt:TDSamt,
                            totalVerCount:count
                        });
                    }
                    else
                    {
                        TDSVerSummary.loadData([],false);
                        TDSVerSummary.add({
                            total:"Total:",
                            totalAmt:0,
                            totalTDSAmt:0,
                            totalVerCount:0
                        });
                    }

                    //TDSVerSummary.load();

                }
                else if(obj.success === "false") 
                {
                    msg("FAILURE",obj.message);
                    return;
                }
            },

            failure: function ( result, request ){

                return;
            }
        });


    },

    init: function(application) {
        this.control({
            "#grdVerRecTDSList": {
                itemclick: this.onGrdVerRecTDSListItemClick
            }
        });
    }

});
