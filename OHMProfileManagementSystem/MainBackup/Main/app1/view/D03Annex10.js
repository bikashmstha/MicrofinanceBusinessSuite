/*
 * File: app/view/D03Annex10.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.D03Annex10', {
    extend: 'Ext.panel.Panel',

    frame: true,
    height: 800,
    itemId: 'pnlD03Annex10',
    title: 'Annex-10',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmD03Annex10',
                    margin: 5,
                    autoScroll: true,
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'label',
                            height: 50,
                            margin: '0 0 0 320',
                            maxHeight: 50,
                            style: 'font-size:20px',
                            text: 'अनुसूची -१०'
                        },
                        {
                            xtype: 'panel',
                            frame: true,
                            margin: '10 0 5 0',
                            width: 1030,
                            layout: {
                                columns: 1,
                                type: 'table'
                            },
                            title: 'पछाडि गएर अनुसूची तय गर्न <div id="lnkRedirectTopAnx10" style="cursor:pointer;color:red;display:inline;text-decoration:underline"><span>यहाँ कि्लक</span></div> गर्नुहोस् ।',
                            items: [
                                {
                                    xtype: 'container',
                                    itemId: 'cntTblAnx1',
                                    margin: '0 0 0 150',
                                    layout: {
                                        columns: 1,
                                        type: 'table'
                                    },
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            itemId: 'cboClaimTypeAnx10',
                                            fieldLabel: 'कर दावीको किसिम ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            emptyText: 'Select ...',
                                            displayField: 'ClaimName',
                                            forceSelection: true,
                                            queryMode: 'local',
                                            store: 'ClaimTypeD03',
                                            valueField: 'ClaimID'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtFiscalYearAnx10',
                                            width: 300,
                                            fieldLabel: 'आर्थिक वर्ष',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            readOnly: true,
                                            maxLength: 8
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtCreditTransferFiscalYearAnx10',
                                            width: 300,
                                            fieldLabel: 'क्रेडिट सारेको आर्थिक वर्ष',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            enforceMaxLength: true,
                                            maxLength: 8
                                        },
                                        {
                                            xtype: 'combobox',
                                            hidden: true,
                                            itemId: 'cboAcctNumberAnx10',
                                            width: 550,
                                            fieldLabel: 'राजश्व शिर्षक नम्वर ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            emptyText: 'Select ...',
                                            displayField: 'RevActWithCode',
                                            queryMode: 'local',
                                            store: 'RevenueAccountAnx10',
                                            valueField: 'AccountCode'
                                        },
                                        {
                                            xtype: 'combobox',
                                            hidden: true,
                                            itemId: 'cboVoucherTypeAnx10',
                                            fieldLabel: 'दाखीलाको तरिका ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            emptyText: 'Select ...',
                                            displayField: 'EstPaymentModeName',
                                            queryMode: 'local',
                                            store: 'EstPaymentMode',
                                            valueField: 'EstPaymentModeID'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtVoucherNumAnx10',
                                            fieldLabel: 'दाखीला निस्सा नम्वर ',
                                            labelAlign: 'right',
                                            labelWidth: 230
                                        },
                                        {
                                            xtype: 'combobox',
                                            hidden: true,
                                            itemId: 'cboBankAnx10',
                                            width: 550,
                                            fieldLabel: 'बैंकको नाम ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            emptyText: 'Select ...',
                                            displayField: 'BankName',
                                            queryMode: 'local',
                                            store: 'OfficeBankInfo',
                                            valueField: 'BankBr'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtCreditDateAnx10',
                                            width: 330,
                                            fieldLabel: 'दाखीला मिति ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            msgTarget: 'side',
                                            emptyText: 'YYYY.MM.DD',
                                            enforceMaxLength: true,
                                            maskRe: /[0-9.]/,
                                            maxLength: 10,
                                            listeners: {
                                                blur: {
                                                    fn: me.onTxtCreditDateAnx10Blur,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtCreditAmtAnx10',
                                            width: 330,
                                            fieldLabel: 'दाखीला रकम ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            fieldCls: 'TxtRight',
                                            maskRe: /[0-9]/,
                                            maxLength: 10
                                        },
                                        {
                                            xtype: 'combobox',
                                            hidden: true,
                                            itemId: 'cboWithHoldingTypeAnx10',
                                            width: 550,
                                            fieldLabel: 'अगि्रम कर कट्टीको किसिम ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            emptyText: 'Select ...',
                                            displayField: 'RevActWithCode',
                                            queryMode: 'local',
                                            store: 'RevenueAccountAnx10',
                                            valueField: 'AccountCode'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtWithHoldingPanAnx10',
                                            fieldLabel: 'अगि्रम कर कट्टी गर्नेको स्था.ले.नं. (भए) ',
                                            labelAlign: 'right',
                                            labelWidth: 230,
                                            enforceMaxLength: true,
                                            maskRe: /[0-9]/,
                                            maxLength: 9,
                                            minLength: 9
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            itemId: 'txtWithHoldingNameAnx10',
                                            fieldLabel: 'अगि्रम कर कट्टी गर्नेको नाम ',
                                            labelAlign: 'right',
                                            labelWidth: 230
                                        },
                                        {
                                            xtype: 'button',
                                            hidden: true,
                                            itemId: 'btnAddAnx10',
                                            margin: '0 0 0 235',
                                            iconCls: 'icon-add',
                                            text: 'Add'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'panel',
                            margin: '0 3 0 0',
                            width: 1030,
                            autoScroll: true,
                            title: 'कर मिलान दावी विवरण',
                            items: [
                                {
                                    xtype: 'toolbar',
                                    width: 1400,
                                    items: [
                                        {
                                            xtype: 'tbspacer',
                                            width: 16
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '१'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '२'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '३'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '४'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 251,
                                            text: '५'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '६'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '७'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '८'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '९'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '१०'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '११'
                                        },
                                        {
                                            xtype: 'tbseparator'
                                        },
                                        {
                                            xtype: 'label',
                                            cls: 'LblCenter',
                                            width: 91,
                                            text: '१२'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    itemId: 'grdCreditClaimD03Anx10',
                                    margin: '0 0 5 0',
                                    minHeight: 50,
                                    width: 1400,
                                    store: 'CreditClaimAnx10',
                                    columns: [
                                        {
                                            xtype: 'rownumberer'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'CreditDocType',
                                            text: 'कर दावीको किसिम'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'AccountCode',
                                            text: 'राजश्व शिर्षक नम्बर'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'CreditDocMode',
                                            text: 'दाखीलाको तरिका'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'CreditDocNo',
                                            text: 'दाखीला निस्सा नम्बर'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 260,
                                            dataIndex: 'CreditBankCode',
                                            text: 'बैंकको नाम'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            defaultWidth: 80,
                                            dataIndex: 'CreditDocDate',
                                            text: 'दाखीला मिति'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'CreditOffCode',
                                            text: 'कार्यालय'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'WithTypeCode',
                                            text: 'अग्रिम कर कट्टीको किसिम'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'WithHoldingPan',
                                            text: 'अग्रिम कर कट्टी गर्नेको स्था.ले.नं. (भए)'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'WithAgentName',
                                            text: 'अग्रिम कर कट्टी गर्नेको नाम'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'CreditAmount',
                                            text: 'दाखीला रकम'
                                        },
                                        {
                                            xtype: 'actioncolumn',
                                            itemId: 'lnkActionAnx10',
                                            padding: '0 5 0 10',
                                            altText: 'Edit',
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e) {
                                                        view.getSelectionModel().select(rowIndex);

                                                        var row = view.getStore().getAt(rowIndex);

                                                        var pnlView = Ext.ComponentQuery.query('#pnlD03Annex10')[0];
                                                        //pnlView.extraParam.App.getController('D03Annex10').editCreditClaim(row);


                                                        //console.log("MyApp hope>>>>",MyApp);
                                                        MyApp.app.getController('D03Annex10').editCreditClaim(row);


                                                        //console.log("MyApp",MyApp.app.getController('D03Annex10'));
                                                    },
                                                    icon: '../ITS/resources/images/icons/pencil.png',
                                                    iconCls: 'iconMargin',
                                                    tooltip: 'Edit'
                                                },
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e) {
                                                        var store = Ext.getStore("CreditClaimAnx10");
                                                        var row = store.getAt(rowIndex).data;

                                                        var txtTotCredit = Ext.ComponentQuery.query('#txtTotalCreditAnx10')[0];
                                                        var creditAmt = (row.TotAmount === "")?0:row.CreditAmount;
                                                        var newTotCredit = 0;

                                                        Ext.Msg.confirm('Confirm Action', 'Do you want to Remove ?', function(btn) {
                                                            if(btn == 'yes'){

                                                                newTotCredit = parseFloat(txtTotCredit.getValue())-parseFloat(creditAmt);        
                                                                txtTotCredit.setValue(newTotCredit);

                                                                if(row.Action === "E")
                                                                {
                                                                    row.Action = "D";        
                                                                    store.filter(function(item){
                                                                        return item.get("Action")!= 'D';
                                                                    });


                                                                    view.bindStore(store); 
                                                                }
                                                                else
                                                                {
                                                                    store.removeAt(rowIndex);
                                                                }

                                                                return true;
                                                            }
                                                        }, this);
                                                    },
                                                    icon: '../ITS/resources/images/icons/cancel.png',
                                                    iconCls: 'iconMargin',
                                                    tooltip: 'Delete'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'toolbar',
                                    margin: '-4 0 0 0 ',
                                    width: 1400,
                                    items: [
                                        {
                                            xtype: 'label',
                                            margins: '0  0 1100',
                                            width: 80,
                                            text: 'Total Credit'
                                        },
                                        {
                                            xtype: 'textfield',
                                            margins: '0 5 ',
                                            itemId: 'txtTotalCreditAnx10',
                                            width: 90,
                                            fieldLabel: '',
                                            fieldCls: 'TxtRight',
                                            readOnly: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntBtnAnx110',
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnSubmitAnx10',
                                    padding: 5,
                                    iconCls: 'icon-ok',
                                    text: 'Save Annex 10'
                                },
                                {
                                    xtype: 'toolbar',
                                    margin: '5 0 5 0',
                                    items: [
                                        {
                                            xtype: 'label',
                                            html: 'पछाडि गएर अनुसूची तय गर्न',
                                            text: ''
                                        },
                                        {
                                            xtype: 'label',
                                            html: '<a href="#" style="color:red"> यहाँ कि्लक  </a>',
                                            itemId: 'lblRedirectAnx10',
                                            text: 'My Label',
                                            listeners: {
                                                render: {
                                                    fn: me.onLblRedirectAnx10Render,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'label',
                                            html: ' गर्नुहोस् । ',
                                            text: 'My Label'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtCreditDateAnx10Blur: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"Y",function(){ field.focus();});
    },

    onLblRedirectAnx10Render: function(component, eOpts) {
        var c = component;

        c.getEl().on('click', function(){ this.fireEvent('click', c); }, c);
    }

});