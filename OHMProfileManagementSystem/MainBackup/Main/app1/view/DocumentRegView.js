/*
 * File: app/view/DocumentRegView.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.DocumentRegView', {
    extend: 'Ext.panel.Panel',

    height: 461,
    itemId: 'pnlDocumentRegView',
    width: 1005,
    title: 'DocumentRegView',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    height: 426,
                    id: 'DocumentRegView',
                    itemId: 'DocumentRegView',
                    width: 1006,
                    bodyPadding: 10,
                    title: '',
                    items: [
                        {
                            xtype: 'gridpanel',
                            formBind: true,
                            frame: true,
                            height: 404,
                            id: 'grdShowFiles',
                            itemId: 'grdShowFiles',
                            width: 746,
                            title: 'Files',
                            store: 'DocRegFileStore',
                            columns: [
                                {
                                    xtype: 'gridcolumn',
                                    width: 251,
                                    dataIndex: 'FileName',
                                    text: 'FileName'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'FileType',
                                    text: 'FileType'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'File',
                                    text: 'File'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    width: 255,
                                    dataIndex: 'DocNameUnique',
                                    text: 'DocNameUnique'
                                },
                                {
                                    xtype: 'actioncolumn',
                                    width: 119,
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                var store = view.getStore();
                                                var rowdata = store.getAt(rowIndex).data;

                                                Ext.Ajax.request
                                                ({

                                                    url: '../Handlers/DocumentManagement/RegDocFileAccessHandler.ashx',
                                                    params:{DocNameUnique:rowdata.DocNameUnique,FileName:rowdata.FileName,FileType:rowdata.FileType},


                                                    success:function(response){
                                                        // Waitmsg.hide();  

                                                        var obj =Ext.decode(response.responseText); 
                                                        //msg(obj.success === "true" ?"SUCCESS":"FAILURE",obj.message);
                                                        if(obj.success === "true")
                                                        {           


                                                            //console.log('-->source is taking',obj.root);
                                                            var htmlSrc = obj.root;



                                                            var myWindow=Ext.create('Ext.window.Window', {
                                                                title: 'Document View',
                                                                height: 600,
                                                                width: 700,
                                                                layout: 'fit',
                                                                autoDestroy:true,                
                                                                autoScroll: true,
                                                                items: {  // Let's put an empty grid in just to illustrate fit layout
                                                                    xtype: 'component',
                                                                    html : htmlSrc,
                                                                    listeners: {
                                                                        render: function(c){
                                                                            c.getEl().on({
                                                                                contextmenu : function(event) {																
                                                                                    if(event.button===2){
                                                                                        event.preventDefault();

                                                                                    }
                                                                                }
                                                                            });
                                                                        }
                                                                    }
                                                                    //html : '<object data="myfile.pdf" type="application/pdf" width="100%" height="100%"></object>'
                                                                }
                                                            }).show();

                                                            myWindow.on("close", function() {
                                                                Ext.Ajax.request
                                                                ({
                                                                    url: '../Handlers/DocumentManagement/RegDocFileAccessHandler.ashx',
                                                                    params:{method:'DeleteDocuments',DocNameUnique:rowdata.DocNameUnique}

                                                                });
                                                            });         





                                                            /*
                                                            Ext.define('MyApp.view.UniVView', {
                                                            extend: 'Ext.panel.Panel',

                                                            height: 461,
                                                            width: 1005,
                                                            title: 'UniV',

                                                            initComponent: function() {
                                                            var me = this;        
                                                            Ext.applyIf(me, {
                                                            items: [
                                                            {
                                                            xtype: 'form',
                                                            frame: true,
                                                            height: 426,
                                                            id: 'UniV',
                                                            itemId: 'UniV',
                                                            width: 1006,
                                                            bodyPadding: 10,
                                                            title: '',
                                                            items: [
                                                            {
                                                            xtype: 'component',
                                                            html : htmlSrc
                                                            }
                                                            ]                   
                                                            }
                                                            ]
                                                            }).show();

                                                            me.callParent(arguments);
                                                            }
                                                            });


                                                            var UniV= Ext.define('MyApp.controller.UniVController', {
                                                            extend: 'Ext.app.Controller'
                                                            });



                                                            uiConfig = {menuLink:'Univ',pageTitle:'Univ'};
                                                            DynamicUI(uiConfig,function(){});
                                                            */


                                                        }


                                                    },

                                                    failure:function(response)
                                                    {
                                                        msg('FAILURE',Ext.decode(response));     
                                                        // Waitmsg.hide();

                                                    }



                                                });

                                            },
                                            icon: '../ITS/resources/images/icons/eye.png'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ],
            listeners: {
                afterrender: {
                    fn: me.onDocumentRegViewAfterRender,
                    scope: me
                }
            }
        });

        me.callParent(arguments);
    },

    onDocumentRegViewAfterRender: function(component, eOpts) {
        //var me=this;

        var view = Ext.ComponentQuery.query('#pnlDocumentRegView')[0];
        console.log("viewSA",view.extraParam);
        var pan="";
        var KEYWORD="";
        var reqid="";
        console.log("view.extraPara.ID>>>",view.extraParam.DOCID);


        var DOCID=view.extraParam.DOCID;

        var grdShowFiles=Ext.ComponentQuery.query('#grdShowFiles')[0];
        var Waitmsg=waitMsg('Loading ...');

        Ext.Ajax.request({
            url: '../Handlers/DocumentManagement/Document_FileContainerHandler.ashx',
            // params: { FID : '13',DOCID:'27' },
            params: { DOCID:DOCID },
            success: function( result, request ){
                Waitmsg.hide();   
                var obj=Ext.decode(result.responseText);
                var row = obj.root;
                console.log("row-->",obj.root); 



                var DocRegFileStore=Ext.getStore('DocRegFileStore');
                DocRegFileStore.removeAll();
                DocRegFileStore.loadData([],false);



                grdShowFiles.store.add(obj.root);



            },
            failure:function(response)
            {
                msg('ERROR OCURRED !!!', 'Error in fetching data');     
                Waitmsg.hide();

            }});



    }

});