/*
 * File: app/view/AuthorizedUpdate.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.AuthorizedUpdate', {
    extend: 'Ext.panel.Panel',

    itemId: 'AuthorizedUpdate',
    autoScroll: true,
    title: 'Authorized Update',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmAuthorizedUpdate',
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'container',
                            itemId: 'cntAUHeader',
                            padding: 10,
                            items: [
                                {
                                    xtype: 'label',
                                    margin: '0 0 0 300',
                                    style: 'font-size:18px;',
                                    text: 'Authorized Update'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnAUAction',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnAUExists',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnAUTranNo',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnAUFrom',
                                    fieldLabel: 'Label'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntAURequest',
                            layout: {
                                columns: 1,
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'fieldset',
                                    layout: {
                                        columns: 2,
                                        type: 'table'
                                    },
                                    title: 'Request',
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAURequestNo',
                                            fieldLabel: 'Request No',
                                            enforceMaxLength: true,
                                            maxLength: 20
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAURequestDate',
                                            margin: '0 0 0 50',
                                            fieldLabel: 'Request Date',
                                            emptyText: 'YYYY.MM.DD',
                                            enforceMaxLength: true,
                                            maxLength: 10,
                                            size: 12
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAUEmployeeNo',
                                            fieldLabel: 'Employee No.',
                                            enforceMaxLength: true,
                                            maxLength: 5,
                                            size: 7
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAURequestedBy',
                                            margin: '0 0 0 50',
                                            fieldLabel: 'Requested By',
                                            enforceMaxLength: true,
                                            maxLength: 60
                                        },
                                        {
                                            xtype: 'textfield',
                                            colspan: 2,
                                            itemId: 'txtAUEntryDate',
                                            fieldLabel: 'Entry Date',
                                            emptyText: 'YYYY.MM.DD',
                                            enforceMaxLength: true,
                                            maxLength: 10,
                                            size: 12
                                        },
                                        {
                                            xtype: 'radiogroup',
                                            colspan: 2,
                                            itemId: 'rdgAUAction',
                                            width: 250,
                                            fieldLabel: 'Action',
                                            items: [
                                                {
                                                    xtype: 'radiofield',
                                                    itemId: 'rdbAUEdit',
                                                    width: 100,
                                                    name: 'AUAction',
                                                    boxLabel: 'Edit'
                                                },
                                                {
                                                    xtype: 'radiofield',
                                                    itemId: 'rdbAUDelete',
                                                    name: 'AUAction',
                                                    boxLabel: 'Delete'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'textareafield',
                                    colspan: 2,
                                    itemId: 'txtAURemarks',
                                    width: 800,
                                    fieldLabel: 'Reason',
                                    cols: 50
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            itemId: 'cntAUApplication',
                            title: 'Application',
                            items: [
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlAUApplication',
                                    maxWidth: 350,
                                    width: 350,
                                    fieldLabel: 'Application',
                                    emptyText: 'Select . . .',
                                    editable: false,
                                    displayField: 'ApplDesc',
                                    forceSelection: true,
                                    queryMode: 'local',
                                    store: 'AuthUpdateApplicationStore',
                                    typeAhead: true,
                                    valueField: 'ApplId'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'fieldset',
                                    title: 'Entity',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            itemId: 'ddlAUEntity',
                                            maxWidth: 350,
                                            width: 300,
                                            fieldLabel: 'Entity Name',
                                            emptyText: 'Select . . .',
                                            editable: false,
                                            displayField: 'Entity',
                                            forceSelection: true,
                                            queryMode: 'local',
                                            store: 'AuthUpdateEntityStore',
                                            typeAhead: true,
                                            valueField: 'EntityId'
                                        },
                                        {
                                            xtype: 'container',
                                            items: [
                                                {
                                                    xtype: 'gridpanel',
                                                    height: 200,
                                                    itemId: 'grdPrimaryKeyFields',
                                                    title: 'Primary Key Fields',
                                                    store: 'AuthUpdatePKsStore',
                                                    columns: [
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'ApplicationId',
                                                            text: 'ApplicationId'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'EntityId',
                                                            text: 'EntityId'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'SeqNo',
                                                            text: 'SeqNo'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            width: 200,
                                                            dataIndex: 'PrimaryKey',
                                                            text: 'PrimaryKey'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            width: 200,
                                                            dataIndex: 'Value',
                                                            text: 'Value',
                                                            editor: {
                                                                xtype: 'textfield',
                                                                itemId: 'txtAUPKValue'
                                                            }
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'Status',
                                                            text: 'Status'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'Action',
                                                            text: 'Action'
                                                        }
                                                    ],
                                                    plugins: [
                                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                                            pluginId: 'plugInGrdAUPK',
                                                            listeners: {
                                                                validateedit: {
                                                                    fn: me.onGridroweditingpluginValidateedit,
                                                                    scope: me
                                                                },
                                                                canceledit: {
                                                                    fn: me.onGridroweditingpluginCanceledit,
                                                                    scope: me
                                                                }
                                                            }
                                                        })
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'button',
                                            itemId: 'btnAUCheck',
                                            padding: 5,
                                            text: 'Check'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'fieldset',
                                    title: 'Entity Details',
                                    items: [
                                        {
                                            xtype: 'gridpanel',
                                            height: 200,
                                            itemId: 'grdAUFields',
                                            title: 'Entity Details',
                                            store: 'AUUPdateFieldStore',
                                            columns: [
                                                {
                                                    xtype: 'gridcolumn',
                                                    hidden: true,
                                                    dataIndex: 'OffCode',
                                                    text: 'OffCode'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    hidden: true,
                                                    dataIndex: 'RequestNo',
                                                    text: 'RequestNo'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    hidden: true,
                                                    dataIndex: 'SeqNo',
                                                    text: 'SeqNo'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 200,
                                                    dataIndex: 'FieldName',
                                                    text: 'FieldName',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtAUFieldName'
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 200,
                                                    dataIndex: 'OldValue',
                                                    text: 'OldValue',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtAUOldValue'
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 200,
                                                    dataIndex: 'NewValue',
                                                    text: 'NewValue',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtAUNewValue'
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    hidden: true,
                                                    dataIndex: 'Action',
                                                    text: 'Action'
                                                }
                                            ],
                                            plugins: [
                                                Ext.create('Ext.grid.plugin.RowEditing', {
                                                    pluginId: 'plugInGrdAUFields',
                                                    listeners: {
                                                        validateedit: {
                                                            fn: me.onGridroweditingpluginValidateedit1,
                                                            scope: me
                                                        },
                                                        canceledit: {
                                                            fn: me.onGridroweditingpluginCanceledit1,
                                                            scope: me
                                                        }
                                                    }
                                                })
                                            ],
                                            dockedItems: [
                                                {
                                                    xtype: 'toolbar',
                                                    dock: 'top',
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            itemId: 'btnAUFieldsAdd',
                                                            padding: 5,
                                                            iconCls: 'icon-add',
                                                            text: 'Add'
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'fieldset',
                                    layout: {
                                        columns: 4,
                                        type: 'table'
                                    },
                                    title: 'Authorized',
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAUAuthNo',
                                            fieldLabel: 'No',
                                            labelWidth: 65,
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAUAuthDate',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Authorized Date',
                                            labelWidth: 95,
                                            readOnly: true,
                                            emptyText: 'YYYY.MM.DD',
                                            size: 12
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAUAuthEmployeeNo',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Employee No',
                                            labelWidth: 80,
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAUAuthEntryDate',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Entry Date',
                                            labelWidth: 65,
                                            readOnly: true,
                                            emptyText: 'YYYY.MM.DD',
                                            size: 12
                                        },
                                        {
                                            xtype: 'textfield',
                                            colspan: 3,
                                            itemId: 'txtAUAuthAuthorization',
                                            fieldLabel: 'Authority',
                                            labelWidth: 65,
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtAUAuthUser',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'User',
                                            labelWidth: 65,
                                            readOnly: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'button',
                                    disabled: true,
                                    itemId: 'btnAUGo',
                                    padding: 5,
                                    text: 'Go'
                                },
                                {
                                    xtype: 'button',
                                    disabled: true,
                                    itemId: 'btnAUDelete',
                                    margin: '0 0 0 10',
                                    padding: 5,
                                    iconCls: 'icon-delete',
                                    text: 'Delete'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnAUCancel',
                                    margin: '0 0 0 10',
                                    padding: 5,
                                    iconCls: 'icon-cancel',
                                    text: 'Cancel'
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {
        var txtAUPKValue = Ext.ComponentQuery.query('#txtAUPKValue')[0];
        var action=Ext.ComponentQuery.query('#hdnAUAction')[0].getValue();
        var message = "";
        e.cancel=false;
        if(action=='E')
        {
            console.log('grd',e);
            msg('INFO','<BR>* तपाईले Primary Key सच्याउन सक्नु हुन्न।');


            var items = Ext.getStore('AuthUpdatePKsStore').data.items;
            console.log('ITEMS ',items);
            items[e.rowIdx].data.Value=e.Value;
            e.cancel=true;

            return;
        }
        if(txtAUPKValue.getValue()==='')
        {
            message+='<BR>* तपाईले Primary Key अनिवार्य रूपमा भर्नु पर्नेछ।';
        }

        if(message!=='')
        {
            msg('INFO',message);
            e.cancel=true;

        }



    },

    onGridroweditingpluginCanceledit: function(editor, e, eOpts) {
        console.log('Grid: ',grid);
        if(Ext.getStore('AuthUpdatePKsStore').data.items[grid.rowIdx].data.Action=='A')
        {

        }

    },

    onGridroweditingpluginValidateedit1: function(editor, e, eOpts) {
        var fieldName=Ext.ComponentQuery.query('#txtAUFieldName')[0].getValue();
        var oldValue=Ext.ComponentQuery.query('#txtAUOldValue')[0].getValue();
        var newValue=Ext.ComponentQuery.query('#txtAUNewValue')[0].getValue();

        var message = "";
        e.cancel=false;

        if(fieldName==='')
        {
            message+='<BR>* Please, Enter The Field Name To Be Changed';
        }
        if(oldValue==='')
        {
            message+='<BR>* Please, Enter Old Value';
        }
        if(newValue==='')
        {
            message+='<BR>* Please, Enter New Value';
        }


        if(message!=='')
        {
            msg('INFO',message);
            e.cancel=true;

        }
        else
        {
            var btnFieldsAdd=Ext.ComponentQuery.query('#btnAUFieldsAdd')[0];
            btnFieldsAdd.enable(true);//var items = Ext.getStore('AVRepRiskStore').data.items;
            //if(!e.record.data.Action)
            //{
            //items[e.rowIdx].data.Action='A';
            //}

        }

    },

    onGridroweditingpluginCanceledit1: function(editor, e, eOpts) {
        var btnFieldsAdd=Ext.ComponentQuery.query('#btnAUFieldsAdd')[0];
        grid.store.removeAt(grid.rowIdx);
        btnFieldsAdd.enable(true);

    }

});