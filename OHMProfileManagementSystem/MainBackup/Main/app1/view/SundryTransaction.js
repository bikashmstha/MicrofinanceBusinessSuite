/*
 * File: app/view/SundryTransaction.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.SundryTransaction', {
    extend: 'Ext.panel.Panel',

    frame: true,
    itemId: 'SundryTransaction',
    layout: {
        align: 'stretch',
        type: 'vbox'
    },
    title: 'Sundry Transaction',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'container',
                    flex: 0.4,
                    margin: '0 0 2 5',
                    items: [
                        {
                            xtype: 'container',
                            height: 30,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtOffcodeST',
                                    width: 135,
                                    fieldLabel: 'Office Code',
                                    readOnly: true,
                                    enableKeyEvents: true,
                                    maxLength: 10
                                },
                                {
                                    xtype: 'textfield',
                                    margins: '0 0 0 15',
                                    id: '',
                                    itemId: 'txtAcctTypST',
                                    maxWidth: 300,
                                    width: 125,
                                    fieldLabel: 'Account Type',
                                    labelWidth: 90,
                                    readOnly: true
                                },
                                {
                                    xtype: 'image',
                                    flex: 1,
                                    height: 17,
                                    itemId: 'imgMessage',
                                    margin: '0 0 0 275',
                                    maxHeight: 17,
                                    maxWidth: 17,
                                    minHeight: 17,
                                    minWidth: 17,
                                    width: 17,
                                    src: '../ITS/resources/images/icons/Update.png'
                                },
                                {
                                    xtype: 'label',
                                    flex: 1,
                                    itemId: 'lblMessageAD',
                                    margin: '0 0 0 4',
                                    text: 'Updating...........'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 30,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtPanST',
                                    maxWidth: 300,
                                    width: 198,
                                    fieldLabel: 'PAN',
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    enableKeyEvents: true,
                                    enforceMaxLength: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 9,
                                    minLength: 9,
                                    size: 9
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 32,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtTradeNameST',
                                    width: 779,
                                    fieldLabel: 'Trade Name',
                                    readOnly: true
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 26,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtSundryDateST',
                                    width: 181,
                                    fieldLabel: 'Sundry Date',
                                    listeners: {
                                        blur: {
                                            fn: me.onTxtSundryDateSTBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    margins: '0 2 0 342',
                                    id: '',
                                    itemId: 'txtSundrySeqNoST',
                                    maxWidth: 337,
                                    width: 255,
                                    fieldLabel: 'Sundry Sequence No.',
                                    labelPad: 2,
                                    labelWidth: 135,
                                    enableKeyEvents: true,
                                    listeners: {
                                        keypress: {
                                            fn: me.onTxtSundrySeqNoSTKeypress,
                                            scope: me
                                        },
                                        blur: {
                                            fn: me.onTxtSundrySeqNoSTBlur,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 26,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtTaxyearST',
                                    maxWidth: 300,
                                    width: 170,
                                    fieldLabel: 'Taxyear',
                                    readOnly: true
                                },
                                {
                                    xtype: 'textfield',
                                    margins: '0 0 0 80',
                                    id: '',
                                    itemId: 'txtFilingPeriodST',
                                    width: 150,
                                    fieldLabel: 'Filing Period',
                                    labelPad: 2,
                                    labelWidth: 80,
                                    readOnly: true,
                                    listeners: {
                                        beforerender: {
                                            fn: me.onTxtFilingPeriodSTBeforeRender,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    flex: 1,
                                    margins: '0 0 0 228',
                                    itemId: 'txtPeriodST',
                                    maxWidth: 150,
                                    width: 50,
                                    fieldLabel: 'Period',
                                    labelWidth: 45,
                                    readOnly: true,
                                    enableKeyEvents: true
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 26,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtSundryAmountST',
                                    width: 220,
                                    fieldLabel: 'Sundry Amount',
                                    readOnly: true
                                },
                                {
                                    xtype: 'textfield',
                                    margins: '0 2 0 338',
                                    id: '',
                                    itemId: 'txtTransferredAmountST',
                                    width: 220,
                                    fieldLabel: 'Transferred Amount',
                                    labelPad: 2,
                                    labelWidth: 120,
                                    readOnly: true
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 26,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtTransferDateST',
                                    width: 181,
                                    fieldLabel: 'Transfer Date',
                                    enableKeyEvents: true
                                },
                                {
                                    xtype: 'textfield',
                                    margins: '0 2 0 340',
                                    disabled: true,
                                    id: '',
                                    itemId: 'txtTransferSeqNoST',
                                    maxWidth: 315,
                                    width: 257,
                                    fieldLabel: 'Transfer Seq No',
                                    labelPad: 2,
                                    labelWidth: 113,
                                    readOnly: true,
                                    enableKeyEvents: true,
                                    listeners: {
                                        blur: {
                                            fn: me.onTxtTransferSeqNoSTBlur,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtTransferSeqNoSTKeypress,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 26,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: '',
                                    itemId: 'txtTransferAmountST',
                                    width: 220,
                                    fieldLabel: 'Transfer Amount',
                                    readOnly: true,
                                    maskRe: /[0-9]/
                                },
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    margins: '0 0 0 307',
                                    itemId: 'txtPaidToST',
                                    maxWidth: 250,
                                    width: 120,
                                    fieldLabel: 'Paid To',
                                    labelWidth: 70,
                                    readOnly: true,
                                    emptyText: '-------select------',
                                    displayField: 'name',
                                    queryMode: 'local',
                                    store: 'Paidto',
                                    valueField: 'name'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'container',
                    flex: 0.06,
                    margins: '0 0 0 1',
                    height: 30,
                    layout: {
                        align: 'stretch',
                        type: 'hbox'
                    },
                    items: [
                        {
                            xtype: 'hiddenfield',
                            itemId: 'hdnActionST',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'hiddenfield',
                            flex: 1,
                            itemId: 'hdnStatusST',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'hiddenfield',
                            flex: 1,
                            itemId: 'UserId',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'hiddenfield',
                            flex: 1,
                            itemId: 'hdnTrandate',
                            fieldLabel: 'Label'
                        }
                    ]
                },
                {
                    xtype: 'gridpanel',
                    flex: 1,
                    id: '',
                    itemId: 'grdST',
                    maxHeight: 180,
                    title: 'कर अवधि',
                    store: 'SundryAccount',
                    columns: [
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'Pan',
                            text: 'Pan'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'AcctType',
                            text: 'Account Type'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'EffDate',
                            text: 'Effective Date'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'SeqNo',
                            text: 'Sequence No'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'TaxYear',
                            text: 'Tax Year'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'Period',
                            text: 'Period'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'Cord',
                            text: 'Cord'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'SunAmt',
                            text: 'Sundry Amount'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'Reason',
                            text: 'Reason'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'TransferAmt',
                            text: 'Transfer Amount'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'Fileper',
                            text: 'Filing period'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'UserId',
                            text: 'UserId'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'TranDate',
                            text: 'TranDate'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'Action',
                            text: 'Action'
                        }
                    ],
                    listeners: {
                        itemclick: {
                            fn: me.onGrdAppealDecisionItemClick,
                            scope: me
                        }
                    }
                },
                {
                    xtype: 'container',
                    flex: 0.05,
                    layout: {
                        align: 'stretch',
                        padding: '1 0 1 550',
                        type: 'hbox'
                    },
                    items: [
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnSaveST',
                            iconCls: 'icon-save',
                            text: 'Save'
                        },
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnEditST',
                            iconCls: 'icon-edit',
                            text: 'Edit'
                        },
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnDeleteST',
                            iconCls: 'icon-delete',
                            text: 'Delete'
                        },
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnSubmitST',
                            iconCls: 'icon-ok',
                            text: 'Submit'
                        },
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnVerifyST',
                            iconCls: 'icon-verify',
                            text: 'Verify'
                        },
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnPrintST',
                            iconCls: 'icon-print',
                            text: 'Print'
                        },
                        {
                            xtype: 'button',
                            flex: 1,
                            margins: '2 3 2 3',
                            itemId: 'btnCancelST',
                            iconCls: 'icon-cancel',
                            text: 'Cancel'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtSundryDateSTBlur: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"Y",function(){ field.focus();});
    },

    onTxtSundrySeqNoSTKeypress: function(textfield, e, eOpts) {
        if(e.keyCode === 13)
        {

            // -------fields to input---------------------------------------------
            var PanST=Ext.ComponentQuery.query('#txtPanST')[0];    
            var acctTypST=Ext.ComponentQuery.query('#txtAcctTypST')[0];
            var sundryDateST=Ext.ComponentQuery.query('#txtSundryDateST')[0];
            var txtSundrySeqNoST=Ext.ComponentQuery.query('#txtSundrySeqNoST')[0];
            //--------------------------------------------------------------------

            //-----------------fields to output-----------------------------------
            var taxyearST=Ext.ComponentQuery.query('#txtTaxyearST')[0];
            var filingPeriodST=Ext.ComponentQuery.query('#txtFilingPeriodST')[0];
            var periodST=Ext.ComponentQuery.query('#txtPeriodST')[0];
            var sundryAmountST=Ext.ComponentQuery.query('#txtSundryAmountST')[0];
            var transferredAmountST=Ext.ComponentQuery.query('#txtTransferredAmountST')[0];
            var actionST=Ext.ComponentQuery.query('#hdnActionST')[0];
            var txtTradeNameST=Ext.ComponentQuery.query('#txtTradeNameST')[0];


            //--------------------------------------------------------------------
            var transferAmountST=Ext.ComponentQuery.query('#txtTransferAmountST')[0];  
            var paidToST=Ext.ComponentQuery.query('#txtPaidToST')[0]; 

            var transferDateST=Ext.ComponentQuery.query('#txtTransferDateST')[0];
            var transferSeqNoST = Ext.ComponentQuery.query('#txtTransferSeqNoST')[0];




            if(PanST.getValue() === "")
            {
                msg("WARNING","Pan छान्नुहोस् ");
                return;
            }

            if(acctTypST.getValue() === "")
            {
                msg("WARNING","Account Type छान्नुहोस् ");
                return;
            }

            if(sundryDateST.getValue() === "")
            {
                msg("WARNING","Sundry Date छान्नुहोस् ");
                return;
            }

            if(txtSundrySeqNoST.getValue() === "")
            {
                msg("WARNING","Sundry Seq No छान्नुहोस् ");
                return;
            }

            LoadTaxpayerInfoWithValidPan(PanST.getValue(),acctTypST.getValue(),function(data)
            {
                if(data.message==='')
                {
                    var taxpayer = data.root.Taxpayer;

                    console.log("taxpayer"+taxpayer);
                    //txtTradeNameST.setValue(taxpayer.BusinessName);
                    //alert(taxpayer.Name);
                    txtTradeNameST.setValue(taxpayer.Name);



                }
            });



            Ext.Ajax.request({

                url:'../Handlers/VAT/SundryTransaction/SundryAccountHandler.ashx?method=GetSundryAccount',
                params:{Pan:PanST.getValue(), AcctType:acctTypST.getValue(), EffDate:sundryDateST.getValue(), SeqNo:txtSundrySeqNoST.getValue()           

                },


                success: function(response){  
                    var obj =Ext.decode(response.responseText);
                    console.log(obj.length);
                    var row = obj.root;


                    if(obj.root.length === 1)
                    {
                        taxyearST.setValue(obj.root[0].TaxYear);

                        //filingPeriodST.setValue(obj.root[0].Fileper);

                        if(obj.root[0].Fileper==="M")
                        {
                            filingPeriodST.setValue('मासिक');
                        }

                        else if(obj.root[0].Fileper==="B")
                        {
                            filingPeriodST.setValue('दूईमासिक');
                        }
                        else 
                        {
                            filingPeriodST.setValue('चौमासिक');
                        }


                        periodST.setValue(obj.root[0].Period);
                        transferredAmountST.setValue(obj.root[0].TransferAmt);
                        sundryAmountST.setValue(obj.root[0].SunAmt);

                        if(sundryAmountST.getValue() !== null)
                        {
                            transferDateST.setReadOnly(false);
                            transferSeqNoST.setReadOnly(false);
                            transferAmountST.setReadOnly(false);
                            paidToST.setReadOnly(false);

                        }

                        if( obj.root[0].SunAmt != obj.root[0].TransferAmt )
                        {

                            var storeSA=Ext.ComponentQuery.query('#grdST')[0].getStore();
                            storeSA.removeAll();

                            // storeSA.add(obj.root);

                        }        


                        else
                        {
                            msg("WARNING"," You cannot do sundry transaction ");
                            return;
                        }

                    }

                    else if(obj.root.length>1)
                    {
                        taxyearST.setValue('');
                        filingPeriodST.setValue('');
                        periodST.setValue('');
                        transferredAmountST.setValue('');
                        sundryAmountST.setValue('');

                        if(sundryAmountST.getValue() !== null)
                        {
                            transferDateST.setReadOnly(false);
                            transferSeqNoST.setReadOnly(false);
                            transferAmountST.setReadOnly(false);
                            paidToST.setReadOnly(false);
                        }

                        if( obj.root[0].SunAmt != obj.root[0].TransferAmt )
                        {
                            var storeSAA=Ext.ComponentQuery.query('#grdST')[0].getStore();
                            storeSAA.add(obj.root);
                        }           


                        else
                        {
                            msg("WARNING"," You cannot do sundry transaction ");
                            return;
                        }


                    }

                    else
                    {

                        msg("WARNING","सही Pan /Sundry Date / Sundry Seq No छान्नुहोस्");
                        taxyearST.setValue("");
                        filingPeriodST.setValue("");
                        periodST.setValue("");
                        sundryAmountST.setValue("");            
                        transferredAmountST.setValue("");
                        transferDateST.setValue("");
                        transferAmountST.setValue("");
                        paidToST.setValue("-------select------");
                        return;
                    }



                },



                //else

                //{

                // taxyearST.setValue(obj.root[0].TaxYear);
                //filingPeriodST.setValue(obj.root[0].Fileper);
                // periodST.setValue(obj.root[0].Period);
                // transferredAmountST.setValue(obj.root[0].TransferAmt);
                // sundryAmountST.setValue(obj.root[0].SunAmt);

                // if(sundryAmountST.getValue() !== null)
                // {
                //  transferDateST.setReadOnly(false);
                // transferSeqNoST.setReadOnly(false);


                // }

                // }

                //if( obj.root[0].SunAmt != obj.root[0].TransferAmt )
                //{

                //var storeSA=Ext.ComponentQuery.query('#grdST')[0].getStore();
                //storeSA.add(obj.root);

                // }           


                // else
                //{
                //msg("WARNING"," You cannot do sundry transaction ");
                // return;
                // }




                // transferAmountST.setReadOnly(false);   
                //paidToST.setReadOnly(false);




                failure:function(response)
                {			
                    msg('FAILURE',Ext.decode(response));
                }
            });

        }

    },

    onTxtSundrySeqNoSTBlur: function(component, e, eOpts) {



        // -------fields to input---------------------------------------------
        var PanST=Ext.ComponentQuery.query('#txtPanST')[0];    
        var acctTypST=Ext.ComponentQuery.query('#txtAcctTypST')[0];
        var sundryDateST=Ext.ComponentQuery.query('#txtSundryDateST')[0];
        var txtSundrySeqNoST=Ext.ComponentQuery.query('#txtSundrySeqNoST')[0];
        //--------------------------------------------------------------------

        //-----------------fields to output-----------------------------------
        var taxyearST=Ext.ComponentQuery.query('#txtTaxyearST')[0];
        var filingPeriodST=Ext.ComponentQuery.query('#txtFilingPeriodST')[0];
        var periodST=Ext.ComponentQuery.query('#txtPeriodST')[0];
        var sundryAmountST=Ext.ComponentQuery.query('#txtSundryAmountST')[0];
        var transferredAmountST=Ext.ComponentQuery.query('#txtTransferredAmountST')[0];
        var actionST=Ext.ComponentQuery.query('#hdnActionST')[0];
        var txtTradeNameST=Ext.ComponentQuery.query('#txtTradeNameST')[0];


        //--------------------------------------------------------------------
        var transferAmountST=Ext.ComponentQuery.query('#txtTransferAmountST')[0];  
        var paidToST=Ext.ComponentQuery.query('#txtPaidToST')[0]; 

        var transferDateST=Ext.ComponentQuery.query('#txtTransferDateST')[0];
        var transferSeqNoST = Ext.ComponentQuery.query('#txtTransferSeqNoST')[0];




        if(PanST.getValue() === "")
        {
            msg("WARNING","Pan छान्नुहोस् ");
            return;
        }

        if(acctTypST.getValue() === "")
        {
            msg("WARNING","Account Type छान्नुहोस् ");
            return;
        }

        if(sundryDateST.getValue() === "")
        {
            msg("WARNING","Sundry Date छान्नुहोस् ");
            return;
        }

        if(txtSundrySeqNoST.getValue() === "")
        {
            msg("WARNING","Sundry Seq No छान्नुहोस् ");
            return;
        }

        LoadTaxpayerInfoWithValidPan(PanST.getValue(),acctTypST.getValue(),function(data)
        {
            if(data.message==='')
            {
                var taxpayer = data.root.Taxpayer;

                console.log("taxpayer"+taxpayer);
                //txtTradeNameST.setValue(taxpayer.BusinessName);
                //alert(taxpayer.Name);
                txtTradeNameST.setValue(taxpayer.Name);



            }
        });



        Ext.Ajax.request({

            url:'../Handlers/VAT/SundryTransaction/SundryAccountHandler.ashx?method=GetSundryAccount',
            params:{Pan:PanST.getValue(), AcctType:acctTypST.getValue(), EffDate:sundryDateST.getValue(), SeqNo:txtSundrySeqNoST.getValue()           

            },


            success: function(response){  
                var obj =Ext.decode(response.responseText);
                console.log(obj.length);
                var row = obj.root;


                if(obj.root.length === 1)
                {
                    taxyearST.setValue(obj.root[0].TaxYear);

                    //filingPeriodST.setValue(obj.root[0].Fileper);

                    if(obj.root[0].Fileper==="M")
                    {
                        filingPeriodST.setValue('मासिक');
                    }

                    else if(obj.root[0].Fileper==="B")
                    {
                        filingPeriodST.setValue('दूईमासिक');
                    }
                    else 
                    {
                        filingPeriodST.setValue('चौमासिक');
                    }


                    periodST.setValue(obj.root[0].Period);
                    transferredAmountST.setValue(obj.root[0].TransferAmt);
                    sundryAmountST.setValue(obj.root[0].SunAmt);

                    if(sundryAmountST.getValue() !== null)
                    {
                        transferDateST.setReadOnly(false);
                        transferSeqNoST.setReadOnly(false);
                        transferAmountST.setReadOnly(false);
                        paidToST.setReadOnly(false);

                    }

                    if( obj.root[0].SunAmt != obj.root[0].TransferAmt )
                    {

                        var storeSA=Ext.ComponentQuery.query('#grdST')[0].getStore();
                        storeSA.removeAll();

                        // storeSA.add(obj.root);

                    }        


                    else
                    {
                        msg("WARNING"," You cannot do sundry transaction ");
                        return;
                    }

                }

                else if(obj.root.length>1)
                {
                    taxyearST.setValue('');
                    filingPeriodST.setValue('');
                    periodST.setValue('');
                    transferredAmountST.setValue('');
                    sundryAmountST.setValue('');

                    if(sundryAmountST.getValue() !== null)
                    {
                        transferDateST.setReadOnly(false);
                        transferSeqNoST.setReadOnly(false);
                        transferAmountST.setReadOnly(false);
                        paidToST.setReadOnly(false);
                    }

                    if( obj.root[0].SunAmt != obj.root[0].TransferAmt )
                    {
                        var storeSAA=Ext.ComponentQuery.query('#grdST')[0].getStore();
                        storeSAA.add(obj.root);
                    }           


                    else
                    {
                        msg("WARNING"," You cannot do sundry transaction ");
                        return;
                    }


                }

                else
                {

                    msg("WARNING","सही Pan / Sundry Date / Sundry Seq No छान्नुहोस्");
                    taxyearST.setValue("");
                    filingPeriodST.setValue("");
                    periodST.setValue("");
                    sundryAmountST.setValue("");            
                    transferredAmountST.setValue("");
                    transferDateST.setValue("");
                    transferAmountST.setValue("");
                    paidToST.setValue("-------select------");
                    return;
                }



            },



            //else

            //{

            // taxyearST.setValue(obj.root[0].TaxYear);
            //filingPeriodST.setValue(obj.root[0].Fileper);
            // periodST.setValue(obj.root[0].Period);
            // transferredAmountST.setValue(obj.root[0].TransferAmt);
            // sundryAmountST.setValue(obj.root[0].SunAmt);

            // if(sundryAmountST.getValue() !== null)
            // {
            //  transferDateST.setReadOnly(false);
            // transferSeqNoST.setReadOnly(false);


            // }

            // }

            //if( obj.root[0].SunAmt != obj.root[0].TransferAmt )
            //{

            //var storeSA=Ext.ComponentQuery.query('#grdST')[0].getStore();
            //storeSA.add(obj.root);

            // }           


            // else
            //{
            //msg("WARNING"," You cannot do sundry transaction ");
            // return;
            // }




            // transferAmountST.setReadOnly(false);   
            //paidToST.setReadOnly(false);




            failure:function(response)
            {			
                msg('FAILURE',Ext.decode(response));
            }
        });



    },

    onTxtFilingPeriodSTBeforeRender: function(component, eOpts) {

    },

    onTxtTransferSeqNoSTBlur: function(component, e, eOpts) {

        //---Fields to input-------------------------------------------------
        var panST=Ext.ComponentQuery.query('#txtPanST')[0];
        var acctTypST=Ext.ComponentQuery.query('#txtAcctTypST')[0];
        var sundryDateST=Ext.ComponentQuery.query('#txtSundryDateST')[0];
        var sundrySeqNoST=Ext.ComponentQuery.query('#txtSundrySeqNoST')[0];
        var transferDateST=Ext.ComponentQuery.query('#txtTransferDateST')[0];
        var transferSeqNoST=Ext.ComponentQuery.query('#txtTransferSeqNoST')[0];
        //-------------------------------------------------------------------

        var transferAmountST=Ext.ComponentQuery.query('#txtTransferAmountST')[0];  
        var paidToST=Ext.ComponentQuery.query('#txtPaidToST')[0];  
        var trandate=Ext.ComponentQuery.query('#hdnTrandate')[0];
        var userId=Ext.ComponentQuery.query('#UserId')[0];
        var statusST=Ext.ComponentQuery.query('#hdnStatusST')[0];
        var hdnActionST=Ext.ComponentQuery.query('#hdnActionST')[0];



        var btnSaveST=Ext.ComponentQuery.query('#btnSaveST')[0];
        var btnEditST=Ext.ComponentQuery.query('#btnEditST')[0];
        var btnSubmitST=Ext.ComponentQuery.query('#btnSubmitST')[0];
        var btnVerifyST=Ext.ComponentQuery.query('#btnVerifyST')[0];
        var btnDeleteST=Ext.ComponentQuery.query('#btnDeleteST')[0];
        var btnPrintST=Ext.ComponentQuery.query('#btnPrintST')[0];



        if(panST.getValue() === "")
        {
            msg("WARNING","Pan छान्नुहोस् ");
            return;
        }

        if(acctTypST.getValue() === "")
        {
            msg("WARNING","Account Type छान्नुहोस् ");
            return;
        }

        if(sundryDateST.getValue() === "")
        {
            msg("WARNING","Sundry Date छान्नुहोस् ");
            return;
        }

        if(sundrySeqNoST.getValue() === "")
        {
            msg("WARNING","Sundry Seq No छान्नुहोस् ");
            return;
        }

        if(transferDateST.getValue() === "")
        {
            msg("WARNING","Transfer Date छान्नुहोस् ");
            return;
        }

        if(sundrySeqNoST.getValue() === "")
        {
            msg("WARNING","Sundry Seq No. छान्नुहोस् ");
            return;
        }





        // console.log('store', grd.getStore().data.items);

        // console.log('count',grd.getStore().getCount());
        // var waitMsg=watiMsg('Loading.......');


        Ext.Ajax.request({

            url:'../Handlers/VAT/SundryTransaction/SundryTransactionsHandler.ashx?method=GetSundryTransactions',
            params:{Pan:panST.getValue(),AcctType:acctTypST.getValue(),EffDate:sundryDateST.getValue(), SeqNo:sundrySeqNoST.getValue(), StDate:transferDateST.getValue(), TseqNo:transferSeqNoST.getValue()
            },

            success: function(response){    
                //  waitMsg.hide();

                var obj =Ext.decode(response.responseText);
                //console.log(obj);
                var row = obj.root;



                if(obj.root.StDate === ""|| obj.root.StDate === null)
                {

                    msg("WARNING","Update गर्न सही Pan / Sundry Date / Sundry Seq No / Transfer Date  छान्नुहोस् </br> वा </br> नया Insert गर्न नया   Transfer Date / Transfer Amount / Paid To  भर्नुहोस् ");
                    btnSaveST.enable(true); 
                    btnEditST.disable(true);
                    btnSubmitST.enable(true);
                    btnVerifyST.disable(true);
                    btnDeleteST.disable(true);
                    btnPrintST.enable(true);

                    return;
                }

                else
                {
                    transferAmountST.setValue(obj.root.TransferAmount);
                    transferAmountST.setReadOnly(false);
                    paidToST.setValue(obj.root.TransferTo);
                    statusST.setValue(obj.root.Status);                
                    userId.setValue(obj.root.UserId);
                    hdnActionST.setValue(obj.root.Action);                
                    paidToST.setReadOnly(false);
                }








                //transferAmountST.setValue(obj.root[0].TransferAmount);
                //paidToST.setValue(obj.root[0].TransferTo);
                //userId.setValue(obj.root[0].UserId);
                //statusST.setValue(obj.root[0].Status);
                // console.log(obj.root[0].Status);
                //hdnActionST.setValue(obj.root[0].Action);





                // -----checking office-code---------------------

                // if(obj.root.ApplOnMaNo===""||obj.root.ApplOnMaNo===null)
                // {

                //msg("WARNING","कार्यालय कोड / पुनरावेदन दर्ता न. छान्नुश");
                // return;
                // }


                //------------------------------------------------




                // ----Making Save and Submit Button Disable while R-STATUS IS "F"------------------

                if(obj.root.Status === "F")
                {
                    msg("MESSAGE","यो बिबरण परिबर्तन गर्न पाईनेछैन !!!");
                    btnSaveST.disable(true);
                    btnEditST.disable(true);
                    btnSubmitST.disable(true);
                    btnVerifyST.enable(true);
                    btnDeleteST.disable(true);
                    btnPrintST.disable(true);

                    sundrySeqNoST.disable(true);

                    MyApp.app.getController('SundryTransaction').readOnly();




                }

                if(obj.root.Status === "V")
                {
                    msg("MESSAGE","यो बिबरण रूजु भईसकेको छ !!!");
                    btnSaveST.disable(true);
                    btnEditST.disable(true);
                    btnSubmitST.disable(true);
                    btnVerifyST.disable(true);
                    btnDeleteST.disable(true);
                    btnPrintST.enable(true);
                }

                if(obj.root.Status === "D")
                {
                    msg("MESSAGE","यो बिबरण हटाईसकेको छ !!!");
                    btnSaveST.disable(true);
                    btnEditST.disable(true);
                    btnSubmitST.disable(true);
                    btnVerifyST.disable(true);
                    btnDeleteST.disable(true);
                    btnPrintST.disable(true);
                }


                if(obj.root.Status === "I")
                {

                    btnSaveST.disable(true);
                    btnEditST.enable(true);
                    btnSubmitST.enable(true);
                    btnVerifyST.disable(true);
                    btnDeleteST.enable(true);
                    btnPrintST.disable(true);
                }









                // ----Making Save and Submit Button Enable while R-STATUS IS "I"------------------

                // if(obj.root.Status === "I")
                // {

                // btnSaveVad.enable(true);
                // btnSubmitVad.enable(true);
                // }



                //-------------------------------------------------------------------------



                //-------setting values in fields------------------


                //var txtAmtRtd = Ext.ComponentQuery.query('#txtAmtRtd')[0];
                // appealdateAD.setValue(row.ApplDate);   
                // pan.setValue(row.Pan);
                //appealOnMaNo.setValue(row.ApplOnMaNo);
                // applLocCode.setValue(row.ApplLocCode);
                //applRegNo.setValue(row.ApplRegNo); 

                // tpName.setValue(row.taxpayername);
                // tpAddress.setValue(row.taxpayeraddress);




                // Ext.ComponentQuery.query('#hdnAcctType')[0].setValue(row.AcctType);
                // tranDate.setValue(row.TranDate);
                // orderDate.setValue(row.OrderDate);
                // orderNo.setValue(row.OrderNo);
                // apealReason.setValue(row.ApplReason);
                // appealStatus.setValue(row.ApplStatus);
                // hdnuserId.setValue(row.UserID);
                // apTranNo.setValue(row.ApTranNo);
                // acTranNo.setValue(row.AcTranNo);
                // rStatus.setValue(row.Rstatus);
                // decNo.setValue(row.AcDecisionNo);
                //  decDate.setValue(row.AcDate);
                // userAC.setValue(row.AcUserID);
                //acOffcode.setValue(row.AcOffCode);


                //var valueoffcodeAD= Ext.ComponentQuery.query("#offcodeAD")[0].getValue();

                // acOffcode.setValue(valueoffcodeAD);




            },




            failure:function(response)
            {			
                // waitMsg.hide();
                msg('FAILURE',Ext.decode(response));
            }
        });





    },

    onTxtTransferSeqNoSTKeypress: function(textfield, e, eOpts) {
        //if(Ext.ComponentQuery.query('#txtSundrySeqNoST')[0].getValue().length>0)
        //{
        //e.stopEvent();
        //}

        if(e.keyCode === 13)
        {
            console.log("lock>>>>",e);
            //---Fields to input-------------------------------------------------
            var panST=Ext.ComponentQuery.query('#txtPanST')[0];
            var acctTypST=Ext.ComponentQuery.query('#txtAcctTypST')[0];
            var sundryDateST=Ext.ComponentQuery.query('#txtSundryDateST')[0];
            var sundrySeqNoST=Ext.ComponentQuery.query('#txtSundrySeqNoST')[0];
            var transferDateST=Ext.ComponentQuery.query('#txtTransferDateST')[0];
            var transferSeqNoST=Ext.ComponentQuery.query('#txtTransferSeqNoST')[0];
            //-------------------------------------------------------------------

            var transferAmountST=Ext.ComponentQuery.query('#txtTransferAmountST')[0];  
            var paidToST=Ext.ComponentQuery.query('#txtPaidToST')[0];  
            var trandate=Ext.ComponentQuery.query('#hdnTrandate')[0];
            var userId=Ext.ComponentQuery.query('#UserId')[0];
            var statusST=Ext.ComponentQuery.query('#hdnStatusST')[0];
            var hdnActionST=Ext.ComponentQuery.query('#hdnActionST')[0];



            var btnSaveST=Ext.ComponentQuery.query('#btnSaveST')[0];
            var btnEditST=Ext.ComponentQuery.query('#btnEditST')[0];
            var btnSubmitST=Ext.ComponentQuery.query('#btnSubmitST')[0];
            var btnVerifyST=Ext.ComponentQuery.query('#btnVerifyST')[0];
            var btnDeleteST=Ext.ComponentQuery.query('#btnDeleteST')[0];
            var btnPrintST=Ext.ComponentQuery.query('#btnPrintST')[0];



            if(panST.getValue() === "")
            {
                msg("WARNING","Pan छान्नुहोस् ");
                return;
            }

            if(acctTypST.getValue() === "")
            {
                msg("WARNING","Account Type छान्नुहोस् ");
                return;
            }

            if(sundryDateST.getValue() === "")
            {
                msg("WARNING","Sundry Date छान्नुहोस् ");
                return;
            }

            if(sundrySeqNoST.getValue() === "")
            {
                msg("WARNING","Sundry Seq No छान्नुहोस् ");
                return;
            }

            if(transferDateST.getValue() === "")
            {
                msg("WARNING","Transfer Date छान्नुहोस् ");
                return;
            }

            if(sundrySeqNoST.getValue() === "")
            {
                msg("WARNING","Sundry Seq No. छान्नुहोस् ");
                return;
            }


            // console.log('store', grd.getStore().data.items);

            // console.log('count',grd.getStore().getCount());
            // var waitMsg=watiMsg('Loading.......');


            Ext.Ajax.request({

                url:'../Handlers/VAT/SundryTransaction/SundryTransactionsHandler.ashx?method=GetSundryTransactions',
                params:{Pan:panST.getValue(),AcctType:acctTypST.getValue(),EffDate:sundryDateST.getValue(), SeqNo:sundrySeqNoST.getValue(), StDate:transferDateST.getValue(), TseqNo:transferSeqNoST.getValue()
                },

                success: function(response){    
                    //  waitMsg.hide();

                    var obj =Ext.decode(response.responseText);
                    //console.log(obj);
                    var row = obj.root;



                    if(obj.root.StDate === ""|| obj.root.StDate === null)
                    {

                        msg("WARNING","Update गर्न सही Pan  / Sundry Date / Sundry Seq No / Transfer Date  छान्नुहोस् </br> वा </br> नया Insert गर्न नया   Transfer Date / Transfer Amount / Paid To  भर्नुहोस् ");
                        btnSaveST.enable(true); 
                        btnEditST.disable(true);
                        btnSubmitST.enable(true);
                        btnVerifyST.disable(true);
                        btnDeleteST.disable(true);
                        // btnPrintST.enable(true);

                        return;
                    }

                    else
                    {
                        transferAmountST.setValue(obj.root.TransferAmount);
                        transferAmountST.setReadOnly(false);
                        paidToST.setValue(obj.root.TransferTo);
                        statusST.setValue(obj.root.Status);                
                        userId.setValue(obj.root.UserId);
                        hdnActionST.setValue(obj.root.Action);                
                        paidToST.setReadOnly(false);
                    }




                    //transferAmountST.setValue(obj.root[0].TransferAmount);
                    //paidToST.setValue(obj.root[0].TransferTo);
                    //userId.setValue(obj.root[0].UserId);
                    //statusST.setValue(obj.root[0].Status);
                    // console.log(obj.root[0].Status);
                    //hdnActionST.setValue(obj.root[0].Action);



                    // -----checking office-code---------------------

                    // if(obj.root.ApplOnMaNo===""||obj.root.ApplOnMaNo===null)
                    // {

                    //msg("WARNING","कार्यालय कोड / पुनरावेदन दर्ता न. छान्नुश");
                    // return;
                    // }


                    //------------------------------------------------




                    // ----Making Save and Submit Button Disable while R-STATUS IS "F"------------------

                    if(obj.root.Status === "F")
                    {
                        msg("MESSAGE","यो बिबरण परिबर्तन गर्न पाईनेछैन !!!");
                        btnSaveST.disable(true);
                        btnEditST.disable(true);
                        btnSubmitST.disable(true);
                        btnVerifyST.enable(true);
                        btnDeleteST.disable(true);
                        btnPrintST.disable(true);

                        MyApp.app.getController('SundryTransaction').readOnly();
                        sundrySeqNoST.disable(true);
                        //e.stopEvent();







                    }

                    if(obj.root.Status === "V")
                    {
                        msg("MESSAGE","यो बिबरण रूजु भईसकेको छ !!!");
                        btnSaveST.disable(true);
                        btnEditST.disable(true);
                        btnSubmitST.disable(true);
                        btnVerifyST.disable(true);
                        btnDeleteST.disable(true);
                        btnPrintST.enable(true);


                    }

                    if(obj.root.Status === "D")
                    {
                        msg("MESSAGE","यो बिबरण हटाईसकेको छ !!!");
                        btnSaveST.disable(true);
                        btnEditST.disable(true);
                        btnSubmitST.disable(true);
                        btnVerifyST.disable(true);
                        btnDeleteST.disable(true);
                        btnPrintST.disable(true);

                        sundrySeqNoST.disable(true);
                    }


                    if(obj.root.Status === "I")
                    {

                        btnSaveST.disable(true);
                        btnEditST.enable(true);
                        btnSubmitST.enable(true);
                        btnVerifyST.disable(true);
                        btnDeleteST.enable(true);
                        btnPrintST.disable(true);

                        sundrySeqNoST.enable(true);


                    }









                    // ----Making Save and Submit Button Enable while R-STATUS IS "I"------------------

                    // if(obj.root.Status === "I")
                    // {

                    // btnSaveVad.enable(true);
                    // btnSubmitVad.enable(true);
                    // }



                    //-------------------------------------------------------------------------



                    //-------setting values in fields------------------


                    //var txtAmtRtd = Ext.ComponentQuery.query('#txtAmtRtd')[0];
                    // appealdateAD.setValue(row.ApplDate);   
                    // pan.setValue(row.Pan);
                    //appealOnMaNo.setValue(row.ApplOnMaNo);
                    // applLocCode.setValue(row.ApplLocCode);
                    //applRegNo.setValue(row.ApplRegNo); 

                    // tpName.setValue(row.taxpayername);
                    // tpAddress.setValue(row.taxpayeraddress);




                    // Ext.ComponentQuery.query('#hdnAcctType')[0].setValue(row.AcctType);
                    // tranDate.setValue(row.TranDate);
                    // orderDate.setValue(row.OrderDate);
                    // orderNo.setValue(row.OrderNo);
                    // apealReason.setValue(row.ApplReason);
                    // appealStatus.setValue(row.ApplStatus);
                    // hdnuserId.setValue(row.UserID);
                    // apTranNo.setValue(row.ApTranNo);
                    // acTranNo.setValue(row.AcTranNo);
                    // rStatus.setValue(row.Rstatus);
                    // decNo.setValue(row.AcDecisionNo);
                    //  decDate.setValue(row.AcDate);
                    // userAC.setValue(row.AcUserID);
                    //acOffcode.setValue(row.AcOffCode);


                    //var valueoffcodeAD= Ext.ComponentQuery.query("#offcodeAD")[0].getValue();

                    // acOffcode.setValue(valueoffcodeAD);




                },




                failure:function(response)
                {			
                    // waitMsg.hide();
                    msg('FAILURE',Ext.decode(response));
                }
            });





        }
    },

    onGrdAppealDecisionItemClick: function(dataview, record, item, index, e, eOpts) {

        Ext.ComponentQuery.query('#txtSundryDateST')[0].setValue(record.data.EffDate);
        Ext.ComponentQuery.query('#txtSundrySeqNoST')[0].setValue(record.data.SeqNo);
        Ext.ComponentQuery.query('#txtSundryAmountST')[0].setValue(record.data.SunAmt);
        Ext.ComponentQuery.query('#txtTaxyearST')[0].setValue(record.data.TaxYear);
        Ext.ComponentQuery.query('#txtFilingPeriodST')[0].setValue(record.data.Fileper);
        Ext.ComponentQuery.query('#txtPeriodST')[0].setValue(record.data.Period);
        Ext.ComponentQuery.query('#txtTransferredAmountST')[0].setValue(record.data.TransferAmt);




    }

});