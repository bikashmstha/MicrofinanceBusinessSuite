{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Role",
        "stores": [
            "Role",
            "RoleModuleFunction",
            "ApplicationWithMNR"
        ]
    },
    "configAlternates": {
        "designer|userClassName": "string",
        "stores": "typedarray"
    },
    "designerId": "a3e62b82-98ae-436d-a8c2-f49b96ed81f7",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#pnlRole",
                "designer|targetType": "Ext.panel.Panel",
                "fn": "onPnlRoleAfterRender",
                "implHandler": [
                    "var grdApp=Ext.ComponentQuery.query('#role_grdApplication')[0];\r",
                    "grdApp.getStore().load();\r",
                    "var grdRole=Ext.ComponentQuery.query('#role_grdRole')[0];\r",
                    "grdRole.getStore().removeAll();\r",
                    "var grdRoleModuleFunction=Ext.ComponentQuery.query(\"#role_grdRoleModuleFunction\")[0];\r",
                    "grdRoleModuleFunction.getStore().removeAll();"
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "configAlternates": {
                "designer|controlQuery": "string",
                "designer|targetType": "view",
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onPnlRoleAfterRender",
            "designerId": "e4c78947-ecd0-4d4f-95b0-075c6a87cf25"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#role_btnAddRole",
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnAddRoleClick",
                "implHandler": [
                    "var me=this;\r",
                    "\r",
                    "var grdApp=Ext.ComponentQuery.query('#role_grdApplication')[0];\r",
                    "var grdR=Ext.ComponentQuery.query('#role_grdRole')[0];\r",
                    "\r",
                    "var selectedApp=grdApp.getSelectionModel().getSelection()[0];\r",
                    "\r",
                    "if(!selectedApp)\r",
                    "{\r",
                    "    msg('WARNING','Select application first!');\r",
                    "\r",
                    "\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    var txtRoleID=Ext.ComponentQuery.query('#roleID')[0].getValue();\r",
                    "    var txtRoleDesc=Ext.ComponentQuery.query('#roleDescription')[0].getValue();\r",
                    "    var txtDBRole=Ext.ComponentQuery.query('#dbRole')[0].getValue();\r",
                    "\r",
                    "    if(txtRoleID===\"\")\r",
                    "    {\r",
                    "        msg('WARNING','Enter Role ID!');   \r",
                    "\r",
                    "    }\r",
                    "    else\r",
                    "    {\r",
                    "        if (grdR.getSelectionModel().hasSelection())\r",
                    "        {\r",
                    "            me.ClearControls('reset');\r",
                    "            var r = grdR.getSelectionModel().getSelection();\r",
                    "            console.log(r);\r",
                    "            r[0].set('RoleID',txtRoleID);\r",
                    "            r[0].set('RoleDescription',txtRoleDesc);\r",
                    "            r[0].set('DbRole',txtDBRole);\r",
                    "            grdR.getSelectionModel().deselectAll();\r",
                    "            return false;\r",
                    "\r",
                    "\r",
                    "        }\r",
                    "        else\r",
                    "        {\r",
                    "            var strRole=Ext.getStore('Role');\r",
                    "\r",
                    "            strRole.add({\r",
                    "                ApplicationID:selectedApp.data.ApplicationID,\r",
                    "                RoleID:txtRoleID,\r",
                    "                RoleDescription:txtRoleDesc,\r",
                    "                DbRole:txtDBRole,\r",
                    "                Action:'A',\r",
                    "                RoleModuleFunctions:[]\r",
                    "            });\r",
                    "\r",
                    "            me.ClearControls('reset');\r",
                    "\r",
                    "        }\r",
                    "\r",
                    "    }\r",
                    "\r",
                    "}"
                ],
                "name": "click",
                "scope": "me"
            },
            "configAlternates": {
                "designer|controlQuery": "string",
                "designer|targetType": "view",
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onBtnAddRoleClick",
            "designerId": "1b16f478-252d-487d-96c9-be2f4ed28c37"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#role_grdApplication",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onGrdApplicationItemClick",
                "implHandler": [
                    "var me=this;\r",
                    "var grdRole=Ext.ComponentQuery.query(\"#role_grdRole\")[0];\r",
                    "grdRole.store.loadData(record.raw.Roles);\r",
                    "\r",
                    "var grdRoleModuleFunction=Ext.ComponentQuery.query(\"#role_grdRoleModuleFunction\")[0];\r",
                    "//console.log('rec',record.raw.ModuleFunctions);\r",
                    "grdRoleModuleFunction.store.loadData(record.raw.ModuleFunctions);\r",
                    "\r",
                    "$('.chkFunc').live('click',function(){\r",
                    "    var chkd= $(this).attr('checked');\r",
                    "    $(this).parent().parent().parent().next().next().next().find('div:first').html(chkd?\"Y\":\"N\");\r",
                    "});\r",
                    "me.ClearControls('reset');"
                ],
                "name": "itemclick",
                "scope": "me"
            },
            "configAlternates": {
                "designer|controlQuery": "string",
                "designer|targetType": "view",
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onGrdApplicationItemClick",
            "designerId": "3ccdba63-eedf-49a9-9ef2-1e2a8d82ee25"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "txt"
                ],
                "fn": "ClearControls",
                "implHandler": [
                    "var txtRoleID;\r",
                    "var txtRoleDesc;\r",
                    "var txtDBRole;\r",
                    "if(txt ===  \"reset\")\r",
                    "{\r",
                    "    txtRoleID=Ext.ComponentQuery.query(\"#roleID\")[0].reset();\r",
                    "    txtRoleDesc =Ext.ComponentQuery.query(\"#roleDescription\")[0].reset();\r",
                    "    txtDBRole=Ext.ComponentQuery.query(\"#dbRole\")[0].reset();\r",
                    "    Ext.ComponentQuery.query(\"#roleID\")[0].enable();\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    txtRoleID=Ext.ComponentQuery.query(\"#roleID\")[0].reset();\r",
                    "    txtRoleDesc=Ext.ComponentQuery.query(\"#roleDescription\")[0].reset();\r",
                    "    txtDBRole=Ext.ComponentQuery.query(\"#dbRole\")[0].reset();\r",
                    "    Ext.ComponentQuery.query('#role_grdApplication')[0].getStore().load();\r",
                    "    Ext.ComponentQuery.query('#role_grdRole')[0].getStore().removeAll();\r",
                    "    Ext.ComponentQuery.query('#role_grdRoleModuleFunction')[0].getStore().removeAll();\r",
                    "\r",
                    "}"
                ]
            },
            "configAlternates": {
                "designer|params": "typedarray",
                "fn": "string",
                "implHandler": "code"
            },
            "name": "ClearControls",
            "designerId": "6b093c4e-72b7-4ee9-87b9-87c431f45b0b"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#role_grdRole",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onGrdRoleItemClick",
                "implHandler": [
                    "\r",
                    "if(index>=0)\r",
                    "{\r",
                    "\r",
                    "var grdR=Ext.ComponentQuery.query(\"#role_grdRole\")[0];\r",
                    "var roleId=Ext.ComponentQuery.query('#roleID')[0];\r",
                    "var roleDesc=Ext.ComponentQuery.query('#roleDescription')[0];\r",
                    "var dbRole=Ext.ComponentQuery.query('#dbRole')[0];\r",
                    "var action=\"\";    \r",
                    "var rec = grdR.getStore('Role').getAt(index);\r",
                    "\r",
                    "roleId.setValue(rec.get('RoleID'));\r",
                    "roleDesc.setValue(rec.get('RoleDescription'));\r",
                    "dbRole.setValue(rec.get('DbRole'));\r",
                    "action=rec.get('Action');\r",
                    "if(action==\"A\")\r",
                    "{\r",
                    "roleId.enable();\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "roleId.disable();\r",
                    "}\r",
                    "}\r",
                    "\r",
                    "$(\".chkFunc\").each(function (i) {\r",
                    "$(this).attr('checked',false);\r",
                    "$(this).parent().parent().parent().next().find('div:first').html('');\r",
                    "$(this).parent().parent().parent().next().next().find('div:first').html('');\r",
                    "$(this).parent().parent().parent().next().next().next().find('div:first').html('');\r",
                    "\r",
                    "});\r",
                    "\r",
                    "var RMF=record.data.RoleModuleFunctions;\r",
                    "//console.log('rmf',RMF);\r",
                    "\r",
                    "for(var i=0;i<record.data.RoleModuleFunctions.length;i++)\r",
                    "{    \r",
                    "var appid = RMF[i].ApplicationID;\r",
                    "var roleid = RMF[i].RoleID;\r",
                    "var moduleid = RMF[i].ModuleID;\r",
                    "var code = RMF[i].FunCD;\r",
                    "var fromDate = RMF[i].FromDate;\r",
                    "\r",
                    "\r",
                    "$(\".chkFunc\").each(function (indx) {\r",
                    "var fcode=$(this).parent().parent().parent().prev().prev().find('div:first').html();\r",
                    "var aid=$(this).parent().parent().parent().prev().prev().prev().prev().prev().find('div:first').html();\r",
                    "var mid=$(this).parent().parent().parent().prev().prev().prev().prev().find('div:first').html();\r",
                    "if (code==fcode && moduleid==mid) \r",
                    "{\r",
                    "    $(this).attr('checked','checked');\r",
                    "\r",
                    "    $(this).parent().parent().parent().next().next().find('div:first').html('Y');\r",
                    "    $(this).parent().parent().parent().prev().find('div:first').html(fromDate);\r",
                    "}\r",
                    "\r",
                    "});        \r",
                    "}"
                ],
                "name": "itemclick",
                "scope": "me"
            },
            "configAlternates": {
                "designer|controlQuery": "string",
                "designer|targetType": "view",
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onGrdRoleItemClick",
            "designerId": "099145df-f946-4b98-9884-e2ea883e3520"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnRoleSave",
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnRoleSaveClick",
                "implHandler": [
                    "var me=this;\r",
                    "var grdApp=Ext.ComponentQuery.query('#role_grdApplication')[0];\r",
                    "var selectedApp=grdApp.getSelectionModel().getSelection()[0];\r",
                    "\r",
                    "var grdRole=Ext.ComponentQuery.query('#role_grdRole')[0];\r",
                    "var selectedRole=grdRole.getSelectionModel().getSelection()[0];\r",
                    "\r",
                    "\r",
                    "if(!selectedApp)\r",
                    "{\r",
                    "    msg('WARNING','Select application first!');\r",
                    "\r",
                    "}\r",
                    "else if(!selectedRole)\r",
                    "{\r",
                    "    msg('WARNING','Select Role!');\r",
                    "\r",
                    "}\r",
                    "else\r",
                    "{\r",
                    "    var apid=selectedRole.data.ApplicationID;\r",
                    "    var roleID=selectedRole.data.RoleID;\r",
                    "    var roleDesc=selectedRole.data.RoleDescription;\r",
                    "    var dbRole=selectedRole.data.DbRole;\r",
                    "    var act=selectedRole.data.Action;\r",
                    "\r",
                    "    var role={\r",
                    "        'ApplicationID':apid,\r",
                    "        'RoleID':roleID,\r",
                    "        'RoleDescription':roleDesc,\r",
                    "        'DBRole':dbRole,\r",
                    "        'Action':act==\"A\"?\"A\":\"E\",\r",
                    "        'RoleModuleFunctions':[]\r",
                    "\r",
                    "    };\r",
                    "    // console.log(role);\r",
                    "\r",
                    "    var RMF=[];\r",
                    "    $(\".chkFunc\").each(function (indx) {\r",
                    "\r",
                    "        var action = \"\";\r",
                    "        var fromDate = \"\";\r",
                    "        var oldVal =  $(this).parent().parent().parent().next().next().find('div:first').html();\r",
                    "        var newVal =  $(this).parent().parent().parent().next().next().next().find('div:first').html();\r",
                    "        var funCd = $(this).parent().parent().parent().prev().prev().find('div:first').html();    \r",
                    "        var moduleDesc = $(this).parent().parent().parent().prev().prev().prev().find('div:first').html();\r",
                    "        var moduleId = $(this).parent().parent().parent().prev().prev().prev().prev().find('div:first').html();\r",
                    "        var appId = $(this).parent().parent().parent().prev().prev().prev().prev().prev().find('div:first').html();\r",
                    "        fromDate = $(this).parent().parent().parent().prev().find('div:first').html();\r",
                    "\r",
                    "        if( (oldVal===\"N\" && newVal===\"Y\") || (oldVal===\"\" && newVal===\"Y\") )\r",
                    "        {\r",
                    "            action=\"A\";\r",
                    "            fromDate = Ext.get('nepDate').dom.innerHTML;\r",
                    "        }\r",
                    "        else if(oldVal===\"Y\" && newVal===\"N\") \r",
                    "        {\r",
                    "            action=\"D\";\r",
                    "        }\r",
                    "        if(action!==\"\")\r",
                    "        {\r",
                    "            RMF[RMF.length]={'ApplicationID': appId ,'RoleID': roleID ,'ModuleID': moduleId ,'ModuleDesc': moduleDesc ,'FunCD':funCd ,'Action':action,'FromDate':fromDate};\r",
                    "            // alert( RMF[RMF.length]);\r",
                    "        }\r",
                    "\r",
                    "    });\r",
                    "\r",
                    "\r",
                    "    role.RoleModuleFunctions=RMF;\r",
                    "\r",
                    "\r",
                    "    Ext.Ajax.request({\r",
                    "        method: 'POST',\r",
                    "        url: '../Handlers/Security/RoleHandler.ashx',\r",
                    "        params: {method:'SaveRole', role : JSON.stringify(role) },\r",
                    "        success: function( result, request ){\r",
                    "\r",
                    "            var jsonMsg=Ext.decode(result.responseText);\r",
                    "            msg(jsonMsg.success==\"True\"?\"SUCCESS\":\"FAILURE\",jsonMsg.message);\r",
                    "            // msg(\"Save Status\",jsonMsg.message);\r",
                    "            \r",
                    "            //console.log('msg',jsonMsg.message);\r",
                    "            \r",
                    "            if(jsonMsg.message == \"Error Saving Role\")\r",
                    "            {\r",
                    "   \t\t\t\tmsg(\"WARNING\",\"Role can not be re-assign on the same day !\");\r",
                    "                return;\r",
                    "                    \r",
                    "            }\r",
                    "           \r",
                    "        }\r",
                    "    });\r",
                    "    me.ClearControls();\r",
                    "\r",
                    "      \r",
                    "    var store=Ext.getStore('ApplicationWithMNR');\r",
                    "    store.load({\r",
                    "        url:\"../Handlers/Security/ApplicationHandler.ashx?method=GetApplicationsWithModuleFunctionsAndRoles\",\r",
                    "        method:'POST',\r",
                    "        params: {}\r",
                    "        \r",
                    "    });\r",
                    "          \r",
                    "}"
                ],
                "name": "click",
                "scope": "me"
            },
            "configAlternates": {
                "designer|controlQuery": "string",
                "designer|targetType": "view",
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onBtnRoleSaveClick",
            "designerId": "5001b7ae-720b-40de-a1a9-12fe5da39471"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnRoleCancel",
                "designer|targetType": "Ext.button.Button",
                "fn": "onBtnRoleCancelClick",
                "implHandler": [
                    "this.ClearControls();\r",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "configAlternates": {
                "designer|controlQuery": "string",
                "designer|targetType": "view",
                "fn": "string",
                "implHandler": "code",
                "name": "string",
                "scope": "string"
            },
            "name": "onBtnRoleCancelClick",
            "designerId": "7fe64192-ed27-46ea-b845-e964832f95d4"
        }
    ]
}