/*
 * File: app/view/PrintCertificatePanCard.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.PrintCertificatePanCard', {
    extend: 'Ext.panel.Panel',

    frame: true,
    height: 600,
    id: 'PrintCertificatePanCard',
    itemId: 'PrintCertificatePanCard',
    maxHeight: 600,
    minHeight: 600,
    autoScroll: true,
    layout: {
        align: 'stretch',
        type: 'hbox'
    },
    manageHeight: false,
    title: 'Print Pan Card',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'fieldset',
                    flex: 1,
                    margins: '110 100 0 35',
                    height: 280,
                    maxHeight: 280,
                    maxWidth: 420,
                    minHeight: 280,
                    width: 420,
                    title: 'PRINT',
                    items: [
                        {
                            xtype: 'container',
                            height: 220,
                            margin: '0 0 0 40',
                            padding: '5 0 0 0 ',
                            width: 322,
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'Print_txtPAN',
                                    width: 190,
                                    fieldLabel: 'PAN',
                                    emptyText: ' | | | | | | | |',
                                    enableKeyEvents: true,
                                    enforceMaxLength: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 9,
                                    minLength: 9
                                },
                                {
                                    xtype: 'textareafield',
                                    itemId: 'Print_txtPurpose',
                                    maxWidth: 400,
                                    width: 300,
                                    fieldLabel: 'Purpose'
                                },
                                {
                                    xtype: 'textfield',
                                    hidden: true,
                                    itemId: 'Print_txtCopies',
                                    width: 133,
                                    fieldLabel: 'No of Copies',
                                    enforceMaxLength: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 2,
                                    minLength: 1
                                },
                                {
                                    xtype: 'textfield',
                                    hidden: true,
                                    itemId: 'Print_txtPrintedBy',
                                    width: 300,
                                    fieldLabel: 'Printed By',
                                    maskRe: /[a-z A-Z]/
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    height: 30,
                                    width: 600,
                                    layout: {
                                        type: 'table'
                                    },
                                    fieldLabel: '',
                                    items: [
                                        {
                                            xtype: 'radiofield',
                                            disabled: true,
                                            itemId: 'rdbCertificate',
                                            margin: '0 0 0 100',
                                            fieldLabel: '',
                                            name: 'rdb',
                                            boxLabel: 'Certificate'
                                        },
                                        {
                                            xtype: 'radiofield',
                                            disabled: true,
                                            itemId: 'rdbPanCard',
                                            margin: 5,
                                            fieldLabel: '',
                                            name: 'rdb',
                                            boxLabel: 'PAN Card',
                                            checked: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            style: 'text-align:center;',
                            width: 405,
                            items: [
                                {
                                    xtype: 'button',
                                    disabled: true,
                                    itemId: 'btnPrintPan',
                                    margin: '0 0 0 25',
                                    iconCls: 'icon-print',
                                    text: 'Print'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnCancelPrint',
                                    margin: '0 0 0 5',
                                    maxWidth: 60,
                                    iconCls: 'icon-cancel',
                                    text: 'Cancel'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'container',
                    flex: 1,
                    margins: '30 0 0 0',
                    padding: '',
                    items: [
                        {
                            xtype: 'fieldcontainer',
                            height: 20,
                            width: 400,
                            layout: {
                                align: 'stretch',
                                type: 'hbox'
                            },
                            fieldLabel: '',
                            items: [
                                {
                                    xtype: 'radiofield',
                                    itemId: 'rbdcerrem',
                                    fieldLabel: '',
                                    name: 'prnt',
                                    boxLabel: 'Certificate'
                                },
                                {
                                    xtype: 'radiofield',
                                    margins: '0 0 0 20',
                                    itemId: 'rbdcardrem',
                                    fieldLabel: '',
                                    name: 'prnt',
                                    boxLabel: 'PAN Card',
                                    checked: true
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            padding: 5,
                            width: 449,
                            layout: {
                                type: 'column'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtFromDate',
                                    maxWidth: 150,
                                    width: 150,
                                    fieldLabel: 'From Date',
                                    labelWidth: 65,
                                    enableKeyEvents: true,
                                    listeners: {
                                        blur: {
                                            fn: me.onTxtFromDateBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtToDate',
                                    margin: '0 0 0 12',
                                    maxWidth: 130,
                                    minWidth: 130,
                                    width: 130,
                                    fieldLabel: 'To Date',
                                    labelWidth: 50,
                                    enableKeyEvents: true,
                                    listeners: {
                                        blur: {
                                            fn: me.onTxtToDateBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'button',
                                    margin: '0 0 0 10',
                                    width: 68,
                                    text: 'Load PAN',
                                    listeners: {
                                        click: {
                                            fn: me.onButtonClick,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            frame: true,
                            height: 300,
                            itemId: 'grdRemainingPan',
                            maxHeight: 300,
                            maxWidth: 450,
                            minHeight: 300,
                            minWidth: 450,
                            width: 450,
                            autoScroll: true,
                            title: 'Remaining PAN',
                            scroll: 'vertical',
                            store: 'RemainingPanModel',
                            viewConfig: {
                                margin: ''
                            },
                            columns: [
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'Pan',
                                    text: 'Pan'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    maxWidth: 314,
                                    minWidth: 314,
                                    width: 314,
                                    dataIndex: 'TaxpayerName',
                                    text: 'TaxpayerName'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'DocumentType',
                                    text: 'DocumentType'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'PrintedBy',
                                    text: 'PrintedBy'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'NoOfCopy',
                                    text: 'NoOfCopy'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'Purpose',
                                    text: 'Purpose'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    hidden: true,
                                    dataIndex: 'UserId',
                                    text: 'UserId'
                                }
                            ],
                            selModel: Ext.create('Ext.selection.CheckboxModel', {

                            })
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'txtPrintedByRmNPan',
                            width: 330,
                            fieldLabel: 'Printed By',
                            labelWidth: 65
                        },
                        {
                            xtype: 'container',
                            height: 30,
                            margin: '5 0 0 0',
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnPrintRemaining',
                                    iconCls: 'icon-print',
                                    text: 'Print'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnCancelPan',
                                    margin: '0 0 0 5',
                                    iconCls: 'icon-cancel',
                                    text: 'Cancel'
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtFromDateBlur: function(component, e, eOpts) {
        var field=Ext.ComponentQuery.query('#txtFromDate')[0];
        validateFutureDate(field.getValue(),'N',function(){field.focus();});
    },

    onTxtToDateBlur: function(component, e, eOpts) {
        var field=Ext.ComponentQuery.query('#txtToDate')[0];
        validateFutureDate(field.getValue(),'N',function(){field.focus();});
    },

    onButtonClick: function(button, e, eOpts) {
        var cert=  Ext.ComponentQuery.query('#rbdcerrem')[0];
        var pCard= Ext.ComponentQuery.query('#rbdcardrem')[0];

        if(!cert.getValue() && !pCard.getValue())
        {
            msg('WARNING',"Select Certificate or PAN Card"); 
            return false;
        }

        var frm=Ext.ComponentQuery.query('#txtFromDate')[0].getValue();
        var to=Ext.ComponentQuery.query('#txtToDate')[0].getValue();

        if(!frm)
        {
            msg('WARNING',"From Date Missing");
            return false;
        }

        if(!to)
        {
            msg('WARNING',"To Date Missing");
            return false;
        }

        if(frm>=to)
        {
            msg('WARNING',"From Date should be less than To Date.");
            return false;
        }


        var str=Ext.getStore('RemainingPanModel');
        str.removeAll();

        var offCode = Ext.get('offCode').dom.innerHTML;
        var docType=cert.getValue()?'C':'P';

        var waitSave = watiMsg('Loading ...');

        Ext.Ajax.request({
            url:'../Reporting/Registration/ReportHandlers/RemainingPanHandler.ashx',
            params:{OffCode:offCode,DocType:docType,FromDate:frm,ToDate:to},

            success:function(response)
            {
                waitSave.hide();

                var obj=Ext.decode(response.responseText);
                var row=obj.root;
                if(obj.root.length<1)
                {
                    msg("INFORMATION","No 'PAN CERTIFICATE' available to print");
                    return;
                }
                str.loadData(obj.root);
            },
            failure:function(response)
            {			
                msg('FAILURE',Ext.decode(response));
                waitSave.hide();
            }
        });

    }

});