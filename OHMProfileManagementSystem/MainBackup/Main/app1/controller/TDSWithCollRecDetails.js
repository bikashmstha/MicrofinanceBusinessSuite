/*
 * File: app/controller/TDSWithCollRecDetails.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TDSWithCollRecDetails', {
    extend: 'Ext.app.Controller',

    models: [
        'TDSWithCollRecDet',
        'TDSWithCollRecDetSum'
    ],
    stores: [
        'TDSWithCollRecDet',
        'TDSWithCollRecDetSum'
    ],
    views: [
        'TDSWithCollRecDetails'
    ],

    ShowWithCollRecDet: function(pan, iro, from, to) {
        Ext.getCmp('cntOMTDS').removeAll();

        var pnlDynamic = Ext.create('MyApp.view.TDSWithCollRecDetails');

        var pnlToRender = Ext.ComponentQuery.query("#cntOMTDS")[0];

        pnlToRender.add(pnlDynamic);

        var hdnpan = Ext.ComponentQuery.query("#hdnWCRDTDSpan")[0];
        var hdniro = Ext.ComponentQuery.query("#hdnWCRDTDSiro")[0];
        var hdnfrom = Ext.ComponentQuery.query("#hdnWCRDTDSfrom")[0];
        var hdnto = Ext.ComponentQuery.query("#hdnWCRDTDSto")[0];

        hdnpan.setValue(pan);
        hdniro.setValue(iro);
        hdnfrom.setValue(from);
        hdnto.setValue(to);

        var param = {
            WhPan:hdnpan.getValue(),
            IrdCode:hdniro.getValue(),
            FromDate:hdnfrom.getValue(),
            ToDate:hdnto.getValue()
        };

        var store = Ext.getStore('TDSWithCollRecDet');

        store.load({
            params:{objRecDet:JSON.stringify(param)}
        });

        Ext.Ajax.request({
            url:"../Handlers/TDS/SearchRecordsHandler.ashx?method=GetVRecordDetails",
            params: {objRecDet:JSON.stringify(param)},
            success: function ( result, request ){

                //waitSave.hide();

                var obj = Ext.decode(result.responseText);
                var data = obj.root;

                console.log("data",obj.success);
                if(obj.success === "true")
                {
                    var amt =0;
                    var TDSamt = 0;

                    var TDSWithCollRecDetSum = Ext.getStore('TDSWithCollRecDetSum'); 

                    if(obj.total!=="0")
                    {
                        for(var i=0;i<obj.total;i++)
                        {
                            amt = amt+data[i].PaymentAmt;
                            TDSamt = TDSamt+data[i].TDSAmt;
                        }

                        TDSWithCollRecDetSum.loadData([],false);
                        TDSWithCollRecDetSum.add({
                            total:"Total:",
                            totalPayAmt:amt,
                            totalTDSAmt:TDSamt
                        });
                    }
                    else
                    {
                        TDSWithCollRecDetSum.loadData([],false);
                        TDSWithCollRecDetSum.add({
                            total:"Total:",
                            totalPayAmt:0,
                            totalTDSAmt:0
                        });
                    }
                    //TDSVerSummary.load();

                }
                else if(obj.success === "false") 
                {
                    msg("FAILURE",obj.message);
                    return;
                }
            },

            failure: function ( result, request ){

                return;
            }
        });

    }

});
