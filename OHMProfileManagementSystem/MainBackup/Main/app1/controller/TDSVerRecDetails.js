/*
 * File: app/controller/TDSVerRecDetails.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TDSVerRecDetails', {
    extend: 'Ext.app.Controller',

    models: [
        'TDSVerifiedDetails',
        'TDSVerSummary'
    ],
    stores: [
        'TDSVerifiedDetails',
        'TDSVerDetSum'
    ],
    views: [
        'TDSVerRecDetails'
    ],

    ShowVerRecDetails: function(iro, from, to) {
        Ext.getCmp('cntOMTDS').removeAll();

        var pnlDynamic = Ext.create('MyApp.view.TDSVerRecDetails');

        var pnlToRender = Ext.ComponentQuery.query("#cntOMTDS")[0];
        pnlToRender.add(pnlDynamic);

        var hdniro = Ext.ComponentQuery.query("#hdnVRDTDSiro")[0];
        var hdnfrom = Ext.ComponentQuery.query("#hdnVRDTDSfrom")[0];
        var hdnto = Ext.ComponentQuery.query("#hdnVRDTDSto")[0];

        hdniro.setValue(iro);
        hdnfrom.setValue(from);
        hdnto.setValue(to);

        var param = {
            IrdCode:hdniro.getValue(),
            FromDate:hdnfrom.getValue(),
            ToDate:hdnto.getValue()
        };

        var store = Ext.getStore('TDSVerifiedDetails');

        store.load({
            params:{objRecDet:JSON.stringify(param)}
        });

        Ext.Ajax.request({
            url:"../Handlers/TDS/SearchRecordsHandler.ashx?method=GetVRecordDetails",
            params: {objRecDet:JSON.stringify(param)},
            success: function ( result, request ){

                //waitSave.hide();

                var obj = Ext.decode(result.responseText);
                var data = obj.root;

                var TDSVerSummary = Ext.getStore('TDSVerDetSum'); 

                if(obj.success === "true")
                {
                    var amt =0;
                    var TDSamt = 0;

                    if(obj.total!=="0")
                    {
                        for(var i=0;i<obj.total;i++)
                        {
                            amt = amt+data[i].PaymentAmt;
                            TDSamt = TDSamt+data[i].TDSAmt;
                            console.log("amt",amt);
                        }
                        TDSVerSummary.loadData([],false);
                        TDSVerSummary.add({
                            total:"Total:",
                            totalPayAmt:amt,
                            totalTDSAmt:TDSamt
                        });
                    }
                    else
                    {
                        console.log("else total",obj.total);
                        TDSVerSummary.loadData([],false);
                        TDSVerSummary.add({
                            total:"Total:",
                            totalPayAmt:0,
                            totalTDSAmt:0
                        });
                    }

                    //TDSVerSummary.load();

                }
                else if(obj.success === "false") 
                {
                    msg("FAILURE",obj.message);
                    return;
                }
            },

            failure: function ( result, request ){

                return;
            }
        });


    }

});
