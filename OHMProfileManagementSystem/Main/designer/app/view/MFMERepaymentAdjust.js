/*
 * File: app/view/MFMERepaymentAdjust.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.MFMERepaymentAdjust', {
    extend: 'Ext.panel.Panel',

    requires: [
        'Ext.form.Panel',
        'Ext.form.field.Text',
        'Ext.form.field.Checkbox',
        'Ext.button.Button'
    ],

    frame: true,
    layout: 'table',
    title: 'Loan Interest Adjust',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmMFMERepaymentAdjust',
                    bodyPadding: 10,
                    title: '',
                    layout: {
                        type: 'table',
                        columns: 3
                    },
                    items: [
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtFromDateBS',
                            fieldLabel: 'From Date(B.S.)',
                            labelWidth: 135
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtFromDateAD',
                            fieldLabel: 'To Date(B.S)'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtCenterCode',
                            fieldLabel: 'Center Code',
                            labelWidth: 135,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtCenterName',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 40
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanProductCode',
                            fieldLabel: 'Loan Product',
                            labelWidth: 135,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtLoanProductName',
                            fieldLabel: 'Label',
                            hideLabel: true,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 40
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanNo',
                            fieldLabel: 'Loan No',
                            labelWidth: 135,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            listeners: {
                                afterrender: {
                                    fn: me.onTxtLoanNoAfterRender,
                                    scope: me
                                },
                                change: {
                                    fn: me.onTxtLoanNoChange,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtMemberName',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 40
                        },
                        {
                            xtype: 'checkboxfield',
                            itemId: 'chkAdjustPastRepayment',
                            margin: '0 0 0 10',
                            fieldLabel: 'Adjust Past Repayment',
                            labelWidth: 140
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanRepayment',
                            fieldLabel: 'Individual Repayment',
                            labelWidth: 135,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            listeners: {
                                afterrender: {
                                    fn: me.onTxtLoanRepaymentAfterRender,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtRepaymentDate',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 40
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtCollectionSheetNo',
                            margin: '0 0 0 10',
                            fieldLabel: 'Collection Sheet No',
                            labelWidth: 140,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'container',
                            colspan: 3,
                            layout: 'table',
                            items: [
                                {
                                    xtype: 'form',
                                    colspan: 2,
                                    frame: true,
                                    bodyPadding: 10,
                                    title: 'Due Balance (Before)',
                                    layout: {
                                        type: 'table',
                                        columns: 2
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPastPrinciple',
                                            fieldLabel: 'Past Principle',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtCurrentPrinciple',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Current Principle',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPastInterest',
                                            fieldLabel: 'Past Interest',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtCurrentInterest',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Current Interest',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPenaltyOnInterest',
                                            fieldLabel: 'Penalty On Interest',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtInstallmentAmount',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Installment Amount',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'form',
                                    colspan: 0,
                                    frame: true,
                                    margin: '-27 0 0 0',
                                    width: 553,
                                    bodyPadding: 10,
                                    title: 'Paid Balance (After)',
                                    layout: {
                                        type: 'table',
                                        columns: 2
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPrincipleBalance',
                                            fieldLabel: 'Principle Balance',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtInterestBalance',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Interest Balance',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPenaltyBalance',
                                            fieldLabel: 'Penalty Balance',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtTotalBalance',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Total Balance',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            colspan: 3,
                            layout: {
                                type: 'table',
                                columns: 3
                            },
                            items: [
                                {
                                    xtype: 'form',
                                    colspan: 3,
                                    frame: true,
                                    bodyPadding: 10,
                                    title: 'Recevied Balance',
                                    layout: {
                                        type: 'table',
                                        columns: 4
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPrincipleReceived',
                                            fieldLabel: 'Principle Received',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtInterestReceived',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Interest Received',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            itemId: 'chkTransferFromSaving',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Transfer From Saving',
                                            labelWidth: 130
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtSavingAccount',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Saving Account',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPenaltyReceived',
                                            fieldLabel: 'Penalty Received',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtTotalReceived',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Total Received',
                                            labelWidth: 120,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtCurrentSavingBalance',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Current Saving Balance',
                                            labelWidth: 130,
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtChequeNo',
                                            margin: '0 0 0 10',
                                            fieldLabel: 'Cheque No',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            colspan: 3,
                            layout: {
                                type: 'table',
                                columns: 3
                            },
                            items: [
                                {
                                    xtype: 'form',
                                    colspan: 3,
                                    frame: true,
                                    width: 1149,
                                    bodyPadding: 10,
                                    title: 'Adjust Amount',
                                    layout: {
                                        type: 'table',
                                        columns: 3
                                    },
                                    items: [
                                        {
                                            xtype: 'checkboxfield',
                                            colspan: 3,
                                            itemId: 'chkApproved',
                                            fieldLabel: 'Approved(Y/N)',
                                            labelWidth: 120
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtInterestAmount',
                                            fieldLabel: 'Interest Amount',
                                            labelWidth: 120
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPrincipleAmount',
                                            margin: '0 0 0 50',
                                            fieldLabel: 'Principle Amount',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        },
                                        {
                                            xtype: 'textfield',
                                            itemId: 'txtPenaltyAmount',
                                            margin: '0 0 0 50',
                                            fieldLabel: 'Penalty Amount'
                                        },
                                        {
                                            xtype: 'textfield',
                                            colspan: 2,
                                            itemId: 'txtTotalAmount',
                                            margin: '0 0 0 300',
                                            fieldLabel: 'Total Amount',
                                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            colspan: 3,
                            height: 31,
                            margin: '10 0 0 0',
                            layout: {
                                type: 'hbox',
                                align: 'stretch',
                                pack: 'center'
                            },
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnAdjustInterestPrincipal',
                                    text: 'Adjust Interest/Principal',
                                    listeners: {
                                        click: {
                                            fn: me.onBtnAdjustInterestPrincipalClick,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnLoanNo',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnRepaymentNo',
                            fieldLabel: 'Label'
                        }
                    ],
                    listeners: {
                        afterrender: {
                            fn: me.onFrmMFMERepaymentAdjustAfterRender,
                            scope: me
                        }
                    }
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtLoanNoAfterRender: function(component, eOpts) {
        component.getEl().on('dblclick', function(){
             var winPopup = Ext.create('MyApp.view.SelectLoanNoPopup',{

                });

                winPopup.extraParam={param:null};
                winPopup.show();
          });

    },

    onTxtLoanNoChange: function(field, newValue, oldValue, eOpts) {
        Ext.Ajax.request({
                    url: '../Handlers/Finance/Transaction/EditTransaction/CalLoanBalanceStatusHandler.ashx',
                    params: {
                        method:'GetCalLoanBalanceStatus',
                        OfficeCode:getOfficeCode(),
                        LoanNo:Ext.ComponentQuery.query('#txtLoanNo')[0].getValue(),
                        RepayDate:Ext.ComponentQuery.query('#txtRepaymentDate')[0].getValue()
                    },
                    success: function ( response, request ) {

                                    var out=Ext.decode(response.responseText);

        							var rec=out.root[0];
                                    if(out.success==="true")
                                        {
                                            Ext.ComponentQuery.query('#txtCurrentPrinciple')[0].setValue(rec.CurrPr_Amount);
                                            Ext.ComponentQuery.query('#txtPastPrinciple')[0].setValue(rec.PastPr_Amount);
                                            Ext.ComponentQuery.query('#txtPenaltyBalance')[0].setValue(rec.PenaltyBalance);
                                            Ext.ComponentQuery.query('#txtPrincipleBalance')[0].setValue(rec.PrcipalBalance);
                                            Ext.ComponentQuery.query('#txtInterestBalance')[0].setValue(rec.TerestBalance);
                                            Ext.ComponentQuery.query('#txtTotalBalance')[0].setValue(rec.TotalBalance);
                                            Ext.ComponentQuery.query('#txtInstallmentAmount')[0].setValue(rec.TotalStallment_Amount);
                                            Ext.ComponentQuery.query('#txtCurrentInterest')[0].setValue(rec.CurrT_Amount);
                                            Ext.ComponentQuery.query('#txtPastInterest')[0].setValue(rec.PastT_Amount);
                                            Ext.ComponentQuery.query('#txtPenaltyOnInterest')[0].setValue(rec.PenaltyAmount);

        								}
                                    else
                                    {
                                        msg("FAILURE",out.message);
                                    }

                    },
                                    failure: function ( result, request )
                                    {

                                        var out=Ext.decode(response.responseText);
                                        msg("FAILURE",out.message);
                                    }

        });
    },

    onTxtLoanRepaymentAfterRender: function(component, eOpts) {
        component.getEl().on('dblclick', function(){
             var winPopup = Ext.create('MyApp.view.SelectCollectionSheetNo',{

                });

                winPopup.extraParam={param:null};
                winPopup.show();
          });

    },

    onBtnAdjustInterestPrincipalClick: function(button, e, eOpts) {
        var myForm=Ext.ComponentQuery.query('#frmMFMERepaymentAdjust')[0];

        var saveObj={
        	LoanNo:Ext.ComponentQuery.query('#hdnLoanNo')[0].getValue(),
        	RepaymentY_N:Ext.ComponentQuery.query('#chkAdjustPastRepayment')[0].getValue()?'Y':'N',
        	RepaymentNo:Ext.ComponentQuery.query('#txtLoanRepayment')[0].getValue(),
        	PaymentDate:myForm.PaymentDateAD,
        	CollectionSheet_No:Ext.ComponentQuery.query('#txtCollectionSheetNo')[0].getValue(),
        	InterestAmt:Ext.ComponentQuery.query('#txtInterestBalance')[0].getValue(),
        	PrincipalAmt:Ext.ComponentQuery.query('#txtPrincipleBalance')[0].getValue(),
        	PenaltyAmt:Ext.ComponentQuery.query('#txtPenaltyBalance')[0].getValue(),
        	NewInt_Amt:Ext.ComponentQuery.query('#txtInterestAmount')[0].getValue(),
        	NewPri_Amt:Ext.ComponentQuery.query('#txtPrincipleAmount')[0].getValue(),
        	NewPen_Amt:Ext.ComponentQuery.query('#txtPenaltyAmount')[0].getValue(),
        	CreatedBy:getCurrentUser(),
        };

        var waitSave = watiMsg("Adjusting Interest/Principal..Please wait ...");
                Ext.Ajax.request({
                    url: '../Handlers/Finance/Transaction/LoanTransaction/AdjustLoanIntPriPenNewHandler.ashx',
                    params: {
                        method:'Save',
                        adjustLoanIntPriPenNew:JSON.stringify(saveObj)
                    },
                    success: function ( response, request ) {
                                 waitSave.hide();
                                    var out=Ext.decode(response.responseText);
                                    console.log(out);

                                    if(out.success==="true")
                                        {
                                           msg("SUCCESS",out.message);

        								}
                                        else
                                            {
                                                msg("FAILURE",out.message);
                                            }
                                    },
                                    failure: function ( result, request ) {
                                        waitSave.hide();
                                        var out=Ext.decode(response.responseText);
                                        msg("FAILURE",out.message);
                                    }

                });
    },

    onFrmMFMERepaymentAdjustAfterRender: function(component, eOpts) {
        Ext.ComponentQuery.query('#txtFromDateBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtFromDateAD')[0].setValue(getMisDateAD());
    }

});