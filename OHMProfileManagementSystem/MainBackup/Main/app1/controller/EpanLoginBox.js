/*
 * File: app/controller/EpanLoginBox.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.EpanLoginBox', {
    extend: 'Ext.app.Controller',

    onBtnEPanloginClick: function(button, e, options) {
        var submissionNo = Ext.ComponentQuery.query("#txtEpansubmission")[0].value;
        var username     = Ext.ComponentQuery.query("#txtEpanUsername")[0].value;
        var password     = Ext.ComponentQuery.query("#txtEpanpassword")[0].value;


        Ext.Ajax.request({
            url: '../Handlers/Vat/VatReturnsSubmissionNumberHandler.ashx',
            waitMsg: 'Validating User...',
            params:{method:'ValidateUser',submissionNo:submissionNo,username:username,password:password},
            success: function(response) {
                var responseTxt = Ext.decode(response.responseText);
                if(responseTxt.total=='1')
                {
                    var uiConfig = {menuLink:'PersonRegistration',pageTitle:'E-Person Registration'};

                    DynamicUI(uiConfig,function(){
                        Ext.ComponentQuery.query('#hdnSubmissionNo')[0].setValue(submissionNo);
                    });
                }
                else
                {
                    msg('Login Failed','Login Failed,Please Try Again.');
                }
            },
            failure:function(fp, o) {

                msg('ERROR','There are Errors on the Pages');
            }
        });


    },

    init: function(application) {
        this.control({
            "#btnEPanlogin": {
                click: this.onBtnEPanloginClick
            }
        });
    }

});
