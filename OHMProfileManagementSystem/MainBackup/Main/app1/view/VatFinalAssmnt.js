/*
 * File: app/view/VatFinalAssmnt.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.VatFinalAssmnt', {
    extend: 'Ext.panel.Panel',

    frame: true,
    itemId: 'VatFinalAssmnt',
    width: 800,
    autoScroll: true,
    title: 'अन्तिम कर निर्धारण आदेश',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    height: 955,
                    itemId: 'frmVatFinalAssmnt',
                    margin: 5,
                    maxHeight: 960,
                    autoScroll: true,
                    layout: {
                        align: 'stretch',
                        type: 'vbox'
                    },
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'label',
                            flex: 1,
                            margin: '0 0 0 160',
                            maxHeight: 50,
                            style: 'font-size:20px',
                            text: 'अन्तिम कर निर्धारण आदेश'
                        },
                        {
                            xtype: 'displayfield',
                            flex: 1,
                            height: 30,
                            itemId: 'lblActionVfa',
                            maxHeight: 30,
                            fieldLabel: '',
                            fieldStyle: '{color:red;}'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtOfficeCodeVfa',
                            maxWidth: 200,
                            width: 200,
                            fieldLabel: 'कार्यलय कोड',
                            labelWidth: 160,
                            readOnly: true
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            height: 30,
                            itemId: 'cntMaNoVfa',
                            maxHeight: 30,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtMaNoVfa',
                                    maxWidth: 250,
                                    width: 250,
                                    fieldLabel: 'कर निर्धारण आदेश नं.',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    emptyText: 'Enter Ma No.',
                                    enableKeyEvents: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 10,
                                    minLength: 10
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblMaNoVfa',
                                    margin: '-10 0 0 5',
                                    fieldLabel: ''
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntPanVfa',
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtPanVfa',
                                    maxWidth: 250,
                                    width: 250,
                                    fieldLabel: 'करदाता दर्ता नम्बर',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    blankText: 'Please Enter PAN No.',
                                    emptyText: 'Enter Pan No.',
                                    enableKeyEvents: true,
                                    enforceMaxLength: true,
                                    maskRe: /[0-9]/,
                                    maxLength: 9,
                                    minLength: 9,
                                    listeners: {
                                        blur: {
                                            fn: me.onTxtPanVfaBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtAcctTypeVfa',
                                    margin: '0 0 0 115',
                                    maxWidth: 200,
                                    width: 150,
                                    fieldLabel: 'खाताको किसिम',
                                    enforceMaxLength: true,
                                    maxLength: 2,
                                    minLength: 2
                                }
                            ]
                        },
                        {
                            xtype: 'textfield',
                            flex: 1,
                            itemId: 'txtNameVfa',
                            maxHeight: 25,
                            maxWidth: 620,
                            fieldLabel: 'नाम',
                            labelWidth: 160,
                            readOnly: true
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntAddressPhoneVfa',
                            maxHeight: 28,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtAddressVfa',
                                    fieldLabel: 'ठेगाना',
                                    labelWidth: 160,
                                    readOnly: true
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtPhoneVfa',
                                    margin: '0 0 0 50',
                                    fieldLabel: 'फोन नं.',
                                    readOnly: true
                                }
                            ]
                        },
                        {
                            xtype: 'textfield',
                            flex: 1,
                            itemId: 'txtAssessPeriodVfa',
                            maxHeight: 24,
                            maxWidth: 315,
                            fieldLabel: 'कर निर्धारण भएको अवधि',
                            labelWidth: 160,
                            msgTarget: 'side',
                            allowBlank: false
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntSectionRuleVfa',
                            maxHeight: 28,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtSectionVfa',
                                    fieldLabel: 'कर निर्धारण गर्ने ऐनको दफा',
                                    labelSeparator: ' ',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    allowBlank: false
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtRuleVfa',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'तथा नियमावलीको नियम',
                                    labelSeparator: ' ',
                                    labelWidth: 130,
                                    msgTarget: 'side',
                                    allowBlank: false
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntBankVfa',
                            maxHeight: 28,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtBankVfa',
                                    fieldLabel: 'बैक',
                                    labelSeparator: ' ',
                                    labelWidth: 160,
                                    msgTarget: 'side',
                                    enableKeyEvents: true,
                                    listeners: {
                                        keyup: {
                                            fn: me.onTxtBankVfaKeyup,
                                            scope: me
                                        },
                                        focus: {
                                            fn: me.onTxtBankVfaFocus,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtBankVfaKeypress,
                                            scope: me
                                        },
                                        change: {
                                            fn: me.onTxtBankVfaChange,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtBranchVfa',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'शाखा',
                                    labelSeparator: ' ',
                                    labelWidth: 130,
                                    msgTarget: 'side',
                                    enableKeyEvents: true,
                                    listeners: {
                                        keyup: {
                                            fn: me.onTxtBranchVfaKeyup,
                                            scope: me
                                        },
                                        focus: {
                                            fn: me.onTxtBranchVfaFocus,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtBranchVfaKeypress,
                                            scope: me
                                        },
                                        change: {
                                            fn: me.onTxtBranchVfaChange,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'combobox',
                            flex: 1,
                            itemId: 'cboMaReasonCodeVfa',
                            maxHeight: 27,
                            maxWidth: 620,
                            fieldLabel: 'कर निर्धारण गर्न पर्ने कारण',
                            labelWidth: 160,
                            msgTarget: 'side',
                            allowBlank: false,
                            emptyText: 'छान्नुहोस् ...',
                            displayField: 'MaReasonNp',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'MaReason',
                            typeAhead: true,
                            valueField: 'MaReasonCode'
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            margins: '0 0 2 215',
                            itemId: 'cntAppealVfa',
                            maxHeight: 98,
                            items: [
                                {
                                    xtype: 'textfield',
                                    disabled: true,
                                    itemId: 'txtAppealNoVfa',
                                    fieldLabel: 'पुनरावेदनको निर्णय अनुसार भएको भए पुनरावेदन नं',
                                    labelWidth: 250,
                                    maskRe: /[0-9]/,
                                    maxLength: 6
                                },
                                {
                                    xtype: 'textareafield',
                                    disabled: true,
                                    itemId: 'txtMaReasonDescVfa',
                                    maxWidth: 405,
                                    width: 405,
                                    fieldLabel: 'अन्य भए विवरण',
                                    enableKeyEvents: true,
                                    listeners: {
                                        keyup: {
                                            fn: me.onTxtMaReasonDescVfaKeyup,
                                            scope: me
                                        },
                                        focus: {
                                            fn: me.onTxtMaReasonDescVfaFocus,
                                            scope: me
                                        },
                                        keypress: {
                                            fn: me.onTxtMaReasonDescVfaKeypress,
                                            scope: me
                                        },
                                        change: {
                                            fn: me.onTxtMaReasonDescVfaChange,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntDatesVfa',
                            margin: '4 0 0 0 ',
                            maxHeight: 30,
                            maxWidth: 590,
                            layout: {
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtIntCalUptoVfa',
                                    margin: '2 0 0 0 ',
                                    maxWidth: 300,
                                    width: 300,
                                    fieldLabel: 'व्याज र जरिवाना गणना गरिएको मिति',
                                    labelWidth: 200,
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    emptyText: 'YYYY.MM.DD',
                                    enforceMaxLength: true,
                                    maskRe: /[0-9.]/,
                                    maxLength: 10,
                                    minLength: 10,
                                    listeners: {
                                        blur: {
                                            fn: me.onTextfieldBlur,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtEffDateVfa',
                                    margin: '0 0 0 70',
                                    maxWidth: 250,
                                    width: 250,
                                    fieldLabel: 'अन्तिम कर निर्धारण मिति',
                                    labelWidth: 150,
                                    msgTarget: 'side',
                                    allowBlank: false,
                                    emptyText: 'YYYY.MM.DD',
                                    enforceMaxLength: true,
                                    maskRe: /[0-9.]/,
                                    maxLength: 10,
                                    minLength: 10,
                                    listeners: {
                                        blur: {
                                            fn: me.onTextfieldBlur1,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'cntGrdTaxDurationVfa',
                            margin: '20 5 5 0',
                            maxWidth: 970,
                            width: 970,
                            layout: {
                                align: 'stretch',
                                type: 'vbox'
                            },
                            items: [
                                {
                                    xtype: 'label',
                                    margin: '0 0 0 160',
                                    style: 'font-size:20px',
                                    text: 'कर अवधि'
                                },
                                {
                                    xtype: 'toolbar',
                                    flex: 1,
                                    height: 30,
                                    itemId: 'tbrAddVfa',
                                    margin: '10 0 0 0',
                                    maxHeight: 30,
                                    maxWidth: 967,
                                    width: 967,
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnAddVfa',
                                            iconCls: 'icon-add',
                                            text: 'Add'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    height: 200,
                                    itemId: 'grdTaxDurationVfa',
                                    margin: '',
                                    maxHeight: 600,
                                    maxWidth: 967,
                                    minHeight: 100,
                                    autoScroll: true,
                                    title: 'कर अवधि',
                                    store: 'TaxDurationVfa',
                                    columns: [
                                        {
                                            xtype: 'rownumberer',
                                            width: 35,
                                            text: 'क्र.सं.'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'FilPeriod',
                                            text: 'मा / चौ / द्वै',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cboFilingPeriodVfa',
                                                name: 'cboFilingPeriod',
                                                emptyText: 'select ...',
                                                displayField: 'FilPeriodDesc',
                                                forceSelection: true,
                                                queryMode: 'local',
                                                store: 'FilingPeriodStore',
                                                valueField: 'FilPeriod'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Period',
                                            text: 'कर अवधि',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cboPeriodVfa',
                                                emptyText: 'Select ...',
                                                displayField: 'PeriodDesc',
                                                queryMode: 'local',
                                                store: 'Period',
                                                valueField: 'Period'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'TaxYear',
                                            text: 'वर्ष',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtTaxYearVfa',
                                                emptyText: 'YYYY',
                                                enforceMaxLength: true,
                                                maskRe: /[0-9]/,
                                                maxLength: 4,
                                                minLength: 4
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            cls: 'TxtRight',
                                            width: 150,
                                            defaultWidth: 120,
                                            align: 'right',
                                            dataIndex: 'MaAmount',
                                            groupable: false,
                                            text: 'कर निर्धारण भएको रकम (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtMaAmountVfa',
                                                labelAlign: 'right',
                                                fieldCls: 'TxtRight',
                                                enableKeyEvents: true,
                                                maskRe: /[0-9]/,
                                                maxLength: 10,
                                                vtype: 'alphanum',
                                                listeners: {
                                                    blur: {
                                                        fn: me.onTxtMaAmountVfaBlur,
                                                        scope: me
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'PenAmount',
                                            text: 'जरिवाना (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtPenAmountVfa',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'AddAmount',
                                            text: 'थप दस्तुर (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtAddAmountVfa',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'IntAmount',
                                            text: 'व्याज (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtIntAmountVfa',
                                                fieldCls: 'TxtRight',
                                                maskRe: /[0-9]/,
                                                maxLength: 10
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            align: 'right',
                                            dataIndex: 'TotAmount',
                                            text: 'जम्मा (रू)',
                                            editor: {
                                                xtype: 'textfield',
                                                itemId: 'txtTotAmountVfa',
                                                fieldCls: 'TxtRight',
                                                readOnly: true
                                            }
                                        },
                                        {
                                            xtype: 'actioncolumn',
                                            width: 80,
                                            align: 'center',
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e) {
                                                        var store = Ext.getStore('TaxDurationVfa');
                                                        var grd =  Ext.ComponentQuery.query('#grdTaxDurationVfa')[0];
                                                        var row = store.getAt(rowIndex).data;

                                                        var finAmount = Ext.ComponentQuery.query('#lblFinTotalVfa')[0];
                                                        var totAmount = (row.TotAmount === "")?0:row.TotAmount;
                                                        var overallTot = "";

                                                        Ext.Msg.confirm('Confirm Action', 'Do you want to Remove ?', function(btn) {
                                                            if(btn == 'yes'){

                                                                overallTot = parseInt(finAmount.getValue())-parseInt(totAmount);        
                                                                finAmount.setValue(overallTot);

                                                                if(row.Action === "E")
                                                                {
                                                                    row.Action = "D";
                                                                    grd.bindStore(store);         
                                                                    store.filter(function(item){
                                                                        return item.get("Action")!= 'D';
                                                                    });
                                                                }
                                                                else
                                                                {
                                                                    store.removeAt(rowIndex);
                                                                }

                                                                return true;
                                                            }
                                                        }, this);
                                                    },
                                                    icon: '../ITS/resources/images/icons/cancel.png'
                                                }
                                            ]
                                        }
                                    ],
                                    plugins: [
                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                            pluginId: 'grdTaxDurationPluginVfa',
                                            listeners: {
                                                edit: {
                                                    fn: me.onGridroweditingpluginEdit,
                                                    scope: me
                                                },
                                                validateedit: {
                                                    fn: me.onGridroweditingpluginValidateedit,
                                                    scope: me
                                                },
                                                canceledit: {
                                                    fn: me.onGridroweditingpluginCanceledit,
                                                    scope: me
                                                },
                                                beforeedit: {
                                                    fn: me.onGridroweditingpluginBeforeEdit,
                                                    scope: me
                                                }
                                            }
                                        })
                                    ]
                                },
                                {
                                    xtype: 'displayfield',
                                    flex: 1,
                                    itemId: 'lblFinTotalVfa',
                                    margin: '0 0 0 360',
                                    fieldLabel: 'कुल जम्मा',
                                    labelPad: 35,
                                    labelSeparator: ':  रू',
                                    value: 0.00
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    itemId: 'hdnActionVfa',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnFilePerVfa',
                                    width: 100,
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    itemId: 'hdnTranNoVfa',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    itemId: 'hdnEffDateVfa',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'container',
                                    flex: 1,
                                    itemId: 'cntButtonsVfa',
                                    margin: '5 0',
                                    maxHeight: 30,
                                    maxWidth: 967,
                                    width: 967,
                                    layout: {
                                        align: 'middle',
                                        pack: 'end',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            flex: 1,
                                            margins: '0 65 0 0',
                                            itemId: 'btnPrintVfa',
                                            padding: 5,
                                            iconCls: 'icon-print',
                                            text: 'Print'
                                        },
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSaveVfa',
                                            margin: '',
                                            padding: 5,
                                            iconCls: 'icon-save',
                                            text: 'Save'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5',
                                            itemId: 'btnEditVfa',
                                            padding: 5,
                                            iconCls: 'icon-edit',
                                            text: 'Edit'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5',
                                            itemId: 'btnDeleteVfa',
                                            padding: 5,
                                            iconCls: 'icon-delete',
                                            text: 'Delete'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5 ',
                                            itemId: 'btnSubmitVfa',
                                            padding: 5,
                                            iconCls: 'icon-ok',
                                            text: 'Submit'
                                        },
                                        {
                                            xtype: 'button',
                                            margins: '0 0 0 5',
                                            itemId: 'btnCancelVfa',
                                            padding: 5,
                                            iconCls: 'icon-cancel',
                                            text: 'Cancel'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtPanVfaBlur: function(component, e, eOpts) {
        var me = this;

        if(field.getValue !== "")
        {
            return ValidatePan(field.getValue(),"00",function(){field.focus();});
        }

        return true;
    },

    onTxtBankVfaKeyup: function(textfield, e, eOpts) {
        if(textfield.getValue().substring(0,9) === "undefined")
        {

            textfield.setValue(textfield.getValue().substring(9,textfield.getValue().length + 8));
        }

        else 
        {
            if((e.keyCode >= 8 &&  e.keyCode <= 27) || (e.keyCode >= 32 &&  e.keyCode <= 46) ||
            e.keyCode === 91 || e.keyCode == 93 || e.keyCode === 144 || e.keyCode === 145 || 
            (e.keyCode >= 112 &&  e.keyCode <= 123)|| e.keyCode === 190 || e.keyCode === 188 || 
            e.keyCode === 61)
            {

                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length));
            }
            else if (e.keyCode >= 96 &&  e.keyCode <= 105)

            {
                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length-1));
            }
        }
    },

    onTxtBankVfaFocus: function(component, e, eOpts) {

        var val =field.value;
        field.setValue(val);
    },

    onTxtBankVfaKeypress: function(textfield, e, eOpts) {
        return charCodeForPCSFont(e, textfield);
    },

    onTxtBankVfaChange: function(field, newValue, oldValue, eOpts) {
        var ch = field.value.substring(field.value.length -1, field.value.length).charCodeAt(0);

        if((ch === "NaN") || (((ch <= 255) && (ch > 32)) && 
        (!((ch === 40) || (ch === 41) || (ch === 44)  || (ch === 46) || (ch === 61)))))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        var ch1 = field.value.substring( field.value.length -2, field.value.length-1).charCodeAt(0);

        //console.log('charcode',ch1,ch);

        if ((ch1 === 46) && (ch === 61))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }
        if ((ch1 === 2404) && (ch === 46))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        if ((ch1 === 2366) && (ch === 93))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
        if ((ch1 === 2366) && (ch === 125))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
    },

    onTxtBranchVfaKeyup: function(textfield, e, eOpts) {
        if(textfield.getValue().substring(0,9) === "undefined")
        {

            textfield.setValue(textfield.getValue().substring(9,textfield.getValue().length + 8));
        }

        else 
        {
            if((e.keyCode >= 8 &&  e.keyCode <= 27) || (e.keyCode >= 32 &&  e.keyCode <= 46) ||
            e.keyCode === 91 || e.keyCode == 93 || e.keyCode === 144 || e.keyCode === 145 || 
            (e.keyCode >= 112 &&  e.keyCode <= 123)|| e.keyCode === 190 || e.keyCode === 188 || 
            e.keyCode === 61)
            {

                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length));
            }
            else if (e.keyCode >= 96 &&  e.keyCode <= 105)

            {
                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length-1));
            }
        }
    },

    onTxtBranchVfaFocus: function(component, e, eOpts) {
        var val =field.value;
        field.setValue(val);
    },

    onTxtBranchVfaKeypress: function(textfield, e, eOpts) {

        return charCodeForPCSFont(e, textfield);
    },

    onTxtBranchVfaChange: function(field, newValue, oldValue, eOpts) {
        var ch = field.value.substring(field.value.length -1, field.value.length).charCodeAt(0);

        if((ch === "NaN") || (((ch <= 255) && (ch > 32)) && 
        (!((ch === 40) || (ch === 41) || (ch === 44)  || (ch === 46) || (ch === 61)))))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        var ch1 = field.value.substring( field.value.length -2, field.value.length-1).charCodeAt(0);

        //console.log('charcode',ch1,ch);

        if ((ch1 === 46) && (ch === 61))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }
        if ((ch1 === 2404) && (ch === 46))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        if ((ch1 === 2366) && (ch === 93))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
        if ((ch1 === 2366) && (ch === 125))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
    },

    onTxtMaReasonDescVfaKeyup: function(textfield, e, eOpts) {
        if(textfield.getValue().substring(0,9) === "undefined")
        {

            textfield.setValue(textfield.getValue().substring(9,textfield.getValue().length + 8));
        }

        else 
        {
            if((e.keyCode >= 8 &&  e.keyCode <= 27) || (e.keyCode >= 32 &&  e.keyCode <= 46) ||
            e.keyCode === 91 || e.keyCode == 93 || e.keyCode === 144 || e.keyCode === 145 || 
            (e.keyCode >= 112 &&  e.keyCode <= 123)|| e.keyCode === 190 || e.keyCode === 188 || 
            e.keyCode === 61)
            {

                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length));
            }
            else if (e.keyCode >= 96 &&  e.keyCode <= 105)

            {
                textfield.setValue(textfield.getValue().substring(0,textfield.getValue().length-1));
            }
        }
    },

    onTxtMaReasonDescVfaFocus: function(component, e, eOpts) {
        var val =field.value;
        field.setValue(val);
    },

    onTxtMaReasonDescVfaKeypress: function(textfield, e, eOpts) {
        return charCodeForPCSFont(e, textfield);
    },

    onTxtMaReasonDescVfaChange: function(field, newValue, oldValue, eOpts) {
        var ch = field.value.substring(field.value.length -1, field.value.length).charCodeAt(0);

        if((ch === "NaN") || (((ch <= 255) && (ch > 32)) && 
        (!((ch === 40) || (ch === 41) || (ch === 44)  || (ch === 46) || (ch === 61)))))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        var ch1 = field.value.substring( field.value.length -2, field.value.length-1).charCodeAt(0);

        //console.log('charcode',ch1,ch);

        if ((ch1 === 46) && (ch === 61))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }
        if ((ch1 === 2404) && (ch === 46))
        {
            field.setValue(field.value.substring(0,field.value.length-1));
        }

        if ((ch1 === 2366) && (ch === 93))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
        if ((ch1 === 2366) && (ch === 125))
        {
            field.setValue(field.value.substring(0,field.value.length-2)+"?");
        }
    },

    onTextfieldBlur: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"N",function(){ field.focus();});
    },

    onTextfieldBlur1: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"Y",function(){ field.focus();});
    },

    onTxtMaAmountVfaBlur: function(component, e, eOpts) {
        var me = this;

        var txtMaAmount = Ext.ComponentQuery.query("#txtMaAmountVfa")[0];
        var txtPenAmount = Ext.ComponentQuery.query("#txtPenAmountVfa")[0];
        var txtIntAmount = Ext.ComponentQuery.query("#txtIntAmountVfa")[0];
        var txtAddAmount = Ext.ComponentQuery.query("#txtAddAmountVfa")[0];


        if(txtMaAmount.getValue() === "")
        {
            return ;

        }


        var txtIntCalUpto = Ext.ComponentQuery.query('#txtIntCalUptoVfa')[0];
        var txtEffDate = Ext.ComponentQuery.query('#txtEffDateVfa')[0];

        var offCode = Ext.ComponentQuery.query('#txtOfficeCodeVfa')[0].getValue();
        var pan = Ext.ComponentQuery.query('#txtPanVfa')[0].getValue();
        var accTypeVfa = Ext.ComponentQuery.query('#txtAcctTypeVfa')[0].getValue();
        var intCalUpto = Ext.ComponentQuery.query('#txtIntCalUptoVfa')[0].getValue();
        var effDate = Ext.ComponentQuery.query('#txtEffDateVfa')[0].getValue();

        var filePer = Ext.ComponentQuery.query("#cboFilingPeriodVfa")[0].getValue();
        var taxyear = Ext.ComponentQuery.query("#txtTaxYearVfa")[0].getValue();
        var period = Ext.ComponentQuery.query("#cboPeriodVfa")[0].getValue();

        var maAmount = txtMaAmount.getValue();



        if(intCalUpto === "" )
        {
            txtMaAmount.setValue("");
            msg("WARNING","कृपया 'जरिवाना गणना मिति' राख्नुहोस् !!!",function(){txtIntCalUpto.focus();});
            return;
        }

        if(effDate === "" )
        {
            txtMaAmount.setValue("");
            msg("WARNING","कृपया  'अन्तिम कर मिति' राख्नुहोस् !!!",function(){txtEffDate.focus();});
            return;
        }

        /*

        if(intCalUpto > effDate)
        {
        msg("WARNING"," व्याज र जरिवाना गणना मिति अन्तिम कर मिति भन्दा कम हुनु पर्छ !!!",function(){txtIntCalUpto.focus();});
        return;
        }

        */
        var wait = waitMsg("Loading ...");

        maFinalLines = [{
            TaxYear:taxyear,
            FilPeriod:filePer,
            Period:period,
            MaAmount:maAmount
        }];


        maFinalHead = { 
            Pan :pan,
            AcctType : accTypeVfa,
            EffDate: effDate,
            IntCalUpto : intCalUpto,
            MaFinalLines:maFinalLines !== ""?maFinalLines:null
        };


        //------------------------------------------------------
        // NB: Posting Data to Server
        //------------------------------------------------------

        Ext.Ajax.request({
            url:"../Handlers/VAT/ManagementAssessment/MaFinalHeadsHandler.ashx?method=CalcMaIntPen" ,
            params:{maFinalHead:JSON.stringify(maFinalHead)},
            success: function ( result, request ) {

                wait.hide();

                var obj = Ext.decode(result.responseText);


                if(obj.success === "true")
                {
                    var arr = obj.message.split("/");
                    var intAmount = arr[0].trim();
                    //var penAmount = arr[1].trim();

                    var addAmount = arr[1].trim();

                    txtIntAmount.setValue(intAmount);
                    //txtPenAmount.setValue(penAmount);

                    txtAddAmount.setValue(addAmount);
                }
                else
                {
                    msg("FAILURE",obj.message);

                    return;
                }



            },
            failure: function ( result, request ) {

                wait.hide();

                var obj = Ext.decode(result.responseText);

                msg("FAILURE","Error in Fetching Data!!!" );
                return;
            }

        });

    },

    onGridroweditingpluginEdit: function(editor, e, eOpts) {

        /*
        var txtMaAmount = Ext.ComponentQuery.query('#txtMaAmountVpa')[0];
        var txtPenAmount = Ext.ComponentQuery.query('#txtPenAmountVpa')[0];
        var txtAddAmount = Ext.ComponentQuery.query('#txtAddAmountVpa')[0];
        var txtIntAmount = Ext.ComponentQuery.query('#txtIntAmountVpa')[0];


        //console.log('int',txtIntAmount.getValue());

        */

        editor.newValues.AddAmount = editor.newValues.AddAmount === ""?null:editor.newValues.AddAmount;
        editor.newValues.IntAmount = editor.newValues.IntAmount === ""?null:editor.newValues.IntAmount;
        editor.newValues.MaAmount = editor.newValues.MaAmount === ""?null:editor.newValues.MaAmount;
        editor.newValues.PenAmount = editor.newValues.PenAmount === ""?null:editor.newValues.PenAmount;
        editor.newValues.TaxYear = editor.newValues.TaxYear === ""?null:editor.newValues.TaxYear;

        //console.log('editor',editor);
        //console.log('e',e);
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {

    },

    onGridroweditingpluginCanceledit: function(editor, e, eOpts) {
        var cboFilingPeriod = Ext.ComponentQuery.query("#cboFilingPeriodVfa")[0];
        var fpVal = cboFilingPeriod.getValue();

        if(fpVal === null)
        {
            grid.store.removeAt(grid.rowIdx);
        }

    },

    onGridroweditingpluginBeforeEdit: function(editor, e, eOpts) {
        //var store = editor.grid.getStore();
        //var row = store.getAt(editor.rowIdx).data;

        //row.Action = "C";


    }

});