/*
 * File: app/view/D03Annex11.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.D03Annex11', {
    extend: 'Ext.panel.Panel',

    frame: true,
    height: 800,
    itemId: 'pnlD03Annex11',
    title: 'Annex-11',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmD03Annex1',
                    margin: 5,
                    autoScroll: true,
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'label',
                            height: 30,
                            margin: '0 0 0 320',
                            style: 'font-size:20px',
                            text: 'अनुसूची -११'
                        },
                        {
                            xtype: 'panel',
                            frame: true,
                            height: 500,
                            margin: '10 0 5 0',
                            layout: {
                                columns: 1,
                                type: 'table'
                            },
                            title: 'पछाडि गएर अनुसूची तय गर्न <div id="lnkRedirectTopAnx11" style="cursor:pointer;color:red;display:inline;text-decoration:underline"><span>यहाँ कि्लक</span></div> गर्नुहोस् ।',
                            items: [
                                {
                                    xtype: 'panel',
                                    margin: '0 3 5 0',
                                    width: 1020,
                                    autoScroll: true,
                                    title: 'औषधोपचार कर मिलान दावी ',
                                    items: [
                                        {
                                            xtype: 'toolbar',
                                            height: 30,
                                            margin: 1,
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    itemId: 'btnAddNewAnx11',
                                                    iconCls: 'icon-add',
                                                    text: 'Add New'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'toolbar',
                                            items: [
                                                {
                                                    xtype: 'tbspacer',
                                                    width: 16
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 91,
                                                    text: '१'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 141,
                                                    text: '२'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 141,
                                                    text: '३'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                },
                                                {
                                                    xtype: 'label',
                                                    cls: 'LblCenter',
                                                    width: 91,
                                                    text: '४'
                                                },
                                                {
                                                    xtype: 'tbseparator'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'gridpanel',
                                            height: 150,
                                            itemId: 'grdMedicalClaimAnx11',
                                            margin: '0 0 5 0',
                                            store: 'MedicalCreditClaimAnx11',
                                            columns: [
                                                {
                                                    xtype: 'rownumberer'
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    dataIndex: 'MedicalExpDate',
                                                    text: 'मिति',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtDateAnx11',
                                                        width: 100,
                                                        emptyText: 'YYYY.MM.DD',
                                                        enforceMaxLength: true,
                                                        maskRe: /[0-9.]/,
                                                        maxLength: 10
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 150,
                                                    dataIndex: 'MedicalServiceProvider',
                                                    text: 'स्वास्थ्य सेवा दिनेको नाम ',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtServiceProviderNameAnx11',
                                                        width: 100
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    width: 150,
                                                    dataIndex: 'MedicalServiceType',
                                                    text: 'स्वास्थ्य सेवाको किसिम',
                                                    editor: {
                                                        xtype: 'combobox',
                                                        itemId: 'cboMedicalServiceTypeAnx11',
                                                        emptyText: 'Select ...',
                                                        displayField: 'MedServiceTypName',
                                                        forceSelection: true,
                                                        queryMode: 'local',
                                                        store: 'MedServiceTypAnx11',
                                                        valueField: 'MedServiceTypID'
                                                    }
                                                },
                                                {
                                                    xtype: 'gridcolumn',
                                                    align: 'right',
                                                    dataIndex: 'MedicalExpAmt',
                                                    text: 'औषधोपचार खर्च',
                                                    editor: {
                                                        xtype: 'textfield',
                                                        itemId: 'txtMedicalExpensesAnx11',
                                                        width: 100,
                                                        fieldCls: 'TxtRight',
                                                        maskRe: /[0-9]/,
                                                        maxLength: 10
                                                    }
                                                },
                                                {
                                                    xtype: 'actioncolumn',
                                                    align: 'center',
                                                    items: [
                                                        {
                                                            handler: function(view, rowIndex, colIndex, item, e) {
                                                                var grd = Ext.ComponentQuery.query('#grdMedicalClaimAnx11')[0];
                                                                var store = grd.getStore();
                                                                var row = store.getAt(rowIndex).data;

                                                                var txtTotMedExp = Ext.ComponentQuery.query('#txtTotalMedExpAnx11')[0];
                                                                var medExpAmt = row.MedicalExpAmt === null || row.MedicalExpAmt === "" ? 0:parseFloat(row.MedicalExpAmt);
                                                                var newTotMedExp = 0;

                                                                Ext.Msg.confirm('Confirm Action', 'Do you want to Remove ?', function(btn) {
                                                                    if(btn == 'yes'){

                                                                        newTotMedExp = parseFloat(txtTotMedExp.getValue())-parseFloat(medExpAmt);
                                                                        txtTotMedExp.setValue(newTotMedExp);

                                                                        if(row.Action === "E")
                                                                        {    
                                                                            row.Action = "D";
                                                                            grd.bindStore(store);         
                                                                            store.filter(function(item){
                                                                                return item.get("Action")!= 'D';
                                                                            });
                                                                        }
                                                                        else
                                                                        {
                                                                            store.removeAt(rowIndex);
                                                                        }
                                                                        return true;
                                                                    }
                                                                }, this);
                                                            },
                                                            icon: '../ITS/resources/images/icons/cancel.png',
                                                            iconCls: 'iconMargin'
                                                        }
                                                    ]
                                                }
                                            ],
                                            plugins: [
                                                Ext.create('Ext.grid.plugin.RowEditing', {
                                                    pluginId: 'pluginMedicalClaimAnx11',
                                                    listeners: {
                                                        canceledit: {
                                                            fn: me.onGridroweditingpluginCanceledit,
                                                            scope: me
                                                        },
                                                        validateedit: {
                                                            fn: me.onGridroweditingpluginValidateedit,
                                                            scope: me
                                                        }
                                                    }
                                                })
                                            ]
                                        },
                                        {
                                            xtype: 'toolbar',
                                            margin: '-4 0 0 0 ',
                                            items: [
                                                {
                                                    xtype: 'label',
                                                    margin: '0 0 0 200',
                                                    text: 'जम्मा'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    margins: '0 5 ',
                                                    itemId: 'txtTotalMedExpAnx11',
                                                    width: 90,
                                                    fieldLabel: '',
                                                    fieldCls: 'TxtRight',
                                                    readOnly: true
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    itemId: 'cntBtnAnx11',
                                    width: 1020,
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSubmitAnx11',
                                            padding: 5,
                                            iconCls: 'icon-ok',
                                            text: 'Save Annex 11'
                                        },
                                        {
                                            xtype: 'toolbar',
                                            margin: '5 0 5 0',
                                            items: [
                                                {
                                                    xtype: 'label',
                                                    height: 15,
                                                    html: 'पछाडि गएर अनुसूची तय गर्न',
                                                    text: ''
                                                },
                                                {
                                                    xtype: 'label',
                                                    html: '<a href="#" style="color:red"> यहाँ कि्लक  </a>',
                                                    itemId: 'lblRedirectAnx11',
                                                    text: 'My Label',
                                                    listeners: {
                                                        render: {
                                                            fn: me.onLblRedirectAnx1Render,
                                                            scope: me
                                                        }
                                                    }
                                                },
                                                {
                                                    xtype: 'label',
                                                    html: ' गर्नुहोस् । ',
                                                    text: 'My Label'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onGridroweditingpluginCanceledit: function(editor, e, eOpts) {
        var grid = editor.grid;
        var date = Ext.ComponentQuery.query('#txtDateAnx11')[0].getValue();
        var medServiceType = Ext.ComponentQuery.query('#cboMedicalServiceTypeAnx11')[0].getValue();
        var serviceProvName = Ext.ComponentQuery.query('#txtServiceProviderNameAnx11')[0].getValue();
        var medExp = Ext.ComponentQuery.query('#txtMedicalExpensesAnx11')[0].getValue();

        /*
        alert("data" + date);
        alert("medServiceType" + medServiceType);
        alert("serviceProvName" + serviceProvName);
        alert("medExp" + medExp);
        */

        if((date == null || date == "") && (medServiceType == null || medServiceType == "") 
        && (serviceProvName == null || serviceProvName == "") && (medExp == null || medExp == ""))
        {
            grid.store.removeAt(editor.rowIdx);
        }
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {
        //var grid = editor.grid;
        var txtDate = Ext.ComponentQuery.query('#txtDateAnx11')[0];
        var cboMedServiceType = Ext.ComponentQuery.query('#cboMedicalServiceTypeAnx11')[0];
        var txtServiceProvName = Ext.ComponentQuery.query('#txtServiceProviderNameAnx11')[0];
        var txtMedExp = Ext.ComponentQuery.query('#txtMedicalExpensesAnx11')[0];

        var date = txtDate.getValue();
        var medServiceType = cboMedServiceType.getValue();
        var serviceProvName = txtServiceProvName.getValue();
        var medExp = txtMedExp.getValue();

        var objFocus = null;
        var errMsg = "";
        var flag ;

        if(date == null || date == "")
        {
            errMsg += "कृपया मिति राख्नुहोस् !!!<br>";
            objFocus = txtDate;
        }
        else
        {

            flag = validateFutureDate(txtDate.getValue(),"Y",function(){ txtDate.focus();});

            if(!flag)
            {
                return false;
            }
        }


        if(serviceProvName == null || serviceProvName == "")
        {
            errMsg += "कृपया 'स्वास्थ्य सेवा दिनेको नाम' राख्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = txtServiceProvName;
            }
        }

        if(medServiceType == null || medServiceType == "") 
        {
            errMsg += " कृपया 'स्वास्थ्य सेवाको किसिम' छान्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = cboMedServiceType;
            }
        }

        if(medExp == null || medExp === "")
        {
            errMsg += " कृपया 'औषधोपचार खर्च' राख्नुहोस् !!! <br>";

            if(objFocus == null)
            {
                objFocus = txtMedExp;
            }
        }


        if(errMsg !== "")
        {
            msg("WARNING",errMsg,function(){ objFocus.focus();});
            return false;
        }

        return true;
    },

    onLblRedirectAnx1Render: function(component, eOpts) {
        var c = component;

        c.getEl().on('click', function(){ this.fireEvent('click', c); }, c);
    }

});