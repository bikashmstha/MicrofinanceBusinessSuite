/*
 * File: app/controller/ChangeTaxpayerLoginUserPass.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.ChangeTaxpayerLoginUserPass', {
    extend: 'Ext.app.Controller',

    onBtnChangeTaxpayerLoginPasswordClick: function(button, e, eOpts) {


        this.SaveChangeTaxpayerLoginPassword();

    },

    onBtnChangeTaxpayerLoginResetClick: function(button, e, eOpts) {
        this.ClaerControl();
    },

    SaveChangeTaxpayerLoginPassword: function() {
        var me = this;
        var count = 0;
        var errorMsg = "";
        var loadMsg = "";


        var txtChangeTaxpayerLoginPan = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginPan")[0].getValue();
        var txtChangeTaxpayerLoginUserName = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginUserName")[0].getValue();
        var txtChangeTaxpayerLoginOldPassWord = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginOldPassWord")[0].getValue();
        var txtChangeTaxpayerLoginNewPassword = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginNewPassword")[0].getValue();
        var txtChangeTaxpayerLoginConformPassword = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginConformPassword")[0].getValue();
        var hdnChangeTaxpayerAction = Ext.ComponentQuery.query('#hdnChangeTaxpayerAction')[0].getValue();

        var hdnChangeTaxpayerLoginOffice = Ext.ComponentQuery.query('#hdnChangeTaxpayerLoginOffice')[0].getValue();

        if(txtChangeTaxpayerLoginPan === "")
        {

            count++;
            errorMsg = errorMsg + '<br/>'+ count + ") कृपया स्था . ले . नं . भर्नुहोस्!!!";

        }

        if(txtChangeTaxpayerLoginUserName === "")
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया प्रयोगकर्ताको नाम भर्नुहोस्!!!";

        }

        if(txtChangeTaxpayerLoginOldPassWord === "" )
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया पुरानो पासवर्ड भर्नुहोस्!!! ";

        }

        if(txtChangeTaxpayerLoginNewPassword === "" )
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया नयाँ पासवर्ड भर्नुहोस्!!! ";

        }
        if(txtChangeTaxpayerLoginConformPassword === "" )
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया कन्फर्म पासवर्ड भर्नुहोस्!!! ";

        }

        if(txtChangeTaxpayerLoginOldPassWord === txtChangeTaxpayerLoginNewPassword)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया नयाँ पासवर्ड र  पुरानो पासवर्ड एउठै हुनुहुदैन!!! ";

        }




        if(txtChangeTaxpayerLoginNewPassword === txtChangeTaxpayerLoginUserName)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया नयाँ पासवर्ड र प्रयोगकर्ताको नाम एउठै हुनुहुदैन!!! ";

        }


        if(txtChangeTaxpayerLoginNewPassword !== txtChangeTaxpayerLoginConformPassword)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया नयाँ पासवर्ड र कन्फर्म पासवर्ड मिलेन!!! ";

        }

        if(count >0)
        {
            msg("WARNING",errorMsg);
            return false;
        }

        var DCTBTaxPayerLogin = "";

        DCTBTaxPayerLogin = {
            Pan:txtChangeTaxpayerLoginPan,
            LoginName:txtChangeTaxpayerLoginUserName,
            LoginPass:txtChangeTaxpayerLoginNewPassword,
            CreatedBy:'',
            CreatedDate:'',
            EmailID:'',
            PhoneNo:'',
            Status:'A',
            TranDate:'',
            OffCode:hdnChangeTaxpayerLoginOffice !== ""?hdnChangeTaxpayerLoginOffice:null,
            Action:'E'

        };

        var waitSave = watiMsg(loadMsg);



        //var txtChangeTaxpayerLoginPan = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginPan")[0].getValue();
        //var txtChangeTaxpayerLoginUserName = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginUserName")[0].getValue();

        //var txtChangeTaxpayerLoginOldPassWord = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginOldPassWord")[0].getValue();
        //alert(txtChangeTaxpayerLoginOldPassWord);
        Ext.Ajax.request({
            url:"../Handlers/E-SystemServices/Taxpayer/DCTBTaxPayerLoginHandlers.ashx?method=ValidateDCTBTaxPayerLogin" ,
            params:{Pan:txtChangeTaxpayerLoginPan,LoginName:txtChangeTaxpayerLoginUserName,loginPass:txtChangeTaxpayerLoginOldPassWord
            },
            async:false,
            success: function ( result, request ) {

                var obj = Ext.decode(result.responseText);

                if(obj.message !== "")
                {

                    msg(obj.success === "true" ?"WARNING":"FAILURE",obj.message);
                    return;
                }
                else
                {

                    //------------------------------------------------------
                    // NB: Posting Data to Server
                    //------------------------------------------------------


                    Ext.Ajax.request({
                        url:"../Handlers/E-SystemServices/Taxpayer/DCTBTaxPayerLoginHandlers.ashx?method=SaveDCTBTaxPayerLogin",
                        params:{dCTBTaxPayerLogins:JSON.stringify(DCTBTaxPayerLogin)},
                        async:false,
                        success: function ( result, request ) {

                            waitSave.hide();

                            var obj = Ext.decode(result.responseText);
                            var dctbForeignTax=obj.root;
                            msg(obj.success === "true" ?"SUCCESS":"FAILURE",obj.message);
                            me.ClaerControl();

                            uiConfig = {menuLink:'TaxPayerLoginWithPan',pageTitle:'TaxPayerLoginWithPan'};
                              DynamicUI(uiConfig,function(){


                             });




                            if(obj.success === "false") return;



                        },
                        failure: function ( result, request ) {

                            waitSave.hide();

                            var errMsg = "Error in " + loadMsg;

                            msg("FAILURE",errMsg);
                            return;
                        }

                    });



                }


            },
            failure: function ( result, request ) {

                var obj = Ext.decode(result.responseText);

                msg("FAILURE",obj.message);
                return;
            }

        });




        //console.log();




    },

    ClaerControl: function() {
        var txtChangeTaxpayerLoginPan = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginPan")[0];
        var txtChangeTaxpayerLoginUserName = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginUserName")[0];
        var txtChangeTaxpayerLoginOldPassWord = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginOldPassWord")[0];
        var txtChangeTaxpayerLoginNewPassword = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginNewPassword")[0];
        var txtChangeTaxpayerLoginConformPassword = Ext.ComponentQuery.query("#txtChangeTaxpayerLoginConformPassword")[0];



        txtChangeTaxpayerLoginPan.setValue("");
        txtChangeTaxpayerLoginPan.clearInvalid();

        txtChangeTaxpayerLoginUserName.setValue("");
        txtChangeTaxpayerLoginUserName.clearInvalid();

        txtChangeTaxpayerLoginOldPassWord.setValue("");
        txtChangeTaxpayerLoginOldPassWord.clearInvalid();

        txtChangeTaxpayerLoginNewPassword.setValue("");
        txtChangeTaxpayerLoginNewPassword.clearInvalid();

        txtChangeTaxpayerLoginConformPassword.setValue("");
        txtChangeTaxpayerLoginConformPassword.clearInvalid();



    },

    init: function(application) {
        this.control({
            "#btnChangeTaxpayerLoginPassword": {
                click: this.onBtnChangeTaxpayerLoginPasswordClick
            },
            "#btnChangeTaxpayerLoginReset": {
                click: this.onBtnChangeTaxpayerLoginResetClick
            }
        });
    }

});
