/*
 * File: app/controller/TaxPayerVerification.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TaxPayerVerification', {
    extend: 'Ext.app.Controller',

    stores: [
        'strTPVModuls'
    ],

    onTPV_txtSubmissionNoBlur: function(component, e, eOpts) {
        var SubmissionNo = Ext.ComponentQuery.query("#TPV_txtSubmissionNo")[0];
        var ModuleName = Ext.ComponentQuery.query('#TPV_cmbModuls')[0];
        var hdnTran=Ext.ComponentQuery.query('#TPV_hdnTranNo')[0];
        var form=Ext.ComponentQuery.query('#frmTaxPayerVerification')[0].getForm();

        if(!form.isValid() )
        {
            msg("WARNING","Please enter the required fields");
            return;
        }

        Ext.Ajax.request({
            url:"../Handlers/VAT/VatReturnsSubmissionNumberHandler.ashx?method=GetLoginTBs",
            params:{submissionNo:SubmissionNo.getValue()},
            success: function ( result, request ) {            


                var obj = Ext.decode(result.responseText);  

                var data=obj.root;

                var tranNo=data.TranNo;
                console.log("t",tranNo);
                console.log('Mname',ModuleName.getValue());

                var submittedFor=data.submittedFor;
                console.log("s",submittedFor);

                if(ModuleName.getValue() === "VatReturns" && submittedFor === "VRET")
                {
                    console.log('VatReturns',tranNo);
                    hdnTran.setValue(tranNo);

                }
                else if(ModuleName.getValue() === "EstimateReturn" && submittedFor === "INST")
                {
                    console.log("EstimateReturn",tranNo);
                    hdnTran.setValue(tranNo);

                }
                else if(ModuleName.getValue() === "SelfAssessmentD01" && submittedFor === "ASS01")
                {
                    console.log("SelfAssessmentD01",tranNo);
                    hdnTran.setValue(tranNo);

                }
                else if(ModuleName.getValue() === "SelfAssessmentD03" && submittedFor === "ASS03")
                {
                    console.log("SelfAssessmentD03",tranNo);
                    hdnTran.setValue(tranNo);

                }

                else if(data === "")
                {
                    hdnTran.setValue("");
                    msg("WARNING","This Submission No does not exits");
                    return;
                }
                else
                {
                    hdnTran.setValue("");
                    msg("WARNING","This Submission No does not exits for "+ModuleName.getValue());
                    return;
                }

            },
            failure: function ( result, request ) {

                msg("FAILURE","Error in Fetching Data !!!");
            }
        });
        hdnTran.setValue("");
        console.log('findtraniffoundornot',hdnTran.getValue());
    },

    onTPV_btnPreviewClick: function(button, e, eOpts) {
        var moduleName=Ext.ComponentQuery.query('#TPV_cmbModuls')[0].getValue();
        var form=Ext.ComponentQuery.query('#frmTaxPayerVerification')[0].getForm();
        var hdnTran=Ext.ComponentQuery.query('#TPV_hdnTranNo')[0];

        if(!form.isValid() )
        {

            msg("WARNING","Please enter the required fields");
            return;
        }


        if(hdnTran.getValue()!=='')
        {
            dynamicPopUp(moduleName,{tranNo:hdnTran.getValue()}); 


        }

    },

    onTPV_cmbModulsCollapse: function(field, eOpts) {
        Ext.ComponentQuery.query('#TPV_txtSubmissionNo')[0].focus(true);

    },

    init: function(application) {
        /*
        Ext.require('MyApp.controller.SelfAssessmentD01');
        Ext.require('MyApp.controller.VatReturns');
        Ext.require('MyApp.controller.SelfAssessmentD03');
        Ext.require('MyApp.controller.EstimatedReturn');

        */




        this.control({
            "#TPV_txtSubmissionNo": {
                blur: this.onTPV_txtSubmissionNoBlur
            },
            "#TPV_btnPreview": {
                click: this.onTPV_btnPreviewClick
            },
            "#TPV_cmbModuls": {
                collapse: this.onTPV_cmbModulsCollapse
            }
        });
    }

});
