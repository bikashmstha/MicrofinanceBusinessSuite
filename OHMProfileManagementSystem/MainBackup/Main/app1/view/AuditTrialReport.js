/*
 * File: app/view/AuditTrialReport.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.AuditTrialReport', {
    extend: 'Ext.window.Window',

    id: 'AuditTrialReport',
    autoScroll: false,
    frameHeader: false,
    x: -100000,
    y: -100000,

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    itemId: 'frmAuditTrialReport',
                    autoScroll: false,
                    bodyPadding: 10,
                    listeners: {
                        afterrender: {
                            fn: me.onFrmAuditTrialReportAfterRender,
                            scope: me
                        }
                    },
                    items: [
                        {
                            xtype: 'container',
                            height: 100,
                            itemId: 'cntATRHeader',
                            style: 'text-align:center;',
                            layout: {
                                align: 'center',
                                pack: 'center',
                                type: 'vbox'
                            },
                            items: [
                                {
                                    xtype: 'label',
                                    style: 'font-size:19px;',
                                    width: 500,
                                    text: 'Government Of Nepal'
                                },
                                {
                                    xtype: 'label',
                                    style: 'font-size:17px;',
                                    width: 500,
                                    text: 'Inland Revenue Department'
                                },
                                {
                                    xtype: 'label',
                                    style: 'font-size:17px;',
                                    width: 500,
                                    text: 'Lazimpat, Kathmandu'
                                },
                                {
                                    xtype: 'label',
                                    style: 'font-size:20px;',
                                    width: 500,
                                    text: 'Audit Trial (Detailed)'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntATRTaxpayerInfo',
                            layout: {
                                columns: 5,
                                type: 'table'
                            },
                            items: [
                                {
                                    xtype: 'displayfield',
                                    colspan: 5,
                                    itemId: 'lblATRStatus',
                                    fieldLabel: 'Status',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 50
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRPan',
                                    margin: '0 0 0 0',
                                    width: 200,
                                    fieldLabel: 'PAN',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 40
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRAccountType',
                                    margin: '0 0 0 20',
                                    padding: '',
                                    width: 150,
                                    fieldLabel: 'Account Type',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 90
                                },
                                {
                                    xtype: 'displayfield',
                                    colspan: 3,
                                    itemId: 'lblATRTradeName',
                                    margin: '0 0 0 20',
                                    width: 600,
                                    fieldLabel: 'Trade Name',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 80
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRTaxyear',
                                    fieldLabel: 'Tax Year',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 60
                                },
                                {
                                    xtype: 'displayfield',
                                    colspan: 4,
                                    itemId: 'lblAtrIntPenCalcUpto',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'Interest Penalty Calculated Upto',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 220
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRTotalDebit',
                                    fieldLabel: 'Total Debit',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 75
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRAddInterest',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'Add. Int',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 60
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRPenalty',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'Penal',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 45
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRUnusedAmt',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'Unused Amt.',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 90
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRTotal',
                                    margin: '0 0 0 20',
                                    fieldLabel: 'Total',
                                    labelStyle: 'font-weight:bold;',
                                    labelWidth: 50
                                },
                                {
                                    xtype: 'displayfield',
                                    itemId: 'lblATRTotCredit',
                                    fieldLabel: 'Tot Credit',
                                    labelStyle: 'font-weight:bold;'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            border: '15 5 5 5',
                            itemId: 'cntNFText',
                            style: 'borderColor:\'#000000\'; borderStyle:\'solid\'; borderWidth:\'1px\';width: \'40px\';',
                            width: 1050,
                            items: [
                                {
                                    xtype: 'displayfield',
                                    border: 5,
                                    itemId: 'lblNFText',
                                    style: 'border:1px solid #D0D0D0;',
                                    width: 1050
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'gridpanel',
                                    itemId: 'grdAuditTrial',
                                    padding: '0 0 5 0',
                                    width: 1050,
                                    bodyStyle: 'font-size:20px;\r\nfont-weight:bold;',
                                    columnLines: true,
                                    scroll: 'none',
                                    store: 'AuditTrialStore',
                                    viewConfig: {
                                        style: 'font-size:19px;'
                                    },
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                //if(rowIndex>0)

                                                var first = !rowIndex || value !== store.getAt(rowIndex - 1).get('PeriodDesc');
                                                var   last = rowIndex >= store.getCount() - 1 || value !== store.getAt(rowIndex + 1).get('PeriodDesc');

                                                // meta.css += 'row-span' + (first ? ' row-span-first' : '') +  (last ? ' row-span-last' : '');

                                                if (first) 
                                                {
                                                    var i = rowIndex + 1;
                                                    while (i < store.getCount() && value === store.getAt(i).get('PeriodDesc')) 
                                                    {
                                                        i++;
                                                    }

                                                    var rowHeight = 20, padding = 6;
                                                    var height = (rowHeight * (i - rowIndex) - padding) + 'px';
                                                    // meta.attr = 'style="height:' + height + ';line-height:' + height + ';"';
                                                }
                                                return first ? value : '';
                                            },
                                            height: 15,
                                            dataIndex: 'PeriodDesc',
                                            text: 'Period'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'TranDate',
                                            text: 'Date'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'TranType',
                                            text: 'TranType'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Details',
                                            text: 'Details'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            dataIndex: 'Credit',
                                            text: 'Credit'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            align: 'right',
                                            dataIndex: 'Debit',
                                            groupable: true,
                                            text: 'Debit'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            dataIndex: 'Balance',
                                            text: 'Balance'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 200,
                                            dataIndex: 'Remarks',
                                            text: 'Remarks'
                                        }
                                    ],
                                    features: [
                                        {
                                            ftype: 'grouping'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            margin: '10 0 0 0',
                            items: [
                                {
                                    xtype: 'label',
                                    margin: '10 0 0 0 ',
                                    padding: '10 0 0 0',
                                    style: 'font-weight:bold;',
                                    text: 'Payment Details'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            items: [
                                {
                                    xtype: 'gridpanel',
                                    itemId: 'grdATRPaymentDetailReport',
                                    width: 1050,
                                    store: 'PaymentDetailReportStore',
                                    viewConfig: {

                                    },
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Date',
                                            text: 'Date'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'PMTypeCode',
                                            text: 'PMTypeCode'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'BankCode',
                                            text: 'BankCode'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            dataIndex: 'BankAcct',
                                            text: 'BankAcct'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 200,
                                            dataIndex: 'VoucherNo',
                                            text: 'VoucherNo'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 200,
                                            dataIndex: 'Amount',
                                            text: 'Amount'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 200,
                                            dataIndex: 'UnusedPM',
                                            text: 'UnusedPM'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onFrmAuditTrialReportAfterRender: function(abstractcomponent, options) {
        /*var pan=Ext.getCmp('atr').param.pan;
        var acctType=Ext.getCmp('atr').param.acctType;
        var taxyear=Ext.getCmp('atr').param.taxyear;
        var calculateUpto=Ext.getCmp('atr').param.calculateUpto;



        Ext.Ajax.request({
        url: '../Handlers/VAT/Reports/Audit Trial/AuditTrialHandler.ashx',
        params: {
        method:'AuditReport',
        pan: pan,
        acctType:acctType,
        taxyear:taxyear,
        calculatedUpto:calculateUpto
        },
        success: function(response){
        var data=Ext.decode(response.responseText);
        if(data.success=='true')
        {
        var storeAT = Ext.getStore("AuditTrialStore");
        storeAT.loadData([],false);

        var storePDR = Ext.getStore("PaymentDetailReportStore");
        storePDR.loadData([],false);

        var rid=data.message.split('&&')[0];

        var wait = watiMsg('loading ...');

        Ext.Ajax.request({
        url:"../Handlers/VAT/Reports/Audit Trial/AuditTrialHandler.ashx?method=GetAuditTrials" ,
        params:{pan:pan,
        acctType:acctType,
        taxyear:taxyear,reportId:rid},
        success: function ( result, request ) {            

        wait.hide();    
        var obj = Ext.decode(result.responseText);
        storeAT.add(obj.root);

        //var uiConfig = {menuLink:'AuditTrialReport',
        //    pageTitle:'ATR'
        //};




        isValid = ValidatePan(pan);

        if(isValid === false)
        {
            msg('WARNING', 'Please enter valid PAN !!!');

        }

        else
        {
            LoadTaxpayerInfoWithValidPan(pan,function(data){

                var rec = data.root;

                if(rec.AcctStatus==='A')
                Ext.ComponentQuery.query('#lblATRStatus')[0].setValue('ACTIVE');
                Ext.ComponentQuery.query('#lblATRPan')[0].setValue(pan);
                Ext.ComponentQuery.query('#lblATRTradeName')[0].setValue(rec.Name);
                Ext.ComponentQuery.query('#lblATRAccountType')[0].setValue(acctType);
                Ext.ComponentQuery.query('#lblATRTaxyear')[0].setValue(taxyear);
                Ext.ComponentQuery.query('#lblAtrIntPenCalcUpto')[0].setValue(calculateUpto);





                Ext.Ajax.request({
                    url:"../Handlers/VAT/Reports/Audit Trial/PaymentDetailReportHandler.ashx?method=GetPaymentDetailReports" ,
                    params:{pan:pan,
                    acctType:acctType},
                    success: function ( result, request ) {            

                        wait.hide();    
                        var obj = Ext.decode(result.responseText);
                        storePDR.add(obj.root); 

                    },
                    failure:function (result, request)
                    {
                        wait.hide();
                        msg("FAILURE","Error in Fetching Payment Details");
                    }
                });


            });

            Ext.Ajax.request({
                url:"../Handlers/VAT/Reports/Audit Trial/AuditTrialHandler.ashx?method=GetTotalIntPenDrCr" ,
                params:{pan:pan,
                    acctType:acctType,
                taxyear:taxyear,reportId:rid},
                success: function ( result, request ) {            

                    wait.hide();    
                    var obj = Ext.decode(result.responseText);
                    var addInt=obj.message.split('&')[0];
                    var penalty=obj.message.split('&')[1];
                    var totDebit=obj.message.split('&')[2];
                    var totCredit=obj.message.split('&')[3];
                    var unusedAmt=obj.message.split('&')[4];
                    var total=totDebit+addInt+penalty-unusedAmt;

                    Ext.ComponentQuery.query('#lblATRAddInterest')[0].setValue(addInt);
                    Ext.ComponentQuery.query('#lblATRPenalty')[0].setValue(penalty);
                    Ext.ComponentQuery.query('#lblATRTotalDebit')[0].setValue(totDebit);
                    Ext.ComponentQuery.query('#lblATRTotCredit')[0].setValue(totCredit);
                    Ext.ComponentQuery.query('#lblATRUnusedAmt')[0].setValue(unusedAmt);
                    Ext.ComponentQuery.query('#lblATRTotal')[0].setValue(total);



                    var targetElement =  document.getElementById('atr');
                    var myWindow = window.open('', '', '');
                    myWindow.document.write('<html><head>');
                    myWindow.document.write('<title>' + 'Title' + '</title>');
                    myWindow.document.write('<link rel="stylesheet" href="../ITS/extjs/resources/css/ext-all.css">');





                    myWindow.document.write('</head><body>');
                    myWindow.document.write(targetElement.innerHTML);
                    myWindow.document.write('</body></html>');





                    tt.close();



                },
                failure:function (result, request)
                {
                    wait.hide();
                    msg("FAILURE","Error in Fecthing Data");
                }
            });
        }




    },
    failure:  function ( result, request ) {            
        wait.hide();

        msg("FAILURE","Error in Fetching data !!!");
    }
            });

}
else
{

}

}
});


*/
    }

});