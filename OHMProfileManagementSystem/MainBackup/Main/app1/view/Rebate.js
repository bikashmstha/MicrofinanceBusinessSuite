/*
 * File: app/view/Rebate.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.Rebate', {
    extend: 'Ext.panel.Panel',

    frame: true,
    itemId: '',
    width: 840,
    title: 'मिनाहा दिने विवरण फारम',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    frame: true,
                    itemId: 'frmPnlRebateTop',
                    margin: 5,
                    padding: 5,
                    width: 877,
                    autoScroll: true,
                    layout: {
                        type: 'auto'
                    },
                    bodyCls: 'overflow:scrool;',
                    bodyPadding: 10,
                    items: [
                        {
                            xtype: 'displayfield',
                            height: 30,
                            id: 'hdnlblRebateAction',
                            itemId: 'hdnlblRebateAction',
                            margin: '0 0 0 10px',
                            maxHeight: 30,
                            width: 700,
                            fieldLabel: '',
                            fieldStyle: '{color:red;}'
                        },
                        {
                            xtype: 'container',
                            height: 150,
                            id: 'cntRebateTop',
                            itemId: 'cntRebateTop',
                            margin: 5,
                            maxWidth: 830,
                            minWidth: 830,
                            width: 830,
                            items: [
                                {
                                    xtype: 'textfield',
                                    id: 'txtRebateOfficeCode',
                                    itemId: 'txtRebateOfficeCode',
                                    fieldLabel: 'कार्यालय कोड',
                                    labelWidth: 125,
                                    readOnly: true,
                                    size: 4
                                },
                                {
                                    xtype: 'container',
                                    height: 30,
                                    id: 'cntPan',
                                    itemId: 'cntPan',
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'txtRebatePAN',
                                            itemId: 'txtRebatePAN',
                                            width: 230,
                                            fieldLabel: 'स्था . ले . नं . ',
                                            labelWidth: 125,
                                            allowBlank: false,
                                            emptyText: 'स्था . ले . नं . ',
                                            enableKeyEvents: true,
                                            enforceMaxLength: true,
                                            maskRe: /[0-9]/,
                                            maxLength: 9,
                                            minLength: 9,
                                            size: 9
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'txtAccType',
                                            itemId: 'txtAccType',
                                            margin: '0 0 0 2',
                                            fieldLabel: 'खाताको किसिम',
                                            labelWidth: 90,
                                            readOnly: true,
                                            allowBlank: false,
                                            emptyText: '',
                                            enforceMaxLength: true,
                                            maxLength: 2,
                                            minLength: 2,
                                            size: 2
                                        },
                                        {
                                            xtype: 'textfield',
                                            flex: 1,
                                            margins: '0 30',
                                            id: 'txtRebateTradeName',
                                            itemId: 'txtRebateTradeName',
                                            maxWidth: 560,
                                            fieldLabel: 'नाम ',
                                            labelWidth: 80,
                                            readOnly: true,
                                            size: 70
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    height: 30,
                                    id: 'cntDateSeq',
                                    itemId: 'cntDateSeq',
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'txtEffectiveRebateDate',
                                            itemId: 'txtEffectiveRebateDate',
                                            width: 230,
                                            fieldLabel: 'मिनाहा मिति',
                                            labelWidth: 125,
                                            msgTarget: 'side',
                                            allowBlank: false,
                                            emptyText: 'YYYY.MM.DD',
                                            enableKeyEvents: true,
                                            maskRe: /[0-9.]/,
                                            size: 10,
                                            listeners: {
                                                blur: {
                                                    fn: me.onTxtEffectiveRebateDateBlur,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            flex: 1,
                                            disabled: true,
                                            id: 'txtRebateSeq',
                                            itemId: 'txtRebateSeq',
                                            margin: '2 7',
                                            maxWidth: 80,
                                            fieldLabel: 'क्र.स.',
                                            labelWidth: 30,
                                            enableKeyEvents: true,
                                            maskRe: /[0-9]/,
                                            size: 4
                                        }
                                    ]
                                },
                                {
                                    xtype: 'textareafield',
                                    id: 'txtRebateReason',
                                    itemId: 'txtRebateReason',
                                    width: 820,
                                    fieldLabel: 'मिनाहा दिने कारण',
                                    labelWidth: 125,
                                    enforceMaxLength: true,
                                    maxLength: 210
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 300,
                            id: 'cntRebateButton',
                            itemId: 'cntRebateButton',
                            maxWidth: 830,
                            minWidth: 830,
                            width: 830,
                            layout: {
                                align: 'stretch',
                                type: 'vbox'
                            },
                            items: [
                                {
                                    xtype: 'toolbar',
                                    height: 37,
                                    id: 'toolBarrebate',
                                    itemId: 'toolBarrebate',
                                    maxHeight: 37,
                                    width: 830,
                                    items: [
                                        {
                                            xtype: 'button',
                                            id: 'btnRebateAdd',
                                            itemId: 'btnRebateAdd',
                                            iconCls: 'icon-add',
                                            text: 'Add'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    flex: 1,
                                    height: 300,
                                    id: 'grdRebateDetails',
                                    maxHeight: 300,
                                    maxWidth: 830,
                                    minHeight: 300,
                                    minWidth: 830,
                                    width: 830,
                                    autoScroll: true,
                                    title: 'मिनाहा दिने विवरण',
                                    store: 'RebateDetails',
                                    viewConfig: {
                                        height: 400,
                                        maxHeight: 400,
                                        minHeight: 400
                                    },
                                    plugins: [
                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                            pluginId: 'plugingrdRebateDetails',
                                            listeners: {
                                                validateedit: {
                                                    fn: me.onGridroweditingpluginValidateedit,
                                                    scope: me
                                                },
                                                canceledit: {
                                                    fn: me.onGridroweditingpluginCanceledit,
                                                    scope: me
                                                }
                                            }
                                        })
                                    ],
                                    columns: [
                                        {
                                            xtype: 'rownumberer',
                                            width: 50,
                                            text: 'क्र.स.'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 120,
                                            dataIndex: 'TaxYear',
                                            text: 'कर बर्ष',
                                            editor: {
                                                xtype: 'textfield',
                                                height: 25,
                                                itemId: 'txtRebateTaxYear',
                                                inputType: 'number',
                                                enforceMaxLength: true,
                                                maskRe: /[0-9]/,
                                                maxLength: 4,
                                                minLength: 4,
                                                size: 4,
                                                listeners: {
                                                    blur: {
                                                        fn: me.onTxtRebateTaxYearBlur,
                                                        scope: me
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            weight: 150,
                                            dataIndex: 'FilePer',
                                            text: 'मा / चौ / द्वै  ',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cmbRebateFilingPeriod',
                                                emptyText: '---छान्नुहोस्.---',
                                                displayField: 'FilPeriodDesc',
                                                forceSelection: true,
                                                queryMode: 'local',
                                                store: 'FilingPeriodStore',
                                                typeAhead: true,
                                                valueField: 'FilPeriod'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            dataIndex: 'Period',
                                            text: 'कर अवधि',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cmbRebatePeriod',
                                                emptyText: '---छान्नुहोस्.---',
                                                displayField: 'PeriodDesc',
                                                forceSelection: true,
                                                store: 'PeriodStore',
                                                typeAhead: true,
                                                valueField: 'Period'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 150,
                                            dataIndex: 'RebateOn',
                                            text: 'मिनाहा कुन मा',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cmbRebateRebateon',
                                                emptyText: '---छान्नुहोस्.---',
                                                displayField: 'RebateOnName',
                                                forceSelection: true,
                                                queryMode: 'local',
                                                store: 'RebateOn',
                                                typeAhead: true,
                                                valueField: 'RebateOnID'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'PAN',
                                            text: 'PAN'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'AcctType',
                                            text: 'AcctType'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'RebateDate',
                                            text: 'RebateDate'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'SeqNo',
                                            text: 'SeqNo'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'DSeqNo',
                                            text: 'DSeqNo'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'TranNo',
                                            text: 'TrnNo'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'TransDate',
                                            text: 'Trans Date'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 120,
                                            dataIndex: 'Amount',
                                            text: 'छुट रकम',
                                            editor: {
                                                xtype: 'textfield',
                                                height: 25,
                                                itemId: 'txtRebateAmount',
                                                inputType: 'number',
                                                enforceMaxLength: true,
                                                maskRe: /[0-9]/,
                                                maxLength: 14,
                                                size: 14
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'Action',
                                            text: 'Action'
                                        },
                                        {
                                            xtype: 'actioncolumn',
                                            width: 120,
                                            align: 'center',
                                            items: [
                                                {
                                                    handler: function(view, rowIndex, colIndex, item, e) {
                                                        var store = Ext.getStore('RebateDetails');
                                                        var grd = Ext.ComponentQuery.query('#grdRebateDetails')[0];
                                                        var row = store.getAt(rowIndex).data;

                                                        Ext.Msg.confirm('Confirm Action', 'Do you want to Remove ?', function(btn) {
                                                            if(btn == 'yes'){
                                                                if(row.Action === "E")
                                                                {    
                                                                    row.Action = "D";
                                                                    grd.bindStore(store);         
                                                                    store.filter(function(item){
                                                                        return item.get("Action")!= 'D';
                                                                    });
                                                                }
                                                                else
                                                                {

                                                                    store.removeAt(rowIndex);
                                                                }


                                                                return true;
                                                            }
                                                        }, this);  
                                                    },
                                                    icon: '../ITS/resources/images/icons/cancel.png'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    id: 'hdnRebateAction',
                                    itemId: 'hdnRebateAction',
                                    fieldLabel: 'Label'
                                },
                                {
                                    xtype: 'hiddenfield',
                                    flex: 1,
                                    id: 'hdnRebateTranNo',
                                    itemId: 'hdnRebateTranNo',
                                    fieldLabel: 'Label'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 40,
                            id: 'cntButtom',
                            itemId: 'cntButtom',
                            maxWidth: 830,
                            minHeight: 30,
                            padding: 5,
                            width: 830,
                            layout: {
                                pack: 'end',
                                type: 'hbox'
                            },
                            items: [
                                {
                                    xtype: 'button',
                                    id: 'btnRbtSave',
                                    itemId: 'btnRbtSave',
                                    margin: '0 5',
                                    iconCls: 'icon-save',
                                    text: 'Save'
                                },
                                {
                                    xtype: 'button',
                                    id: 'btnRbtEdit',
                                    itemId: 'btnRbtEdit',
                                    iconCls: 'icon-edit',
                                    text: 'Edit'
                                },
                                {
                                    xtype: 'button',
                                    id: 'btnRbtDel',
                                    itemId: 'btnRbtDel',
                                    margin: '0 5 5',
                                    iconCls: 'icon-delete',
                                    text: 'Delete'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnSubmitRbt',
                                    margin: '0 5',
                                    iconCls: 'icon-ok',
                                    text: 'Submit'
                                },
                                {
                                    xtype: 'button',
                                    itemId: 'btnCancelRbt',
                                    margin: '0 1 0 0',
                                    iconCls: 'icon-cancel',
                                    text: 'Cancel'
                                }
                            ]
                        },
                        {
                            xtype: 'hiddenfield',
                            itemId: 'hdnRebateregistrationDate',
                            fieldLabel: 'Label'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTxtEffectiveRebateDateBlur: function(component, e, eOpts) {
        return validateFutureDate(field.getValue(),"Y",function(){field.focus();});
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {
        var count=0;
        var message="";
        var valid=true;
        var me = this;
        var errorMsg = "";

        var btnRebateAdd= Ext.ComponentQuery.query('#btnRebateAdd')[0];


        var cmbRebateFilingPeriod = Ext.ComponentQuery.query('#cmbRebateFilingPeriod')[0].getValue();
        var cmbRebatePeriod = Ext.ComponentQuery.query('#cmbRebatePeriod')[0].getValue();
        var txtRebateTaxYear = Ext.ComponentQuery.query('#txtRebateTaxYear')[0].getValue();
        var cmbRebateRebateon = Ext.ComponentQuery.query('#cmbRebateRebateon')[0].getValue();
        var txtRebateAmount = Ext.ComponentQuery.query('#txtRebateAmount')[0].getValue();
        var pan = Ext.ComponentQuery.query('#txtRebatePAN')[0].getValue();
        var acctType = Ext.ComponentQuery.query('#txtAccType')[0].getValue();
        var hdnRebateregistrationDate =  Ext.ComponentQuery.query('#hdnRebateregistrationDate')[0].getValue();



        if(txtRebateTaxYear === "" || txtRebateTaxYear === null)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया आ.ब. भर्नुहोस् !!! ";
            btnRebateAdd.disable(true);

        }

        if(cmbRebateFilingPeriod === ""  || cmbRebateFilingPeriod === null)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") कृपया मा / चौ / द्वै  छान्नुहोस् !!!";
            btnRebateAdd.disable(true);

        }

        if(cmbRebatePeriod === "" || cmbRebatePeriod === null)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ")  कृपया कर अवधि  छान्नुहोस् !!!";
            btnRebateAdd.disable(true);

        }
        if(cmbRebateRebateon === "" || cmbRebateRebateon === null)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ")  कृपया मिनाहा कुन मा  छान्नुहोस् !!!";
            btnRebateAdd.disable(true);

        }


        if(txtRebateAmount === "" || txtRebateAmount === null)
        {

            count++;
            errorMsg = errorMsg +'<br/>'+ count + ") मिनाहा रकम भर्नुहोस् !!! ";
            btnRebateAdd.disable(true);

        }
        else
        {
            btnRebateAdd.enable(true);
        }


        if(count >0)
        {
            msg("WARNING",errorMsg);
            return false;
        }


        //VALIDATING TAX YEAR
        //Taxyear Should Be Between 2054 and Current Year (2069)

        ValidateTaxyear(txtRebateTaxYear,function(invalidMsg){
            if(invalidMsg!=='')
            {
                msg('INFO',invalidMsg);

                return ;
            }
            //
        });
        //ENDS VALIDATING TAX YEAR


        //VALIDATING FILING PERIOD
        ValidateFilingPeriod(pan,acctType,cmbRebateFilingPeriod,txtRebateTaxYear,cmbRebatePeriod,hdnRebateregistrationDate,function(errMessage){
            if(errMessage!=='')
            {
                msg('INFO',errMessage);
                return ;
            }
        });

    },

    onGridroweditingpluginCanceledit: function(editor, e, eOpts) {
        //grid.store.removeAt(grid.rowIdx);

        var btnRebateAdd= Ext.ComponentQuery.query('#btnRebateAdd')[0];
        btnRebateAdd.enable(true);
    },

    onTxtRebateTaxYearBlur: function(component, e, eOpts) {

        var me=this;
        var taxyear=Ext.ComponentQuery.query("#txtRebateTaxYear")[0].getValue();
        if(taxyear===null)
        {
            return;
        }

        //VALIDATING TAX YEAR
        //Taxyear Should Be Between 2054 and Current Year (2069)
        ValidateTaxyear(taxyear,function(invalidMsg){
            if(invalidMsg!=='')
            {
                msg('INFO',invalidMsg);

                return;
            }
            //
        });
        //ENDS VALIDATING TAX YEAR

    }

});