{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "LastMonthVoucher",
        "stores": [
            "FiscaYearStore",
            "RecVoucParticularStore",
            "DestinationFormatStore",
            "RecVoucherSearchStore",
            "RecVoucherLoadStore"
        ]
    },
    "configAlternates": {
        "designer|userClassName": "string",
        "stores": "typedarray"
    },
    "name": "MyController2",
    "designerId": "bfb5f876-dce5-44e5-aa18-aba1d71646ec",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#frmLastMonthVoucher",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "LastMonthVoucher",
                "fn": "onFrmLastMonthVoucherAfterRender",
                "implHandler": [
                    "Ext.ComponentQuery.query('#txtTransactionDateBS')[0].setValue(getMisDateBS());",
                    "Ext.ComponentQuery.query('#txtTransactionDateAD')[0].setValue(getMisDateAD());",
                    "",
                    "Ext.Ajax.request({",
                    "      url: '../Handlers/Common/FiscalYearHandler.ashx',",
                    "      params: {",
                    "          method:'GetLastFiscalYearList',",
                    "          OfficeCode:getOfficeCode()",
                    "      },",
                    "      success: function(response){",
                    "          var data=Ext.decode(response.responseText);",
                    "          var fiscaYearStore=Ext.getStore('FiscaYearStore');",
                    "          fiscaYearStore.removeAll();",
                    "          fiscaYearStore.add(data.root);",
                    "      }",
                    "  });",
                    "",
                    "var storeRecVoucParticular =Ext.getStore('RecVoucParticularStore');",
                    "getParticularsLov('',function(data){",
                    "    storeRecVoucParticular.removeAll();",
                    "    storeRecVoucParticular.add(data.root);",
                    "});",
                    "",
                    "var destinationFormatStore=Ext.getStore('DestinationFormatStore');",
                    "getReferences('REPORTS_DESFORMAT',function(data){",
                    "    destinationFormatStore.removeAll();",
                    "    destinationFormatStore.add(data.root);",
                    "});",
                    "",
                    "",
                    " Ext.Ajax.request({",
                    "              url: '../Handlers/Finance/AccountTransaction/JvSearchVoucherHandler.ashx',",
                    "              params: {",
                    "                  method:'GetJvSearchVoucher',",
                    "                  OfficeCode:getOfficeCode(),VoucherNo:''",
                    "              },",
                    "              success: function(response){",
                    "                  var data=Ext.decode(response.responseText);",
                    "                  var recVoucherSearchStore=Ext.getStore('RecVoucherSearchStore');",
                    "                  recVoucherSearchStore.removeAll();",
                    "                  recVoucherSearchStore.add(data.root);",
                    "              }",
                    "          });",
                    "",
                    "",
                    "Ext.Ajax.request({",
                    "              url: '../Handlers/Finance/AccountTransaction/VoucherAccountHandler.ashx',",
                    "              params: {",
                    "                  method:'GetVoucherAcc',",
                    "                  OfficeCode:getOfficeCode(),VoucherNo:''",
                    "              },",
                    "              success: function(response){",
                    "                  var data=Ext.decode(response.responseText);",
                    "                  var recVoucherSearchStore=Ext.getStore('RecVoucherSearchStore');",
                    "                  recVoucherSearchStore.removeAll();",
                    "                  recVoucherSearchStore.add(data.root);",
                    "              }",
                    "          });",
                    "",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "configAlternates": {
                "fn": "string",
                "name": "string",
                "scope": "string",
                "designer|controlQuery": "string",
                "designer|params": "typedarray",
                "designer|targetType": "view",
                "implHandler": "code"
            },
            "name": "onFrmLastMonthVoucherAfterRender",
            "designerId": "1b352078-09b1-4da2-9d42-a3f70f367733"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnSave",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "MyButton",
                "fn": "onBtnSaveClick",
                "implHandler": [
                    "//ReceiveVoucherDetails",
                    "var grdRecVouDetails = Ext.ComponentQuery.query('#grdRecVouDetails')[0];",
                    "var storeVoucherDetailsRecStore = Ext.getStore('VoucherDetailsRecStore');",
                    "var selectionT = grdRecVouDetails.getSelectionModel().getSelection()[0];",
                    "var selectedIndxT= grdRecVouDetails.getStore().indexOf(selectionT);",
                    "var utStore1 =grdRecVouDetails.getStore();",
                    "var crAmount=utStore1.getAt(selectedIndxT).data.CrAmount;",
                    "console.log(crAmount);",
                    "",
                    "",
                    "",
                    "",
                    "var grdVoucherLoad = Ext.ComponentQuery.query('#grdVoucherCollection')[0];",
                    "var storeVoucherLoad = Ext.getStore('RecVoucherLoadStore');",
                    "var selectionT = grdVoucherLoad.getSelectionModel().getSelection()[0];",
                    "var selectedIndxT= grdVoucherLoad.getStore().indexOf(selectionT);",
                    "var utStore =grdVoucherLoad.getStore();",
                    "var approvedBy=utStore.getAt(selectedIndxT).data.ApprovedBy;",
                    "",
                    "",
                    "",
                    "",
                    "var p_FiscalYear = Ext.ComponentQuery.query('#txtFiscalYear')[0];",
                    "var p_TransactionDate = Ext.ComponentQuery.query('#txtTransactionDateBS')[0];",
                    "var p_Particulars = Ext.ComponentQuery.query('#ddlParticulars')[0];",
                    "var p_ModifiedFlag = 'N';",
                    "var p_AuditedFlag = 'N';",
                    "var p_AuditedDate = null;",
                    "var p_AuditedBy = null;",
                    "var p_Remarks = Ext.ComponentQuery.query('#txtRemarks')[0];",
                    "var p_ApprovedNo = null;",
                    "var p_ApprovedFlag = 'N';",
                    "var p_PostedYN = 'N';",
                    "var p_ReferenceNo =null;",
                    "var p_CreatedBy = Ext.get('user').dom.innerHTML;",
                    "var p_CreatedOn = Ext.get('date').dom.innerHTML;",
                    "var p_TranOfficeCode = Ext.get('offCode').dom.innerHTML;",
                    "var p_VoucherType ='J';",
                    "var p_CloseFlag = 'N';",
                    "var p_VoucherNoAgainst =null;",
                    "var p_ChequeBillNo = Ext.ComponentQuery.query('#txtChequeBillNo')[0];",
                    "var p_VoucherNoReference =null;",
                    "var p_VoucherSeqNo = '';",
                    "var p_ApprovedDate = null;",
                    "var p_ApprovedDateBs = null;",
                    "var p_ApprovedBy = utStore.getAt(selectedIndxT).data.ApprovedBy===null?null:utStore.getAt(selectedIndxT).data.ApprovedBy;",
                    "var p_TotalDrAmount = Ext.ComponentQuery.query('#TotalDrAmount')[0];",
                    "var p_InsertUpdate = Ext.ComponentQuery.query('#InsertUpdate')[0];",
                    "var p_OutVoucherNo = Ext.ComponentQuery.query('#txtVoucherNo')[0];",
                    "var p_OutHistSeq_No = Ext.ComponentQuery.query('#OutHistSeq_No')[0];",
                    "",
                    "",
                    "",
                    "var glTransactionDetail=",
                    "    {",
                    "        voucherNo:'',",
                    "        TransactionDate:p_TransactionDate.getValue(),",
                    "        TransactionId:TransactionId,",
                    "        TranOfficeCode:TranOfficeCode,",
                    "        AccountCode:AccountCode,",
                    "        Particulars:p_Particulars.getValue(),",
                    "        Amount:utStore.getAt(selectedIndxT).data.Amount===null?null:utStore.getAt(selectedIndxT).data.Amount,",
                    "        DrCrFlag:'',",
                    "        Remarks:p_Remarks.getValue(),",
                    "        CurrencyCode:'',",
                    "        TranType:'',",
                    "        DmlType:''",
                    "    };",
                    "var objglTransactionMaster ={",
                    "                FiscalYear : p_FiscalYear.getValue(),",
                    "                TransactionDate : p_TransactionDate.getValue(),",
                    "                Particulars : p_Particulars.getValue(),",
                    "                ModifiedFlag : p_ModifiedFlag.getValue(),",
                    "                AuditedFlag : p_AuditedFlag.getValue(),",
                    "                AuditedDate : p_AuditedDate.getValue(),",
                    "                AuditedBy : p_AuditedBy.getValue(),",
                    "                Remarks : p_Remarks.getValue(),",
                    "                ApprovedNo : p_ApprovedNo,",
                    "                ApprovedFlag : p_ApprovedFlag,",
                    "                PostedYN : p_PostedYN.getValue(),",
                    "                ReferenceNo : p_ReferenceNo.getValue(),",
                    "                CreatedBy : p_CreatedBy,",
                    "                CreatedOn : p_CreatedOn,",
                    "                TranOfficeCode : p_TranOfficeCode,",
                    "                VoucherType : p_VoucherType.getValue(),",
                    "                CloseFlag : p_CloseFlag.getValue(),",
                    "                VoucherNoAgainst : p_VoucherNoAgainst.getValue(),",
                    "                ChequeBillNo : p_ChequeBillNo.getValue(),",
                    "                VoucherNoReference : p_VoucherNoReference.getValue(),",
                    "                VoucherSeqNo : p_VoucherSeqNo.getValue(),",
                    "                ApprovedDate : p_ApprovedDate,",
                    "                ApprovedDateBs : p_ApprovedDateBs,",
                    "                ApprovedBy : p_ApprovedBy,",
                    "                TotalDrAmount : p_TotalDrAmount.getValue(),",
                    "                InsertUpdate : 'A',",
                    "                OutVoucherNo : p_OutVoucherNo.getValue(),",
                    "                OutHistSeq_No : '',",
                    "                GlTransactionDetail:glTransactionDetail",
                    "};",
                    "",
                    "//start Code for Save",
                    "var waitSave = watiMsg('Please wait ...');",
                    "Ext.Ajax.request({",
                    "     url:'../Handlers/Finance/AccountTransaction/GlTransactionMasterHandler.ashx',",
                    "     params:{method:'SaveGlTransactionMaster',glTransactionMaster:JSON.stringify(objglTransactionMaster)},",
                    "     success: function ( result, request ) {",
                    "waitSave.hide();",
                    "          var obj = Ext.decode(result.responseText);",
                    "          if(obj.success === 'true'){",
                    " msg('SUCCESS',out.message,function(){",
                    "var grd = Ext.ComponentQuery.query('#grdGlTransactionMaster')[0];",
                    "var record = grd.getSelectionModel().getSelection()[0];",
                    "record.set('Action','U');",
                    "});",
                    "}",
                    "          else{msg('FAILURE',out.message);",
                    "",
                    "",
                    "          }",
                    "     },",
                    "     failure: function(form, action) {",
                    "waitSave.hide();",
                    "var out=Ext.decode(response.responseText);",
                    "msg('FAILURE',out.message);     }",
                    "});",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "configAlternates": {
                "fn": "string",
                "name": "string",
                "scope": "string",
                "designer|controlQuery": "string",
                "designer|params": "typedarray",
                "designer|targetType": "view",
                "implHandler": "code"
            },
            "name": "onBtnSaveClick",
            "designerId": "b69d9c8e-b3f4-4e93-b879-280f9437e33e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#btnSearch",
                "designer|params": [
                    "button",
                    "e",
                    "eOpts"
                ],
                "designer|targetType": "MyButton2",
                "fn": "onBtnSearchClick",
                "implHandler": [
                    "var officeCode =Ext.get('offCode').dom.innerHTML;",
                    "var voucherNo = Ext.ComponentQuery.query('#ddlJVoucherNo')[0].getValue();",
                    "var fromDate = '';",
                    "var toDate = '';",
                    "",
                    "",
                    "Ext.Ajax.request",
                    "({",
                    "    url:'../Handlers/Finance/AccountTransaction/JvMasterDetailHandler.ashx?method=GetJvMstDetail',",
                    "                    params:{OfficeCode:officeCode,VoucherNo:voucherNo,FromDate:fromDate,ToDate:toDate},",
                    "                    success: function(result, request) {",
                    "                        var obj = Ext.decode(result.responseText);",
                    "                        console.log('obj',obj.root);",
                    "                        if (obj.success != \"true\")",
                    "                        {",
                    "                            showMessage('ERROR OCURRED !!!',obj.message);",
                    "                        }",
                    "                        else",
                    "                        {",
                    "                            var recVoucherLoadStore =Ext.getStore('RecVoucherLoadStore');",
                    "                            recVoucherLoadStore.removeAll();",
                    "                            recVoucherLoadStore.add(obj.root);",
                    "",
                    "                        }",
                    "                    },",
                    "                    failure: function(result, request) {",
                    "                        var obj = Ext.decode(result.responseText);",
                    "",
                    "                        msg(\"FAILURE\",\"Generated Failed\");",
                    "                        return;",
                    "                    }",
                    "                });"
                ],
                "name": "click",
                "scope": "me"
            },
            "configAlternates": {
                "fn": "string",
                "name": "string",
                "scope": "string",
                "designer|controlQuery": "string",
                "designer|params": "typedarray",
                "designer|targetType": "view",
                "implHandler": "code"
            },
            "name": "onBtnSearchClick",
            "designerId": "57f3a961-eddc-4302-9987-957f699dee59"
        }
    ]
}