/*
 * File: app/view/StaffLoanAdditionalDisbursement.js
 *
 * This file was generated by Sencha Architect version 4.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.StaffLoanAdditionalDisbursement', {
    extend: 'Ext.panel.Panel',

    requires: [
        'Ext.form.Panel',
        'Ext.form.field.ComboBox',
        'Ext.button.Button',
        'Ext.grid.Panel',
        'Ext.grid.View',
        'Ext.selection.RowModel',
        'Ext.grid.column.Action'
    ],

    frame: true,
    title: 'Staff Additional Loan Disbursement',

    layout: {
        type: 'table',
        columns: 4
    },

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    colspan: 4,
                    frame: true,
                    itemId: 'frmStaffLoanAdditionalDisbursement',
                    bodyPadding: 10,
                    layout: {
                        type: 'table',
                        columns: 4
                    },
                    items: [
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtDateBS',
                            fieldLabel: 'Date(B.S.)',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtDateAD',
                            margin: '0 0 0 10',
                            fieldLabel: 'Date (A.D.)',
                            labelWidth: 130,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'combobox',
                            colspan: 4,
                            itemId: 'ddlLoanProduct',
                            fieldLabel: 'Loan Product',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            size: 60,
                            displayField: 'LoanProductName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'LoanProductForStaffLoanDisbursementStore',
                            valueField: 'LoanProductCode'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtLoanNo',
                            fieldLabel: 'Loan No',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            size: 60,
                            listeners: {
                                afterrender: {
                                    fn: me.onTxtLoanNoAfterRender,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtNoOfLoanDisbures',
                            margin: '0 0 0 10',
                            fieldLabel: 'No Of Loan Disbures',
                            labelWidth: 130,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 64
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtMemberName',
                            fieldLabel: 'Member Name',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 60
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtRemainingNoOfInstallment',
                            margin: '0 0 0 10',
                            fieldLabel: 'Remaiming No Of Installment',
                            labelWidth: 165,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;',
                            size: 59
                        },
                        {
                            xtype: 'combobox',
                            colspan: 4,
                            itemId: 'ddlManager',
                            fieldLabel: 'Manager',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            size: 60,
                            displayField: 'EmpName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'EmployeeSearchShortStore',
                            valueField: 'EmpId'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanDateBS',
                            fieldLabel: 'Loan Date(B.S.)',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanDateAD',
                            margin: '0 0 0 10',
                            fieldLabel: 'Loan Date(A.D.)',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtMaturityDateBS',
                            margin: '0 0 0 10',
                            fieldLabel: 'Maturity Date(B.S.)',
                            labelWidth: 130,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtMaturityDateAD',
                            margin: '0 0 0 10',
                            fieldLabel: 'Maturity Date(A.D.)',
                            labelWidth: 120,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtLoanPeriod',
                            fieldLabel: 'Loan Period',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'combobox',
                            itemId: 'ddlPeriodType',
                            margin: '0 0 0 10',
                            fieldLabel: 'Period Type',
                            emptyText: '---Select---',
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'LoanPeriodTypeStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtInstallmentPeriod',
                            margin: '0 0 0 10',
                            fieldLabel: 'Installment Period',
                            labelWidth: 130,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'combobox',
                            itemId: 'ddlInstallmentType',
                            margin: '0 0 0 10',
                            fieldLabel: 'Installment Type',
                            labelWidth: 120,
                            emptyText: '---Select---',
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'InstallmentTypeRefShortStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtPrincipalBalance',
                            fieldLabel: 'Principle Balance',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtInterestBalance',
                            margin: '0 0 0 10',
                            fieldLabel: 'Interest Balance',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtGraceDays',
                            margin: '0 0 0 10',
                            fieldLabel: 'Grace Days',
                            labelWidth: 130,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'combobox',
                            itemId: 'ddlInterestRate',
                            margin: '0 0 0 10',
                            fieldLabel: 'Interest Rate',
                            labelWidth: 120,
                            emptyText: '---Select---',
                            displayField: 'RefDtlName',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'MFInterestRateStore',
                            valueField: 'RefDtlCode'
                        },
                        {
                            xtype: 'container',
                            colspan: 4,
                            margin: '20 0 0 0',
                            layout: 'table'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtApprovedAmount',
                            fieldLabel: 'Approved Amount',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtAdditionalDisbursement',
                            margin: '0 0 0 10',
                            fieldLabel: 'Additional Disburse',
                            labelWidth: 130
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtDeduction1',
                            fieldLabel: 'Deduction 1',
                            labelWidth: 125
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtDeduction2',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 2'
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtDeduction3',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 3',
                            labelWidth: 130
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtDeduction4',
                            margin: '0 0 0 10',
                            fieldLabel: 'Deduction 4',
                            labelWidth: 120
                        },
                        {
                            xtype: 'textfield',
                            itemId: 'txtDeductionAmount',
                            fieldLabel: 'Total Deduction Amt',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 1,
                            itemId: 'txtNetPaidAmount',
                            margin: '0 0 0 10',
                            fieldLabel: 'Net Paid Amount',
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 2,
                            itemId: 'txtNewTotalLoanAmount',
                            margin: '0 0 0 10',
                            fieldLabel: 'New Total Loan Amt',
                            labelWidth: 130,
                            fieldStyle: 'background-color:#D2D2D2;background-image:none;'
                        },
                        {
                            xtype: 'combobox',
                            colspan: 4,
                            itemId: 'ddlContraAccount',
                            fieldLabel: 'Contra Account',
                            labelWidth: 125,
                            fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                            size: 60,
                            displayField: 'AccountDesc',
                            forceSelection: true,
                            queryMode: 'local',
                            store: 'ContraAccountSearchShortStore',
                            valueField: 'AccountCode'
                        },
                        {
                            xtype: 'textfield',
                            colspan: 4,
                            itemId: 'txtChequeNo',
                            fieldLabel: 'Cheque No',
                            labelWidth: 125
                        },
                        {
                            xtype: 'container',
                            colspan: 4,
                            height: 26,
                            layout: {
                                type: 'hbox',
                                align: 'stretch',
                                pack: 'center'
                            },
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnDisburseLoan',
                                    padding: 5,
                                    text: 'Disburse Loan',
                                    listeners: {
                                        click: {
                                            fn: me.onBtnDisburseLoanClick,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'button',
                                    hidden: true,
                                    itemId: 'btnDelete',
                                    text: 'Delete',
                                    listeners: {
                                        click: {
                                            fn: me.onBtnDeleteClick,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            colspan: 4,
                            frame: true,
                            margin: '10 0 0 0',
                            bodyPadding: 10,
                            title: 'Search',
                            layout: {
                                type: 'table',
                                columns: 2
                            },
                            items: [
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDisburseDateFromBS',
                                    fieldLabel: 'Disbures Date From(B.S.)',
                                    labelWidth: 145
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtDisburseDateToBS',
                                    margin: '0 0 0 200',
                                    fieldLabel: 'Disbures Date To(B.S.)',
                                    labelWidth: 145
                                },
                                {
                                    xtype: 'combobox',
                                    itemId: 'ddlSearchLoanNo',
                                    fieldLabel: 'Loan No',
                                    labelWidth: 145,
                                    fieldStyle: 'background-color:#DAEBE1;background-image:none;',
                                    displayField: 'LoanDno',
                                    forceSelection: true,
                                    queryMode: 'local',
                                    store: 'LoanNoShortStore',
                                    valueField: 'LoanNo',
                                    listeners: {
                                        select: {
                                            fn: me.onDdlSearchLoanNoSelect,
                                            scope: me
                                        }
                                    }
                                },
                                {
                                    xtype: 'textfield',
                                    itemId: 'txtSearchMemberName',
                                    margin: '0 0 0 200',
                                    fieldLabel: 'Member Name',
                                    labelWidth: 145,
                                    size: 65
                                },
                                {
                                    xtype: 'container',
                                    colspan: 4,
                                    height: 26,
                                    margin: '10 0 0 0',
                                    layout: {
                                        type: 'hbox',
                                        align: 'stretch',
                                        pack: 'center'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'btnSearch',
                                            padding: 5,
                                            text: 'Search',
                                            listeners: {
                                                click: {
                                                    fn: me.onBtnSearchClick,
                                                    scope: me
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'gridpanel',
                            colspan: 4,
                            itemId: 'grdStaffLoanAdditionalDetail',
                            store: 'StaffLoanAdditionalDetailStore',
                            columns: [
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanDno',
                                    text: 'Loan No'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'ClientName',
                                    text: 'Member Name'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'CenterGroup',
                                    text: 'Center/Group'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanProductName',
                                    text: 'Loan Heading'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanDateBs',
                                    text: 'Loan Date'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanMatureBs',
                                    text: 'Loan Maturity Date'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanAmount',
                                    text: 'Loan Amount'
                                },
                                {
                                    xtype: 'gridcolumn',
                                    dataIndex: 'LoanPeriod',
                                    text: 'Loan Period'
                                },
                                {
                                    xtype: 'actioncolumn',
                                    items: [
                                        {
                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                Ext.ComponentQuery.query('#grdStaffLoanAdditionalDetail')[0].getSelectionModel().select(rowIndex);
                                                //get reference of store
                                                var store = Ext.getStore('StaffLoanAdditionalDetailStore');

                                                //get selected row using rowindex
                                                var row = store.getAt(rowIndex).data;


                                                // set values
                                                console.log('row',row);

                                                Ext.ComponentQuery.query('#txtDateBS')[0].setValue(row.DisburseDateBs);
                                                Ext.ComponentQuery.query('#txtDateAD')[0].setValue(row.DisburseDateAd);
                                                Ext.ComponentQuery.query('#ddlLoanProduct')[0].setValue(row.LoanProductCode);
                                                Ext.ComponentQuery.query('#txtLoanNo')[0].setValue(row.LoanDno);
                                                Ext.ComponentQuery.query('#txtNoOfLoanDisbures')[0].setValue(row.YearNo);
                                                Ext.ComponentQuery.query('#txtMemberName')[0].setValue(row.ClientName);
                                                //Ext.ComponentQuery.query('#txtRemainingNoOfInstallment')[0].setValue(row.DistrictName);
                                                Ext.ComponentQuery.query('#ddlManager')[0].setValue(row.EmployeeId);
                                                Ext.ComponentQuery.query('#txtLoanDateBS')[0].setValue(row.LoanDateBs);
                                                Ext.ComponentQuery.query('#txtLoanDateAD')[0].setValue(row.LoanDateAd);
                                                Ext.ComponentQuery.query('#txtMaturityDateBS')[0].setValue(row.LoanMatureBs);
                                                Ext.ComponentQuery.query('#txtMaturityDateAD')[0].setValue(row.LoanMaturityDate_Ad);
                                                Ext.ComponentQuery.query('#txtLoanPeriod')[0].setValue(row.LoanPeriod);
                                                Ext.ComponentQuery.query('#ddlPeriodType')[0].setValue(row.LoanPeriodType);
                                                Ext.ComponentQuery.query('#txtInstallmentPeriod')[0].setValue(row.InstallmentPeriod);
                                                Ext.ComponentQuery.query('#ddlInstallmentType')[0].setValue(row.InstallmentPeriodType);
                                                //Ext.ComponentQuery.query('#txtPrincipalBalance')[0].setValue(row.LoanPeriod);
                                                //Ext.ComponentQuery.query('#txtInterestBalance')[0].setValue(row.LoanPeriodType);
                                                Ext.ComponentQuery.query('#txtGraceDays')[0].setValue(row.GraceDays);
                                                Ext.ComponentQuery.query('#ddlInterestRate')[0].setValue(row.InterestRate);
                                                Ext.ComponentQuery.query('#txtApprovedAmount')[0].setValue(row.ApprovedLoanAmount);
                                                Ext.ComponentQuery.query('#txtAdditionalDisbursement')[0].setValue(row.LoanAmount);
                                                //Ext.ComponentQuery.query('#txtDeduction1')[0].setValue(row.LoanPurposeCode);
                                                //Ext.ComponentQuery.query('#txtDeduction2')[0].setValue(row.AbbsDepositLimit);
                                                //Ext.ComponentQuery.query('#txtDeduction3')[0].setValue(row.GraceDays);
                                                //Ext.ComponentQuery.query('#txtDeduction4')[0].setValue(row.FixedPrincipalAmount);
                                                //Ext.ComponentQuery.query('#txtDeductionAmount')[0].setValue(row.ApprovedLoanAmount);
                                                //Ext.ComponentQuery.query('#txtNetPaidAmount')[0].setValue(row.NoOfInstallment);
                                                Ext.ComponentQuery.query('#txtNewTotalLoanAmount')[0].setValue(row.InstallmentAmount);
                                                Ext.ComponentQuery.query('#ddlContraAccount')[0].setValue(row.ContraAccount);
                                                Ext.ComponentQuery.query('#txtChequeNo')[0].setValue(row.ChequeNo);



                                                //set buttons visible

                                                //Ext.ComponentQuery.query('#btnDelete')[0].setVisible(true);
                                                //Ext.ComponentQuery.query('#btnDeleteOfficeInfo')[0].setVisible(false);
                                            },
                                            icon: '../ITS/resources/images/icons/Modify.png'
                                        }
                                    ]
                                }
                            ],
                            selModel: Ext.create('Ext.selection.RowModel', {

                            })
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnLoanNo',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction1Code',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction2Code',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction3Code',
                            fieldLabel: 'Label'
                        },
                        {
                            xtype: 'textfield',
                            hidden: true,
                            itemId: 'hdnDeduction4Code',
                            fieldLabel: 'Label'
                        }
                    ]
                }
            ],
            listeners: {
                afterrender: {
                    fn: me.onPanelAfterRender,
                    scope: me
                }
            }
        });

        me.callParent(arguments);
    },

    onTxtLoanNoAfterRender: function(component, eOpts) {
        component.getEl().on('dblclick', function(){
            var winPopup = Ext.create('MyApp.view.SelectStaffLoanAddDisburseLoanNumberPopup',{

            });
            winPopup.extraParam={param:null};
            winPopup.show();
        });
    },

    onBtnDisburseLoanClick: function(button, e, eOpts) {
        var p_ChequeNo = Ext.ComponentQuery.query('#txtChequeNo')[0];
        var p_LoanNo = Ext.ComponentQuery.query('#hdnLoanNo')[0];
        var p_LoanProductCode = Ext.ComponentQuery.query('#ddlLoanProduct')[0];
        var p_DisburseDate = Ext.ComponentQuery.query('#txtDateAD')[0];
        var p_LoanAmount = Ext.ComponentQuery.query('#txtAdditionalDisbursement')[0];
        var p_ContraAccount = Ext.ComponentQuery.query('#ddlContraAccount')[0];
        var p_EmployeeId = Ext.ComponentQuery.query('#ddlManager')[0];
        var p_TranOfficeCode = getOfficeCode();
        var p_Deduction1Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction1Desc = 'Deduction 1';
        var p_DeductionAmount1 = Ext.ComponentQuery.query('#txtDeduction1')[0];
        var p_Deduction2Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction2Desc = 'Deduction 2';
        var p_DeductionAmount2 = Ext.ComponentQuery.query('#txtDeduction2')[0];
        var p_Deduction3Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction3Desc = 'Deduction 3';
        var p_DeductionAmount3 = Ext.ComponentQuery.query('#txtDeduction3')[0];
        var p_Deduction4Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction4Desc = 'Deduction 4';
        var p_DeductionAmount4 = Ext.ComponentQuery.query('#txtDeduction4')[0];
        var p_ChkAdjustSaving = null;
        var p_SavingAccountNo = null;
        var p_User1 = getCurrentUser();
        var p_InsertUpdate = 'I';


        var objstaffAdditionalLoanDisbursement ={
                        ChequeNo : p_ChequeNo.getValue(),
                        LoanNo : p_LoanNo.getValue(),
                        LoanProductCode : p_LoanProductCode.getValue(),
                        DisburseDate : p_DisburseDate.getValue(),
                        LoanAmount : p_LoanAmount.getValue(),
                        ContraAccount : p_ContraAccount.getValue(),
                        EmployeeId : p_EmployeeId.getValue(),
                        TranOfficeCode : p_TranOfficeCode,
                        Deduction1Code : p_Deduction1Code.getValue(),
                        Deduction1Desc : p_Deduction1Desc,
                        DeductionAmount1 : p_DeductionAmount1.getValue(),
                        Deduction2Code : p_Deduction2Code.getValue(),
                        Deduction2Desc : p_Deduction2Desc,
                        DeductionAmount2 : p_DeductionAmount2.getValue(),
                        Deduction3Code : p_Deduction3Code.getValue(),
                        Deduction3Desc : p_Deduction3Desc,
                        DeductionAmount3 : p_DeductionAmount3.getValue(),
                        Deduction4Code : p_Deduction4Code.getValue(),
                        Deduction4Desc : p_Deduction4Desc,
                        DeductionAmount4 : p_DeductionAmount4.getValue(),
                        ChkAdjustSaving : p_ChkAdjustSaving,
                        SavingAccountNo : p_SavingAccountNo,
                        User1 : p_User1,
                        InsertUpdate : p_InsertUpdate,

        };



        //start Code for Save
        var waitSave = watiMsg('Please wait ...');
        Ext.Ajax.request({
            url:'../Handlers/Finance/Transaction/StaffLoanTransaction/StaffAdditionalLoanDisbursementHandler.ashx',
            params:{
                method:'SaveStaffAdditionalLoanDisbursement',
                staffAdditionalLoanDisbursement:JSON.stringify(objstaffAdditionalLoanDisbursement)
            },
            success: function ( result, request ) {
                waitSave.hide();
                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    msg('SUCCESS',out.message,function(){
                        var grd = Ext.ComponentQuery.query('#grdStaffAdditionalLoanDisbursement')[0];
                        var record = grd.getSelectionModel().getSelection()[0];
                        record.set('Action','U');
                    });
                }
                else{msg('FAILURE',out.message);


                    }
            },
            failure: function(form, action) {
                waitSave.hide();
                var out=Ext.decode(response.responseText);
                msg('FAILURE',out.message);     }
        });
        //end Code for Save
    },

    onBtnDeleteClick: function(button, e, eOpts) {
        var p_ChequeNo = Ext.ComponentQuery.query('#txtChequeNo')[0];
        var p_LoanNo = Ext.ComponentQuery.query('#hdnLoanNo')[0];
        var p_LoanProductCode = Ext.ComponentQuery.query('#ddlLoanProduct')[0];
        var p_DisburseDate = Ext.ComponentQuery.query('#txtDateAD')[0];
        var p_LoanAmount = Ext.ComponentQuery.query('#txtAdditionalDisbursement')[0];
        var p_ContraAccount = Ext.ComponentQuery.query('#ddlContraAccount')[0];
        var p_EmployeeId = Ext.ComponentQuery.query('#ddlManager')[0];
        var p_TranOfficeCode = getOfficeCode();
        var p_Deduction1Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction1Desc = 'Deduction 1';
        var p_DeductionAmount1 = Ext.ComponentQuery.query('#txtDeduction1')[0];
        var p_Deduction2Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction2Desc = 'Deduction 2';
        var p_DeductionAmount2 = Ext.ComponentQuery.query('#txtDeduction2')[0];
        var p_Deduction3Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction3Desc = 'Deduction 3';
        var p_DeductionAmount3 = Ext.ComponentQuery.query('#txtDeduction3')[0];
        var p_Deduction4Code = Ext.ComponentQuery.query('#hdnDeduction4Code')[0];
        var p_Deduction4Desc = 'Deduction 4';
        var p_DeductionAmount4 = Ext.ComponentQuery.query('#txtDeduction4')[0];
        var p_ChkAdjustSaving = null;
        var p_SavingAccountNo = null;
        var p_User1 = getCurrentUser();
        var p_InsertUpdate = 'D';


        var objstaffAdditionalLoanDisbursement ={
                        ChequeNo : p_ChequeNo.getValue(),
                        LoanNo : p_LoanNo.getValue(),
                        LoanProductCode : p_LoanProductCode.getValue(),
                        DisburseDate : p_DisburseDate.getValue(),
                        LoanAmount : p_LoanAmount.getValue(),
                        ContraAccount : p_ContraAccount.getValue(),
                        EmployeeId : p_EmployeeId.getValue(),
                        TranOfficeCode : p_TranOfficeCode,
                        Deduction1Code : p_Deduction1Code.getValue(),
                        Deduction1Desc : p_Deduction1Desc,
                        DeductionAmount1 : p_DeductionAmount1.getValue(),
                        Deduction2Code : p_Deduction2Code.getValue(),
                        Deduction2Desc : p_Deduction2Desc,
                        DeductionAmount2 : p_DeductionAmount2.getValue(),
                        Deduction3Code : p_Deduction3Code.getValue(),
                        Deduction3Desc : p_Deduction3Desc,
                        DeductionAmount3 : p_DeductionAmount3.getValue(),
                        Deduction4Code : p_Deduction4Code.getValue(),
                        Deduction4Desc : p_Deduction4Desc,
                        DeductionAmount4 : p_DeductionAmount4.getValue(),
                        ChkAdjustSaving : p_ChkAdjustSaving,
                        SavingAccountNo : p_SavingAccountNo,
                        User1 : p_User1,
                        InsertUpdate : p_InsertUpdate,

        };



        //start Code for Save
        var waitSave = watiMsg('Please wait ...');
        Ext.Ajax.request({
            url:'../Handlers/Finance/Transaction/StaffLoanTransaction/StaffAdditionalLoanDisbursementHandler.ashx',
            params:{
                method:'SaveStaffAdditionalLoanDisbursement',
                staffAdditionalLoanDisbursement:JSON.stringify(objstaffAdditionalLoanDisbursement)
            },
            success: function ( result, request ) {
                waitSave.hide();
                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    msg('SUCCESS',out.message,function(){
                        var grd = Ext.ComponentQuery.query('#grdStaffAdditionalLoanDisbursement')[0];
                        var record = grd.getSelectionModel().getSelection()[0];
                        record.set('Action','U');
                    });
                }
                else{msg('FAILURE',out.message);


                    }
            },
            failure: function(form, action) {
                waitSave.hide();
                var out=Ext.decode(response.responseText);
                msg('FAILURE',out.message);     }
        });
        //end Code for Save
    },

    onDdlSearchLoanNoSelect: function(combo, records, eOpts) {
        Ext.ComponentQuery.query('#txtSearchMemberName')[0].setValue(records[0].data.ClientName);
    },

    onBtnSearchClick: function(button, e, eOpts) {
        var waitSave = watiMsg('Please wait ...');
        Ext.Ajax.request({
            url:'../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanAdjustmentDetailHandler.ashx',
            params:{
                method:'GetStaffLoanAdjDetail',
                OfficeCode:getOfficeCode(),
                LoanNo:Ext.ComponentQuery.query('#ddlSearchLoanNo')[0].getValue(),
                ClientName:Ext.ComponentQuery.query('#ddlSearchLoanNo')[0].getValue(),
                FromDate:null,
                ToDate:null

            },
            success: function ( result, request ) {
                waitSave.hide();
                var obj = Ext.decode(result.responseText);
                if(obj.success === 'true'){
                    var store =Ext.getStore('StaffLoanAdditionalDetailStore');
                    store.removeAll();
                    store.add(obj.root);
                }
                else{
                    msg('FAILURE','Could Not Load Data');}
            },
            failure: function(form, action) {
                msg("FAILURE","Could Not Load Data");
            }
        });
    },

    onPanelAfterRender: function(component, eOpts) {
        Ext.ComponentQuery.query('#txtDateBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtDisburseDateFromBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtDisburseDateToBS')[0].setValue(getMisDateBS());
        Ext.ComponentQuery.query('#txtDateAD')[0].setValue(getMisDateAD());

        var loanPeriodTypeStore=Ext.getStore('LoanPeriodTypeStore');
        getReferences('LOAN_PERIOD_TYPE',function(data){
            loanPeriodTypeStore.removeAll();
            loanPeriodTypeStore.add(data.root);
        });

        var employeeSearchStore=Ext.getStore('EmployeeSearchShortStore');
        getfieldAssistants(getOfficeCode(),null,function(data){
                employeeSearchStore.removeAll();
                employeeSearchStore.add(data.root);
        });

        var mfInterestRateStore=Ext.getStore('MFInterestRateStore');
        getReferences('MF_INTEREST_RATE',function(data){
            mfInterestRateStore.removeAll();
            mfInterestRateStore.add(data.root);
        });

        var installmentTypeRefShortStore=Ext.getStore('InstallmentTypeRefShortStore');
        getReferences('INSTALLMENT_PERIOD_TYPE',function(data){
            installmentTypeRefShortStore.removeAll();
            installmentTypeRefShortStore.add(data.root);
        });

        var contraAccountStore=Ext.getStore('ContraAccountSearchShortStore');
        getContraAccount(getOfficeCode(),null,function(data){
            contraAccountStore.removeAll();
            contraAccountStore.add(data.root);
            Ext.ComponentQuery.query('#ddlContraAccount')[0].select('100000021000002');
        });



        Ext.Ajax.request({
            url: '../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanDisbursementProductHandler.ashx',
            params: {
                method:'GetStaffLoanDisProd',
                ProductName:null
            },
            success: function(response){


                var obj = Ext.decode(response.responseText);

                if(obj.success === "true")
                {

                    var store=Ext.getStore('LoanProductForStaffLoanDisbursementStore');
                    store.removeAll();
                    store.add(obj.root);

                }
                else
                {

                    msg("FAILURE",obj.message);
                }

            }
        });



        Ext.Ajax.request({
            url: '../Handlers/Finance/Transaction/StaffLoanTransaction/StaffLoanAdditionalScrLoanHandler.ashx',
            params: {
                method:'GetStaffLoanAdjScrLoan',
                OfficeCode:getOfficeCode(),
                EmpName:null
            },
            success: function(response){


                var obj = Ext.decode(response.responseText);

                if(obj.success === "true")
                {

                    var store=Ext.getStore('LoanNoShortStore');
                    store.removeAll();
                    store.add(obj.root);

                }
                else
                {

                    msg("FAILURE",obj.message);
                }

            }
        });
    }

});