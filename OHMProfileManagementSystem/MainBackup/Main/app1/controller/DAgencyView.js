/*
 * File: app/controller/DAgencyView.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.DAgencyView', {
    extend: 'Ext.app.Controller',

    stores: [
        'AgencyList',
        'AgencyType'
    ],
    views: [
        'DAgencyView'
    ],

    onBtnARAgRegClick: function(button, e, options) {
        var me = this;

        var window = Ext.create('MyApp.view.WndAgencyView');
        //window.close();
        window.modal = true;
        window.show(undefined,function()
        {
            me.getController('MyApp.controller.AgencyWindow').init();
            me.getController('MyApp.controller.AgencyWindow').action("I","0");
        }
        );

    },

    onGrdAVAgencyListAfterRender: function(abstractcomponent, options) {
        var store = Ext.getStore('AgencyList');
        store.load();
    },

    onGrdAVAgencyListItemClick: function(tablepanel, record, item, index, e, options) {
        console.log("changed");

        var me = this;

        var hdnGrdAgId = Ext.ComponentQuery.query("#hdnGrdAgId")[0].getValue();
        var hdnGrdStatus = Ext.ComponentQuery.query("#hdnGrdStatus")[0].getValue();
        var hdnGrdCrDate = Ext.ComponentQuery.query("#hdnGrdCrDate")[0].getValue();

        if(hdnGrdAgId!=="")
        {
            me.getController('MyApp.controller.AgencyWindow').init();
            me.getController('MyApp.controller.AgencyWindow').action("E",hdnGrdAgId,hdnGrdStatus,hdnGrdCrDate);
        }

    },

    onBtnAVCreateUserLogClick: function(button, e, options) {
        var me = this;

        var hdnUser = Ext.ComponentQuery.query("#hdnGrdAgUser")[0].getValue();
        console.log("agency view user",hdnUser);

        me.getController('MyApp.controller.DpCreateUserLogin').init();
        me.getController('MyApp.controller.DpCreateUserLogin').Show(hdnUser);
    },

    viewAgency: function(user) {
        Ext.getCmp('cntARDisplay').removeAll();

        var DAgency = Ext.create('MyApp.view.DAgencyView');
        var pnlToRender = Ext.getCmp('cntARDisplay');

        pnlToRender.add(DAgency);

        var hdnUser = Ext.ComponentQuery.query("#hdnGrdAgUser")[0];
        hdnUser.setValue(user);
    },

    init: function(application) {
        this.control({
            "#btnARAgReg": {
                click: this.onBtnARAgRegClick
            },
            "#grdAVAgencyList": {
                afterrender: this.onGrdAVAgencyListAfterRender,
                itemclick: this.onGrdAVAgencyListItemClick
            },
            "#btnAVCreateUserLog": {
                click: this.onBtnAVCreateUserLogClick
            }
        });
    }

});
