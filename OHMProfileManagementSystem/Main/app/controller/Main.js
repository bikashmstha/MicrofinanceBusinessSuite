/*
 * File: app/controller/Main.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.Main', {
    extend: 'Ext.app.Controller',

    stores: [
        'LoginUser'
    ],

    showMainView: function() {
        /*
        Ext.application({
        name:'MyApp',
        controllers:["MenuController"],	
        launch:function(){
        var pnlDynamic = Ext.create('MyApp.view.MenuController',{
        autoScroll: true,
        height:1000,
        flex:1
        });

        //pnlDynamic.extraParam = ExtraParam;

        var pnlToRender = Ext.getCmp('cntBody');
        pnlToRender.removeAll();
        pnlToRender.add(pnlDynamic);
    }
    });
    */

    var pnlToRender = Ext.getCmp('cntBody'); 
    var pnlDynamic = Ext.create('MyApp.view.MenuController',{
    autoScroll: true,
    height:1000,
    flex:1
    });

    pnlToRender.removeAll();
    pnlToRender.add(pnlDynamic);


    },

    destroyAll: function() {
        var pnlToRender = Ext.getCmp('cntBody'); 
        pnlToRender.removeAll();
    },

    showLoginView: function() {
        /*
        Ext.application({
        name:'MyApp',
        controllers:["LoginSecurity"],	
        launch:function(){
        var pnlDynamic = Ext.create('MyApp.view.LoginSecurity',{
        autoScroll: true,
        height:1000,
        flex:1
        });

        //pnlDynamic.extraParam = ExtraParam;

        var pnlToRender = Ext.getCmp('cntBody');
        pnlToRender.removeAll();
        pnlToRender.add(pnlDynamic);
    }
    });

    */
    var pnlToRender = Ext.getCmp('cntBody');
    var pnlDynamic = Ext.create('MyApp.view.LoginSecurity',{
    autoScroll: true,
    height:1000,
    flex:1
    });


    pnlToRender.removeAll();
    pnlToRender.add(pnlDynamic);

    },

    LoadUserFromSession: function() {
        var me=this;
        Ext.Ajax.request({
            url:"../Handlers/Security/UserHandler.ashx?method=GetUserFromSession",
            success: function ( result, request ) {          
                var obj = Ext.decode(result.responseText);
                /*var el = Ext.get('logOUt');
                var elLoginTitle = Ext.get('LoginTitle');
                var elNepDate=Ext.get('nepDate');
                var elOffCode=Ext.get('offCode');


                 GetNepaliDate(function(nepaliDate){
                    elNepDate.dom.innerHTML=nepaliDate;
                });


                el.child('span').dom.innerHTML = "LogOut";  
                elLoginTitle.dom.innerHTML = "Welcome " + obj.root.Obj.UserID;
                me.getController('MyApp.controller.Main').showMainView();                    

                var store=Ext.getStore('TreePanelDataStore');
                store.setRootNode(obj.root.MenuObj);*/

				var el = Ext.get('logOUt');
				var elLoginTitle = Ext.get('LoginTitle');
				var eloffCode = Ext.get('offCode');
				var elfiscalYear = Ext.get('fiscalYear');
				var elbranchOfficeCount = Ext.get('branchOfficeCount');
				var elregionalOfficeCount = Ext.get('regionalOfficeCount');
				var elmisDateBS = Ext.get('misDateBS');
				var elmisDateAD = Ext.get('misDateAD');
				var elcompanyName = Ext.get('companyName');
				var eloffName = Ext.get('offName');


				var user=obj.root.Obj;
				Ext.ComponentQuery.query('#CntHeaderRight')[0].setVisible(true);
				//Sets Office Code
				//elOffCode.dom.innerHTML=obj.root.Obj.OfficeUser.OfficeCode;

				//Sets Nepali Date
				//GetNepaliDate(function(nepaliDate){
				//    elNepDate.dom.innerHTML=nepaliDate;
				//});

				

				el.child('span').dom.innerHTML = "LogOut";
				elLoginTitle.dom.innerHTML = "Welcome " + user.UserID;
				eloffCode.dom.innerHTML = user.Office.OfficeCode;
				elfiscalYear.dom.innerHTML = user.FiscalYear;
				elbranchOfficeCount.dom.innerHTML = user.Office.BranchOfficeCount;
				elregionalOfficeCount.dom.innerHTML = user.Office.RegionalOfficeCount;
				elmisDateBS.dom.innerHTML = user.MisDateNepali+" (B.S.)&nbsp;&nbsp;";
				elmisDateAD.dom.innerHTML = user.MisDateEnglish+" (A.D.)";
				elcompanyName.dom.innerHTML = user.Office.CompanyName;
				eloffName.dom.innerHTML = user.Office.OfficeName;
				me.getController('MyApp.controller.Main').showMainView();


				var store=Ext.getStore('TreePanelDataStore');

				store.setRootNode(obj.root.MenuObj);








            },
            failure: function ( result, request ) {
                msg("FAILURE","Error in Fetching Data !!!");
            }
        });
    }

});
