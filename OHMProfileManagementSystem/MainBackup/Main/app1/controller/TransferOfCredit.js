/*
 * File: app/controller/TransferOfCredit.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TransferOfCredit', {
    extend: 'Ext.app.Controller',

    stores: [
        'FiscalYear',
        'TaxCreditTransferDetail'
    ],

    onTC_btnAddClick: function(button, e, eOpts) {
        var TC_Details=Ext.ComponentQuery.query('#grdTC')[0];

        var cmbFiscalYrFrom=Ext.ComponentQuery.query('#cmbTC_FiscalYrFrom')[0];
        var cmbFiscalYrTo=Ext.ComponentQuery.query('#cmbTC_FiscalYrTo')[0];
        var txtClaimAmount=Ext.ComponentQuery.query('#txtTC_ClaimAmount')[0];
        var txtApproveAmount=Ext.ComponentQuery.query('#txtTC_ApproveAmount')[0];

        var Store=Ext.getStore('TaxCreditTransferDetail');

        var datas={

            TransferSn:Store.count()+1,



            FiscalYearFrom:'',


            FiscalYearTo:'',


            ClaimAmount:'',


            ApproveAmount:'',

            Action:"A"





        };
        TC_Details.store.add(datas);

        var col = TC_Details.headerCt.getHeaderAtIndex(0);
        var recd = TC_Details.store.data.items;
        var record = recd[recd.length-1];
        TC_Details.getPlugin('pluginTC').startEdit(record, col);


        //TC_Details.Store.load({params:{start:0,limit:4}});
    },

    onTxtTC_PanNoKeypress: function(textfield, e, eOpts) {


        var me=this;

        if(e.keyCode===13 || e.keyCode===9)
        {
            me.TaxpayerInfo();

        }






    },

    onTC_btnSaveClick: function(button, e, eOpts) {

        var me=this;

        me.ReadOnlyControls('');

        var Form = Ext.ComponentQuery.query('#frm_TransferOfCredit')[0].getForm();
        var mode=Ext.ComponentQuery.query('#hdnActionSetForEditDelete')[0].getValue();
        var RecordStatus=Ext.ComponentQuery.query('#hdnRecordStatus')[0].getValue();

        var fiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0].getValue();
        var panNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var regNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0].getValue();



        if(!Form.isValid())
        {

            var errMsg="";
            var errCount=0;

            if(panNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया स्थानीय लेखा नम्बर हाल्नुहोस्।<br/>";

            }
            if(fiscalYear===null)
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया आर्थिक वर्ष छान्नुहोस्।<br/>";
            }
            if(regNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया निवेदन दर्ता नम्बर हाल्नुहोस्।<br/>";


            }
            if(errCount>0)
            {
                msg("WARNING",errMsg);
                return false;
            }

        }
        else
        {
            if(RecordStatus==='I' || RecordStatus==='')
            {

                if(mode==='')
                {
                    me.saveOperation('A','I');
                    me.ClearControl();
                }
                else if(mode==='E')
                {
                    Ext.ComponentQuery.query('#modeUpdating')[0].setVisible(true);
                    me.saveOperation(mode,'I');
                    me.ClearControl();
                }

            }
            else if(RecordStatus==='F')
            {
                msg('WARNING','यो डाटा पहिलनै FINALIZED भई सकेको छ ।');

                Ext.ComponentQuery.query('#TC_btnAdd')[0].disable();

                me.ClearControl();
            }
            else if(RecordStatus==='D')
            {
                msg('WARNING','यो डाटा हटाई सकेको छ।');
                Ext.ComponentQuery.query('#TC_btnAdd')[0].disable();
                me.ClearControl();

            }


        }

    },

    onTC_btnEditClick: function(button, e, eOpts) {
        var me=this;

        var Form = Ext.ComponentQuery.query('#frm_TransferOfCredit')[0].getForm();

        var PanNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var FiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0].getValue();
        var RegNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0].getValue();


        var lblmsg=Ext.ComponentQuery.query('#modeUpdating')[0];

        lblmsg.setVisible(true);
        Ext.ComponentQuery.query('#modeUpdating')[0].setText('Updating...');



        me.ClearControl();
        Ext.ComponentQuery.query('#hdnActionSetForEditDelete')[0].setValue('E');
        me.ReadOnlyControls('e');

        if(!Form.isValid())
        {
            // msg("WARNING","Please Enter the required fields");   
            // return;

            var errMsg="";
            var errCount=0;

            if(PanNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया स्थानीय लेखा नम्बर हाल्नुहोस्।<br/>";

            }
            if(FiscalYear===null)
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया आर्थिक वर्ष छन्नुहोस्।<br/>";
            }
            if(RegNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया निवेदन दर्ता नम्बर हाल्नुहोस्।<br/>";


            }
            if(errCount>0)
            {
                msg("WARNING",errMsg);
                return false;
            }
        }

    },

    onTC_txtRegNoKeypress: function(textfield, e, eOpts) {

        var me=this;


        if(e.keyCode===13 || e.keyCode===9)
        {
            var strTaxCreditTransferDetail=Ext.getStore('TaxCreditTransferDetail');

            strTaxCreditTransferDetail.removeAll();

            me.editOperation();
        }
    },

    onGrdTCAfterRender: function(component, eOpts) {
        Ext.ComponentQuery.query('#grdTC')[0].on('validateedit', function(editor, e) {

            var index=e.rowIdx; 
            var items=e.store.data.items;


            var action=e.store.data.items[index].data.Action;

            if(action==="")
            {
                e.store.data.items[index].data.Action="E";
            }
            else
            {
                e.store.data.items[index].data.Action="A";
            }



            //  e.store.data.items[index].data.Action=editor.context.newValues.Action=="A"?"A":"E";





        });
    },

    onTC_btnSubmitClick: function(button, e, eOpts) {
        var me=this;

        me.ReadOnlyControls('');

        var Form = Ext.ComponentQuery.query('#frm_TransferOfCredit')[0].getForm();

        var Action=Ext.ComponentQuery.query('#hdnAction')[0].getValue();
        var RecordStatus=Ext.ComponentQuery.query('#hdnRecordStatus')[0].getValue();

        var fiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0].getValue();
        var panNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var regNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0].getValue();

        if(!Form.isValid())
        {
            // msg("WARNING","Please Enter the required fields");   
            //return;
            var errMsg="";
            var errCount=0;

            if(panNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया स्थानीय लेखा नम्बर हाल्नुहोस्।<br/>";

            }
            if(fiscalYear===null)
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया आर्थिक वर्ष छन्नुहोस्।<br/>";
            }
            if(regNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया निवेदन दर्ता नम्बर हाल्नुहोस्।<br/>";


            }
            if(errCount>0)
            {
                msg("WARNING",errMsg);
                return false;
            }

        }
        var mode=Ext.ComponentQuery.query('#hdnActionSetForEditDelete')[0].getValue();

        if(mode==='D')
        {
            Ext.Msg.confirm('Confirm Action','के तपाई डाटा हटाउन चाहनुहुन्छ?',function(btn){
                if(btn==='yes')
                {
                    Ext.ComponentQuery.query('#modeUpdating')[0].setVisible(true);
                    Ext.Ajax.request({
                        url: '../Handlers/IncomeTax/TransferOfCredit/TaxCreditTransferHandler.ashx?method=DeleteTransferOfCredit',
                        params: {



                            panNo:panNo,
                            accType:'10',
                            fiscalYear:fiscalYear,
                            regNo:regNo,
                            RecordStatus:RecordStatus

                        },
                        success: function(response){

                            var obj = Ext.decode(response.responseText);
                            var grdPnl=Ext.ComponentQuery.query('#grdTC')[0];

                            if(obj.success === "false")
                            { 

                                msg("INFO",obj.message);
                                return;

                            }
                            else if(obj.success==="true")
                            {
                                if(RecordStatus!=='F')
                                {
                                    msg("INFO",obj.message);
                                    return;
                                }
                                else if(RecordStatus==='F')
                                {
                                    msg("WARNING",obj.message);
                                    return;
                                }
                            }

                        },
                        failure:function(result, request){
                            msg('ERROR OCURRED !!!', 'Error');                 
                        }

                    });

                    me.ClearControl();
                }
            });
        }
        else
        {
            Ext.Msg.confirm('Confirm Action', 'एकपटक Submit गरिसकेपछि अर्को पटक विवरण फेरि परिवर्तन गर्न पइने छैन। \n के तपाई Submit गर्न चाहनुहन्छ ?', function(btn) {
                if(btn == 'yes'){
                    /*if(!Form.isValid())
                    {
                    msg("WARNING","Please Enter the required fields");   
                    return;
                    }*/
                    //else
                    // {
                    if(RecordStatus==='' || RecordStatus==='I')
                    {    
                        if(Action==="E")
                        {
                            me.saveOperation('E','F');
                        }
                        else
                        {
                            me.saveOperation('A','F');
                        }

                        me.ClearControl();
                    }
                    else if(RecordStatus==='F')
                    {
                        msg("WARNING","यो डाटा FINALIZED भई सकेको छ ।");   
                        return;

                    }

                    // }


                }
            });
        }
    },

    onTC_btnDeleteClick: function(button, e, eOpts) {
        var me=this;
        me.ClearControl();

        me.ReadOnlyControls('d');


        var lblmsg=Ext.ComponentQuery.query('#modeUpdating')[0];

        lblmsg.setVisible(true);
        Ext.ComponentQuery.query('#modeUpdating')[0].setText('Deleting...');


        var fiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0].getValue();
        var panNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var regNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0].getValue();
        var RecordStatus=Ext.ComponentQuery.query('#hdnRecordStatus')[0].getValue();

        Ext.ComponentQuery.query('#hdnActionSetForEditDelete')[0].setValue('D');


        var Form = Ext.ComponentQuery.query('#frm_TransferOfCredit')[0].getForm();



        var errMsg="";
        var errCount=0;

        if(!Form.isValid())
        {

            if(panNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया स्थानीय लेखा नम्बर हाल्नुहोस्।<br/>";

            }
            if(fiscalYear===null)
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया आर्थिक वर्ष छन्नुहोस्।<br/>";
            }
            if(regNo==="")
            {
                errCount++;
                errMsg+=errCount+")"+"कृपया निवेदन दर्ता नम्बर हाल्नुहोस्।<br/>";


            }
            if(errCount>0)
            {
                msg("WARNING",errMsg);
                return false;
            }
        }

    },

    onTC_btnCancelClick: function(button, e, eOpts) {
        var me=this;

        me.ClearControl();
        me.ReadOnlyControls('');
    },

    editOperation: function() {

        var fiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0].getValue();
        var panNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var regNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0].getValue();
        var totalClaimAmount=Ext.ComponentQuery.query('#txtTotalClaimAmount')[0];
        var totalApproveAmount=Ext.ComponentQuery.query('#txtTotalApproveAmount')[0];
        var officerCode=Ext.ComponentQuery.query('#TC_txtOfficerCode')[0];
        var officerName=Ext.ComponentQuery.query('#TC_txtOfficerName')[0];
        var Action=Ext.ComponentQuery.query('#hdnAction')[0];
        var TranNo=Ext.ComponentQuery.query('#hdnTranNo')[0];
        var RecordStatus=Ext.ComponentQuery.query('#hdnRecordStatus')[0];

        var btnSave=Ext.ComponentQuery.query('#TC_btnSave')[0];
        var btnAdd=Ext.ComponentQuery.query('#TC_btnAdd')[0];
        var btnEdit=Ext.ComponentQuery.query('#TC_btnEdit')[0];
        var btnDelete=Ext.ComponentQuery.query('#TC_btnDelete')[0];
        var btnSubmit=Ext.ComponentQuery.query('#TC_btnSubmit')[0];



        var storeData='';
        Ext.Ajax.request({
            url: '../Handlers/IncomeTax/TransferOfCredit/TaxCreditTransferHandler.ashx?method=GetTransferOfCredit',
            params: {



                panNo:panNo,
                accType:'10',
                fiscalYear:fiscalYear,
                regNo:regNo

            },
            success: function(response){

                var obj = Ext.decode(response.responseText);
                var grdPnl=Ext.ComponentQuery.query('#grdTC')[0];
                var data = obj.root;
                console.log(obj.root);

                var action=Ext.ComponentQuery.query('#hdnActionSetForEditDelete')[0].getValue();
                if(obj.message==='यो डाटा हटाई सकेको छ ।' && action==='E')
                {
                    Ext.ComponentQuery.query('#hdnRecordStatus')[0].setValue('D');

                    msg('WARNING',obj.message);

                    totalClaimAmount.reset();
                    totalApproveAmount.reset();
                    officerCode.reset();
                    officerName.reset();

                    btnAdd.disable();
                    btnSave.disable();
                    btnSubmit.disable();

                    return;
                }
                else if(obj.message==='यो डाटा पहिलनै FINALIZED भई सकेको छ ।' && action==='E')
                {
                    RecordStatus.setValue('F');
                    msg("WARNING",obj.message);


                    totalClaimAmount.setValue(data.TotalClaimAmount);
                    totalApproveAmount.setValue(data.TotalApproveAmount);

                    officerCode.setValue(data.OfficerCode);
                    officerName.setValue(data.OfficerName);
                    Action.setValue(data.Action);
                    TranNo.setValue(data.TranNo);
                    RecordStatus.setValue(data.RecordStatus);

                    storeData=Ext.getStore('TaxCreditTransferDetail');



                    storeData.clearFilter();




                    storeData.add(data.TaxCrTansLst);

                    grdPnl.bindStore(storeData);

                    if(storeData.getCount() > 0)
                    {
                        officerCode.setReadOnly(true);
                        officerName.setReadOnly(true);
                    }
                    else
                    {
                        officerCode.setReadOnly(false);
                        officerName.setReadOnly(false);
                    }



                    btnAdd.disable();
                    btnSave.disable();
                    btnDelete.disable();
                    btnSubmit.disable();

                    return;

                }
                else if(obj.message==='तपाईले खोजेको डाटा यहाँ छैन् ।' && action==='E')
                {
                    msg("WARNING",obj.message);
                    Ext.ComponentQuery.query('#TC_btnAdd')[0].disable();
                    Ext.ComponentQuery.query('#TC_btnSave')[0].disable();
                    btnSubmit.disable();


                    totalClaimAmount.reset();
                    totalApproveAmount.reset();
                    officerCode.reset();
                    officerName.reset();

                    return;

                }
                else if(obj.message!=='यो डाटा पहिलनै FINALIZED भई सकेको छ ।' && action==='E' )
                {
                    Ext.ComponentQuery.query('#TC_btnAdd')[0].enable();
                    totalClaimAmount.setValue(data.TotalClaimAmount);
                    totalApproveAmount.setValue(data.TotalApproveAmount);

                    officerCode.setValue(data.OfficerCode);
                    officerName.setValue(data.OfficerName);
                    Action.setValue(data.Action);
                    TranNo.setValue(data.TranNo);
                    RecordStatus.setValue(data.RecordStatus);

                    storeData=Ext.getStore('TaxCreditTransferDetail');



                    storeData.clearFilter();




                    storeData.add(data.TaxCrTansLst);

                    grdPnl.bindStore(storeData);

                    if(storeData.getCount() > 0)
                    {
                        officerCode.setReadOnly(true);
                        officerName.setReadOnly(true);
                    }
                    else
                    {
                        officerCode.setReadOnly(false);
                        officerName.setReadOnly(false);
                    }

                    btnSave.enable();
                    btnEdit.disable();
                    btnDelete.disable();
                    btnSubmit.enable();

                    return;
                }
                else if(obj.message==='यो डाटा हटाई सकेको छ ।' && action==='D')
                {
                    Ext.ComponentQuery.query('#hdnRecordStatus')[0].setValue('D');
                    btnAdd.disable();
                    btnSubmit.disable();
                    msg('WARNING',obj.message);

                    totalClaimAmount.reset();
                    totalApproveAmount.reset();
                    officerCode.reset();
                    officerName.reset();

                    return;
                }
                else if(obj.message==='तपाईले खोजेको डाटा यहाँ छैन् ।' && action==='D')
                {
                    msg("WARNING",obj.message);
                    Ext.ComponentQuery.query('#TC_btnAdd')[0].disable();
                    Ext.ComponentQuery.query('#TC_btnSave')[0].disable();
                    btnSubmit.disable();


                    totalClaimAmount.reset();
                    totalApproveAmount.reset();
                    officerCode.reset();
                    officerName.reset();

                    return;

                }
                else if(obj.message==='यो डाटा पहिलनै FINALIZED भई सकेको छ ।' && action==='D' )
                {
                    msg("WARNING",obj.message);
                    Ext.ComponentQuery.query('#TC_btnAdd')[0].enable();
                    totalClaimAmount.setValue(data.TotalClaimAmount);
                    totalApproveAmount.setValue(data.TotalApproveAmount);

                    officerCode.setValue(data.OfficerCode);
                    officerName.setValue(data.OfficerName);
                    Action.setValue(data.Action);
                    TranNo.setValue(data.TranNo);
                    RecordStatus.setValue(data.RecordStatus);

                    storeData=Ext.getStore('TaxCreditTransferDetail');



                    storeData.clearFilter();




                    storeData.add(data.TaxCrTansLst);

                    grdPnl.bindStore(storeData);

                    if(storeData.getCount() > 0)
                    {
                        officerCode.setReadOnly(true);
                        officerName.setReadOnly(true);
                    }
                    else
                    {
                        officerCode.setReadOnly(false);
                        officerName.setReadOnly(false);
                    }

                    btnAdd.disable();
                    btnSave.disable();
                    btnEdit.disable();
                    btnDelete.disable();
                    btnSubmit.disable();

                    return;
                }
                else if(obj.message!=='यो डाटा पहिलनै FINALIZED भई सकेको छ ।' && action==='D')
                {
                    totalClaimAmount.setValue(data.TotalClaimAmount);
                    totalApproveAmount.setValue(data.TotalApproveAmount);

                    officerCode.setValue(data.OfficerCode);
                    officerName.setValue(data.OfficerName);
                    Action.setValue(data.Action);
                    TranNo.setValue(data.TranNo);
                    RecordStatus.setValue(data.RecordStatus);

                    storeData=Ext.getStore('TaxCreditTransferDetail');

                    storeData.add(data.TaxCrTansLst);

                    grdPnl.bindStore(storeData);

                    btnAdd.disable();
                    btnSubmit.enable();

                    return;
                }

                else if(obj.message === "यो डाटा हटाई सकेको छ ।")
                {   
                    msg("WARNING",obj.message);
                    btnAdd.disable();
                    btnSave.disable();
                    btnEdit.disable();
                    btnDelete.disable();
                    btnSubmit.disable();

                    totalClaimAmount.reset();
                    totalApproveAmount.reset();
                    officerCode.reset();
                    officerName.reset();

                    officerCode.setReadOnly(true);
                    officerName.setReadOnly(true);

                    return;
                }
                else if(obj.message!=='यो डाटा पहिलनै FINALIZED भई सकेको छ ।')
                {
                    Ext.ComponentQuery.query('#TC_btnAdd')[0].enable();
                    totalClaimAmount.setValue(data.TotalClaimAmount);
                    totalApproveAmount.setValue(data.TotalApproveAmount);

                    officerCode.setValue(data.OfficerCode);
                    officerName.setValue(data.OfficerName);
                    Action.setValue(data.Action);
                    TranNo.setValue(data.TranNo);
                    RecordStatus.setValue(data.RecordStatus);

                    storeData=Ext.getStore('TaxCreditTransferDetail');



                    storeData.clearFilter();




                    storeData.add(data.TaxCrTansLst);

                    grdPnl.bindStore(storeData);

                    if(storeData.getCount() > 0)
                    {
                        officerCode.setReadOnly(true);
                        officerName.setReadOnly(true);
                    }
                    else
                    {
                        officerCode.setReadOnly(false);
                        officerName.setReadOnly(false);
                    }



                    return;
                }
                else if(obj.message==='यो डाटा पहिलनै FINALIZED भई सकेको छ ।')
                {
                    msg('WARNING',obj.message);

                    totalClaimAmount.setValue(data.TotalClaimAmount);
                    totalApproveAmount.setValue(data.TotalApproveAmount);

                    officerCode.setValue(data.OfficerCode);
                    officerName.setValue(data.OfficerName);
                    Action.setValue(data.Action);
                    TranNo.setValue(data.TranNo);
                    RecordStatus.setValue(data.RecordStatus);

                    storeData=Ext.getStore('TaxCreditTransferDetail');

                    storeData.add(data.TaxCrTansLst);

                    grdPnl.bindStore(storeData);


                    btnAdd.disable();
                    btnSave.disable();
                    btnEdit.disable();
                    btnDelete.disable();
                    btnSubmit.disable();

                    officerCode.setReadOnly(true);
                    officerName.setReadOnly(true);

                    return;

                }





            },
            failure:function(result, request){
                msg('ERROR OCURRED !!!', 'Error');                 
            }

        });
    },

    saveOperation: function(Action,Status) {
        var PanNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var FiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0].getValue();
        var RegNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0].getValue();
        var grd=Ext.ComponentQuery.query('#grdTC')[0];
        var OfficerCode=Ext.ComponentQuery.query('#TC_txtOfficerCode')[0].getValue();
        var OfficerName=Ext.ComponentQuery.query('#TC_txtOfficerName')[0].getValue();
        var TotalClaimAmount=Ext.ComponentQuery.query('#txtTotalClaimAmount')[0].getValue();
        var TotalApproveAmount=Ext.ComponentQuery.query('#txtTotalApproveAmount')[0].getValue();
        var OfficeCode=Ext.ComponentQuery.query('#TC_txtOffCode')[0].getValue();
        var TranNo;


        var grdStore=grd.getStore();

        var errMsg="";
        var errCount=0;

        if(grdStore.data.length===0)
        {
            errCount++;
            errMsg+=errCount+")"+"कृपया टेबलमा बढी दाखिला भएको कर मिलानको विवरण हाल्नुहोस्।<br/>";

        }
        if(OfficerCode==="")
        {
            errCount++;
            errMsg+=errCount+")"+"कृपया अधिकृतको कोड हाल्नुहोस्।<br/>";

        }
        if(OfficerName==="")
        {
            errCount++;
            errMsg+=errCount+")"+"कृपया अधिकृतको नाम हाल्नुहोस्।<br/>";

        }
        if(errCount>0)
        {
            msg("WARNING",errMsg);
            return false;
        }

        var TableLst="";

        var grdTCDone=Ext.getStore('TaxCreditTransferDetail');
        grdTCDone.clearFilter();

        if(grdTCDone.getCount() > 0)
        {
            TableLst = getJson(grdTCDone); 
        }
        else
        {
            msg('WARNING','कृपया टेबलमा बढी दाखिला भएको कर मिलानको विवरण हाललाई ADD Click गर्नुहोस्।');
        }
        if(Action==="E")
        {
            loadMsg="Updating...";
            TranNo=Ext.ComponentQuery.query('#hdnTranNo')[0].getValue();

        }
        else
        {
            loadMsg="Saving...";
            TranNo='';
        }
        var asChildData="";
        var asParentData="";

        if(PanNo!=="" && FiscalYear!==null && RegNo!=="" && grdStore.data.length!==0 && OfficerCode!=="" && OfficerName!=="")
        {

            //msg("WARNING","VALID DATA ENTRY");




            asParentData={

                Pan:PanNo,
                accType:'10',
                FiscalYear:FiscalYear ,
                RegistrationNo:RegNo,
                RegistrationDate:'' ,
                ApprovedDate:'' ,
                TotalClaimAmount:TotalClaimAmount ,
                TotalApproveAmount:TotalApproveAmount ,
                OfficerCode:OfficerCode ,
                OfficerName: OfficerName,
                OffCode:OfficeCode ,
                Terminal:'' ,
                TranNo:TranNo ,
                TranDate:'' ,
                UserName:'' ,
                RecordStatus:Status,

                TaxCrTansLst:TableLst!==""?TableLst:null,
                Action:Action


            };
            Ext.Ajax.request({
                url: '../Handlers/IncomeTax/TransferOfCredit/TaxCreditTransferHandler.ashx?method=SaveTransferOfCredit',
                params: {


                    Data:JSON.stringify(asParentData)

                },
                success: function(response){

                    var resp=Ext.decode(response.responseText);



                    if(resp.message==="Successfully Updated." && Status==='F')
                    {
                        msg('INFO','तपाईको विवरण सफलता पूर्वक SUBMIT भयो।');
                        return;
                    }
                    else if(resp.message==="Successfully Saved." && Action==='A' )
                    {
                        msg('INFO','तपाईको विवरण सफलता पूर्वक SAVE भयो।');
                        return;
                    }
                    else if(resp.message==="Successfully Updated." && Action==='E')
                    {
                        msg('INFO','तपाईको विवरण सफलता पूर्वक UPDATE भयो।');
                        return;
                    }
                    else if(resp.message==="Your data already exists.")
                    {
                        msg('INFO',resp.message);
                        return;
                    }


                },
                failure:function(result, request){
                    msg('ERROR OCURRED !!!', 'Error');                 
                }

            });



        }

    },

    TaxpayerInfo: function() {
        var me=this;

        var Pan=Ext.ComponentQuery.query('#txtTC_PanNo')[0].getValue();
        var AcctType='10';

        var offCode=null;
        offCode=Ext.get('offCode').dom.innerHTML;
        //Ext.ComponentQuery.query('#TC_txtOffCode')[0].setValue(office.OfficeCode);

        LoadTaxpayerInfoWithValidPan(Pan,AcctType,function(data){

            var taxpayer=data.root.Taxpayer;
            var address=taxpayer.BusinessAddress.Address;
            var office=taxpayer.Office;
            var vOffCode=office.OfficeCode;

            if(offCode!=vOffCode)
            {
                msg('WARNING','तपाईले भर्नु भएको PAN यो OFFICE मा दर्ता भएको छैन्।');
                me.ClearControl();
                return;
            }
            else
            {
                //    Ext.ComponentQuery.query('#TC_txtOffCode')[0].setValue(office.OfficeCode);

                Ext.ComponentQuery.query('#TC_IROName')[0].setValue(office.OfficeNameNepali);

                Ext.ComponentQuery.query('#txtTC_Name')[0].setValue(taxpayer.Name);



                Ext.ComponentQuery.query('#txtTC_HouseNo')[0].setValue(address.HouseNo);

                Ext.ComponentQuery.query('#txtTC_WardNo')[0].setValue(address.WardNo);

                Ext.ComponentQuery.query('#txtTC_ToleName')[0].setValue(address.StreetName);


                if(address.LocationType=='MM')
                {
                    Ext.ComponentQuery.query('#rdbtn_MNP')[0].setValue(true);
                }
                else if(address.LocationType=='SM')
                {
                    Ext.ComponentQuery.query('#rdbtn_UMNP')[0].setValue(true);
                }
                else if(address.LocationType=='MN')
                {
                    Ext.ComponentQuery.query('#rdbtn_NP')[0].setValue(true);
                }
                else if(address.LocationType=='VD')
                {
                    Ext.ComponentQuery.query('#rdbtn_VDC')[0].setValue(true);
                }

                Ext.ComponentQuery.query('#txtTC_VDCName')[0].setValue(address.VdcTown);

                Ext.ComponentQuery.query('#txtTC_DistrictName')[0].setValue(address.DistrictNameNep);

                Ext.ComponentQuery.query('#txtTC_Phone')[0].setValue(address.Telephone);

            }

        });

    },

    ClearControl: function() {


        var officerCode=Ext.ComponentQuery.query('#TC_txtOfficerCode')[0];
        var officerName=Ext.ComponentQuery.query('#TC_txtOfficerName')[0];
        var totalClaimAmount=Ext.ComponentQuery.query('#txtTotalClaimAmount')[0];
        var totalApproveAmount=Ext.ComponentQuery.query('#txtTotalApproveAmount')[0];
        var panNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0];
        var regNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0];

        //var offCode=Ext.ComponentQuery.query('#TC_txtOffCode')[0];
        var tcName=Ext.ComponentQuery.query('#txtTC_Name')[0];
        var tcHouseNo=Ext.ComponentQuery.query('#txtTC_HouseNo')[0];
        var tcWardNo=Ext.ComponentQuery.query('#txtTC_WardNo')[0];
        var tcToleName=Ext.ComponentQuery.query('#txtTC_ToleName')[0];
        var tcVdcName=Ext.ComponentQuery.query('#txtTC_VDCName')[0];
        var districtName=Ext.ComponentQuery.query('#txtTC_DistrictName')[0];
        var phoneNo=Ext.ComponentQuery.query('#txtTC_Phone')[0];
        var radioBtn=Ext.ComponentQuery.query('#TC_VDC')[0];

        var fiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0];

        var IROName=Ext.ComponentQuery.query('#TC_IROName')[0];

        IROName.setValue('');

        //Ext.ComponentQuery.query('#TC_btnSave')[0].enable();

        Ext.getStore('TaxCreditTransferDetail').loadData([],false);

        officerCode.reset();
        officerName.reset();
        totalClaimAmount.reset();
        totalApproveAmount.reset();
        panNo.reset();
        regNo.reset();

        //offCode.reset();
        tcName.reset();
        tcHouseNo.reset();
        tcWardNo.reset();
        tcToleName.reset();
        tcVdcName.reset();
        districtName.reset();
        phoneNo.reset();

        radioBtn.reset();
        fiscalYear.reset();

        Ext.ComponentQuery.query('#modeUpdating')[0].setVisible(false);
        var action=Ext.ComponentQuery.query('#hdnActionSetForEditDelete')[0];
        action.reset();

    },

    ReadOnlyControls: function(txt) {


        var officerCode=Ext.ComponentQuery.query('#TC_txtOfficerCode')[0];
        var officerName=Ext.ComponentQuery.query('#TC_txtOfficerName')[0];
        var totalClaimAmount=Ext.ComponentQuery.query('#txtTotalClaimAmount')[0];
        var totalApproveAmount=Ext.ComponentQuery.query('#txtTotalApproveAmount')[0];
        var panNo=Ext.ComponentQuery.query('#txtTC_PanNo')[0];
        var regNo=Ext.ComponentQuery.query('#TC_txtRegNo')[0];

        var offCode=Ext.ComponentQuery.query('#TC_txtOffCode')[0];
        var tcName=Ext.ComponentQuery.query('#txtTC_Name')[0];
        var tcHouseNo=Ext.ComponentQuery.query('#txtTC_HouseNo')[0];
        var tcWardNo=Ext.ComponentQuery.query('#txtTC_WardNo')[0];
        var tcToleName=Ext.ComponentQuery.query('#txtTC_ToleName')[0];
        var tcVdcName=Ext.ComponentQuery.query('#txtTC_VDCName')[0];
        var districtName=Ext.ComponentQuery.query('#txtTC_DistrictName')[0];
        var phoneNo=Ext.ComponentQuery.query('#txtTC_Phone')[0];
        var radioBtn=Ext.ComponentQuery.query('#TC_VDC')[0];

        var fiscalYear=Ext.ComponentQuery.query('#cmbTC_FiscalYear')[0];

        var btnSave=Ext.ComponentQuery.query('#TC_btnSave')[0];
        var btnAdd=Ext.ComponentQuery.query('#TC_btnAdd')[0];
        var btnEdit=Ext.ComponentQuery.query('#TC_btnEdit')[0];
        var btnDelete=Ext.ComponentQuery.query('#TC_btnDelete')[0];
        var btnSubmit=Ext.ComponentQuery.query('#TC_btnSubmit')[0];
        //Ext.getStore('TaxCreditTransferDetail').loadData([],false);



        if(txt==='d')
        {
            officerCode.setReadOnly(true);
            officerName.setReadOnly(true);
            totalClaimAmount.setReadOnly(true);
            totalApproveAmount.setReadOnly(true);
            btnAdd.disable();
            btnSave.disable();
            btnEdit.disable();
            btnDelete.disable();

            Ext.ComponentQuery.query('#modeUpdating')[0].setVisible(true);

        }
        else if(txt==='e')
        {
            officerCode.setReadOnly(true);
            officerName.setReadOnly(true);
            totalClaimAmount.setReadOnly(true);
            totalApproveAmount.setReadOnly(true);
            btnAdd.enable();
            btnEdit.disable();
            btnDelete.disable();
            Ext.ComponentQuery.query('#modeUpdating')[0].setVisible(true);
        }
        else if(txt==='')
        {
            officerCode.setReadOnly(false);
            officerName.setReadOnly(false);
            totalClaimAmount.setReadOnly(true);
            totalApproveAmount.setReadOnly(true);
            btnAdd.enable();
            btnSave.enable();
            btnEdit.enable();
            btnDelete.enable();
            btnSubmit.enable();
            Ext.ComponentQuery.query('#modeUpdating')[0].setVisible(false);
        }

        //offCode.setReadOnly(true);
        //tcName.setReadOnly(true);
        //tcHouseNo.setReadOnly(true);
        //tcWardNo.setValue('');
        //tcToleName.setValue('');
        //tcVdcName.setValue('');
        //districtName.setValue('');
        //phoneNo.setValue('');
    },

    init: function(application) {
        this.control({
            "#TC_btnAdd": {
                click: this.onTC_btnAddClick
            },
            "#txtTC_PanNo": {
                keypress: this.onTxtTC_PanNoKeypress
            },
            "#TC_btnSave": {
                click: this.onTC_btnSaveClick
            },
            "#TC_btnEdit": {
                click: this.onTC_btnEditClick
            },
            "#TC_txtRegNo": {
                keypress: this.onTC_txtRegNoKeypress
            },
            "#grdTC": {
                afterrender: this.onGrdTCAfterRender
            },
            "#TC_btnSubmit": {
                click: this.onTC_btnSubmitClick
            },
            "#TC_btnDelete": {
                click: this.onTC_btnDeleteClick
            },
            "#TC_btnCancel": {
                click: this.onTC_btnCancelClick
            }
        });
    }

});
