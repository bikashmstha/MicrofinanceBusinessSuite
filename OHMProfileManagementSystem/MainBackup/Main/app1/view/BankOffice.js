/*
 * File: app/view/BankOffice.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.BankOffice', {
    extend: 'Ext.panel.Panel',

    frame: true,
    padding: '100 0 0 0',
    title: 'Bank Office',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'fieldset',
                    height: 110,
                    padding: '10 0 0 0',
                    title: '',
                    items: [
                        {
                            xtype: 'container',
                            height: 30,
                            items: [
                                {
                                    xtype: 'combobox',
                                    itemId: 'cboOffice',
                                    margin: '0 0 0 150',
                                    maxWidth: 350,
                                    minWidth: 350,
                                    width: 350,
                                    fieldLabel: 'Office Name',
                                    emptyText: 'select ...',
                                    displayField: 'OfficeNameEnglish',
                                    forceSelection: true,
                                    store: 'Office',
                                    typeAhead: true,
                                    valueField: 'OfficeCode'
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 30,
                            items: [
                                {
                                    xtype: 'combobox',
                                    itemId: 'cboBank',
                                    margin: '0 0 0 150',
                                    width: 350,
                                    fieldLabel: 'Bank Name',
                                    emptyText: 'select ...',
                                    displayField: 'BankNameEnglish',
                                    forceSelection: true,
                                    store: 'StrBank',
                                    typeAhead: true,
                                    valueField: 'BankCode',
                                    listeners: {
                                        change: {
                                            fn: me.onCboBankChange,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            height: 30,
                            items: [
                                {
                                    xtype: 'combobox',
                                    itemId: 'cboBranch',
                                    margin: '0 0 0 150',
                                    width: 350,
                                    fieldLabel: 'Branch Name',
                                    emptyText: 'select ...',
                                    displayField: 'BrnAddress',
                                    forceSelection: true,
                                    queryMode: 'local',
                                    store: 'Branch',
                                    typeAhead: true,
                                    valueField: 'BrnCode'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'container',
                    height: 30,
                    items: [
                        {
                            xtype: 'button',
                            itemId: 'btnSaveBankOffice',
                            margin: '0 5 0 270',
                            iconCls: 'icon-save',
                            text: 'Save'
                        },
                        {
                            xtype: 'button',
                            itemId: 'btnCancelBO',
                            iconCls: 'icon-cancel',
                            text: 'Cancel'
                        },
                        {
                            xtype: 'hiddenfield',
                            itemId: 'hdnDate',
                            fieldLabel: 'Label'
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onCboBankChange: function(field, newValue, oldValue, options) {
        /*
        var strBranch=Ext.getStore('Branch');

        console.log('value',newValue);
        strBranch.load({
        url:'../Handlers/Common/BranchHandler.ashx?',

        params:{method:'LoadBranch', BankCode:newValue,BrnStatus:""
        }

        });

        Ext.override(Ext.LoadMask, {
        onHide: function() {
        this.callParent();
        }
        });
        */






        //console.log('Combo>>>>',combo);
        //console.log('Records>>>>',records);
        //console.log('Options>>>>',options);


        var cboBranch=Ext.ComponentQuery.query('#cboBranch')[0];
        cboBranch.setValue('');

        var cboBank=Ext.ComponentQuery.query('#cboBank')[0].getValue();
        //alert(cboBank);


        var strBranch=Ext.getStore('Branch');
        strBranch.removeAll();
        ///strBranch.loadData([],false);


        cboBranch.setValue("");
        console.log("Bank",cboBank);

        Ext.Ajax.request({

            url:'../Handlers/Common/BranchHandler.ashx',
            params:{
                method:'LoadBranch',BankCode:cboBank,BrnStatus:""
            },

            success: function(response){    
                // waitMsg.hide();


                var obj =Ext.decode(response.responseText);
                //console.log(obj);
                var row = obj.root;
                console.log('From Date***',obj.root[0].FromDate);
                Ext.ComponentQuery.query('#hdnDate')[0].setValue(obj.root[0].FromDate);

                console.log("checking Data",row);  

                var strBrancha=Ext.getStore('Branch');
                strBrancha.loadData(obj.root);
                // cboBranch.store.loadData(obj.root);

            },                   

            failure:function(response)
            {			
                //waitMsg.hide();
                msg('FAILURE',Ext.decode(response));
            }
        });
    }

});