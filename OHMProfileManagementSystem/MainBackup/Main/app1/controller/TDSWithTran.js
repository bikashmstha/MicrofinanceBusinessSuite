/*
 * File: app/controller/TDSWithTran.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.TDSWithTran', {
    extend: 'Ext.app.Controller',

    models: [
        'TDSDateType'
    ],
    stores: [
        'TDSDateType'
    ],
    views: [
        'TDSWithTran'
    ],

    onBtnTDSWTSearchClick: function(button, e, eOpts) {
        var me = this;

        var txtPan = Ext.ComponentQuery.query("#txtTDSWTPan")[0];
        var cboDateType = Ext.ComponentQuery.query("#cboTDSWTDateType")[0];
        var txtFromDate = Ext.ComponentQuery.query("#txtTDSWTFromDate")[0];
        var txtToDate = Ext.ComponentQuery.query("#txtTDSWTToDate")[0];

        var form = Ext.ComponentQuery.query("#frmTDSWithTranForm")[0].getForm();
        console.log("form",form);

        if(!form.isValid())
        {
            msg("WARNING","Please Enter the required fields");   
            return;
        }

        Ext.Ajax.request({
            url:"../Handlers/TDS/InsertTransactionHandler.ashx?method=GetTradeName",
            params:{Pan:txtPan.getValue(),AcctType:"00"},
            success: function ( result, request ) 
            {            

                var obj = Ext.decode(result.responseText); 
                var data = obj.root;

                var Pan = Ext.ComponentQuery.query("#txtTDSWTPan")[0];
                var DateType = Ext.ComponentQuery.query("#cboTDSWTDateType")[0];
                var FromDate = Ext.ComponentQuery.query("#txtTDSWTFromDate")[0];
                var ToDate = Ext.ComponentQuery.query("#txtTDSWTToDate")[0];

                if(obj.success === "true")
                {
                    me.getController('MyApp.controller.TDSWithholdeeTran').init();
                    me.getController('MyApp.controller.TDSWithholdeeTran').ShowWithholdeeTran(Pan.getValue(),DateType.getValue(),FromDate.getValue(),ToDate.getValue(),data.TradeName);
                }
                if(obj.success === "false")
                {   
                    msg("WARNING",obj.message);
                    return;
                }


            }
        });
    },

    ShowWithTranForm: function() {
        Ext.getCmp('cntOMTDS').removeAll();

        var pnlDynamic = Ext.create('MyApp.view.TDSWithTran');
        var pnlToRender = Ext.ComponentQuery.query("#cntOMTDS")[0];
        pnlToRender.add(pnlDynamic);
    },

    init: function(application) {
        this.control({
            "#btnTDSWTSearch": {
                click: this.onBtnTDSWTSearchClick
            }
        });
    }

});
