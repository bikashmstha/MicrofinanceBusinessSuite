/*
 * File: app/view/AppealDecision.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.AppealDecision', {
    extend: 'Ext.panel.Panel',

    frame: true,
    itemId: 'pnlAppealDecision',
    layout: {
        align: 'stretch',
        type: 'vbox'
    },
    title: 'पूनरावेदन समाप्तीको सूचना',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'form',
                    calTotAmtRetained: function() {

                        var grd = Ext.ComponentQuery.query('#grdAppealDecision')[0];
                        var store = grd.getStore();
                        var selectedRow = grd.getSelectionModel();

                        var record = grd.getSelectionModel().getSelection()[0];
                        var finAmount = Ext.ComponentQuery.query('#txtAmtRtd')[0];
                        //var totARtnd=Ext.ComponentQuery.query('#amountR')[0];

                        finAmount.setValue("");

                        //This code sum numbers in certain column
                        var sum = 0; 
                        var rowIdx = store.indexOf(record);
                        var idx = 0;

                        console.log("rowIdx",rowIdx);

                        store.each(function (rec) {     


                            if(rec.get('AmountRetained') !=="" && rowIdx !== idx)
                            {
                                sum = parseInt(sum) + parseInt(rec.get('AmountRetained')); 
                            }

                            idx++;


                        });



                        //var overallTot = parseInt(sum)+parseInt(totARtnd);

                        finAmount.setValue(sum);
                    },
                    flex: 1,
                    frame: true,
                    itemId: 'frmAppealDecision',
                    autoScroll: true,
                    bodyPadding: 10,
                    title: '',
                    items: [
                        {
                            xtype: 'displayfield',
                            height: 25,
                            hidden: true,
                            itemId: 'lblActionAppealDec',
                            width: 800,
                            fieldStyle: '{color:red;}'
                        },
                        {
                            xtype: 'container',
                            margin: '10 0 2 5',
                            items: [
                                {
                                    xtype: 'container',
                                    height: 26,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'offcodeAD',
                                            itemId: 'offcodeAD',
                                            width: 133,
                                            fieldLabel: 'कार्यालय कोड',
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            flex: 1,
                                            disabled: true,
                                            id: 'txtAcOffcode',
                                            itemId: 'txtAcOffcode',
                                            margin: '0 0 2 10',
                                            maxWidth: 160,
                                            width: 100,
                                            fieldLabel: 'समाप्ति कार्यालय कोड',
                                            labelWidth: 120,
                                            enforceMaxLength: true,
                                            growMax: 600,
                                            growMin: 20,
                                            maskRe: /[0-9]/,
                                            maxLength: 2,
                                            minLength: 2,
                                            size: 10
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    height: 30,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'appealnoAD',
                                            itemId: 'appealnoAD',
                                            width: 202,
                                            fieldLabel: 'पुनरावेदन दर्ता नं.',
                                            msgTarget: 'side',
                                            allowBlank: false,
                                            enableKeyEvents: true,
                                            enforceMaxLength: true,
                                            maskRe: /[0-9]/,
                                            maxLength: 10,
                                            minLength: 10
                                        },
                                        {
                                            xtype: 'container',
                                            flex: 1,
                                            margins: '0 0 0 5',
                                            layout: {
                                                align: 'stretch',
                                                type: 'hbox'
                                            },
                                            items: [
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnAcctType',
                                                    itemId: 'hdnAcctType',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    id: 'hdnTranDate',
                                                    itemId: 'hdnTranDate',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnOrderDate',
                                                    itemId: 'hdnOrderDate',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnOrderNo',
                                                    itemId: 'hdnOrderNo',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnAppealReason',
                                                    itemId: 'hdnAppealReason',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnAppealStatus',
                                                    itemId: 'hdnAppealStatus',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnUserId',
                                                    itemId: 'hdnUserId',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnApTranNo',
                                                    itemId: 'hdnApTranNo',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnAcTranNo',
                                                    itemId: 'hdnAcTranNo',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnPrStatus',
                                                    itemId: 'hdnPrStatus',
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    id: 'hdnAction',
                                                    itemId: 'hdnAction',
                                                    maxWidth: 100,
                                                    fieldLabel: 'Label'
                                                },
                                                {
                                                    xtype: 'hiddenfield',
                                                    flex: 1,
                                                    itemId: 'hdnActAD',
                                                    fieldLabel: 'Label'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    height: 30,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'txtPanAC',
                                            itemId: 'txtPanAC',
                                            maxWidth: 300,
                                            width: 208,
                                            fieldLabel: 'स्था.ले.नं.',
                                            msgTarget: 'side',
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            margins: '0 0 0 258',
                                            id: 'txtappealdateAD',
                                            itemId: 'txtappealdateAD',
                                            maxWidth: 300,
                                            width: 246,
                                            fieldLabel: 'पुनरावेदन निर्णय पाएको मिति',
                                            labelWidth: 160,
                                            readOnly: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    height: 33,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'txtTaxpayer',
                                            itemId: 'txtTaxpayer',
                                            width: 379,
                                            fieldLabel: 'करदाताको नाम',
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            margins: '0 2 0 130',
                                            id: 'txtTPAddress',
                                            itemId: 'txtTPAddress',
                                            width: 500,
                                            fieldLabel: 'करदाताको ठेगाना',
                                            labelPad: 2,
                                            labelWidth: 120,
                                            readOnly: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    height: 26,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'txtappealOnMaNo',
                                            itemId: 'txtappealOnMaNo',
                                            width: 370,
                                            fieldLabel: 'पुनरावेदनमा गएको कर निरधारन आदेश नं.',
                                            labelPad: 12,
                                            labelWidth: 210,
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            margins: '2 0 0 110',
                                            id: 'txtApplLocCode',
                                            itemId: 'txtApplLocCode',
                                            margin: '',
                                            fieldLabel: 'पुनरावेदनमा गएको निकाय',
                                            labelPad: 4,
                                            labelWidth: 148,
                                            readOnly: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'textfield',
                                    id: 'txtApplRegNo',
                                    itemId: 'txtApplRegNo',
                                    width: 490,
                                    fieldLabel: 'आन्तरिक राजस्व विभाग / राजस्व न्यायाधिकरण / सवौच्च अदालत दर्ता नं.',
                                    labelPad: 20,
                                    labelWidth: 360,
                                    readOnly: true
                                },
                                {
                                    xtype: 'container',
                                    height: 28,
                                    margin: '10 0 0 0',
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            id: 'txtDecno',
                                            itemId: 'txtDecno',
                                            width: 210,
                                            fieldLabel: 'निर्णय नं.',
                                            msgTarget: 'side',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            flex: 1,
                                            margins: '0 0 0 97',
                                            id: 'txtDecdate',
                                            itemId: 'txtDecdate',
                                            maxWidth: 160,
                                            width: 200,
                                            fieldLabel: 'निर्णय मिति',
                                            labelWidth: 70,
                                            msgTarget: 'side',
                                            allowBlank: false,
                                            emptyText: 'YYYY.MM.DD'
                                        },
                                        {
                                            xtype: 'textfield',
                                            flex: 1,
                                            id: 'txtUserAC',
                                            itemId: 'txtUserAC',
                                            margin: '0 0 2 37',
                                            maxWidth: 350,
                                            width: 300,
                                            fieldLabel: 'निर्णय कर्ता',
                                            labelPad: 10,
                                            labelWidth: 82,
                                            msgTarget: 'side',
                                            allowBlank: false,
                                            enableKeyEvents: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    margin: '10 0 0 0',
                                    items: [
                                        {
                                            xtype: 'textareafield',
                                            itemId: 'txtApplDecReasonAD',
                                            width: 600,
                                            fieldLabel: 'निर्णय विवरण',
                                            labelWidth: 130,
                                            enableKeyEvents: true
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'cntAppealDecision',
                            margin: '5 0 0 5',
                            width: 976,
                            items: [
                                {
                                    xtype: 'gridpanel',
                                    height: 175,
                                    id: 'grdAppealDecision',
                                    itemId: 'grdAppealDecision',
                                    width: 786,
                                    title: 'कर अवधि',
                                    store: 'ACLines',
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'OffCode',
                                            text: 'OffCode'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'AppealNo',
                                            text: 'AppealNo'
                                        },
                                        {
                                            xtype: 'rownumberer',
                                            width: 40,
                                            dataIndex: 'SeqNo',
                                            text: 'क्र.सं.'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'TaxYear',
                                            text: 'बर्ष'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 110,
                                            dataIndex: 'FilePer',
                                            text: 'मा / चौ / द्वै',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cboFillingPeriodAD',
                                                readOnly: true,
                                                displayField: 'FilPeriodDesc',
                                                queryMode: 'local',
                                                store: 'FilingPeriodStore',
                                                valueField: 'FilPeriod'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'AppealDocNo'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'TranDate'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'EffDate'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'Period',
                                            text: 'कर अवधि',
                                            editor: {
                                                xtype: 'combobox',
                                                itemId: 'cboPeriodAD',
                                                readOnly: true,
                                                displayField: 'PeriodDesc',
                                                queryMode: 'local',
                                                store: 'Period',
                                                valueField: 'Period'
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 180,
                                            dataIndex: 'AppealOn',
                                            text: 'पुनरावेदन गएको  विषय <br/> कर / जरिवाना / थप  दस्तुर / ब्याज'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 120,
                                            dataIndex: 'Amount',
                                            text: 'पुनरावेदन गरिएको रकम'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 132,
                                            dataIndex: 'AmountRetained',
                                            text: 'निर्णय ठहर गरिएको रकम',
                                            editor: {
                                                xtype: 'textfield',
                                                id: 'amountR',
                                                itemId: 'amountR',
                                                fieldStyle: 'text-align:right',
                                                enableKeyEvents: true,
                                                maskRe: /[0-9]/
                                            }
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            dataIndex: 'UserID'
                                        }
                                    ],
                                    plugins: [
                                        Ext.create('Ext.grid.plugin.RowEditing', {
                                            pluginId: 'grdpluginAD',
                                            listeners: {
                                                validateedit: {
                                                    fn: me.onGridroweditingpluginValidateedit,
                                                    scope: me
                                                },
                                                beforeedit: {
                                                    fn: me.onGridroweditingpluginBeforeEdit,
                                                    scope: me
                                                }
                                            }
                                        })
                                    ]
                                },
                                {
                                    xtype: 'container',
                                    height: 30,
                                    margin: '5 0 0 65',
                                    padding: '0 0 0 418',
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            flex: 1,
                                            id: 'txtAmtRtd',
                                            itemId: 'txtAmtRtd',
                                            maxWidth: 265,
                                            fieldLabel: 'कुल निर्णय ठहर गरिएको रकम  रू. ',
                                            labelWidth: 180,
                                            readOnly: true,
                                            growMax: 300
                                        }
                                    ]
                                },
                                {
                                    xtype: 'hiddenfield',
                                    itemId: 'hdnActionApplDec',
                                    fieldLabel: 'Label'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            height: 25,
                            itemId: 'fCntButtonAD',
                            width: 1000,
                            layout: {
                                align: 'stretch',
                                pack: 'end',
                                type: 'hbox'
                            },
                            fieldLabel: '',
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnSaveVad',
                                    margin: '',
                                    iconCls: 'icon-save',
                                    text: 'Save'
                                },
                                {
                                    xtype: 'splitter'
                                },
                                {
                                    xtype: 'button',
                                    disabled: true,
                                    itemId: 'btnEditVad',
                                    iconCls: 'icon-edit',
                                    text: 'Edit'
                                },
                                {
                                    xtype: 'splitter'
                                },
                                {
                                    xtype: 'button',
                                    disabled: true,
                                    itemId: 'btnDeleteVad',
                                    iconCls: 'icon-delete',
                                    text: 'Delete'
                                },
                                {
                                    xtype: 'splitter'
                                },
                                {
                                    xtype: 'button',
                                    id: 'btnSubmitVad',
                                    itemId: 'btnSubmitVad',
                                    margin: '',
                                    iconCls: 'icon-ok',
                                    text: 'Submit'
                                },
                                {
                                    xtype: 'splitter'
                                },
                                {
                                    xtype: 'button',
                                    id: 'btnCancelVad',
                                    itemId: 'btnCancelVad',
                                    iconCls: 'icon-cancel',
                                    text: 'Cancel'
                                }
                            ]
                        },
                        {
                            xtype: 'fieldcontainer',
                            height: 25,
                            hidden: true,
                            itemId: 'fCntBackAD',
                            width: 1000,
                            layout: {
                                align: 'stretch',
                                pack: 'end',
                                type: 'hbox'
                            },
                            fieldLabel: '',
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'btnBackVad',
                                    margin: '',
                                    iconCls: 'icon-back',
                                    text: 'Back'
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onGridroweditingpluginValidateedit: function(editor, e, eOpts) {

        var amount = Ext.ComponentQuery.query('#grdAppealDecision')[0].getSelectionModel().getSelection()[0].data.Amount;


        var amtRtd=Ext.ComponentQuery.query('#txtAmtRtd')[0];

        var count=0;
        var message="";


        //console.log(editor);
        //console.log(e);


        if(isNaN(editor.context.newValues.AmountRetained)||Number(editor.context.newValues.AmountRetained)===0)
        {
            // console.log(editor.context.newValues.AmountRetained);
            count++;
            message=message+count+") "+" कृपया निर्णय ठहर गरिएको रकम हाल्नुहोस् !<br/>" ;
        }
        else
        {    
            if(Number(editor.context.newValues.AmountRetained)>Number(editor.context.newValues.Amount))
            {
                count++;
                message=message+count+") "+" पुनरावेदन गरिएको रकम भन्दा निर्णय ठहर गरिएको रकम कम हाल्नुहोस् !<br/>" ;
            }
        }

        e.cancel =count>0;
        if(e.cancel)
        {
            Ext.MessageBox.alert('Warning',message);
        }

        var grd=Ext.ComponentQuery.query('#grdAppealDecision')[0];
        var store = grd.getStore();
        //console.log(store);
        var countData=store.data.items.length;
        var totalAR=0;

        for(var i=0;i<countData;i++)
        {
            // console.log(store.data.items[i].data);

            if(editor.context.rowIdx==i)
            {
                totalAR=Number(totalAR)+Number(editor.context.newValues.AmountRetained);
            }
            else
            {
                totalAR=Number(totalAR)+Number(store.data.items[i].data.AmountRetained);
            }

        }

        amtRtd.setValue(totalAR);


        var selectedRow = grd.getSelectionModel();

        var record = grd.getSelectionModel().getSelection()[0];



    },

    onGridroweditingpluginBeforeEdit: function(editor, e, eOpts) {
        var hdnAction=Ext.ComponentQuery.query("#hdnAction")[0];
        var hdnAct=Ext.ComponentQuery.query("#hdnActAD")[0];
        var hdnActApplDec=Ext.ComponentQuery.query("#hdnActionApplDec")[0];
        //console.log("act",hdnActApplDec.lastValue);

        if(hdnAction.lastValue === "T" || hdnAct.lastValue === "F" || hdnActApplDec.lastValue === "D" || hdnActApplDec.lastValue === "V")
        {
            return false;
        }
        else
        {
            return true;
        }

    }

});