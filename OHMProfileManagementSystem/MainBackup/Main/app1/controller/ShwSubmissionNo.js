/*
 * File: app/controller/ShwSubmissionNo.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.ShwSubmissionNo', {
    extend: 'Ext.app.Controller',

    stores: [
        'Sub_No_BusinessType',
        'Show_Sub_PartnerPanList',
        'Sub_No_BusinessSubType'
    ],
    views: [
        'ShwSubmissionNo'
    ],

    onBtnMovePersonaEpanClick: function(button, e, eOpts) {
        var submissionNo=Ext.ComponentQuery.query('#SubmissionNoText')[0].text;
        var count=0;
        var ppanAction="";  // A=add,R=readonly(disable edit)  in PPAN

        var regForr= Ext.ComponentQuery.query('#Show_SubNo_hdnRegFor')[0];                                       
        var comboBusType=Ext.ComponentQuery.query('#Sub_No_BusinessType')[0];
        var panNo=Ext.ComponentQuery.query('#Show_Sub_No_PanNo')[0];  
        var have=Ext.ComponentQuery.query('#havePanY')[0];

        var val=regForr.value;
        var regFor=val;
        var  uiConfig ={}; 

        var businessTyp=Ext.ComponentQuery.query('#Sub_No_BusinessType')[0].getValue();
        var businessSubTyp=Ext.ComponentQuery.query('#Sub_No_BusinessubType')[0].getValue();

        if(val==1)  //PPAN
        {        
            ppanAction="A";
            uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
            DynamicUI(uiConfig,function(){    

                if(uiConfig.menuLink==='PersonRegistration')// if(ppanAction!=='')
                {
                    Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue('');
                    var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                
                    PPANRegNext.hide();
                    Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);
                }
            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
            }
            else if(val==2)  //ITAX
            {
                if(comboBusType.getValue()=="I" && have.checked)
                {
                    uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                    if(panNo.getValue()==="")
                    {
                        msg('WARNING',"PAN missing.");
                        return;
                    }
                    else{
                        //---
                        Ext.Ajax.request({
                            url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                            params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'30'},        
                            success: function(response){

                                var JSONResponse=Ext.decode(response.responseText);            
                                if(JSONResponse.success=='true')
                                {     
                                    if(JSONResponse.message)
                                    {
                                        msg('WARNING',JSONResponse.message);
                                        return;
                                    } 
                                    else
                                    {
                                        /////
                                        Ext.Ajax.request({
                                            url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                            params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                            success: function(ajxResp){
                                                var rsp=Ext.decode(ajxResp.responseText);            
                                                if(rsp.success=='true'||rsp.success=='True')
                                                {    
                                                    var taxxInfo={SubmissionNo:submissionNo,TaxpayerType:businessSubTyp,TaxpayerCategoryID:businessTyp,Action:'A'};
                                                    Ext.Ajax.request({
                                                        url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx?method=SaveTaxpayerInfo',
                                                        params: {                
                                                            taxpayerInfo:JSON.stringify( taxxInfo)
                                                        },
                                                        success: function(response){
                                                            var text = response.responseText;
                                                            var resp=Ext.decode(text);  
                                                            console.log(resp);
                                                            if(resp.success=='True'||resp.success=='true')
                                                            {                                                             
                                                                //*****
                                                                ppanAction="R";
                                                                DynamicUI(uiConfig,function(){                        
                                                                    Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                                    var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                                    PPANRegNext.show(); 
                                                                    PPANRegNext.enable(); 
                                                                    Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);
                                                                },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor,pan: panNo.getValue()});                                    
                                                                    //******                                                  
                                                                }
                                                                else
                                                                {
                                                                    msg("FAILURE","Taxpayer Information Saving Failed.");
                                                                }
                                                            },
                                                            failure: function ( result, request ) {
                                                                msg("FAILURE","Taxpayer Information Saving Failed.");        
                                                            }
                                                        });   

                                                    }
                                                    else
                                                    {
                                                        msg('WARNING',"Could Not Set PAN");
                                                        return;
                                                    }

                                                },
                                                failure:function(response){
                                                    msg('WARNING',"Could Not Set PAN");
                                                    return;
                                                }
                                            });
                                            /////                    
                                        } 
                                    }
                                    else
                                    {            
                                        msg('WARNING', "Error occured while Validating PAN");
                                        return;
                                    }
                                },
                                failure:function(response)
                                {           
                                    if(waitSave)
                                    {
                                        waitSave.hide();
                                    }
                                    msg('WARNING', "Error occured while Validating PAN");
                                    return;
                                }
                            });
                        }
                        //--- 
                    }
                    else if(comboBusType.getValue()=="I" && !have.checked)
                    {
                        uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                        ppanAction="A";
                        DynamicUI(uiConfig,function(){                        
                            Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                            var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                            PPANRegNext.show();                                                       
                            Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);

                        },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
                        }
                        else
                        {
                            uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                            ppanAction="A";
                            DynamicUI(uiConfig,function(){            
                                Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue('');
                                var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                Bus_Reg_Next.hide();
                                Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});

                            }
                        }
                        else if(val==3)  //VAT
                        {
                            //ask for pan (validate against CTB_Registration with params:pan and acctype=='10')
                            // if valid redirect to business registration
                            // else alert invalid pan

                            if(panNo.getValue()==="")
                            {
                                msg('WARNING',"PAN missing");
                                return;
                            }
                            else
                            {
                                Ext.Ajax.request({
                                    url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                                    params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'10'},        
                                    success: function(response){

                                        var JSONResponse=Ext.decode(response.responseText);            
                                        if(JSONResponse.success=='true')
                                        {     
                                            if(JSONResponse.message)
                                            {
                                                msg('WARNING',JSONResponse.message);
                                                return;
                                            } 
                                            else
                                            {
                                                /////
                                                Ext.Ajax.request({
                                                    url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                                    params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                                    success: function(ajxResp){
                                                        var rsp=Ext.decode(ajxResp.responseText);            
                                                        if(rsp.success=='true'||rsp.success=='True')
                                                        {     
                                                            uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                                                            ppanAction="R";
                                                            DynamicUI(uiConfig,function(){            
                                                                Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue(val);
                                                                var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                                                Bus_Reg_Next.show();
                                                                Bus_Reg_Next.enable();
                                                                Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                                                            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});                                    
                                                            }
                                                            else
                                                            {
                                                                msg('WARNING',"Could Not Set PAN");
                                                                return;
                                                            }
                                                        },
                                                        failure:function(response){
                                                            msg('WARNING',"Could Not Set PAN");
                                                            return;
                                                        }
                                                    });
                                                    /////                    
                                                } 
                                            }
                                            else
                                            {            
                                                msg('WARNING', "Error occured while Validating PAN");
                                                return;
                                            }
                                        },
                                        failure:function(response)
                                        {           
                                            if(waitSave)
                                            {
                                                waitSave.hide();
                                            }
                                            msg('WARNING', "Error occured while Validating PAN");
                                            return;
                                        }
                                    });
                                } 

                            }
                            else if(val==4)  //EXCISE
                            {
                                //ask for pan (validate against CTB_Registration with params:pan and acctype=='10')
                                // if valid redirect to business registration
                                // else alert invalid pan
                                if(panNo.getValue()==="")
                                {
                                    msg('WARNING',"PAN missing.");
                                    return;
                                }
                                else
                                {
                                    Ext.Ajax.request({
                                        url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                                        params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'10'},        
                                        success: function(response){

                                            var JSONResponse=Ext.decode(response.responseText);            
                                            if(JSONResponse.success=='true')
                                            {     
                                                if(JSONResponse.message)
                                                {
                                                    msg('WARNING',JSONResponse.message);
                                                    return;
                                                } 
                                                else
                                                {
                                                    /////
                                                    Ext.Ajax.request({
                                                        url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                                        params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                                        success: function(ajxResp){
                                                            var rsp=Ext.decode(ajxResp.responseText);            
                                                            if(rsp.success=='true'||rsp.success=='True')
                                                            {     
                                                                uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                                                                ppanAction="R";
                                                                DynamicUI(uiConfig,function(){            
                                                                    Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue(val);
                                                                    var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                                                    Bus_Reg_Next.show();
                                                                    Bus_Reg_Next.enable();
                                                                    Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                                                                },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});                                   
                                                                }
                                                                else
                                                                {
                                                                    msg('WARNING',"Could Not Set PAN");
                                                                    return;
                                                                }
                                                            },
                                                            failure:function(response){
                                                                msg('WARNING',"Could Not Set PAN");
                                                                return;
                                                            }
                                                        });
                                                        /////                    
                                                    } 
                                                }
                                                else
                                                {            
                                                    msg('WARNING', "Error occured while Validating PAN");
                                                    return;
                                                }
                                            },
                                            failure:function(response)
                                            {           
                                                if(waitSave)
                                                {
                                                    waitSave.hide();
                                                }
                                                msg('WARNING', "Error occured while Validating PAN");
                                                return;
                                            }
                                        });

                                    } 
                                }
                                else if(val==5)  //ITAX,VAT,EXCISE
                                {
                                    if(comboBusType.getValue()=="I" && have.checked)
                                    {
                                        uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                                        if(panNo.getValue()==="")
                                        {
                                            msg('WARNING',"PAN missing.");
                                            return;
                                        }
                                        else
                                        {
                                            Ext.Ajax.request({
                                                url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                                                params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'30'},        
                                                success: function(response){

                                                    var JSONResponse=Ext.decode(response.responseText);            
                                                    if(JSONResponse.success=='true')
                                                    {     
                                                        if(JSONResponse.message)
                                                        {
                                                            msg('WARNING',JSONResponse.message);
                                                            return;
                                                        } 
                                                        else
                                                        {
                                                            /////
                                                            Ext.Ajax.request({
                                                                url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                                                params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                                                success: function(ajxResp){
                                                                    var rsp=Ext.decode(ajxResp.responseText);            
                                                                    if(rsp.success=='true'||rsp.success=='True')
                                                                    {     
                                                                        ppanAction="R";
                                                                        DynamicUI(uiConfig,function(){                        
                                                                            Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                                            var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                                            PPANRegNext.show();
                                                                            PPANRegNext.enable();
                                                                            Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);

                                                                        },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});                                    
                                                                        }
                                                                        else
                                                                        {
                                                                            msg('WARNING',"Could Not Set PAN");
                                                                            return;
                                                                        }
                                                                    },
                                                                    failure:function(response){
                                                                        msg('WARNING',"Could Not Set PAN");
                                                                        return;
                                                                    }
                                                                });
                                                                /////                    
                                                            } 
                                                        }
                                                        else
                                                        {            
                                                            msg('WARNING', "Error occured while Validating PAN");
                                                            return;
                                                        }
                                                    },
                                                    failure:function(response)
                                                    {           
                                                        if(waitSave)
                                                        {
                                                            waitSave.hide();
                                                        }
                                                        msg('WARNING', "Error occured while Validating PAN");
                                                        return;
                                                    }
                                                });

                                            } 
                                        }
                                        else if(comboBusType.getValue()=="I" && !have.checked)
                                        {
                                            uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                                            ppanAction="A";
                                            DynamicUI(uiConfig,function(){                        
                                                Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                PPANRegNext.show();                                                       
                                                Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);

                                            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
                                            }
                                            else
                                            {
                                                uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                                                ppanAction="A";
                                                DynamicUI(uiConfig,function(){            
                                                    Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue(val);
                                                    var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                                    Bus_Reg_Next.show();
                                                    Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                                                },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});

                                                }
                                            }
                                            else if(val==6)  //ITAX,VAT
                                            {
                                                if(comboBusType.getValue()=="I" && have.checked)
                                                {
                                                    uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                                                    if(panNo.getValue()==="")
                                                    {
                                                        msg('WARNING',"PAN missing.");
                                                        return;
                                                    }
                                                    else
                                                    {

                                                        Ext.Ajax.request({
                                                            url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                                                            params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'30'},        
                                                            success: function(response){

                                                                var JSONResponse=Ext.decode(response.responseText);            
                                                                if(JSONResponse.success=='true')
                                                                {     
                                                                    if(JSONResponse.message)
                                                                    {
                                                                        msg('WARNING',JSONResponse.message);
                                                                        return;
                                                                    } 
                                                                    else
                                                                    {
                                                                        /////
                                                                        Ext.Ajax.request({
                                                                            url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                                                            params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                                                            success: function(ajxResp){
                                                                                var rsp=Ext.decode(ajxResp.responseText);            
                                                                                if(rsp.success=='true'||rsp.success=='True')
                                                                                {     
                                                                                    var taxxpInfo={SubmissionNo:submissionNo,TaxpayerType:businessSubTyp,TaxpayerCategoryID:businessTyp,Action:'A'};
                                                                                    Ext.Ajax.request({
                                                                                        url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx?method=SaveTaxpayerInfo',
                                                                                        params: {                
                                                                                            taxpayerInfo:JSON.stringify( taxxpInfo)
                                                                                        },
                                                                                        success: function(response){
                                                                                            var text = response.responseText;
                                                                                            var resp=Ext.decode(text);  
                                                                                            console.log(resp);
                                                                                            if(resp.success=='True'||resp.success=='true')
                                                                                            {                                                             
                                                                                                //*****
                                                                                                ppanAction="R";
                                                                                                DynamicUI(uiConfig,function(){                        
                                                                                                    Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                                                                    var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                                                                    PPANRegNext.show(); 
                                                                                                    PPANRegNext.enable(); 
                                                                                                    Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);
                                                                                                },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor,pan: panNo.getValue()});                                    
                                                                                                    //******                                                  
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    msg("FAILURE","Taxpayer Information Saving Failed.");
                                                                                                }
                                                                                            },
                                                                                            failure: function ( result, request ) {
                                                                                                msg("FAILURE","Taxpayer Information Saving Failed.");        
                                                                                            }
                                                                                        });   
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        msg('WARNING',"Could Not Set PAN");
                                                                                        return;
                                                                                    }
                                                                                },
                                                                                failure:function(response){
                                                                                    msg('WARNING',"Could Not Set PAN");
                                                                                    return;
                                                                                }
                                                                            });
                                                                            /////                    
                                                                        } 
                                                                    }
                                                                    else
                                                                    {            
                                                                        msg('WARNING', "Error occured while Validating PAN");
                                                                        return;
                                                                    }
                                                                },
                                                                failure:function(response)
                                                                {           
                                                                    if(waitSave)
                                                                    {
                                                                        waitSave.hide();
                                                                    }
                                                                    msg('WARNING', "Error occured while Validating PAN");
                                                                    return;
                                                                }
                                                            });

                                                        } 
                                                    }
                                                    else if(comboBusType.getValue()=="I" && !have.checked)
                                                    {
                                                        uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                                                        ppanAction="A";
                                                        DynamicUI(uiConfig,function(){                        
                                                            Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                            var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                            PPANRegNext.show();                                                       
                                                            Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);

                                                        },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
                                                        }
                                                        else
                                                        {
                                                            uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                                                            ppanAction="A";
                                                            DynamicUI(uiConfig,function(){            
                                                                Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue(val);
                                                                var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                                                Bus_Reg_Next.show();
                                                                Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                                                            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
                                                            }
                                                        }
                                                        else if(val==7)  //VAT,EXCISE
                                                        {
                                                            if(panNo.getValue()==="")
                                                            {
                                                                msg('WARNING',"PAN missing.");
                                                                return;
                                                            }
                                                            else
                                                            {

                                                                Ext.Ajax.request({
                                                                    url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                                                                    params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'10'},        
                                                                    success: function(response){

                                                                        var JSONResponse=Ext.decode(response.responseText);            
                                                                        if(JSONResponse.success=='true')
                                                                        {     
                                                                            if(JSONResponse.message)
                                                                            {
                                                                                msg('WARNING',JSONResponse.message);
                                                                                return;
                                                                            } 
                                                                            else
                                                                            {
                                                                                /////
                                                                                Ext.Ajax.request({
                                                                                    url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                                                                    params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                                                                    success: function(ajxResp){
                                                                                        var rsp=Ext.decode(ajxResp.responseText);            
                                                                                        if(rsp.success=='true'||rsp.success=='True')
                                                                                        {     
                                                                                            uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                                                                                            ppanAction="R";
                                                                                            DynamicUI(uiConfig,function(){            
                                                                                                Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue(val);
                                                                                                var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                                                                                Bus_Reg_Next.show();
                                                                                                Bus_Reg_Next.enable();
                                                                                                Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                                                                                            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});                                   
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                msg('WARNING',"Could Not Set PAN");
                                                                                                return;
                                                                                            }
                                                                                        },
                                                                                        failure:function(response){
                                                                                            msg('WARNING',"Could Not Set PAN");
                                                                                            return;
                                                                                        }
                                                                                    });
                                                                                    /////                    
                                                                                } 
                                                                            }
                                                                            else
                                                                            {            
                                                                                msg('WARNING', "Error occured while Validating PAN");
                                                                                return;
                                                                            }
                                                                        },
                                                                        failure:function(response)
                                                                        {           
                                                                            if(waitSave)
                                                                            {
                                                                                waitSave.hide();
                                                                            }
                                                                            msg('WARNING', "Error occured while Validating PAN");
                                                                            return;
                                                                        }
                                                                    });

                                                                } 
                                                            }
                                                            else if(val==8)  //IT,EXCISE
                                                            {
                                                                if(comboBusType.getValue()=="I" && have.checked)
                                                                {
                                                                    uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                                                                    if(panNo.getValue()==="")
                                                                    {
                                                                        msg('WARNING',"PAN missing.");
                                                                        return;
                                                                    }
                                                                    else
                                                                    {
                                                                        Ext.Ajax.request({
                                                                            url: '../Handlers/Registration/Taxpayer/TaxpayerHandler.ashx',
                                                                            params: {method:'ValidatePan',pan: panNo.getValue(),accountType:'30'},        
                                                                            success: function(response){

                                                                                var JSONResponse=Ext.decode(response.responseText);            
                                                                                if(JSONResponse.success=='true')
                                                                                {     
                                                                                    if(JSONResponse.message)
                                                                                    {
                                                                                        msg('WARNING',JSONResponse.message);
                                                                                        return;
                                                                                    } 
                                                                                    else
                                                                                    {
                                                                                        /////
                                                                                        Ext.Ajax.request({
                                                                                            url: '../Handlers/Registration/Taxpayer/TaxpayerInfoHandler.ashx',
                                                                                            params: {method:'SetPan',subNo: submissionNo,pan:panNo.getValue()},                         
                                                                                            success: function(ajxResp){
                                                                                                var rsp=Ext.decode(ajxResp.responseText);            
                                                                                                if(rsp.success=='true'||rsp.success=='True')
                                                                                                {     
                                                                                                    ppanAction="R";
                                                                                                    DynamicUI(uiConfig,function(){                        
                                                                                                        Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                                                                        var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                                                                        PPANRegNext.show();
                                                                                                        PPANRegNext.enable();
                                                                                                        Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);

                                                                                                    },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});                                    
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        msg('WARNING',"Could Not Set PAN");
                                                                                                        return;
                                                                                                    }
                                                                                                },
                                                                                                failure:function(response){
                                                                                                    msg('WARNING',"Could Not Set PAN");
                                                                                                    return;
                                                                                                }
                                                                                            });
                                                                                            /////                    
                                                                                        } 
                                                                                    }
                                                                                    else
                                                                                    {            
                                                                                        msg('WARNING', "Error occured while Validating PAN");
                                                                                        return;
                                                                                    }
                                                                                },
                                                                                failure:function(response)
                                                                                {           
                                                                                    if(waitSave)
                                                                                    {
                                                                                        waitSave.hide();
                                                                                    }
                                                                                    msg('WARNING', "Error occured while Validating PAN");
                                                                                    return;
                                                                                }
                                                                            });

                                                                        } 
                                                                    }
                                                                    else if(comboBusType.getValue()=="I" && !have.checked)
                                                                    {
                                                                        uiConfig = {menuLink:'PersonRegistration',pageTitle:'Person Registration'};
                                                                        ppanAction="A";
                                                                        DynamicUI(uiConfig,function(){                        
                                                                            Ext.ComponentQuery.query('#PPAN_RedirectURL')[0].setValue(val);
                                                                            var PPANRegNext=Ext.ComponentQuery.query('#PPAN_Reg_Next')[0];                            
                                                                            PPANRegNext.show();                                                       
                                                                            Ext.ComponentQuery.query('#PersonalPanAction')[0].setValue(ppanAction);

                                                                        },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
                                                                        }
                                                                        else
                                                                        {
                                                                            uiConfig = {menuLink:'BusinessRegistration',pageTitle:'Business Registration'};
                                                                            ppanAction="A";
                                                                            DynamicUI(uiConfig,function(){            
                                                                                Ext.ComponentQuery.query('#Bus_Reg_RedirectURL')[0].setValue(val);
                                                                                var Bus_Reg_Next=Ext.ComponentQuery.query('#Bus_Reg_Next')[0];                
                                                                                Bus_Reg_Next.show();
                                                                                Ext.ComponentQuery.query('#Bus_Reg_PanAction')[0].setValue(ppanAction);            
                                                                            },{subNo:submissionNo,busTyp:businessTyp,busSubTyp:businessSubTyp,regFor:regFor});
                                                                            }
                                                                        }

    },

    onSub_No_BusinessTypeChange: function(field, newValue, oldValue, eOpts) {
        Ext.ComponentQuery.query('#Sub_No_BusinessubType')[0].setValue('');
        var busType=Ext.ComponentQuery.query('#Sub_No_BusinessType')[0].getValue();
        var havePan=Ext.ComponentQuery.query('#Show_Sub_No_HavePan')[0];
        var panNo=Ext.ComponentQuery.query('#Show_Sub_No_PanNo')[0];
        var have=Ext.ComponentQuery.query('#havePanY')[0];
        var partnerPan=Ext.ComponentQuery.query('#Show_Sub_PartnerPan')[0];
        var btnAddPan=Ext.ComponentQuery.query('#Show_Sub_AddPan')[0];
        var grdPanList=Ext.ComponentQuery.query('#Show_Sub_PanList')[0];


        var store=Ext.getStore('Sub_No_BusinessSubType');
        store.removeAll();
        Ext.Ajax.request({
            url: '../Handlers/Common/TaxPayerTypeHandler.ashx?Method=LoadTaxPayerType',
            params:{tpCat:busType},
            success: function ( result, request ) {
                var data = Ext.decode(result.responseText); 
                if(data.root)
                {   
                    store.loadData(data.root);           
                }
            },
            failure: function ( result, request ) {
                statuBar.close();
                Ext.Msg.show({
                    title: 'Failure',
                    msg: 'ERROR OCURRED !!!' ,
                    buttons: Ext.MessageBox.OK,
                    icon:Ext.Msg.ERROR
                });
            }

        });

        if(busType=="I")
        {

            havePan.show();
            have.setValue(false);
            panNo.hide();
            panNo.setValue('');

            partnerPan.setValue('');
            partnerPan.hide();
            btnAddPan.hide();
            grdPanList.hide();
        }
        else if(busType=="B")
        {
            havePan.hide();
            panNo.hide();
            partnerPan.setValue('');
            partnerPan.hide();
            btnAddPan.hide();
            grdPanList.hide();
        }
        else
        {
            havePan.hide();
            panNo.hide();
            partnerPan.setValue('');
            partnerPan.show();
            btnAddPan.show();
            grdPanList.show();
        }
    },

    onShow_Sub_No_HavePanChange: function(field, newValue, oldValue, eOpts) {
        var panNo=Ext.ComponentQuery.query('#Show_Sub_No_PanNo')[0];
        var have=Ext.ComponentQuery.query('#havePanY')[0];

        if(have.checked===true)
        {   
            panNo.show();
            panNo.setValue('');
        }
        else
        {
            panNo.hide();
        }
    },

    onShow_Sub_AddPanClick: function(button, e, eOpts) {
        var pan=Ext.ComponentQuery.query('#Show_Sub_PartnerPan')[0];
        var store=Ext.ComponentQuery.query('#Show_Sub_PanList')[0].getStore();
        //console.log(store);
        store.add({PanNo:pan.value});
        pan.setValue('');
    },

    init: function(application) {
        this.control({
            "#btnMovePersonaEpan": {
                click: this.onBtnMovePersonaEpanClick
            },
            "#Sub_No_BusinessType": {
                change: this.onSub_No_BusinessTypeChange
            },
            "#Show_Sub_No_HavePan": {
                change: this.onShow_Sub_No_HavePanChange
            },
            "#Show_Sub_AddPan": {
                click: this.onShow_Sub_AddPanClick
            }
        });
    }

});
